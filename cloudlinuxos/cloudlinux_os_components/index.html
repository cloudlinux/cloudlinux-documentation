<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.61">
    <script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/5408110.js"></script><script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T538N4K');
    </script><script>
    (function() {
    var routes = {"/?compatiblity_matrix.html":"/cloudlinuxos/limits/#compatibility-matrix","/cloudlinux_os_components/#installation-5":"/cloudlinuxos/cloudlinux_os_components/#installation-and-update-5","/cloudlinux_os_components/#installation-and-update-2":"/cloudlinuxos/cloudlinux_os_components/#installation-and-update-1","/?cagefs_installation.html":"/cloudlinuxos/cloudlinux_os_components/#installation-and-update-1","/mysql_governor.html":"/cloudlinuxos/cloudlinux_os_components/#mysql-governor","?backing_up_mysql.html":"/cloudlinuxos/cloudlinux_os_components/#backing-up-mysql","/mod_lsapi_troubleshooting.html":"/cloudlinuxos/cloudlinux_os_components/#troubleshooting-3","/cloudlinux_installation/#registering-cloudlinux-server":"/cloudlinuxos/cloudlinux_installation/#license-activation","/apache_mod_lsapi.html":"/cloudlinuxos/cloudlinux_os_components/#apache-mod-lsapi-pro","/cagefs.html":"/cloudlinuxos/cloudlinux_os_components/#cagefs","/change_mysql_version.html":"/cloudlinuxos/cloudlinux_os_components/#change-mysql-version","/cldiag.html":"/cloudlinuxos/command-line_tools/#cldiag","/custom_php_ini_options.html":"/cloudlinuxos/cloudlinux_os_components/#custom-php-ini-options","?apache_mod_lsapi.html":"/cloudlinuxos/cloudlinux_os_components/#apache-mod-lsapi-pro","?custom_php_ini_options.html":"/cloudlinuxos/cloudlinux_os_components/#custom-php-ini-options","?hybrid_kernel.html":"/cloudlinuxos/cloudlinux_os_kernel/#hybrid-kernels","?installation.html":"/cloudlinuxos/cloudlinux_installation/","?link_traversal_protection.html":"/cloudlinuxos/cloudlinux_os_kernel/#securelinks-and-link-traversal-protection","?lve_limits_with_packages.html":"/cloudlinuxos/lve_manager/#packages","?lve_pam_module.html":"/cloudlinuxos/cloudlinux_os_components/#lve-pam-module","?php_selector_installation.html":"/cloudlinuxos/cloudlinux_os_components/#installation-and-update-3","?virtuozzo_and_openvz.html":"/cloudlinuxos/cloudlinux_installation/#virtuozzo-and-openvz","/installation-wizard.html":"/cloudlinuxos/lve_manager/#installation-wizard","/lve-limits-validation.html":"/cloudlinuxos/limits/#limits-validation","/mysql_governor_installation.html":"/cloudlinuxos/cloudlinux_os_components/#installation-and-update-2","/node_js_selector.html":"/cloudlinuxos/cloudlinux_os_components/#node-js-selector","/php_selector.html":"/cloudlinuxos/cloudlinux_os_components/#php-selector","/php_selector_installation.html":"/cloudlinuxos/cloudlinux_os_components/#installation-and-update-3","/python_and_ruby_selector.html":"/cloudlinuxos/cloudlinux_os_components/#python-selector","/reseller_limits.html":"/cloudlinuxos/limits/#reseller-limits","/cloudlinux-os-plus/#x-ray-autotracing":"/cloudlinuxos/shared-pro/#x-ray-autotracing","/cloudlinux_installation/#activation":"/cloudlinuxos/cloudlinux_installation/#license-activation","/cloudlinux_installation/#converting-existing-servers":"/cloudlinuxos/cloudlinux_installation/#converting-existing-servers","/cloudlinux_installation/#known-restrictions-and-issues":"/cloudlinuxos/cloudlinux_installation/#known-restrictions-and-issues","/cloudlinux_installation/#uninstalling":"/cloudlinuxos/cloudlinux_installation/#uninstalling","/cloudlinux_os_components/#customize-lve-stats2-notifications":"/cloudlinuxos/cloudlinux_os_components/#customize-lve-stats2-notifications","/cloudlinux_os_components/#installation-enabling-and-disabling":"/cloudlinuxos/command-line_tools/#cagefs","/cloudlinux_os_components/#php-selector":"/cloudlinuxos/cloudlinux_os_components/#php-selector","/cloudlinux_os_components/#node-js-selector":"/cloudlinuxos/cloudlinux_os_components/#node-js-selector","/lve_manager/#node-js-selector-2":"/cloudlinuxos/lve_manager/#node-js-selector","/cloudlinux-os-plus/#faq-2":"/cloudlinuxos/shared-pro/#faq-2","/cloudlinux-os-plus/#installation-2":"/cloudlinuxos/shared-pro/#installation-1","/cloudlinux-os-plus/#i-started-a-tracing-task-and-made-requests-to-url-but-did-not-see-any-results-in-the-ui-what-should-i-do":"/cloudlinuxos/shared-pro/#i-started-a-tracing-task-and-made-requests-to-url-but-did-not-see-any-results-in-the-ui-what-should-i-do","/control_panel_integration/#mysql-governor":"/cloudlinuxos/control_panel_integration/#mysql-governor","/control_panel_integration/#the-list-of-the-integration-scripts":"/cloudlinuxos/control_panel_integration/#the-list-of-the-integration-scripts","/ffmpeg":"/cloudlinuxos/cloudlinux_os_components/#ffmpeg","/limits/#limits-validation":"/cloudlinuxos/limits/#limits-validation","/php_selector/#litespeed-support":"/cloudlinuxos/cloudlinux_os_components/#litespeed-support","/python_selector":"/cloudlinuxos/cloudlinux_os_components/#python-selector","/python_selector/#installation":"/cloudlinuxos/cloudlinux_os_components/#installation-1","/user-docs/user-docs-shared-cloudlinux/#acceleratewp":"/user-docs/user-docs-shared-pro-cloudlinux/#acceleratewp","/cloudlinux-os-plus":"/cloudlinuxos/shared-pro/","/cloudlinuxos":"/cloudlinuxos/cloudlinux_installation/#installation","/shared":"/cloudlinuxos/","/shared-pro/accelerate-wp/#set-upgrade-url-for-cdn":"/cloudlinuxos/shared-pro/#set-upgrade-url-for-cdn","/shared-pro/":"/cloudlinuxos/shared-pro/","/cloudlinuxos-pro/introduction/":"/cloudlinuxos/shared-pro/#introduction","/shared-pro/accelerate-wp":"/cloudlinuxos/shared-pro/#acceleratewp","/cloudlinuxos/shared-pro/accelerate-wp/":"/cloudlinuxos/shared-pro/#acceleratewp","/solo/introduction/":"/introduction/solo/","/solo/activation/":"/introduction/solo/#license-activation","/solo/faq/":"/introduction/solo/#faq","/admin/description/":"/introduction/admin/","/admin/installation/":"/introduction/admin/#licensing","/admin/components/":"/introduction/admin/#components","/admin/faq/":"/introduction/admin/#faq","/introduction/":"/introduction/cloudlinux-os-editions/","/introduction/#cloudlinux-os-life-cycle":"/introduction/cloudlinux-os-editions/#cloudlinux-os-life-cycle","/introduction/#cloudlinux-9":"/cloudlinuxos/cloudlinux_installation/#requirements","/cloudlinuxos/apache2nginx/":"/cloudlinuxos/max_webserver/","/shared-pro/x-ray":"/cloudlinuxos/shared-pro/#x-ray","/cloudlinuxos/alt-ea_packages/#alt-php":"https://docs.tuxcare.com/els-for-languages/php/","/cloudlinuxos/alt-ea_packages/#about-alt-php":"https://docs.tuxcare.com/els-for-languages/php/#about-alt-php","/cloudlinuxos/alt-ea_packages/#a-list-of-alt-php-versions-that-we-support-for-different-operating-systems":"https://docs.tuxcare.com/els-for-languages/php/#supported-os-and-php-versions","/cloudlinuxos/alt-ea_packages/#_1-cloudlinux":"https://docs.tuxcare.com/els-for-languages/php/#supported-os-and-php-versions","/cloudlinuxos/alt-ea_packages/#_2-debian":"https://docs.tuxcare.com/els-for-languages/php/#supported-os-and-php-versions","/cloudlinuxos/alt-ea_packages/#_3-ubuntu":"https://docs.tuxcare.com/els-for-languages/php/#supported-os-and-php-versions","/cloudlinuxos/alt-ea_packages/#bundled-php-extensions":"https://docs.tuxcare.com/els-for-languages/php/#php-extensions-list","/cloudlinuxos/alt-ea_packages/#list-of-extensions-supported-by-the-alt-ea-team-for-each-version-of-php":"https://docs.tuxcare.com/els-for-languages/php/#php-extensions-list","/cloudlinuxos/alt-ea_packages/#php-5-2-extensions":"https://docs.tuxcare.com/els-for-languages/php/#PHP_5.2_extensions","/cloudlinuxos/alt-ea_packages/#php-5-3-extensions":"https://docs.tuxcare.com/els-for-languages/php/#PHP_5.3_extensions","/cloudlinuxos/alt-ea_packages/#php-5-4-extensions":"https://docs.tuxcare.com/els-for-languages/php/#PHP_5.4_extensions","/cloudlinuxos/alt-ea_packages/#php-5-5-extensions":"https://docs.tuxcare.com/els-for-languages/php/#PHP_5.5_extensions","/cloudlinuxos/alt-ea_packages/#php-5-6-extensions":"https://docs.tuxcare.com/els-for-languages/php/#PHP_5.6_extensions","/cloudlinuxos/alt-ea_packages/#php-7-0-extensions":"https://docs.tuxcare.com/els-for-languages/php/#PHP_7.0_extensions","/cloudlinuxos/alt-ea_packages/#php-7-1-extensions":"https://docs.tuxcare.com/els-for-languages/php/#PHP_7.1_extensions","/cloudlinuxos/alt-ea_packages/#php-7-2-extensions":"https://docs.tuxcare.com/els-for-languages/php/#PHP_7.2_extensions","/cloudlinuxos/alt-ea_packages/#php-7-3-extensions":"https://docs.tuxcare.com/els-for-languages/php/#PHP_7.3_extensions","/cloudlinuxos/alt-ea_packages/#php-7-4-extensions":"https://docs.tuxcare.com/els-for-languages/php/#PHP_7.4_extensions","/cloudlinuxos/alt-ea_packages/#php-8-0-extensions":"https://docs.tuxcare.com/els-for-languages/php/#PHP_8.0_extensions","/cloudlinuxos/alt-ea_packages/#php-8-1-extensions":"https://docs.tuxcare.com/els-for-languages/php/#PHP_8.1_extensions","/cloudlinuxos/alt-ea_packages/#php-8-2-extensions":"https://docs.tuxcare.com/els-for-languages/php/#PHP_8.2_extensions","/cloudlinuxos/alt-ea_packages/#php-8-3-extensions":"https://docs.tuxcare.com/els-for-languages/php/#PHP_8.3_extensions","/cloudlinuxos/alt-ea_packages/#php-8-4-extensions":"https://docs.tuxcare.com/els-for-languages/php/#PHP_8.4_extensions","/cloudlinuxos/alt-ea_packages/#how-do-i-install-alt-php":"https://docs.tuxcare.com/els-for-languages/php/#installation-instructions-for-linux","/cloudlinuxos/alt-ea_packages/#what-commands-should-i-use-to-install-alt-php-on-cloudlinux-and-ubuntu":"https://docs.tuxcare.com/els-for-languages/php/#installation-instructions-for-linux","/cloudlinuxos/alt-ea_packages/#for-centos-rhel-based-systems-using-yum":"https://docs.tuxcare.com/els-for-languages/php/#installation-instructions-for-linux","/cloudlinuxos/alt-ea_packages/#for-debian-based-systems-using-apt-get":"https://docs.tuxcare.com/els-for-languages/php/#installation-instructions-for-linux","/cloudlinuxos/alt-ea_packages/#how-can-i-check-which-versions-of-php-are-already-installed":"https://docs.tuxcare.com/els-for-languages/php/#installation-instructions-for-linux","/cloudlinuxos/alt-ea_packages/#for-centos-rhel":"https://docs.tuxcare.com/els-for-languages/php/#installation-instructions-for-linux","/cloudlinuxos/alt-ea_packages/#for-ubuntu-debian":"https://docs.tuxcare.com/els-for-languages/php/#installation-instructions-for-linux","/cloudlinuxos/alt-ea_packages/#how-do-i-find-out-what-dependencies-alt-packages-have":"https://docs.tuxcare.com/els-for-languages/php/#Find_out_what_dependencies_alt-php_packages_have","/cloudlinuxos/alt-ea_packages/#for-centos-rhel-based-systems-using-yum-1":"https://docs.tuxcare.com/els-for-languages/php/#Find_out_what_dependencies_alt-php_packages_have","/cloudlinuxos/alt-ea_packages/#for-debian-based-systems-using-apt":"https://docs.tuxcare.com/els-for-languages/php/#Find_out_what_dependencies_alt-php_packages_have","/cloudlinuxos/alt-ea_packages/#how-do-i-check-the-current-version-of-alt-php-packages":"https://docs.tuxcare.com/els-for-languages/php/#Check_current_version_of_alt-php_packages","/cloudlinuxos/alt-ea_packages/#for-centos-rhel-using-yum":"https://docs.tuxcare.com/els-for-languages/php/#Check_current_version_of_alt-php_packages","/cloudlinuxos/alt-ea_packages/#for-ubuntu-using-apt":"https://docs.tuxcare.com/els-for-languages/php/#Check_current_version_of_alt-php_packages","/cloudlinuxos/alt-ea_packages/#how-do-i-update-alt-php":"https://docs.tuxcare.com/els-for-languages/php/#Update_alt-php","/cloudlinuxos/alt-ea_packages/#for-centos-rhel-based-systems-using-yum-2":"https://docs.tuxcare.com/els-for-languages/php/#Update_alt-php","/cloudlinuxos/alt-ea_packages/#for-debian-based-systems-using-apt-1":"https://docs.tuxcare.com/els-for-languages/php/#Update_alt-php","/cloudlinuxos/alt-ea_packages/#what-commands-should-i-use-to-search-for-packages-in-repositories":"https://docs.tuxcare.com/els-for-languages/php/#Search_for_packages_in_repositories","/cloudlinuxos/alt-ea_packages/#for-centos-rhel-using-yum-1":"https://docs.tuxcare.com/els-for-languages/php/#Search_for_packages_in_repositories","/cloudlinuxos/alt-ea_packages/#for-ubuntu-using-apt-1":"https://docs.tuxcare.com/els-for-languages/php/#Search_for_packages_in_repositories","/cloudlinuxos/alt-ea_packages/#how-to-use-alt-php":"https://docs.tuxcare.com/els-for-languages/php/#useful-commands-and-usage-of-php-els","/cloudlinuxos/alt-ea_packages/#the-bin-files":"https://docs.tuxcare.com/els-for-languages/php/#The_bin_files","/cloudlinuxos/alt-ea_packages/#modules-and-pecl-extensions":"https://docs.tuxcare.com/els-for-languages/php/#Modules_and_pecl_extensions","/cloudlinuxos/alt-ea_packages/#running-code-on-a-specific-version-through-the-cli":"https://docs.tuxcare.com/els-for-languages/php/#Running_code_on_a_specific_version_through_the_CLI","/cloudlinuxos/alt-ea_packages/#location-of-ini-config-files":"https://docs.tuxcare.com/els-for-languages/php/#Location_of_ini_config_files","/cloudlinuxos/alt-ea_packages/#location-of-default-ini":"https://docs.tuxcare.com/els-for-languages/php/#Location_of_default.ini","/cloudlinuxos/alt-ea_packages/#listing-enabled-modules-on-a-specific-version":"https://docs.tuxcare.com/els-for-languages/php/#Listing_enabled_modules_on_a_specific_version","/cloudlinuxos/alt-ea_packages/#enabling-a-module-through-the-cli":"https://docs.tuxcare.com/els-for-languages/php/#Enabling_a_module","/cloudlinuxos/alt-ea_packages/#additional-configurations-optional":"https://docs.tuxcare.com/els-for-languages/php/#Enabling_a_module","/cloudlinuxos/alt-ea_packages/#enabling-a-module-through-default-ini":"https://docs.tuxcare.com/els-for-languages/php/#Enabling_a_module","/cloudlinuxos/alt-ea_packages/#enabling-a-module-through-the-configuration-files":"https://docs.tuxcare.com/els-for-languages/php/#Enabling_a_module","/cloudlinuxos/alt-ea_packages/#alt-python":"https://docs.tuxcare.com/els-for-languages/python/","/cloudlinuxos/alt-ea_packages/#alt-php-python-ruby-nodejs-end-of-life":"/cloudlinuxos/alt-ea_packages/#alt-python-ruby-nodejs-end-of-life","/cloudlinuxos/alt-ea_packages/#alt-php-eol":"https://docs.tuxcare.com/els-for-languages/php/#End_Of_Life"};
    
    // Function to normalize a URL by removing a trailing slash and leading characters
    function normalizeUrl(url) {
      url = url.endsWith('/') ? url.slice(0, -1) : url;
      url = url.startsWith('/') ? url.slice(1) : url;
      url = url.startsWith('?') ? url.slice(1) : url;
      return url;
    }
  
    var currentPath = window.location.pathname + window.location.search + window.location.hash;
    currentPath = normalizeUrl(currentPath);
  
    for (var route_url in routes) {
      if (normalizeUrl(route_url) === currentPath) {
      window.location.href = routes[route_url];
      break; // Exit the loop after redirecting
      }
    }
    })();
    </script><script>
    (function() {
      // Trigger the scroll event without actually scrolling
      function triggerScrollEvent() {
      const targetElement = window;
      const scrollEvent = new Event('scroll', {
        bubbles: true,
        cancelable: true,
      });
      targetElement.dispatchEvent(scrollEvent);
      }
  
      // Call the triggerScrollEvent and scrollBodyDown functions after the page is fully loaded
      window.addEventListener('load', () => {
      triggerScrollEvent();
      });
    })();
    </script><meta name="google-site-verification" content="5-Q2NFM8YQ1f64j819in5tsqnlwNjQXX6Y0PQzmBEcs"><title>CloudLinux OS components</title><meta name="description" content="">
    <link rel="preload" href="/assets/style-f0588709.css" as="style"><link rel="stylesheet" href="/assets/style-f0588709.css">
    <link rel="modulepreload" href="/assets/app-a6b4ef15.js"><link rel="modulepreload" href="/assets/framework-3c337068.js"><link rel="modulepreload" href="/assets/index.html-b894c995.js"><link rel="modulepreload" href="/assets/index.html-0d0622a3.js"><link rel="prefetch" href="/assets/index.html-3b293775.js" as="script"><link rel="prefetch" href="/assets/index.html-6df021ce.js" as="script"><link rel="prefetch" href="/assets/index.html-311e3c48.js" as="script"><link rel="prefetch" href="/assets/index.html-8784c27b.js" as="script"><link rel="prefetch" href="/assets/index.html-af4402a5.js" as="script"><link rel="prefetch" href="/assets/index.html-5f5b585a.js" as="script"><link rel="prefetch" href="/assets/index.html-ac8928eb.js" as="script"><link rel="prefetch" href="/assets/convert.html-f72b4278.js" as="script"><link rel="prefetch" href="/assets/index.html-81fdb6dc.js" as="script"><link rel="prefetch" href="/assets/index.html-b1035221.js" as="script"><link rel="prefetch" href="/assets/conversion.html-d288c2ad.js" as="script"><link rel="prefetch" href="/assets/index.html-8f2405df.js" as="script"><link rel="prefetch" href="/assets/index.html-8c5ecf17.js" as="script"><link rel="prefetch" href="/assets/index.html-cc8131a7.js" as="script"><link rel="prefetch" href="/assets/index.html-faa1c9ca.js" as="script"><link rel="prefetch" href="/assets/regular.html-3b7030a1.js" as="script"><link rel="prefetch" href="/assets/reseller.html-57f304ce.js" as="script"><link rel="prefetch" href="/assets/index.html-eafa4c34.js" as="script"><link rel="prefetch" href="/assets/index.html-92c4383f.js" as="script"><link rel="prefetch" href="/assets/index.html-b8f45164.js" as="script"><link rel="prefetch" href="/assets/index.html-ec2bd0a3.js" as="script"><link rel="prefetch" href="/assets/index.html-06621422.js" as="script"><link rel="prefetch" href="/assets/index.html-81beb05e.js" as="script"><link rel="prefetch" href="/assets/index.html-70efdd1b.js" as="script"><link rel="prefetch" href="/assets/index.html-0c9e9858.js" as="script"><link rel="prefetch" href="/assets/index.html-0a658867.js" as="script"><link rel="prefetch" href="/assets/index.html-02538020.js" as="script"><link rel="prefetch" href="/assets/index.html-d22fb93e.js" as="script"><link rel="prefetch" href="/assets/index.html-8785f9a0.js" as="script"><link rel="prefetch" href="/assets/index.html-2d6a804d.js" as="script"><link rel="prefetch" href="/assets/index.html-c24106b5.js" as="script"><link rel="prefetch" href="/assets/index.html-7bf33f8f.js" as="script"><link rel="prefetch" href="/assets/index.html-5205b84f.js" as="script"><link rel="prefetch" href="/assets/index.html-cf3e6950.js" as="script"><link rel="prefetch" href="/assets/whmcs_saved.html-44210070.js" as="script"><link rel="prefetch" href="/assets/index.html-d2d8cc40.js" as="script"><link rel="prefetch" href="/assets/index.html-1a901f49.js" as="script"><link rel="prefetch" href="/assets/index.html-d3b8642e.js" as="script"><link rel="prefetch" href="/assets/index.html-fbc392b7.js" as="script"><link rel="prefetch" href="/assets/index.html-78ef7082.js" as="script"><link rel="prefetch" href="/assets/index.html-fac878d6.js" as="script"><link rel="prefetch" href="/assets/index.html-8549ea48.js" as="script"><link rel="prefetch" href="/assets/index.html-781941ff.js" as="script"><link rel="prefetch" href="/assets/index.html-f0fd3107.js" as="script"><link rel="prefetch" href="/assets/index.html-4b035f13.js" as="script"><link rel="prefetch" href="/assets/index.html-63fea01f.js" as="script"><link rel="prefetch" href="/assets/index.html-90053b64.js" as="script"><link rel="prefetch" href="/assets/index.html-32a2b0e0.js" as="script"><link rel="prefetch" href="/assets/index.html-ad9ff012.js" as="script"><link rel="prefetch" href="/assets/index.html-84ce9456.js" as="script"><link rel="prefetch" href="/assets/404.html-e0575d4e.js" as="script"><link rel="prefetch" href="/assets/index.html-50a6386b.js" as="script"><link rel="prefetch" href="/assets/index.html-9b29ae3d.js" as="script"><link rel="prefetch" href="/assets/index.html-602eca20.js" as="script"><link rel="prefetch" href="/assets/index.html-0d5f3de2.js" as="script"><link rel="prefetch" href="/assets/index.html-8794b8e8.js" as="script"><link rel="prefetch" href="/assets/index.html-d8d232db.js" as="script"><link rel="prefetch" href="/assets/index.html-8ee67f93.js" as="script"><link rel="prefetch" href="/assets/convert.html-86cc8830.js" as="script"><link rel="prefetch" href="/assets/index.html-a2aaa807.js" as="script"><link rel="prefetch" href="/assets/index.html-bdce12f3.js" as="script"><link rel="prefetch" href="/assets/conversion.html-7c60028d.js" as="script"><link rel="prefetch" href="/assets/index.html-7eb2a37d.js" as="script"><link rel="prefetch" href="/assets/index.html-2c95b07a.js" as="script"><link rel="prefetch" href="/assets/index.html-95f2f2ec.js" as="script"><link rel="prefetch" href="/assets/index.html-f924a9c4.js" as="script"><link rel="prefetch" href="/assets/regular.html-873b5642.js" as="script"><link rel="prefetch" href="/assets/reseller.html-f369948e.js" as="script"><link rel="prefetch" href="/assets/index.html-4b923025.js" as="script"><link rel="prefetch" href="/assets/index.html-4ccdecc8.js" as="script"><link rel="prefetch" href="/assets/index.html-2f9d9488.js" as="script"><link rel="prefetch" href="/assets/index.html-d3e5c602.js" as="script"><link rel="prefetch" href="/assets/index.html-a95d5b1d.js" as="script"><link rel="prefetch" href="/assets/index.html-56fb25ab.js" as="script"><link rel="prefetch" href="/assets/index.html-c9127c20.js" as="script"><link rel="prefetch" href="/assets/index.html-e7bbaacd.js" as="script"><link rel="prefetch" href="/assets/index.html-f886aa36.js" as="script"><link rel="prefetch" href="/assets/index.html-e440fbd5.js" as="script"><link rel="prefetch" href="/assets/index.html-a6e1c712.js" as="script"><link rel="prefetch" href="/assets/index.html-d02a364a.js" as="script"><link rel="prefetch" href="/assets/index.html-c83ce993.js" as="script"><link rel="prefetch" href="/assets/index.html-b1bd3931.js" as="script"><link rel="prefetch" href="/assets/index.html-bf7f58c4.js" as="script"><link rel="prefetch" href="/assets/index.html-f8655762.js" as="script"><link rel="prefetch" href="/assets/index.html-1089df8f.js" as="script"><link rel="prefetch" href="/assets/whmcs_saved.html-79e77640.js" as="script"><link rel="prefetch" href="/assets/index.html-a7238c50.js" as="script"><link rel="prefetch" href="/assets/index.html-849415fd.js" as="script"><link rel="prefetch" href="/assets/index.html-8fa74df6.js" as="script"><link rel="prefetch" href="/assets/index.html-d16b9d58.js" as="script"><link rel="prefetch" href="/assets/index.html-90574929.js" as="script"><link rel="prefetch" href="/assets/index.html-3075b59a.js" as="script"><link rel="prefetch" href="/assets/index.html-5303c9ce.js" as="script"><link rel="prefetch" href="/assets/index.html-1ad35607.js" as="script"><link rel="prefetch" href="/assets/index.html-6577fca7.js" as="script"><link rel="prefetch" href="/assets/index.html-0e61de46.js" as="script"><link rel="prefetch" href="/assets/index.html-57f7f103.js" as="script"><link rel="prefetch" href="/assets/index.html-0acd56d1.js" as="script"><link rel="prefetch" href="/assets/index.html-456ba9b8.js" as="script"><link rel="prefetch" href="/assets/index.html-ca0f681f.js" as="script"><link rel="prefetch" href="/assets/index.html-197bf602.js" as="script"><link rel="prefetch" href="/assets/404.html-dbc594a3.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar fixed"><div class="navbar-header"><div class="navbar-header__logo-wrapper"><a href="/" class="home-link"><img class="logo" src="/global/logo.svg" alt="logo header"></a><div class="header-layout__search-container header-mobile__hidden"><!----><form id="search-form" class="drawer-header__input"><input type="text" value="" id="algolia-search-input" placeholder="Search" class="header-layout__search-default" maxlength="100"><div class="header-layout__search-icon-default"><img alt="search icon" src="/global/search.svg"><!----></div></form><div><div class="drawer"><div class="drawer-header"><div class="drawer-header__wrapper"><h2 class="drawer-header__paragraph">How can we help you?</h2><div id="drawerSearch"></div></div><div class="drawer-cross"><img class="drawer-cross__img" src="/global/cross.svg" alt="cross"><p class="drawer-cross__text">close</p></div></div><main><div class="drawer-main"><div class="drawer-main__wrapper"><div class="drawer-main__breadcrumb"><!-- Optional breadcrumb can stay here --></div><div><p class="no_results">Please type your search query, then press Enter or click the search button.</p></div></div></div><!----></main></div><!----></div></div></div><div class="links" style="max-width:nullpx;"><img class="navbar-header__mobile-search" src="/global/search.svg" alt="icon image"><div class="header-products-wrapper"><div class="dropdown"><!----><!----><div class="header-products-container"><img class="header-products-container__img" alt="hamburger menu" src="/global/hamburger-menu.svg"><p class="header-products-wrapper-paragraph">Products</p><img class="products-icon__default" width="10" height="8" src="/arrows/arrow-down.svg" alt="arrow down icon"></div></div></div><!--[--><a href="https://www.cloudlinux.com/support-portal/" target="_blank" class="btn">Submit support request</a><a href="https://cloudlinux.com/trial" target="_blank" class="btn btn-white">Try Free</a><!--]--></div></div><!----></header><!----><div class="page"><!--[--><!--]--><div class="breadcrumb-wrapper page-breadcrumb" data-v-8b59302b><!--[--><a href="/" class="breadcrumb" data-v-8b59302b>Documentation</a><a href="/cloudlinuxos/" class="breadcrumb" data-v-8b59302b>CloudLinux OS</a><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/" class="router-link-active router-link-exact-active breadcrumb" data-v-8b59302b>CloudLinux OS components</a><!--]--></div><img class="page-mobile__sidebar-menu" src="/global/sidebar-menu.svg" alt="sidebar hamburger menu"><div class="page-nav-wrapper"><!----></div><div class="content" custom="false"><h1 id="cloudlinux-os-components" tabindex="-1"><a class="header-anchor" href="#cloudlinux-os-components" aria-hidden="true">#</a> CloudLinux OS components</h1><ul><li><a href="/cloudlinuxos/limits/#reseller-limits" class="">Reseller limits</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lve-stats-2" class="router-link-active router-link-exact-active">LVE-Stats 2</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#cagefs" class="router-link-active router-link-exact-active">CageFS</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#mysql-governor" class="router-link-active router-link-exact-active">MySQL Governor</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#php-selector" class="router-link-active router-link-exact-active">PHP Selector</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#python-selector" class="router-link-active router-link-exact-active">Python Selector</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#ruby-selector" class="router-link-active router-link-exact-active">Ruby Selector</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#node-js-selector" class="router-link-active router-link-exact-active">Node.js Selector</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#apache-mod-lsapi-pro" class="router-link-active router-link-exact-active">Apache mod_lsapi PRO</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#nginx-lsapi-module" class="router-link-active router-link-exact-active">NGINX lsapi module</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#additional-integration-components" class="router-link-active router-link-exact-active">Additional integration components</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#apache-suexec-module" class="router-link-active router-link-exact-active">Apache suexec module</a></li></ul><h4 id="general-information-and-requirements" tabindex="-1"><a class="header-anchor" href="#general-information-and-requirements" aria-hidden="true">#</a> General information and requirements</h4><h2 id="lve-stats-2" tabindex="-1"><a class="header-anchor" href="#lve-stats-2" aria-hidden="true">#</a> LVE-Stats 2</h2><h3 id="general-information-and-requirements-1" tabindex="-1"><a class="header-anchor" href="#general-information-and-requirements-1" aria-hidden="true">#</a> General information and requirements</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#why-is-it-needed" class="router-link-active router-link-exact-active">Why is it needed?</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#major-improvements-and-features" class="router-link-active router-link-exact-active">Major improvements and features</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#what-features-will-be-implemented-in-the-future" class="router-link-active router-link-exact-active">What features will be implemented in the future?</a></li></ul><h4 id="why-is-it-needed" tabindex="-1"><a class="header-anchor" href="#why-is-it-needed" aria-hidden="true">#</a> Why is it needed?</h4><ul><li>Old LVE-statistics store averages as integer numbers, as % of <span class="notranslate">CPU</span> usage. If user used 100% of <span class="notranslate">CPU</span> for 1 second within an hour, it is only 1-2% for a minute, and 0 for 5 minutes. Data in old LVE-statistics is aggregated to 1-hour intervals. So, such peak load will noExat be recorded and we need to store data with much higher precision.</li><li>100% <span class="notranslate">CPU</span> usage in old lve statistics means “all cores”. On 32 core servers usage is not visible for most users (as they are limited to 1 core).</li><li>Old LVE-statistics does not provide a way to determine a cause of LVE faults, i.e. what processes are running when user hits LVE limits.Example</li><li>Notifications in old LVE-statistics are not accurate because they are based on average values for <span class="notranslate">CPU, IO, IOPS.</span></li><li>Old LVE-statistics functionality is hard to extend.</li></ul><h4 id="major-improvements-and-features" tabindex="-1"><a class="header-anchor" href="#major-improvements-and-features" aria-hidden="true">#</a> Major improvements and features</h4><ul><li>increased precision of statistics;</li><li><span class="notranslate">CPU</span> usage is calculated  in terms of % of a single core (100% usage means one core);</li><li>lvestats-server emulates and tracks faults for <span class="notranslate">CPU, IO, IOPS</span>;</li><li>lvestats-server saves “snapshots” of user’s processes and queries for each “incident” - added new lve-read-snapshot utility;</li><li>improved notifications about hitting LVE limits (more informative and without false positives);</li><li>implemented ability to add custom plugins;</li><li>MySQL and <span class="notranslate">PostGreSQL</span> support;</li><li>more pretty, scalable, interactive charts;</li><li>snapshots include HTTP-requests.</li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#mod-proctitle" class="router-link-active router-link-exact-active"><code>mod_proctitle</code></a> has to be enabled for HTTP request collection to be available</p></div><h4 id="what-features-will-be-implemented-in-the-future" tabindex="-1"><a class="header-anchor" href="#what-features-will-be-implemented-in-the-future" aria-hidden="true">#</a> What features will be implemented in the future?</h4><ul><li>Notifications for control panels other than CPanel.</li><li>Burstable Limits/server health: We are monitoring server health ( <span class="notranslate"> LA </span> , <span class="notranslate"> memory </span> , idle <span class="notranslate"> CPU </span> ) and automatically decreasing/increasing limits based on server health.</li><li><span class="notranslate">Reseller Limits</span>: plugin would analyze usage per group of users (reseller’s usage), and do actions.</li><li>Suspend/notify plugin: would detect that user is being throttled for 10 minutes, and suspend him (just because), or notify, or increase limits.</li></ul><h3 id="installation-and-update" tabindex="-1"><a class="header-anchor" href="#installation-and-update" aria-hidden="true">#</a> Installation and update</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#downgrade" class="router-link-active router-link-exact-active">Downgrade</a></li></ul><p>To install, please execute:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install lve-stats
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>To update:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum update lve-stats
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Settings of old <span class="notranslate">lve-stats</span> (ver. 0.x) are imported automatically on the first install/update of a new <span class="notranslate">lve-stats</span> package.</p><p>SQLite database file is located in <span class="notranslate"><code>/var/lve/lvestats2.db</code></span>, data from old <span class="notranslate">lve-stats</span> (ver. 0.x) are being migrated automatically in the background. Migrating process can last 2-8 hours (during this time lags are possible when admin is trying to check statistics, at the same time users will not be affected). Migrating the latest 30 days, <span class="notranslate">SQLite DB</span> stable migration is provided.</p><p>Currently, the new <span class="notranslate">lve-stats</span> supports all databases available in CloudLinux OS.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>You can also use <a href="/cloudlinuxos/command-line_tools/#lve-stats-2" class="">LVE-stats 2 CLI</a></p></div><h4 id="downgrade" tabindex="-1"><a class="header-anchor" href="#downgrade" aria-hidden="true">#</a> Downgrade</h4><p>If you have any problems after update, downgrade <span class="notranslate">lve-stats2</span> to the previous stable version by running:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum downgrade lve-stats
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>and contact CloudLinux OS support at <a href="https://cloudlinux.zendesk.com/hc/en-us/requests/new" target="_blank" rel="noopener noreferrer">https://cloudlinux.zendesk.com/hc/requests/new</a></p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>You may need to rename <code>*.rpmsave</code> files to original ones in order to restore settings for old <span class="notranslate">lve-stats (<code>/etc/sysconfig/lvestats</code>, <code>/etc/sysconfig/cloudlinux-notify</code></span>).</p></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>You can also use <a href="/cloudlinuxos/command-line_tools/#lve-stats-2" class="">LVE-stats 2 CLI</a></p></div><h3 id="configuration" tabindex="-1"><a class="header-anchor" href="#configuration" aria-hidden="true">#</a> Configuration</h3><p>The main configuration file <span class="notranslate"><code>/etc/sysconfig/lvestats2</code></span> contains the following options:</p><ul><li><p><span class="notranslate"><code>db_type</code></span> - selects appropriate database type to use;</p></li><li><p><span class="notranslate"><code>connect-string</code></span> - connection string for <span class="notranslate">PostGreSQL</span> and MySQL database, has the following form:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>connect_string = USER:PASSWORD@HOST[:PORT]/DATABASE
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Default port is used for specific database, if port is not specified (typical port is 3306 for MySQL and 5432 for <span class="notranslate">PostGreSQL</span>). Connection string is not used for sqlite database.</p></li><li><p><span class="notranslate"><code>server_id</code></span> - sets the name of the server (at most 10 characters). This option is to use with centralized database ( <span class="notranslate">PostGreSQL</span> or MySQL). For use with sqlite database, value of this option should be &quot;localhost&quot; (without quotes).</p></li><li><p><span class="notranslate"><code>plugins</code></span> – path to directory containing custom plugins for <span class="notranslate">lve-stats</span> (default path <span class="notranslate"><code>/usr/share/lve-stats/plugins</code></span>).</p></li><li><p><span class="notranslate"><code>db_timeout</code></span> - period of time to write data to database (in seconds); default value is 60 seconds.</p></li><li><p><span class="notranslate"><code>timeout</code></span> - timeout for custom plugins (seconds). If plugin execution does not finish within this period, plugin is terminated. Default value is 5 seconds.</p></li><li><p><span class="notranslate"><code>interval</code></span> - duration of one cycle of <span class="notranslate">lvestats-server</span> (seconds). This should be less than total duration of execution of all plugins. Default value is 5 seconds. Increasing this parameter makes precision of statistics worse.</p></li><li><p><span class="notranslate"><code>keep_history_days</code></span> - period of time (in days) to keep history in th database. Old data is removed from the database automatically. Default value is 30 days.</p></li><li><p><span class="notranslate"><code>mode</code></span> – sets compatibility output mode (compatibility with older lveinfo version</p><ul><li>Value <code>v1</code> enables compatibility with old version of <span class="notranslate">lveinfo</span>.</li><li>Value <code>v2</code> enables <span class="notranslate"><code>extended</code></span> output mode, but can break LVE plugins for control panels (statistics in <span class="notranslate">LVE Manager</span>, <span class="notranslate">Resource Usage</span>, etc). Support of <code>v2</code> mode will be added to LVE plugins in the recent future. When mode parameter is absent, later version of <span class="notranslate">lveinfo</span> is implied.</li></ul></li><li><p><span class="notranslate"><code>disable_snapshots</code></span> - disable snapshots and incidents. Possible values:</p><ul><li><span class="notranslate"><code>true</code></span></li><li><span class="notranslate"><code>false</code></span></li></ul></li><li><p><span class="notranslate"><code>disable_mysql_snapshots</code></span> - disable saving SQL queries to snapshots. Possible values:</p><ul><li><span class="notranslate"><code>true</code></span></li><li><span class="notranslate"><code>false</code></span></li></ul></li><li><p><span class="notranslate"><code>hide_lve_more_than_maxuid</code></span> - disable displaying LVE IDs greater than the max UID in resource usage. Possible values:</p><ul><li><span class="notranslate"><code>true</code></span></li><li><span class="notranslate"><code>false</code></span></li></ul></li><li><p><span class="notranslate"><code>use_big_uids</code></span> - the option is available from <span class="notranslate">lvestats</span> version <span class="notranslate"><code>3.0.14-1</code></span>. It allows using the user uids more than 10<sup>9</sup> and up to 2<sup>31</sup>-2 (2 147 483 646). Top border is the biggest value which <span class="notranslate"><code>kmodlve</code></span> can use as <span class="notranslate">LVE ID</span>. You should recreate <span class="notranslate">lvestats</span> database by command <span class="notranslate"><code>lve-create-db --recreate</code></span> if you change the option&#39;s value from <span class="notranslate"><code>false</code></span> to <span class="notranslate"><code>true</code></span>. Possible values:</p><ul><li><span class="notranslate"><code>true</code></span></li><li><span class="notranslate"><code>false</code></span></li></ul></li></ul><p>Configuration files for plugins are located in <span class="notranslate"><code>/etc/sysconfig/lvestats.config</code></span> directory.</p><p><span class="notranslate"><code>/etc/sysconfig/lvestats.config/SnapshotSaver.cfg</code></span> contains the following options:</p><ul><li><span class="notranslate"><code>period_between_incidents</code></span> - the minimal interval of time between incidents (in seconds). If minimal interval of time between LVE faults is greater than value specified, than new &quot;incident&quot; will begin and new snapshots will be saved. Default value is 300 seconds.</li><li><span class="notranslate"><code>snapshots_per_minute</code></span> - the maximum number of snapshots saved per minute for specific LVE id (default is <code>2</code>).</li><li><span class="notranslate"><code>max_snapshots_per_incident</code></span> - the maximum number of snapshots saved for one &quot;incident&quot;. Default is <code>10</code>.</li><li><span class="notranslate"><code>litespeed</code></span> - enable or disable data import from LiteSpeed, default is <code>auto</code> (autodetect); <code>On</code>|<code>on</code>|<code>1</code> - force use litespeed; <code>Off</code>|<code>off</code>|<code>0</code> - force use apache</li></ul><p><span class="notranslate"><code>/etc/sysconfig/lvestats.config/StatsNotifier.cfg</code></span> contains the following options:</p><ul><li><span class="notranslate"><code>NOTIFY_ADMIN</code></span> – enables notification for admin (<span class="notranslate"><code>Y/N</code></span>, default <code>N</code>);</li><li><span class="notranslate"><code>NOTIFY_RESELLER</code></span> – enables notification for reseller (<span class="notranslate"><code>Y/N</code></span>, default <code>N</code>);</li><li><span class="notranslate"><code>NOTIFY_CUSTOMER</code></span> - enables notification for customers (<span class="notranslate"><code>Y/N</code></span>, default <code>N</code>);</li><li><span class="notranslate"><code>NOTIFY_INCLUDE_RESELLER_CUSTOMER</code></span> – <code>Y</code>=notify all users, <code>N</code>=notify only hoster&#39;s users (whos reseller is root), default = <code>N</code>;</li><li><span class="notranslate"><code>NOTIFY_CPU</code></span> – notify about <span class="notranslate">CPU</span> faults when customer hits 100% of his <span class="notranslate">CPU</span> limit (<span class="notranslate"><code>Y/N</code></span>, default <code>N</code>);</li><li><span class="notranslate"><code>NOTIFY_IO</code></span> - notify about <span class="notranslate">IO</span> faults when customer hits 100% of his <span class="notranslate">IO</span> limit (<span class="notranslate"><code>Y/N</code></span>, default <code>N</code>);</li><li><span class="notranslate"><code>NOTIFY_IOPS</code></span> - notify about <span class="notranslate">IOPS</span> faults when customer hits 100% of his <span class="notranslate">IOPS</span> limit (<span class="notranslate"><code>Y/N</code></span>, default <code>N</code>);</li><li><span class="notranslate"><code>NOTIFY_MEMORY</code></span> - notify about memory faults (<span class="notranslate"><code>Y/N</code></span>, default <code>N</code>);</li><li><span class="notranslate"><code>NOTIFY_EP</code></span> – notify about entry processes faults (<span class="notranslate"><code>Y/N</code></span>, default <code>N</code>);</li><li><span class="notranslate"><code>NOTIFY_NPROC</code></span> – notify about number of processes faults (<span class="notranslate"><code>Y/N</code></span>, default <code>N</code>);</li><li><span class="notranslate"><code>NOTIFY_MIN_FAULTS_ADMIN</code></span> – minimum number of faults to notify admin (default <code>1</code>);</li><li><span class="notranslate"><code>NOTIFY_MIN_FAULTS_USER</code></span> – minimum number of faults to notify customer (default <code>1</code>);</li><li><span class="notranslate"><code>NOTIFY_INTERVAL_ADMIN</code></span> – period of time to notify admin (default <code>12h</code>);</li><li><span class="notranslate"><code>NOTIFY_INTERVAL_USER</code></span> – period of time to notify customer (default <code>12h</code>);</li><li><span class="notranslate"><code>NOTIFY_FROM_EMAIL</code></span> - sender email address. For example: <span class="notranslate"><code>NOTIFY_FROM_EMAIL=main_admin@host.com</code>;</span></li><li><span class="notranslate"><code>NOTIFY_FROM_SUBJECT</code></span> - email message subject. For example: <span class="notranslate"><code>NOTIFY_FROM_SUBJECT=Message from notifier</code></span></li><li><span class="notranslate"><code>REPORT_ADMIN_EMAIL</code></span> - custom email for admin reporting. For example: <span class="notranslate"><code>REPORT_ADMIN_EMAIL=report_email@host.com</code></span></li><li><span class="notranslate"><code>NOTIFY_CHARSET_EMAIL</code></span> – charset type for email. Available for <span class="notranslate"><strong>lve-stats-2.9.4-1</strong></span> and later. Default is <span class="notranslate"><code>us-ascii</code></span>. For example: <span class="notranslate"><code>NOTIFY_CHARSET_EMAIL=utf-8</code></span>. If your email templates include non-Latin letters, it is recommended to use the UTF-8 encoding.</li></ul><p>These values can also be set using <a href="/cloudlinuxos/command-line_tools/#cloudlinux-config" class="">cloudlinux-config CLI</a> utility</p><p>Templates of notifications are located here:</p><ul><li><span class="notranslate"><code>/usr/share/lve/emails/en_US/admin_notify.txt</code></span></li><li><span class="notranslate"><code>/usr/share/lve/emails/en_US/reseller_notify.txt</code></span></li><li><span class="notranslate"><code>/usr/share/lve/emails/en_US/user_notify.txt</code></span></li><li><span class="notranslate"><code>/usr/share/lve/emails/en_US/admin_notify.html</code></span></li><li><span class="notranslate"><code>/usr/share/lve/emails/en_US/reseller_notify.html</code></span></li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Notifications about LVE faults are implemented for CPanel, Plesk, and DirectAdmin.</p></div><p>After changing any options above, please restart <span class="notranslate">lvestats</span> service:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service lvestats restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><span class="notranslate"><code>/etc/logrotate.d/lvestats</code></span> - configuration file for <span class="notranslate"><code>/var/log/lve-stats.log rotation</code></span></p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>You can also use <a href="/cloudlinuxos/command-line_tools/#lve-stats-2" class="">LVE-stats 2 CLI</a></p></div><h3 id="lve-stats2-and-db-servers-compatible-work-setup" tabindex="-1"><a class="header-anchor" href="#lve-stats2-and-db-servers-compatible-work-setup" aria-hidden="true">#</a> LVE-stats2 and DB servers compatible work setup</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lve-stats2-and-mysql-db-server-compatible-work-setup" class="router-link-active router-link-exact-active">LVE-stats2 and MySQL DB server compatible work setup</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lve-stats2-and-postgresql-db-server-compatible-work-setup" class="router-link-active router-link-exact-active">LVE-stats2 and PostgreSQL DB server compatible work setup</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#customize-lve-stats2-notifications" class="router-link-active router-link-exact-active">Customize LVE-stats2 notifications</a></li></ul><h4 id="lve-stats2-and-mysql-db-server-compatible-work-setup" tabindex="-1"><a class="header-anchor" href="#lve-stats2-and-mysql-db-server-compatible-work-setup" aria-hidden="true">#</a> LVE-stats2 and MySQL DB server compatible work setup</h4><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Run all the commands below under root.</p></div><p><strong>1. MySQL server setup</strong></p><p>If MySQL Server is not installed, then install it according to control panel documentation.</p><p>For non-panel system:</p><ul><li><p>CloudLinux OS 6</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install mysql mysql-server
service mysqld start
chkconfig mysqld on
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div></li><li><p>CloudLinux OS 7</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install mariadb mariadb-server
systemctl start mariadb.service
systemctl enable mariadb.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div></li></ul><p><strong>2. Database setup</strong></p><ul><li><p>Run MySQL administrative utility: <span class="notranslate"><code>mysql</code></span>.</p></li><li><p>In utility run the commands:</p><ul><li>creating server DB. Also, check <strong><em>Note</em></strong> below.</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>CREATE DATABASE db_lvestats2;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li>creating a user for <span class="notranslate">LVE Stats 2</span> server to work under. Also, check <strong><em>Note</em></strong> below.</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>CREATE USER &#39;lvestats2&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;lvestats2_passwd&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li>granting all the privileges for all DB tables to the user. Use the username and DB name from the points above.</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GRANT ALL PRIVILEGES ON db_lvestats2.* TO &#39;lvestats2&#39;@&#39;localhost&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li>refreshing privileges information.</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>FLUSH PRIVILEGES;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li>Exit administrative utility <span class="notranslate"><code>(Ctrl+d)</code></span>.</li></ul></li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>DB name, username and their passwords above are given for an example - you can use any of your choices. Using old DB from <span class="notranslate">LVE Stats</span> version 1 is also acceptable as <span class="notranslate">LVE Stats2</span> uses different tables and the old information will not be corrupted.</p></div><p><strong>3.</strong> <span class="notranslate"><strong>LVE-stats2</strong></span> <strong>setup</strong></p><ul><li>Stop <span class="notranslate">LVE Stats 2</span> server by running the command:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service lvestats stop
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li>In server configuration file <span class="notranslate"><code>/etc/sysconfig/lvestats2</code></span>, edit the following options: <ul><li><span class="notranslate"><code>db_type = mysql</code></span></li><li><span class="notranslate"><code>connect_string = lvestats2:lvestats2_passwd@localhost/db_lvestats2</code></span></li></ul></li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p><span class="notranslate"><code>connect_string</code></span> option value is used in format: <span class="notranslate"><code>user:pass@host/database</code></span>. Username, password and DB name must be the same as in point 2 of Database Setup above.</p></div><ul><li>After making changes in configuration files run:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/lve-create-db
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>For DB primary initialization (creating tables, indexes, etc). There is no need to create anything in the DB manually.</p><ul><li>When done, restart server by running:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service lvestats restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>4. Additional security settings</strong></p><p>If you need to provide access to <span class="notranslate">LVE Stats</span> information utilities (<span class="notranslate"><code>lveinfo</code>, <code>lvechart</code>, <code>lve-read-snapshot</code></span>) for different users, then we recommend creating one more DB user with read-only privilege to guarantee information security. It can be done by running the following commands in administrative utility:</p><ul><li>creating a user (check <strong><em>Note</em></strong> above)</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>CREATE USER &#39;lvestats2_read&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;lvestats2_read_passwd&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li>granting read-only privilege to the user</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GRANT SELECT ON db_lvestats2.* TO &#39;lvestats2_read&#39;@&#39;localhost&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li>refreshing privileges information</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>FLUSH PRIVILEGES;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>If <span class="notranslate">LVE Stats2</span> server is set correctly (see information below), the information utilities will work under this user.</p><p>If you need to provide access to information utilities to other users, then in order to guarantee information security you should do the following:</p><ul><li>Assign permission 600 to the main configuration file (<span class="notranslate"><code>/etc/sysconfig/lvestats2</code></span>), so that it could be read only by <span class="notranslate">LVE Stats 2</span> server and by utilities that run under root.</li><li>Copy <span class="notranslate"><code>/etc/sysconfig/lvestats2</code></span> to <span class="notranslate"><code>/etc/sysconfig/lvestats2.readonly</code></span>, assign permission 644 to the new file, so that it could be read by any user but could only be changed by root.</li><li>In <span class="notranslate"><code>/etc/sysconfig/lvestats2.readonly</code></span> file, in the line <span class="notranslate"><code>connect_string</code></span>, specify DB user with read-only permission, created above.</li></ul><p>These steps allow hiding main DB user username/password from other system users.</p><p>If there is no need in such access differentiation, then <span class="notranslate"><code>/etc/sysconfig/lvestats2</code></span> file access permission should be 644, so that it could be read by all users and could be changed only by root.</p><p><strong>5. Using special characters in database password</strong></p><p>Since scheme <span class="notranslate"><code>://user:password@host[:port]/database_name</code></span> <a href="https://en.wikipedia.org/wiki/Uniform_Resource_Identifier" target="_blank" rel="noopener noreferrer">URI</a> is used in <span class="notranslate"><code>connect_string</code></span> config option, then usage of special characters in user DB password is not allowed.</p><p>To use special symbols in the password, it must be converted to <a href="https://en.wikipedia.org/wiki/Percent-encoding" target="_blank" rel="noopener noreferrer">escape-sequence</a>. You can convert a password to escape-sequence in a console as follows:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>echo -n &#39;[You_P@$$]:&#39; | perl -MURI::Escape -ne &#39;print uri_escape($_).&quot;\n&quot;&#39;
%5BYou_P%40%24%24%5D%3A
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Or replace the symbols manually:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>!    #    $    &amp;    &#39;    (    )    *    +    ,    /    :    ;    =    ?    @   [    ]
%21  %23  %24  %26  %27  %28  %29  %2A  %2B  %2C  %2F  %3A  %3B  %3D  %3F  %40  %5B %5D
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>After that <span class="notranslate"><code>сonnect_string</code></span> will look as follows:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>сonnect_string=lvestats2:%5BYou_P%40%24%24%5D%3A@localhost/db_lvestats2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="lve-stats2-and-postgresql-db-server-compatible-work-setup" tabindex="-1"><a class="header-anchor" href="#lve-stats2-and-postgresql-db-server-compatible-work-setup" aria-hidden="true">#</a> LVE-stats2 and PostgreSQL DB server compatible work setup</h4><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Run all the commands below under <span class="notranslate">root</span>.</p></div><p><strong>1.</strong> <strong><span class="notranslate">PostgreSQL</span></strong> <strong>server installation and setup</strong></p><ul><li><p><strong>PostgreSQL installation and initialization</strong></p><p>For control panels use proper documentation for installation on the links: <a href="https://documentation.cpanel.net/display/CKB/Install+or+Update+PostgreSQL+on+Your+cPanel+Server" target="_blank" rel="noopener noreferrer">сPanel</a>, <a href="https://kb.plesk.com/en/123729" target="_blank" rel="noopener noreferrer">Plesk</a>.</p><p>For non-panel CloudLinux OS, run the following commands:</p><ul><li>CloudLinux OS 6</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install postgresql-server postgresql
service postgresql initdb
service postgresql start
chkconfig postgresql on
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><ul><li>CloudLinux OS 7</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install postgresql-server postgresql
postgresql-setup initdb
systemctl start postgresql
systemctl enable postgresql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div></li><li><p><strong>Setup</strong></p><ul><li><p>In <span class="notranslate"><code>/var/lib/pgsql/data/pg_hba.conf</code></span> config file change user authentication mode. Add the following lines (place before all other authentication parameters):</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># IPv4 local connections for lve-stats-2.x
host dblvestat all 127.0.0.1/32 password
# IPv6 local connections for lve-stats-2.x
host dblvestat all ::1/128 password
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>These lines enable user authentication by the password for <span class="notranslate">IP4/IP6</span> connections. You can set other modes if needed.</p></li><li><p>Apply config changes by running:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service postgresql restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div></li></ul></li></ul><p><strong>2. DB for</strong> <span class="notranslate"><strong>LVE-stats-2.x</strong></span> <strong>- creating and setup</strong></p><ul><li>Run standard <span class="notranslate">PostgreSQL psql</span> administrative utility:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sudo -u postgres psql postgres
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>OR for сPanel</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>psql -w -U postgres
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li><p>In utility run:</p><ul><li><p>creating server DB. Also, check <strong><em>Note</em></strong> below.</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>CREATE DATABASE dblvestat;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div></li><li><p>creating a user for <span class="notranslate">LVE Stats 2</span> server to work under. Also, check <strong><em>Note</em></strong> below.</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>CREATE USER lvestat WITH password &#39;passw&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div></li><li><p>granting <span class="notranslate">lvestat</span> user all privileges for work with <span class="notranslate">dblvestat DB</span>.</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GRANT ALL privileges ON DATABASE dblvestat TO lvestat;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div></li><li><p>exit <code>psql</code> utility:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>\q
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>OR alternatively:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Ctrl+d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div></li></ul></li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>DB name, username and their passwords above are given for an example - you can use any of your choices. Using old DB from <span class="notranslate">LVE Stats</span> version 1 is also acceptable as <span class="notranslate">LVE Stats 2</span> uses different tables and the old information will not be corrupted</p></div><p><strong>3.</strong> <span class="notranslate"><strong>LVE-stats-2.x</strong></span> <strong>setup</strong></p><ul><li>Stop <span class="notranslate">lve-stats2</span> server by running:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service lvestats stop
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li>In server config file <span class="notranslate"><code>/etc/sysconfig/lvestats2</code></span> edit options for connecting to DB:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db_type = postgresql
connect_string=lvestat:passw@localhost/dblvestat
If DB is going to be used as centralized for multiple hosts then collect_usernames parameter must be changed:
collect_usernames=true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p><span class="notranslate"><code>connect_string</code></span> option value is of the format: <span class="notranslate"><code>user:pass@host/database</code></span>. Username, password and DB name must be the same as in Database Setup section above.</p></div><ul><li>After making changes in configuration files, for DB primary initialization (creating tables, indexes, etc), run:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/lve-create-db
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li>There is no need to create anything in the DB manually. When done, restart server by running:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service lvestats restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>4. Additional security settings</strong></p><p>If you need to provide access to <span class="notranslate">LVE Stats</span> information utilities (<span class="notranslate"><code>lveinfo</code>, <code>lve-read-snapshot</code></span> ) for other users (or if <span class="notranslate">CageFS</span> is disabled), then in order to guarantee DB security the following steps are required:</p><ul><li>Create a DB user with read-only permission:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>CREATE USER lvestat_read WITH password &#39;passw&#39;;
GRANT CONNECT ON DATABASE dblvestat to lvestat_read;
\connect dblvestat;
GRANT SELECT ON lve_stats2_history, lve_stats2_history_gov, lve_stats2_history_x60, lve_stats2_incident, lve_stats2_servers, lve_stats2_snapshot, lve_stats2_user TO lvestat_read;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><ul><li><p>Assign root ownership and permission 600 to the main configuration file (<span class="notranslate"><code>/etc/sysconfig/lvestats2</code></span>), so that it could be read only by <span class="notranslate">LVE Stats 2</span> server and by utilities that run under root.</p></li><li><p>Copy <span class="notranslate"><code>/etc/sysconfig/lvestats2</code> to <code>/etc/sysconfig/lvestats2.readonly</code></span>, assign permission 644 to the new file, so that it could be read by any user but could be changed only by root.</p></li><li><p>In <span class="notranslate"><code>/etc/sysconfig/lvestats2.readonly</code></span> file, in the line <span class="notranslate"><code>connect_string</code></span>, specify DB user with read-only permission, created above.</p><p>These steps allow hiding main DB user username/password from other system users.</p><p>If there is no need in such access differentiation, then <span class="notranslate"><code>/etc/sysconfig/lvestats2</code></span> file access permission should be 644, so that it could be read by all users and could be changed only by <span class="notranslate">root</span>.</p></li><li><p>When done, restart server by running:</p></li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service lvestats restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>5. Using special characters in database password</strong></p><p>Since scheme <span class="notranslate"><code>://user:password@host[:port]/database_name</code></span> <a href="https://en.wikipedia.org/wiki/Uniform_Resource_Identifier" target="_blank" rel="noopener noreferrer">URI</a> is used in <span class="notranslate"><code>connect_string</code></span> config option, then usage of special characters in user DB password is not allowed.</p><p>To use special symbols in the password, it must be converted to <a href="https://en.wikipedia.org/wiki/Percent-encoding" target="_blank" rel="noopener noreferrer">escape-sequence</a>. You can convert a password to escape-sequence in a console as follows:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>echo -n &#39;[You_P@$$]:&#39; | perl -MURI::Escape -ne &#39;print uri_escape($_).&quot;\n&quot;&#39;
%5BYou_P%40%24%24%5D%3A
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>OR replace the symbols manually:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>!    #    $    &amp;    &#39;    (    )    *    +    ,    /    :    ;    =    ?    @    [    ]
%21  %23  %24  %26  %27  %28  %29  %2A  %2B  %2C  %2F  %3A  %3B  %3D  %3F  %40  %5B  %5D
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>After that <span class="notranslate"><code>сonnect_string</code></span> will look as follows:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>сonnect_string=lvestats2:%5BYou_P%40%24%24%5D%3A@localhost/db_lvestats2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="customize-lve-stats2-notifications" tabindex="-1"><a class="header-anchor" href="#customize-lve-stats2-notifications" aria-hidden="true">#</a> Customize LVE-stats2 notifications</h4><p><span class="notranslate"><a href="http://jinja.pocoo.org/" target="_blank" rel="noopener noreferrer">Jinja2</a></span> is used as a template engine for the notifications.</p><p>The templates for notifications are located in <span class="notranslate"><code>/usr/share/lve/emails/LOCALE</code></span>, where <span class="notranslate"><code>LOCALE</code></span> is the directory with localization name (language codes are formed according to <span class="notranslate">ISO 639-1</span> and <span class="notranslate">ISO 639-2</span>).</p><p>By default the templates for English are set: <span class="notranslate"><code>/usr/share/lve/emails/en_US.</code></span>.</p><p><span class="notranslate"><code>/usr/share/lve/emails/en_US</code></span> contains the following templates:</p><ul><li><span class="notranslate"><code>admin_notify.html</code> <code>admin_notify.txt</code></span> for administrator;</li><li><span class="notranslate"><code>reseller_notify.html</code> <code>reseller_notify.txt</code></span> for reseller;</li><li><span class="notranslate"><code>user_notify.txt</code></span> for user.</li></ul><p>Starting from <code>lve-stats-4.1.2</code>, it allows server administrators to use their own lvestats notifier email notification templates.</p><p>To use the custom templates, place them and the <code>locales.json</code> file to the <code>/etc/cl.emails.d/LOCALE</code> directory. File names are the same as in general <code>/etc/cl.emails.d/LOCALE</code> file.</p><p>If the <code>/etc/cl.emails.d/LOCALE</code> doesn&#39;t exist or doesn&#39;t contain the templates, you can use the <code>/usr/share/lve/emails/LOCALE</code> directory, as it was in previous versions of lve-stats.</p><p>Please do not edit the templates in the the <code>/usr/share/lve/emails</code> and place the new updated templates in the <code>/etc/cl.emails.d</code> directory.</p><p>The notification is formed as <span class="notranslate"><em>Multipart content type</em></span> <a href="https://www.w3.org/Protocols/rfc1341/7_2_Multipart.html" target="_blank" rel="noopener noreferrer">RFC1341(MIME)</a>.</p><p>The plain text is taken from the <span class="notranslate"><code>.txt</code></span> files, html version - from the <span class="notranslate"><code>.html</code></span> template.</p><p>In case when only one template is present (<span class="notranslate"><code>.txt</code></span> or <span class="notranslate"><code>.html</code></span>) the notification is sent as a <span class="notranslate"><em>Non-multipart content</em></span> type notification.</p><p>It is better to use <span class="notranslate"><em>Multipart content</em></span> type notifications because when a mail client can not display an html-format message, then it will be displayed as plain text version.</p><p>To localize notifications, copy standard templates into directory with the proper locale name and translate the template. Also you can customize the main template making proper changes into it.</p><p>The list of variables that can be used in the template:</p><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td>Variable</td><td>Example</td><td>Description</td></tr><tr><td><span class="notranslate"><code>TONAME</code></span></td><td><span class="notranslate"><code>Customer</code></span></td><td>Notification receiver user name. Taken from profile in the control panel, by default - <span class="notranslate"><code>Customer</code></span> for user, <span class="notranslate"><code>Administrator</code></span> for administrator, <span class="notranslate"><code>Reseller</code></span> for reseller.</td></tr><tr><td><span class="notranslate"><code>TOMAIL</code></span></td><td><span class="notranslate"><code>support@cloudlinux.com</code></span></td><td>Notification receiver email address.</td></tr><tr><td><span class="notranslate"><code>DOMAIN</code></span></td><td><span class="notranslate"><code>wordpress.test247.cloudlinux.com</code></span></td><td>Main domain. Available only for user.</td></tr><tr><td><span class="notranslate"><code>LOCALE</code></span></td><td><span class="notranslate"><code>en_US</code></span></td><td>Locale in which the notification is sent. Available only for user.</td></tr><tr><td><span class="notranslate"><code>RESELLER</code></span></td><td><span class="notranslate"><code>root</code></span></td><td>User reseller. Available only for user.</td></tr><tr><td><span class="notranslate"><code>PERIOD</code></span></td><td><span class="notranslate"><code>12 hours</code></span></td><td>Verification and notification sending period.</td></tr><tr><td><span class="notranslate"><code>LOGIN</code></span></td><td><span class="notranslate"><code>wordpress</code></span></td><td>User login in the system.</td></tr><tr><td><span class="notranslate"><code>ID</code></span></td><td><code>500</code></td><td>User ID in the system.</td></tr><tr><td><span class="notranslate"><code>lPMem</code> <code>lEP</code> <code>PMemF</code> <code>lVMem</code> <code>anyF</code> <code>IOf</code> <code>VMemF</code> <code>lCPU</code> <code>aIOPS</code> <code>aEP</code> <code>aPMem</code> <code>IOPSf</code> <code>lIO</code> <code>lIOPS</code> <code>aIO</code> <code>EPf</code> <code>aCPU</code> <code>aVMem</code> <code>NprocF</code> <code>aNproc</code> <code>lNproc</code> <code>CPUf</code></span></td><td></td><td>See description in <span class="notranslate"><code>lveinfo --help</code></span> output. Available only for users</td></tr><tr><td><span class="notranslate"><code>STATS_HTML</code></span></td><td></td><td>html table with the list of users that exceeded limits. Available for administrator and reseller.</td></tr><tr><td><span class="notranslate"><code>STATS</code></span></td><td></td><td>ASCII - table with the list of users that exceeded limits. Available only for admins and resellers.</td></tr></tbody></table><p>Sender’s email address by default is administrator email address from control panel settings <span class="notranslate"><code>(root@{hostn_name}</code></span> if there is no email in the control panel).</p><p>It can be changed with <span class="notranslate"><code>NOTIFY_FROM_EMAIL</code></span> option in the config <span class="notranslate"><code>/etc/sysconfig/lvestats.config/StatsNotifier.cfg</code></span></p><p>For example:</p><p><span class="notranslate"><code>NOTIFY_FROM_EMAIL=support@hostername.com</code></span></p><p>To apply changes restart <span class="notranslate"><code>lve-stats</code></span> service:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service lvestats restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>for CloudLinux OS 7</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>systemctl restart lvestats.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Default subject is <span class="notranslate"><code>Hosting account resources exceeded</code></span>.  It can be changed for each template (and for localized templates as well). To change subject, in the very beginning of the file (no blank lines allowed in the beginning of the template) add the field <span class="notranslate"><code>Subject:</code></span>, leave two blank lines after it and add template body.</p><p>Customized subjects can be taken only from the templates with the resolution <span class="notranslate"><code>*.txt</code></span> <span class="notranslate">(<code>admin_notify.txt</code>, <code>reseller_notify.txt</code>, <code>user_notify.txt</code>)</span>. Changes apply without <span class="notranslate"><code>lvestats</code></span> restart.</p><p>For backward compatibility the subject can be also changed with the key <span class="notranslate"><code>NOTIFY_FROM_SUBJECT</code></span> in the config <span class="notranslate"><code>/etc/sysconfig/lvestats.config/StatsNotifier.cfg</code></span>.</p><p>Customized subjects have the higher priority than the key <span class="notranslate"><code>NOTIFY_FROM_SUBJECT</code></span>.</p><p>Example for the file <span class="notranslate"><code>user_notify.txt</code></span></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre v-pre class="language-text"><code>Subject: Customized subject example
Dear {{TONAME}},

Your {{DOMAIN}} web hosting account exceeded one or more of its resources within the last {{PERIOD}}.
{% if epf %}Exceeded the maximum of {{lep}} concurrent website connections. Your website was not available {{epf}} times because of this problem.
{% endif %}{% if pmemf %}Exceeded the physical memory limit of {{lpmem}}KB. Your website was not available {{pmemf}} times because of this problem.
{% endif %}{% if vmemf %}Exceeded the virtual memory limit of {{lvmem}}KB. Your website was not available {{vmemf}} times because of this problem.
{% endif %}{% if nprocf %}Exceeded the number of processes limit of {{lnproc}}. Your website was not available {{nprocf}} times because of this problem.
{% endif %}{% if cpuf %}You reached limit of {{lcpu}} of total server CPU usage {{cpuf}} times. Your website was forced to load slower to reduce its CPU usage.
{% endif %}{% if iof %}You reached limit of {{lio}}KB/s disk io rate {{iof}} times. The disk io speed for your account was slowed as a result of this problem.
{% endif %}{% if iopsf %}You reached limit of {{liops}} I/O operations {{iopsf}} times. The disk io speed for your account was slowed as a result of this problem.
{% endif %}

To view full details about your web hosting account&#39;s resource usage, including the time of each incident listed above, please click the link below and log into your cpanel hosting control panel, then click the &quot;Resource Usage&quot; link under the &quot;Logs and Statistics&quot; section.
http://{{DOMAIN}}:2083

If your account is regularly exceeding it&#39;s available resources, please consider upgrading to a higher level hosting plan that includes more resources. If you have any questions or need help with anything, just reply to this email and let us know.

Sincerely,

Your Friendly Web Hosting Support Team
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>The email template should be in the UTF-8 encoding. The other encodings are not supported.</p></div><p>Starting from lve-stats v. 3.0.15-1, it allows to localize the words that before were imported directly from the lve-stats program code and couldn&#39;t be changed.</p><p>The email template looks like follows:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Dear {{TONAME}},
Following accounts experienced issues in the past {{PERIOD}}{% if HOSTNAME is defined %} on host {{HOSTNAME}}{% endif %}

{{STATS}}

Sincerely,
Your Friendly Web Hosting Support Team
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Before, the <code>{TONAME}</code> was replaced with “Administrator”/”Reseller”/”Customer” according to the type of the addressee. The <code>{PERIOD}</code> was replaced with the duration of the period during which the limits faults were detected. The period duration includes the words &quot;days&quot;/&quot;hour&quot;/&quot;minutes&quot;/&quot;seconds&quot;.</p><p>In the new version, in order for the lve-stats notifier to include these words in the letter in the language corresponding to the addressee locale, you should create a file for the required locale <code>/usr/share/lve/emails/&lt;encoding_name&gt;/locale_defines.json</code> with the following content:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{
 &quot;NOTIFY_FROM_SUBJECT&quot;: &quot;Your server has lve-stats faults&quot;,
 &quot;PERIOD&quot;: {
   &quot;days&quot;: &quot;days&quot;, &quot;hours&quot;: &quot;hour(s)&quot;, &quot;minutes&quot;: &quot;minutes&quot;, &quot;seconds&quot;: &quot;seconds&quot;
 },
 &quot;TONAME&quot;: {
   &quot;admin&quot;: &quot;Administrator&quot;, &quot;reseller&quot;: &quot;Reseller&quot;, &quot;customer&quot;: &quot;Customer&quot;
 }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The file format should be JSON, and the file encoding should be UTF-8. If this file is found and successfully read, the words from it will be used in emails. In case of any file reading/parsing error, a corresponding message will be written in the lve-stats log, and the contents of the file will be completely ignored. If a key in the JSON file content is missing, then lve-stats notifier uses the word contained in the body of the program (just like in previous lve-stats versions). Also, this file allows you to override/localize the subject of the email.</p><p>It should be noted that this override of the subject line is the highest priority. I.e., if you want to use the subject from the configuration file <code>/etc/sysconfig/lvestats.config/StatsNotifier.cfg</code>, then do not specify the <code>NOTIFY_FROM_SUBJECT</code> key in the <code>locale_defines.json</code>.</p><h3 id="plugins" tabindex="-1"><a class="header-anchor" href="#plugins" aria-hidden="true">#</a> Plugins</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#creating-a-plugin-for-lve-stats2" class="router-link-active router-link-exact-active">Creating a plugin for LVE-stats2</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#introduction" class="router-link-active router-link-exact-active">Introduction</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#server-plugin-arrangement" class="router-link-active router-link-exact-active">Server plugin arrangement</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#plugin-configuration" class="router-link-active router-link-exact-active">Plugin configuration</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#types-of-plugins" class="router-link-active router-link-exact-active">Types of plugins</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#examples-of-plugins" class="router-link-active router-link-exact-active">Examples of plugins</a><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#collector" class="router-link-active router-link-exact-active">Collector</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#analyzer" class="router-link-active router-link-exact-active">Analyzer</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#persistor" class="router-link-active router-link-exact-active">Persistor</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#notifier" class="router-link-active router-link-exact-active">Notifier</a></li></ul></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#file-info-and-format-for-var-lve-info-file" class="router-link-active router-link-exact-active">File info and format for /var/lve/info file</a></li></ul><p>LVE-stats2 comes with a set of generic plugins:</p><table><thead><tr><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>Plugin Name</td><td>Order</td><td>Default</td><td>Period (seconds)</td><td>Description</td></tr><tr><td>LVECollector</td><td>1000</td><td>Y</td><td>5</td><td>Collects usage/limits data from <code>/proc/lve/list</code></td></tr><tr><td>CPUInfoCollector</td><td>2000</td><td>Y</td><td>5</td><td>collents info about <span class="notranslate"> CPU - <code>/proc/cpuinfo</code></span></td></tr><tr><td>LVEUsernamesCollector</td><td>3000</td><td>Y</td><td>3600</td><td>collects usernames &amp; user ids to match <span class="notranslate"><code>uid &lt;-&gt; lve id</code></span> later on</td></tr><tr><td>LVEUsageAnalyzer</td><td>4000</td><td>Y</td><td>5</td><td>analyzes usage of LVE</td></tr><tr><td>LveUsageAggregator</td><td>5000</td><td>Y</td><td>60</td><td>aggregates data by time periods</td></tr><tr><td>DBGovSaver</td><td>6000</td><td>Y</td><td>5</td><td>Saves data about database governor</td></tr><tr><td>FileSaver</td><td>7000</td><td>Y</td><td>5</td><td>Saves LVE data into <span class="notranslate"><code>/var/lve/info</code></span></td></tr><tr><td>CloudLinuxTopFileSaver</td><td>8000</td><td>Y</td><td>60</td><td>saves data used by <span class="notranslate"> cloudlinux-top to <code>/var/lve/cloudlinux-top.json</code></span></td></tr><tr><td>DBSaver</td><td>9000</td><td>Y</td><td>60</td><td>save LVE data to database</td></tr><tr><td>DbUsernamesSaver</td><td>10000</td><td>Y</td><td>3600</td><td>saves users name to database</td></tr><tr><td>DBSaverX60</td><td>11000</td><td>Y</td><td>3600</td><td>saves aggregated hourly data into database</td></tr><tr><td>SnapshotSaver</td><td>12000</td><td>Y</td><td>30</td><td>collects &amp; saves snapshots data</td></tr><tr><td>StatsNotifier</td><td>13000</td><td>Y</td><td>varied</td><td>notify user/admin based on usage</td></tr><tr><td>HistoryCleaner</td><td>14000</td><td>Y</td><td>3600</td><td>removes old usage</td></tr><tr><td>ResMEMCollector</td><td>1500</td><td>N</td><td>30</td><td>collects physical memory usage from processes RES field instead of <span class="notranslate"><code>/proc/lve/list</code></span></td></tr><tr><td>LVEDestroyer</td><td>-</td><td>N</td><td>5</td><td>destroys LVEs that weren&#39;t active for X iterations. Number of iterations is passed from config using iterations variable. <span class="notranslate"><code>iterations=0</code></span> means plugin disabled</td></tr></tbody></table><p>To enable non-default plugin, copy or link it to <code>/usr/share/lve-stats/plugins</code> directory.</p><p>For example to enable <code>ResMEMCollector</code> plugin, do:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ln -s /usr/share/lve-stats/plugins.other/res_mem_collector.py /usr/share/lve-stats/plugins/
service lvestats restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><h4 id="creating-a-plugin-for-lve-stats2" tabindex="-1"><a class="header-anchor" href="#creating-a-plugin-for-lve-stats2" aria-hidden="true">#</a> Creating a plugin for LVE-stats2</h4><h4 id="introduction" tabindex="-1"><a class="header-anchor" href="#introduction" aria-hidden="true">#</a> Introduction</h4><p><span class="notranslate"> LVE Stats 2 </span> complex has scalable architecture, which allows to connect custom plugins.</p><p><span class="notranslate"> LVE Stats </span> server searches for plugins in the directory which is specified with plugins parameter of server’s <em>/etc/sysconfig/lvestats2</em> configuration file. Default directory is <span class="notranslate"><em>/usr/share/lve-stats/plugins</em>. </span></p><p>Each plugin must be of a <span class="notranslate"> Python </span> class, must be written in <span class="notranslate"> Python </span> language and its file must have <span class="notranslate"> .py </span> extension. Files with all other extensions will be ignored. For normal server work access permission 400 is enough; owner – <span class="notranslate"> root </span> .</p><p>Plugin classes can be of the same name, but better not, because classes&#39; names can affect the set of parameters in <span class="notranslate"><em>set_config</em></span> method. You can find detailed plugins&#39; configuring information below, in appropriate chapter.</p><p>Plugin class must contain <span class="notranslate"><em>execute()</em></span> method, which is invoked by the server every 5 seconds (by default, can be changed by interval parameter of configuration file). Also <span class="notranslate"> set_config </span> method (configuration settings) can be available. You can find more info in <span class="notranslate"><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#plugin-configuration" class="router-link-active router-link-exact-active">Plugins Configuration</a></span> chapter.</p><p>Additionally the following attributes can be set (plugin class instance variable):</p><ul><li><span class="notranslate"> order (integer) </span> - defines plugin&#39;s position in the server&#39;s plugin list, (more info in <span class="notranslate"> Servers Plugin Arrangement </span> ).</li><li><span class="notranslate"> timeout (integer </span> or <span class="notranslate"> float </span> ) – the longest allowable duration of one launch of the plugin (execute method). Default value of <span class="notranslate"> timeout </span> parameter is 5 seconds.</li><li><span class="notranslate"> period (integer) </span> – sets the interval between two launches of execute plugin method in seconds. If not defined, then plugin runs every 5 seconds ( <span class="notranslate"> interval </span> parameter in configuration file).</li></ul><p>When <span class="notranslate"><em>execute()</em></span> method of the plugin is invoked, the server creates an attribute <span class="notranslate"><em>now</em></span> in it, where launch time is recorded. This value is equal to what a standard Python function <span class="notranslate"><em>time.time()</em></span> returns. All the plugins launched one after another receive the same  value of <span class="notranslate"><em>now</em></span> attribute from the server. <span class="notranslate"><em>now</em></span> is overwritten before <span class="notranslate"><em>execute()</em></span> method is invoked.</p><p>The previous value of now attribute is not saved by the server. If plugin needs it, it has to save it by itself.</p><p>Plugin class can be inherited from <span class="notranslate"><em>LveStatsPlugin</em></span> class, which is the part of the server itself. This is not obligatory, but inheritance can help to avoid different errors in servers work, particularly if a plugin doesn&#39;t contain required execute method.</p><p><span class="notranslate"><em>LveStatsPlugin</em></span> class is defined in the file: <span class="notranslate"><em>/opt/alt/python27/lib/python2.7/site-packages/lvestats/core/plugin.py</em> . </span></p><h4 id="server-plugin-arrangement" tabindex="-1"><a class="header-anchor" href="#server-plugin-arrangement" aria-hidden="true">#</a> Server plugin arrangement</h4><p>When the server starts, it performs the search of plugins in the directory specified in <em>/etc/sysconfig/lvestats2</em> configuration file. This directory is scanned only when the server starts, therefore if any plugin was added into the directory, the server has to be restarted with the following command:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service lvestats restart.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>After successful restart, the plugins are graded and executed ascending by <span class="notranslate"><em>order</em></span> attribute. If any plugin <span class="notranslate"><em>order</em></span> attribute is not set, it is considered as a <span class="notranslate"> Python </span> language constant <em>sys.maxint</em> (which is usually 9223372036854775807). This in fact means that such plugins will be executed in the last. If any plugins has similar <span class="notranslate"><em>order</em></span> meanings, their execution order is unpredictable.</p><p>The server invokes <span class="notranslate"><em>execute</em></span> method of all plugins one after another.</p><p>When the server invokes <span class="notranslate"><em>execute()</em></span> method of any plugin, it transmits a data dictionary ( <span class="notranslate"><em>lve_data</em></span> argument) into plugin. The dictionary is common for all the plugins. Any plugin can read, write and change any data in this dictionary. <span class="notranslate"> LVE Stats 2 </span> server doesn&#39;t control this area. That is why one must be careful while developing new plugins, in order not to change or corrupt other plugins&#39; data which can break their functionality.</p><p>If an exception occurs in <span class="notranslate"><em>execute()</em></span> method, its text and <span class="notranslate"> python </span> stack trace is recorded into server log <em>/var/log/lve-stats</em> and all the changes made to <span class="notranslate"><em>lve_data</em></span> dictionary before the exception happened are lost.</p><p>The keys of the <span class="notranslate"><em>lve_data</em></span> dictionary are recommended to look like <span class="notranslate"> “ <em>PluginName_Key</em> ” </span> , in order the plugins do not corrupt other data accidentally.</p><p>Server contains some standard plugins which define and use the following keys in the common dictionary <span class="notranslate"> lve_data: <em>LVE_VERSION, stats, old_stats, procs</em></span> and <span class="notranslate"><em>lve_usage</em></span> . User plugins can use data from these keys, but it is recommended not to change them if there is no special need, because it can break the next plugins in the execution queue.</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>Key</td><td>Content</td></tr><tr><td><span class="notranslate"><code>LVE_VERSION</code></span></td><td>LVE version. The same as console command <span class="notranslate"><code>lvectl lve-version</code></span> produces.</td></tr><tr><td><span class="notranslate"><code>stats</code></span></td><td>Dictionary, that contains lve id’s as keys and LVEStat class objects as values. Every LVEStat object contains values of usages and limits taken from <span class="notranslate"><em>/proc/lve/list</em></span> file for every <span class="notranslate"> LVE Id </span> . Dictionary keys – <span class="notranslate"> integer lve id </span> , including 0 for “ <span class="notranslate"> default </span> ” LVE. This dictionary is updated on each iteration of lvestats-server (every 5 seconds by default). LVEStat – is a standard server class, it can be imported with the command from <span class="notranslate"><em>lvestats.core.lvestat</em></span> <code>import LVEStat.</code> The class is described in the file <span class="notranslate"><em>/opt/alt/python27/lib/python2.7/site-packages/lvestats/core/lvestat.py</em></span> . Here you can find the whole list of data fields and their functions.</td></tr><tr><td><span class="notranslate"><code>old_stats</code></span></td><td><em>stats</em> content from the previous iteration. Before the first iteration – empty dictionary.</td></tr><tr><td><span class="notranslate"><code>totalHz</code></span></td><td>When LVE_VERSION is 4, real <span class="notranslate"> CPU </span> frequency in <span class="notranslate"> Hz </span> multiplied by number of cores. When LVE_VERSION &gt; 4, <span class="notranslate"> CPU </span> speed is in conventional units and equals to 1000000000 * cores (1 <span class="notranslate"> GHz </span> per core).</td></tr><tr><td><span class="notranslate"><code>procs</code></span></td><td>Quantity of <span class="notranslate"> CPU </span> cores.</td></tr><tr><td><span class="notranslate"><code>lve_usages</code></span></td><td>Contains accumulated LVE statistics for each 5-seconds interval in current minute. Cleared each minute.</td></tr><tr><td><span class="notranslate"><code>lve_usage</code></span></td><td>Contains aggregated LVE Statistics for “previous” minute to store to database. Overwritten each minute.</td></tr></tbody></table><p>Each plugin’s instance lifetime is from the moment it was loaded till the server stops working. But if <span class="notranslate"><em>execute()</em></span> method working time exceeds timeout, the plugin will be terminated and restarted in the next iteration. All changes to the <span class="notranslate"><em>lve_data</em></span> dictionary will be lost.</p><p>During servers graceful shutdown (restart, server shutdown, commands <span class="notranslate"><code>service lvestats stop, service lvestats restart</code></span> ), each plugin receives SIGTERM signal. This is useful to correctly unload the plugin (terminate all subsidiary processes, save data to files etc.). If a plugin doesn&#39;t need to “finalize” its execution before termination, then there&#39;s no need to implement this signal handler. Below you can see an example of such handler.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>If a plugin implements handler for SIGTERM, then this handler must end with <span class="notranslate"><code>sys.exit(0)</code></span> command. Otherwise plugin process will not be terminated correctly and will become orphaned.</p></div><h4 id="plugin-configuration" tabindex="-1"><a class="header-anchor" href="#plugin-configuration" aria-hidden="true">#</a> Plugin configuration</h4><p><span class="notranslate"> LVE Stats 2 </span> Server allows to configure each plugin separately.</p><p>On initialization stage the server invokes <span class="notranslate"><em>set_config()</em></span> method of the plugin and locates there a dictionary which contains:</p><ul><li>all parameters from file <em>/etc/sysconfig/lvestats2</em> (global).</li><li>plugin&#39;s individual configuration file parameters (if one exists). Configuration files must be located in <span class="notranslate"><em>/etc/sysconfig/lvestats.config</em></span> directory, have .cfg extension and be the same format as <em>/etc/sysconfig/lvestats2</em> . Files in this directory are matched with the plugins by name. For instance, if plugin class is <span class="notranslate"><em>Plugin1_class</em></span> , then server will try to find and download <span class="notranslate"><em>/etc/sysconfig/lvestats.config/Plugin1_class.cfg</em>. </span> Names are case sensitive. If any plugin doesn&#39;t have an individual configuration file, then it&#39;s not an error. In this case plugin will just receive parameters from <em>/etc/sysconfig/lvestats2</em> .</li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>An individual configuration file of every plugin is loaded after server configuration file. That is why if it contains any parameters with names similar to ones of server config, then plugin will use parameters from its individual config rather than server config parameters.</p><p>If a plugin doesn&#39;t require any configuration to be done, then set_config method can be skipped.</p><p>In addition, plugins can use their own configuration methods.</p></div><h4 id="types-of-plugins" tabindex="-1"><a class="header-anchor" href="#types-of-plugins" aria-hidden="true">#</a> Types of plugins</h4><p>According to server architecture, plugins can be of the following types:</p><ul><li><span class="notranslate"> collectors </span></li><li><span class="notranslate"> analyzers </span></li><li><span class="notranslate"> persistors </span></li><li><span class="notranslate"> notifiers </span></li></ul><p><span class="notranslate"> Collectors </span> are designed to collect information; <span class="notranslate"> analyzers </span> – to analyze it and form some other data on its basis; <span class="notranslate"> persistors </span> – to save information from the common dictionary into files, databases, etc.; <span class="notranslate"> notifiers </span> - to notify system users about any events.</p><p>This division is rather arbitrary. There is an opportunity to execute all the actions on collection, analysis and saving the information in one and only plugin. But at the same time the division into functionally independent parts allows to build flexible and easily configurable system for collecting and processing the data.</p><p>Also it is possible to implement the systems of lazy-write, planning of collecting/processing tasks and notifying users about different events.</p><h4 id="examples-of-plugins" tabindex="-1"><a class="header-anchor" href="#examples-of-plugins" aria-hidden="true">#</a> Examples of plugins</h4><p>Here is a practical example of a user plugin.</p><p>Specification:</p><ol><li><p>To trace specified file size changes. The name of file being traced must be specified in configuration file, which allows to change it without modifying the plugin itself. If file size has been changed, it has to be written as a message into our log. The name of log must be specified in configuration file as well.</p></li><li><p>File size must be checked with default interval (5 seconds), and log notification must be held once a minute (to avoid resource expend for possibly regular write).</p></li><li><p>System administrator must receive emails with file size at the moment the email was sent. These notifications must be sent even if the file size hasn’t been changed. Notification emails must be read periodicity from configuration file as well as sender/receiver emails .</p></li></ol><p>As file size check, fixing the result and notification sending must be held with different periods, then it’s impossible to realize all the tasks by means of one plugin. The fact that one minute (60 seconds) is multiple to 5 seconds doesn’t matter in this case, because default period can be changed in server’s configuration file, but the condition of fixing the result once a minute is a part of the specification, which can not be violated. In addition, notification email period is known in advance, as it is specified by user in configuration file.</p><p>That is why we realize 4 plugins: <span class="notranslate"><strong>collector, analyzer, persistor</strong></span> and <span class="notranslate"><strong>notifier</strong></span>.</p><h4 id="collector" tabindex="-1"><a class="header-anchor" href="#collector" aria-hidden="true">#</a> <strong>Collector</strong></h4><p><span class="notranslate"> Collector&#39;s </span> aim is to determine the size of a proper file.</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># FSize_watcher_collector.py
# Example plugin for monitoring file size.
# Part 1. Collector

import os
from lvestats.core.plugin import LveStatsPlugin

# Key name
COLLECTOR_KEY = &#39;FSizeWatcher_fsize&#39;
COLLECTOR_KEY_FILENAME = &#39;FSizeWatcher_fname&#39;

class FSize_watcher_collector (LveStatsPlugin):
	# this plugin should be first in chain
	order = 0
	# File to monitoring
	file_to_monitoring = None

	def __init__(self):
		pass

	# Sets configuration to plugin
	def set_config(self, config):
		self.file_to_monitoring = config.get(&#39;file_to_monitoring&#39;, None)
		pass
	# Work method
	def execute(self, lve_data):
		try:
			# if monitoring file absent, do nothing
			if self.file_to_monitoring is None or not os.path.exists(self.file_to_monitoring):
		return

			# Get file size
			stat_info = os.stat(self.file_to_monitoring)
			fsize = stat_info.st_size

			# Place file name and file size to server data dictionary
			lve_data[COLLECTOR_KEY_FILENAME] = self.file_to_monitoring
			lve_data[COLLECTOR_KEY] = fsize
		except (OSError, IOError):
			# file absent or any other error - remove size from dictionary
			del lve_data[COLLECTOR_KEY]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Plugin algorithm is extremely simple – file size is read and written into data dictionary. Files name is read from <span class="notranslate"><em>set_config</em></span> method configuration. If the name is not specified, then <span class="notranslate"> None </span> is written into appropriate variable. All the errors are completely ignored (e.g. if specified file doesn&#39;t exist or there&#39;s no way to read any of it&#39;s information).</p><p><span class="notranslate"><em>order</em></span> attribute is specified as 0 to make this plugin go the first among three. Data collector must always be the first in plugins logical chain, because it provides all the necessary information for the analyzer which goes the next. Specific values of <span class="notranslate"><em>order</em></span> can be of any kind, but what is important is that when the server starts, all the plugins line up in proper sequence: <span class="notranslate"> collector – analyzer – persistor </span> .</p><p>In order to make plugin work, we have to create configuration file <span class="notranslate"><em>/etc/sysconfig/lvestats.config/FSize_watcher_collector.cfg</em></span> with the following content:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># Config file for FSize_watcher_collector plugin
# Please define monitoring file here
# file_to_monitoring = /usr/local/cpanel/logs/error_log
file_to_monitoring = /usr/local/cpanel/logs/access_log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Note that file name <span class="notranslate"><em>FSize_watcher_collector</em></span> without .cfg extension matches plugin class name.</p><p><span class="notranslate"><em>file_to_monitoring</em></span> option is read by plugin in <span class="notranslate"><em>set_config</em></span> method and contains file’s full name for monitoring.</p><p>Files for monitoring, suggested in the actual example - <span class="notranslate"><em>/usr/local/cpanel/logs/error_log</em> and <em>/usr/local/cpanel/logs/access_log</em></span> - are real, these are cPanel control panel logs.</p><p>The first file is errors log; the second is appeal log, is refreshed during common work with panel (e.g. if user email address is changed).</p><p>Errors log tracking is more important, but appeal log monitoring allows to illustrate plugins work more in details, because it is refreshed more often.</p><p>Note that plugin can monitor one file only.</p><h4 id="analyzer" tabindex="-1"><a class="header-anchor" href="#analyzer" aria-hidden="true">#</a> <strong>Analyzer</strong></h4><p><span class="notranslate"> Analyzer </span> decides if the file&#39;s size has changed and gives a command to persistor to refresh log.</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># FSize_watcher_analyzer.py
# Example plugin for monitoring file size.
# Part 2. Analyzer

from lvestats.core.plugin import LveStatsPlugin

# Key name from collector plugin
COLLECTOR_KEY = &#39;FSizeWatcher_fsize&#39;

# Key name 1 for saver plugin
SAVER_KEY = &#39;FSizeWatcher_fsize_to_store&#39;
# Key name 2 for saver plugin
SAVER_DATA_PRESENCE = &#39;FSizeWatcher_fsize_present&#39;

class FSize_watcher_analyzer (LveStatsPlugin):
	# this plugin should be second in chain
	order = 1
	# Last file size
	file_last_size = 0
	# Plugin run period in secondsperiod = 60

	def __init__(self):
		pass

	# work method
	def execute(self, lve_data):
		# Default setting for saver
		lve_data[SAVER_DATA_PRESENCE] = 0
		# Check presence data
		if COLLECTOR_KEY not in lve_data:
		return

		# Get file size from server data dictionary
		fsize = lve_data[COLLECTOR_KEY]

		# Check, if file size changed, store it for saver plugin
		if fsize == self.file_last_size:
			return

		# Put new size for saver plugin
		lve_data[SAVER_KEY] = fsize
		self.file_last_size = fsize
		lve_data[SAVER_DATA_PRESENCE] = 1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>This plugin is extremely simple as well. It starts after <span class="notranslate"> collector (order=1) </span> , searches for file size in the dictionary and compares it with the previous index. If it has changed, then it writes a sign of presence of a new size into the dictionary. If no changes seen, then sign resets. The previous file size is stored in the plugin itself in <span class="notranslate"><em>file_last_size</em></span> variable. Note that they are stored during the whole server <span class="notranslate"> lve-stats </span> lifetime.</p><p>If file size is not found in data dictionary, then plugin just ends.</p><p>All the errors are completely ignored.</p><p><span class="notranslate"> Analyzer </span> is unconfigurable, that is why it doesn’t require any configuration file and it doesn’t contain <span class="notranslate"><em>set_config</em></span> method.</p><p>Plugin starts every 60 seconds (1 minute), because we need data fixation to be performed one time in a minute.</p><h4 id="persistor" tabindex="-1"><a class="header-anchor" href="#persistor" aria-hidden="true">#</a> <strong>Persistor</strong></h4><p><span class="notranslate"> Persistor </span> saves information from the common dictionary into files, databases, etc.</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># FSize_watcher_saver.py
# Example plugin for monitoring file size and last modification date-time.
# Part 3. Data saver

import signal
import sys
import time
from lvestats.core.plugin import LveStatsPlugin

# Key name 1 for saver plugin
SAVER_KEY = &#39;FSizeWatcher_fsize_to_store&#39;
# Key name 2 for saver plugin
SAVER_DATA_PRESENCE = &#39;FSizeWatcher_fsize_present&#39;
# Monitoring file name
COLLECTOR_KEY_FILENAME = &#39;FSizeWatcher_fname&#39;

class FSize_watcher_saver (LveStatsPlugin):
	# this plugin should be third in chain
	order = 2
	# Plugin run period in seconds
	period = 60
	# Log filename
	log_file_name = None
	# First run flag
	is_first_run = True

	def __init__(self):
		signal.signal(signal.SIGTERM, self.sigterm_handler)

	# Sets configuration to plugin
	def set_config(self, config):
		# Get log filename
		self.log_file_name = config.get(&#39;log_filename&#39;, None)

	# work method
	def execute(self, lve_data):
		# do nothing, if log file not defined
		if not self.log_file_name:
			return
		try:
			# Check presence data
			if SAVER_DATA_PRESENCE not in lve_data or lve_data[SAVER_DATA_PRESENCE] == 0:
				# No data
				return
			# Get file size from server data dictionary
			fsize = lve_data[SAVER_KEY]

			# Store data to log
			f = open(self.log_file_name, &#39;a&#39;)
			if self.is_first_run:
				f.write(&#39;%s - FSize_watcher started. Monitoring file: %s, saving data period=%d sec\n&#39; % (time.asctime(time.localtime()), lve_data[COLLECTOR_KEY_FILENAME], self.period))
				self.is_first_run = False
			f.write(&#39;%s - FSize_watcher: file size is %d bytes\n&#39; % (time.asctime(time.localtime()), fsize))
			f.close()
		except:
			# Ignore all errors
			pass

	# Terminate handler
	def sigterm_handler(self, signum, frame):
		if self.log_file_name:
			try:
				# Store data to log file
				f = open(self.log_file_name, &#39;a&#39;)
				f.write(&#39;%s - File watcher saver plugin: TERMINATE\n&#39; % time.asctime(time.localtime()))
				f.close()
				pass
			except:
				# Ignore all errors
				pass
		# Terminate process
		sys.exit(0)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Configuration file <span class="notranslate"><code>/etc/sysconfig/lvestats.config/FSize_watcher_saver.cfg</code></span>:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># Config file for FSize_watcher_saver.py plugin
# Please define log filename here
log_filename = /var/log/FSize_watcher.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>This plugin starts after <span class="notranslate"> analyzer (order=2) </span> , checks new file size <span class="notranslate"><code>presence</code></span> flag, and if positive – writes it into log. If the flag is cleared (which means the size hasn&#39;t changed), then plugin simply ends.</p><p>Starts once in a minute (period=60).</p><p>Also this plugin shows the work of signal handler.</p><p>Plugin constructor registers handler-function of a proper signal: <span class="notranslate"><em>signal.signal(signal.SIGTERM, self.sigterm_handler)</em> . </span> This means, that when the server finishes its work, then <span class="notranslate"><em>sigterm_handler</em></span> method of plugin class will be invoked. In the actual example the function just writes a notification into log, tracing the fact of it&#39;s invocation.</p><p>Pay attention on <span class="notranslate"><em>sys.exit(0)</em></span> command in the end of the handler. Find the information on it in <span class="notranslate"><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#server-plugin-arrangement" class="router-link-active router-link-exact-active">Server Plugin Arrangement</a></span> section.</p><p>In addition see into examples of file log <span class="notranslate"><em>/var/log/FSize_watcher.log</em></span> formed by the plugins above:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Tue Feb  3 13:06:24 2015 - FSize_watcher started. Monitoring file: /usr/local/cpanel/logs/access_log, saving data period=60 sec
Tue Feb  3 13:06:24 2015 - FSize_watcher: file size is 122972890 bytes
Tue Feb  3 13:07:25 2015 - FSize_watcher: file size is 122975507 bytes
Tue Feb  3 13:08:25 2015 - FSize_watcher: file size is 122978124 bytes
Tue Feb  3 13:09:25 2015 - FSize_watcher: file size is 122978997 bytes
Tue Feb  3 13:10:25 2015 - FSize_watcher: file size is 122981033 bytes
Tue Feb  3 13:11:25 2015 - FSize_watcher: file size is 122982052 bytes
Tue Feb  3 13:13:25 2015 - FSize_watcher: file size is 122983798 bytes
Tue Feb  3 13:20:15 2015 - File watcher saver plugin: TERMINATE
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>and</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Thu Feb  5 13:07:27 2015 - FSize_watcher started. Monitoring file: /usr/local/cpanel/logs/error_log, saving data period=60 sec
Thu Feb  5 13:07:27 2015 - FSize_watcher: file size is 14771849 bytes
Thu Feb  5 14:03:32 2015 - FSize_watcher: file size is 14771995 bytes
Thu Feb  5 15:01:36 2015 - FSize_watcher: file size is 14772434 bytes
Thu Feb  5 17:15:47 2015 - FSize_watcher: file size is 14772873 bytes
Thu Feb  5 18:47:54 2015 - FSize_watcher: file size is 14775213 bytes
Thu Feb  5 19:11:56 2015 - FSize_watcher: file size is 14775652 bytes
Thu Feb  5 21:09:05 2015 - FSize_watcher: file size is 14776091 bytes
Thu Feb  5 23:06:14 2015 - FSize_watcher: file size is 14776530 bytes
Fri Feb  6 00:47:23 2015 - FSize_watcher: file size is 14778870 bytes
Fri Feb  6 01:02:24 2015 - FSize_watcher: file size is 14779309 bytes
Fri Feb  6 02:00:28 2015 - FSize_watcher: file size is 14779434 bytes
Fri Feb  6 03:16:34 2015 - FSize_watcher: file size is 14779873 bytes
Fri Feb  6 05:04:42 2015 - FSize_watcher: file size is 14779998 bytes
Fri Feb  6 05:12:43 2015 - FSize_watcher: file size is 14780437 bytes
Fri Feb  6 05:56:50 2015 - FSize_watcher: file size is 14780551 bytes
Fri Feb  6 06:01:50 2015 - FSize_watcher: file size is 14780975 bytes
Fri Feb  6 06:03:51 2015 - FSize_watcher: file size is 14782183 bytes
Fri Feb  6 06:04:51 2015 - FSize_watcher: file size is 14782575 bytes
Fri Feb  6 06:18:52 2015 - FSize_watcher: file size is 14782647 bytes
Fri Feb  6 06:21:52 2015 - FSize_watcher: file size is 14782898 bytes
Fri Feb  6 06:48:54 2015 - FSize_watcher: file size is 14785238 bytes
Fri Feb  6 07:09:56 2015 - FSize_watcher: file size is 14785677 bytes
Tue Feb  6 08:03:15 2015 - File watcher saver plugin: TERMINATE
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>You can see that log record is being held once a minute (what we actually need), new file size is written.</p><p>Also we can notice that handler <span class="notranslate"> SIG_TERM </span> was executed, signaling that plugin received the notification about server shut-down.</p><h4 id="notifier" tabindex="-1"><a class="header-anchor" href="#notifier" aria-hidden="true">#</a> <strong>Notifier</strong></h4><p><span class="notranslate">Notifier</span> informs system users about any events.</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># FSize_watcher_saver.py
# Example plugin for monitoring file size and last modification date-time.
# Part 4. Notifier

import time
import smtplib

from lvestats.lib.commons import dateutil
from lvestats.core.plugin import LveStatsPlugin


# Key name
COLLECTOR_KEY_FSIZE = &#39;FSizeWatcher_fsize&#39;
COLLECTOR_KEY_FILENAME = &#39;FSizeWatcher_fname&#39;

# email message pattern
EMAIL_MESSAGE_PATTERN = &quot;&quot;&quot;Hello, administrator!
Size of the file &#39;%s&#39; is %d bytes.
&quot;&quot;&quot;


class FSize_watcher_notifier (LveStatsPlugin):
	# Default period
	DEFAULT_PERIOD_STR = &#39;12h&#39;
	# this plugin should be third in chainorder = 3
	# Timeout
	timeout = 20
	# Notifier Log filename
	log_file_name = &#39;/var/log/FSize_watcher_notifier.log&#39;
	# Email from address
	email_from = None
	# Email to address
	email_to = None
	# Email subject
	email_subject = None
	# Sets configuration to plugin
	def set_config(self, config):
		# Email settings
		self.email_from = config.get(&#39;notify_from_email&#39;, None)
		self.email_to = config.get(&#39;notify_to_email&#39;, None)
		self.email_subject = config.get(&#39;notify_from_subject&#39;, &#39;Message from FSize_watcher_notifier plugin&#39;)
		# Notify period
		s_period = config.get(&#39;notify_period&#39;, None)
		if s_period:
			self.period = dateutil.parse_period2(s_period)
		else:
			self.period = dateutil.parse_period2(FSize_watcher_notifier.DEFAULT_PERIOD_STR)
		f = open(self.log_file_name, &#39;a&#39;)
		f.write(&#39;%s - FSize_watcher_notifier plugin: configure\n&#39; % time.asctime(time.localtime()))
		f.write(&#39;       - Period: %s\n&#39; % self.period)
		f.write(&#39;       - From: %s\n&#39; % self.email_from)
		f.write(&#39;       - To: %s\n&#39; % self.email_to)
		f.write(&#39;       - Subject: \&#39;%s\&#39;\n&#39; % self.email_subject)
		f.close()

	# work method
	def execute(self, lve_data):
		if COLLECTOR_KEY_FSIZE not in lve_data or COLLECTOR_KEY_FILENAME not in lve_data:
			return
		if not self.email_from or not self.email_to:
			f = open(self.log_file_name, &#39;a&#39;)
			f.write(&#39;%s - FSize_watcher_notifier plugin error: email_from or email_to not set\n&#39;)
			f.close()
			return
		try:
			from email.mime.text import MIMEText
			# Send email
			msg = MIMEText(EMAIL_MESSAGE_PATTERN % (lve_data[COLLECTOR_KEY_FILENAME], lve_data[COLLECTOR_KEY_FSIZE]))
		msg[&#39;Subject&#39;] = self.email_subject
		msg[&#39;From&#39;] = self.email_from
		msg[&#39;To&#39;] = self.email_to

		s = smtplib.SMTP(&#39;localhost&#39;)
		s.sendmail(self.email_from, [self.email_to], msg.as_string())
			s.quit()

		f = open(self.log_file_name, &#39;a&#39;)
			f.write(&#39;%s - FSize_watcher_notifier plugin: email message was successfully sent\n&#39; % time.asctime(time.localtime()))
			f.close()
			except Exception as e:
			f = open(self.log_file_name, &#39;a&#39;)
			f.write(&#39;%s - FSize_watcher_notifier plugin error:\n%s\n&#39; % (time.asctime(time.localtime()), str(e)))
			f.close()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Configuration file <span class="notranslate"><em>/etc/sysconfig/lvestats.config/FSize_watcher_notifier.cfg</em> : </span></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># Config file for FSize_watcher_notifier.py plugin
# Please define email options here

NOTIFY_FROM_EMAIL=user@hostname
NOTIFY_FROM_SUBJECT=Message from FSize_watcher_notifier
NOTIFY_TO_EMAIL=admin@hostname
NOTIFY_PERIOD=12h
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Plugin’s index number equals 3 ( <span class="notranslate"> order=3 </span> ), that is why <span class="notranslate"> notifier </span> starts after the rest. But since it uses only data formed by <span class="notranslate"> collector </span> , then its order may equal any number bigger that <span class="notranslate"> collectors </span> order (&gt;0).</p><p><span class="notranslate"> Notifier </span> reads the necessary parameters from the configuration (email address, topic, period) and writes them into its own log as reference.</p><p>Plugin’s <span class="notranslate"><em>execute</em></span> method checks the availability of all the necessary data (email parameters, collectors data) and sends the message. All the notifications are written into the <span class="notranslate"> notifier&#39;s </span> own log.</p><p>If any data is missing, the message is not sent.</p><p>Log example:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Thu Feb  5 11:51:34 2015 - FSize_watcher_notifier plugin: configure
       - Period: 60.0
       - From: user@hostname
       - To: admin@hostname
       - Subject: &#39;Message from FSize_watcher_notifier&#39;
Thu Feb  5 11:51:35 2015 - FSize_watcher_notifier plugin: email message was successfully sent
Thu Feb  5 11:52:35 2015 - FSize_watcher_notifier plugin: email message was successfully sent
Thu Feb  5 11:53:35 2015 - FSize_watcher_notifier plugin: email message was successfully sent
Thu Feb  5 11:54:35 2015 - FSize_watcher_notifier plugin: email message was successfully sent
Thu Feb  5 11:57:00 2015 - FSize_watcher_notifier plugin: configure
       - Period: 43200.0
       - From: user@hostname
       - To: admin@hostname
       - Subject: &#39;Message from FSize_watcher_notifier&#39;
Thu Feb  5 11:57:00 2015 - FSize_watcher_notifier plugin: email message was successfully sent
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><h4 id="file-info-and-format-for-var-lve-info-file" tabindex="-1"><a class="header-anchor" href="#file-info-and-format-for-var-lve-info-file" aria-hidden="true">#</a> File info and format for /var/lve/info file</h4><p>This file is used by control panels to display to user their &#39;current&#39; usage. The file is updated every 5 seconds by lve-stats.</p><p>When writing to this file we make sure that: average <span class="notranslate"> CPU/IOPS/MEM </span> is never greater then <span class="notranslate"> LIMIT </span> for that resource.</p><p>Example:</p><p>0,0,20,0,2500,0,262144,0,0,262144,0,0,100,0,0,0,0,1024,1024,0,0,0,0 600,1,20,2492,2500,70,262144,0,0,262144,33,0,100,1,0,0,0,1024,1024,0,5,0,0 200,0,20,0,2500,0,262144,0,0,262144,0,0,100,0,0,0,0,1024,1024,0,0,0,0 500,0,20,0,2500,0,262144,0,0,262144,0,0,100,0,0,0,0,1024,1024,0,0,0,0</p><p>First line of the file is &#39; <span class="notranslate"> default limits </span> &#39;.</p><p>Fields:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># 0 - id
# 1 - mep (average entry processes)
# 2 - lep  (limit ...)
# 3 - cpu_usage (average speed)
# 4 - lcpu (limit spped)
# 5 - mem_usage (average virtual memory)
# 6 - lmem (limit ...)
# 7 - mem_fault (number of virtual memory faults)
# 8 - mep_fault (number of entry processes faults)
LVE_VERSION &gt;=6
# 9 - lmemphy (limit physical memory)
# 10 - memphy (average ...)
# 11 - memphy_fault (faults ...)
# 12 - lnproc (limit number of processes)
# 13 - nproc (average ...)
# 14 - nproc_fault (faults ...)
# 15 - lcpuw (CPU weight -- deprecated not used)
# 16 - io_usage (average IO usage)
# 17 - io_limit (limit ...)
LVE_VERSION &gt;=8
#18 - liops  (limit IOPS)
#19 - iops (average IOPS)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>You can also use <a href="/cloudlinuxos/command-line_tools/#lve-stats-2" class="">LVE-stats 2 CLI</a></p></div><h3 id="troubleshooting" tabindex="-1"><a class="header-anchor" href="#troubleshooting" aria-hidden="true">#</a> Troubleshooting</h3><p><span class="notranslate"> lvestats </span> service and utilities write fatal errors to system log.</p><p>There is <span class="notranslate"><code>/var/log/lve-stats.log</code></span> file with additional information (warnings, tracebacks for errors).</p><p>To see which letters were sent via lves-tats notifier in the logs, do the following:</p><ol><li>In the <code>/etc/sysconfig/lvestats2</code>, specify <code>logging_level=debug</code>;</li><li>Execute the <code>service lvestats restart</code> command.</li></ol><h2 id="cagefs" tabindex="-1"><a class="header-anchor" href="#cagefs" aria-hidden="true">#</a> CageFS</h2><h3 id="general-information-and-requirements-2" tabindex="-1"><a class="header-anchor" href="#general-information-and-requirements-2" aria-hidden="true">#</a> General Information and Requirements</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#minimum-requirements" class="router-link-active router-link-exact-active">Minimum Requirements</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#cagefs-quirks" class="router-link-active router-link-exact-active">CageFS Quirks</a></li></ul><p>CageFS is a virtualized file system and a set of tools designed to isolate each user in their own &#39;cage.&#39; Each customer gets their own fully functional CageFS environment, complete with system files, tools, and more.</p><p>Benefits of CageFS:</p><ul><li>Only safe binaries are available to the user.</li><li>Users cannot see or detect other users or their usernames on the server.</li><li>Users cannot access server configuration files, such as Apache configuration files.</li><li>Users have a restricted view of the <em>/proc</em> file system and cannot see other users&#39; processes.</li></ul><p>Despite these restrictions, the user&#39;s environment remains fully functional, and users should not feel limited in any way. No changes to user scripts are required. CageFS will isolate any script execution performed via:</p><ul><li><span class="notranslate"> Apache (suexec, suPHP, mod_fcgid, mod_fastcgi) </span></li><li><span class="notranslate"> LiteSpeed Web Server </span></li><li><span class="notranslate"> Cron Jobs </span></li><li>SSH</li><li>Any other <span class="notranslate"> PAM </span>-enabled service</li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>mod_php is not supported, and MPM ITK requires a custom patch.</p></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>CageFS is not supported for H-Sphere.</p></div><p>See also <a href="/cloudlinuxos/limits/#compatibility-matrix" class="">Compatibility Matrix</a>.</p><h4 id="minimum-requirements" tabindex="-1"><a class="header-anchor" href="#minimum-requirements" aria-hidden="true">#</a> Minimum Requirements:</h4><ul><li>Kernel: CL6 with lve1.2.17.1 or later, CL7.</li><li>7GB of disk space.</li></ul><p>Depending on your setup and the number of users, you might also need:</p><ul><li>Up to 8MB per customer in the <code>/var</code> directory (to store custom <code>/etc</code> directories).</li><li>5GB to 20GB in the <code>/usr/share</code> directory (to store a safe skeleton of a filesystem).</li></ul><div class="danger custom-block"><p class="custom-block-title">Warning</p><p>If you decide to uninstall CageFS, ensure you follow the <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#uninstalling" class="router-link-active router-link-exact-active">uninstall instructions</a>.</p></div><h4 id="cagefs-quirks" tabindex="-1"><a class="header-anchor" href="#cagefs-quirks" aria-hidden="true">#</a> CageFS Quirks</h4><p>Due to its design, some features may not work as expected or may require adjustments:</p><ul><li>The <code>lastlog</code> command will not work (<span class="notranslate"><code>/var/log/lastlog</code></span>).</li><li>PHP will load <code>php.ini</code> from <span class="notranslate"><code>/usr/selector/php.ini</code></span>. This file is a link to the actual <code>php.ini</code> file on your system, ensuring the same <code>php.ini</code> is ultimately loaded.</li><li>You must run <span class="notranslate"><code>cagefsctl --update</code></span> whenever you modify <code>php.ini</code> or need new/updated software inside CageFS.</li><li>CageFS installation changes <span class="notranslate"><code>jailshell</code></span> to regular bash on cPanel. <a href="https://cloudlinux.zendesk.com/hc/articles/115004517685-Why-CageFS-installation-changes-jailshell-to-regular-bash-on-cPanel-" target="_blank" rel="noopener noreferrer">Learn why</a>.</li></ul><h3 id="installation-and-update-1" tabindex="-1"><a class="header-anchor" href="#installation-and-update-1" aria-hidden="true">#</a> Installation and Update</h3><p>To install CageFS:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install cagefs
/usr/sbin/cagefsctl --init
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>The last command creates a skeleton directory, which may require around 7GB of disk space. If you lack sufficient space in <em>/usr/share</em>, use the following commands to place the <span class="notranslate"><code>cagefs-skeleton</code></span> in a different location:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mkdir /home/cagefs-skeleton
ln -s /home/cagefs-skeleton /usr/share/cagefs-skeleton
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Execute these commands before running <span class="notranslate"><code>cagefsctl --init</code></span>.</p><p>Additionally, approximately 4KB of disk space per user is required for the <span class="notranslate"><code>/var/cagefs</code></span> directory. Ensure this directory is located on a partition with sufficient space and disk quota enabled.</p><p>For example, to create the <span class="notranslate"><code>/var/cagefs</code></span> directory on the <span class="notranslate"><code>/home</code></span> partition, execute the following commands before running <span class="notranslate"><code>cagefsctl --init</code></span>:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mkdir /home/cagefs
ln -s /home/cagefs /var/cagefs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="danger custom-block"><p class="custom-block-title">IMPORTANT</p><p>Ensure disk quota is enabled for the partition where the <span class="notranslate"><code>/var/cagefs</code></span> directory is located, or move it to a partition with disk quota enabled. This prevents users from abusing disk quota inside CageFS.</p></div><p>If the <code>/var/cagefs</code> directory already exists, you can move it. Learn how to move the <code>/var/cagefs</code> directory: <a href="https://docs.cloudlinux.com./#moving-var-cagefs-directory" target="_blank" rel="noopener noreferrer">https://docs.cloudlinux.com./#moving-var-cagefs-directory</a></p><div class="danger custom-block"><p class="custom-block-title">IMPORTANT</p><p>If you place the skeleton in the <span class="notranslate"><code>/home</code></span> directory on cPanel servers, configure the following option in cPanel WHM: <span class="notranslate"><strong>WHM -&gt; Server Configuration -&gt; Basic cPanel/WHM Setup -&gt; Basic Config -&gt; Additional home directories</strong></span>. Set the value to blank (not the default <span class="notranslate"> Home </span>). Without this change, cPanel will create new accounts in incorrect locations.</p></div><p>CageFS automatically detects and configures all necessary files for:</p><ul><li>cPanel</li><li>Plesk</li><li>DirectAdmin</li><li>ISPmanager</li><li>Interworx</li><li>MySQL</li><li>PostgreSQL</li><li>LiteSpeed</li></ul><p>A web interface for managing CageFS is available for cPanel, Plesk 10+, DirectAdmin, ISPmanager, and Interworx. For other control panels, use the command-line tool.</p><p>Once the template is initialized, you can start enabling users. By default, CageFS is disabled for all users.</p><p>Starting from <strong>cagefs-6.1-27</strong>, the <span class="notranslate"><code>fs.proc_can_see_other_uid</code></span> setting is migrated (one time) from <em>/etc/sysctl.conf</em> to <em>/etc/sysctl.d/90-cloudlinux.conf</em>. If this variable is not set in either file, it defaults to 0.</p><p>It is strongly recommended not to set this variable in <code>90-cloudlinux.conf</code>. Instead, define it in <code>/etc/sysctl.conf</code> or another config file with an index number greater than <code>90-cloudlinux.conf</code>, such as <code>/etc/sysctl.d/95-custom.conf</code>.</p><p>For more information on the automatic migration of <span class="notranslate"><code>fs.proc_can_see_other_uid</code></span>, see <a href="/cloudlinuxos/cloudlinux_os_kernel/#kernel-config-variables" class="">Kernel Config Variables</a>.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>You can also use <a href="/cloudlinuxos/command-line_tools/#cagefs" class="">CageFS CLI</a>.</p></div><h3 id="uninstalling" tabindex="-1"><a class="header-anchor" href="#uninstalling" aria-hidden="true">#</a> Uninstalling</h3><p>To uninstall CageFS, start by disabling and removing all directories:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/cagefsctl --remove-all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>This command disables CageFS for all customers, unmounts CageFS for all users, and removes the <span class="notranslate"><em>/usr/share/cagefs-skeleton</em> &amp; <em>/var/cagefs</em></span> directories. It does not remove the <em>/etc/cagefs</em> directory.</p><p>To remove the CageFS RPM:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum remove cagefs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h3 id="managing-users" tabindex="-1"><a class="header-anchor" href="#managing-users" aria-hidden="true">#</a> Managing users</h3><p>CageFS provides for two modes of operations:</p><ol><li>Enabled for all, except those that are disabled.</li><li>Disabled for all, except those that are enabled.</li></ol><p>Mode #1 is convenient for production operation, where you want all new users to automatically be added to CageFS. Mode #2 is convenient while you test CageFS, as it allows you to enable it on one by one for your customers.</p><p>To start using CageFS you have to select one of the mode of operations:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/cagefsctl --enable-all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> or <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/cagefsctl --disable-all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> or <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/cagefsctl --toggle-mode
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> That will switch the operation mode, preserving current disabled/enabled users. <p>To enable individual user do:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/cagefsctl --enable [username]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> To disable individual user: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/cagefsctl --disable [username]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> To list all enabled users: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/cagefsctl --list-enabled
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> To list all disabled users: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/cagefsctl --list-disabled
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> To see current mode of operation: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/cagefsctl --display-user-mode
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>You can also use <a href="/cloudlinuxos/command-line_tools/#cagefs" class="">CageFS CLI</a></p></div><h3 id="configuration-1" tabindex="-1"><a class="header-anchor" href="#configuration-1" aria-hidden="true">#</a> Configuration</h3><ul><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#file-system-templates" class="router-link-active router-link-exact-active">File system templates</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#excluding-files" class="router-link-active router-link-exact-active">Excluding files</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#excluding-users" class="router-link-active router-link-exact-active">Excluding users</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#mount-points" class="router-link-active router-link-exact-active">Mount points</a></p><ul><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#per-user-virtual-mount-points" class="router-link-active router-link-exact-active">Per user virtual mount points</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#split-by-username" class="router-link-active router-link-exact-active">Split by username</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#splitted-by-user-s-uid-mounts" class="router-link-active router-link-exact-active">Splitted by user’s UID mounts</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#mounting-users-home-directory-inside-cagefs" class="router-link-active router-link-exact-active">Mounting user’s home directory inside CageFS</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#how-to-hide-directory-inside-mount-point" class="router-link-active router-link-exact-active">How to hide directory inside mount point</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#example" class="router-link-active router-link-exact-active">Example</a></p></li></ul></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#base-home-directory" class="router-link-active router-link-exact-active">Base home directory</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#postgresql-support" class="router-link-active router-link-exact-active">PostgreSQL support</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#pam-configuration" class="router-link-active router-link-exact-active">PAM configuration</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#filtering-options-for-commands-executed-by-proxyexec" class="router-link-active router-link-exact-active">Filtering options for commands executed by proxyexec</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#executing-by-proxy" class="router-link-active router-link-exact-active">Executing by proxy</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#users-with-duplicate-uids" class="router-link-active router-link-exact-active">Users with duplicate UIDs</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#examples" class="router-link-active router-link-exact-active">Examples</a></p><ul><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#example-1-make-users-in-cagefs-be-able-to-execute-a-script-which-must-work-outside-cagefs" class="router-link-active router-link-exact-active">Example 1. Make users in CageFS be able to execute a script which must work outside CageFS</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#example-2-permissions-escalation" class="router-link-active router-link-exact-active">Example 2. Permissions escalation</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#example-3-custom-proxyexec-wrapper" class="router-link-active router-link-exact-active">Example 3. Custom proxyexec wrapper</a></p></li></ul></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#custom-etc-files-per-customer" class="router-link-active router-link-exact-active">Custom /etc files per customer</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#moving-cagefs-skeleton-directory" class="router-link-active router-link-exact-active">Moving <span class="notranslate"> cagefs-skeleton </span> directory</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#moving-var-cagefs-directory" class="router-link-active router-link-exact-active">Moving /var/cagefs directory</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#tmp-directories" class="router-link-active router-link-exact-active">TMP directories</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#syslog" class="router-link-active router-link-exact-active">Syslog</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#excluding-mount-points" class="router-link-active router-link-exact-active">Excluding mount points</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#shared-memory-dev-shm-isolation-in-cagefs" class="router-link-active router-link-exact-active">Shared memory (/dev/shm) isolation in CageFS</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#preventing-process-from-entering-cagefs-on-error" class="router-link-active router-link-exact-active">Preventing process from entering CageFS on error</a></p></li></ul><h4 id="file-system-templates" tabindex="-1"><a class="header-anchor" href="#file-system-templates" aria-hidden="true">#</a> File system templates</h4><div class="warning custom-block"><p class="custom-block-title">Warning</p><p>Please do not modify any existing files in the <span class="notranslate"><code>/etc/cagefs/conf.d</code></span> directory because they may be overwritten while updating CageFS package. You should create a new file with a unique name instead.</p></div><p>CageFS creates a filesystem template in <span class="notranslate"><code>/usr/share/cagefs-skeleton</code></span> directory. CageFS template will be mounted for each customer. The template is created by running:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/cagefsctl --init
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>To update the template, you should run:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/cagefsctl --update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>The behavior of the commands (and the files copied into <span class="notranslate"><em>/usr/share/cagefs-skeleton</em></span> directory) depends on the configuration files in <em>/etc/cagefs/conf.d</em> You can add additional files, users, groups and devices into CageFS template by adding .cfg file, and running:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/cagefsctl --update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>To delete files from CageFS template, remove corresponding .cfg file, and run:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/cagefsctl --update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Here is an example <span class="notranslate"><em>openssh-clients.cfg</em></span> file:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[openssh-clients]

comment=OpenSSH Clients

paths=/etc/ssh/ssh_config, /bin/hostname, /usr/bin/scp, /usr/bin/sftp, /usr/bin/slogin, /usr/bin/ssh, /usr/bin/ssh-add, /usr/bin/ssh-agent, /usr/bin/ssh-copy-id, /usr/bin/.ssh.hmac, /usr/bin/ssh-keyscan, /usr/libexec/openssh/sftp-server, /etc/environment, /etc/security/pam_env.conf

devices=/dev/ptmx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Example <span class="notranslate"><em>mail.cfg</em></span> file:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[mail]

comment=Mail tools

paths=/bin/mail, /etc/aliases.db, /etc/mail, /etc/mailcap, /etc/mail.rc, /etc/mime.types, /etc/pam.d/smtp.sendmail, /etc/rc.d/init.d/sendmail, /etc/smrsh, /etc/sysconfig/sendmail, /usr/bin/hoststat, /usr/bin/Mail, /usr/bin/mailq.sendmail, /usr/bin/makemap, /usr/bin/newaliases.sendmail, /usr/bin/purgestat, /usr/bin/rmail.sendmail, /usr/lib64/sasl2/Sendmail.conf, /usr/lib/mail.help, /usr/lib/mail.tildehelp, /usr/lib/sendmail.sendmail, /usr/sbin/mailstats, /usr/sbin/makemap, /usr/sbin/praliases, /usr/sbin/sendmail.sendmail, /usr/sbin/smrsh, /var/log/mail, /var/spool/clientmqueue, /var/spool/mqueue

users=smmsp

groups=smmsp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>There is an easy way to add/delete files from particular <span class="notranslate"> RPMs </span> into CageFS. That can be done by using <span class="notranslate"><code>--addrpm</code> and <code>--delrpm</code></span> options in <span class="notranslate"><code>cagefsctl</code></span> . Like:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --addrpm ffmpeg
cagefsctl --update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>ffmpeg RPM should be installed on the system already.</p></div><h4 id="excluding-files" tabindex="-1"><a class="header-anchor" href="#excluding-files" aria-hidden="true">#</a> Excluding Files</h4><p>To exclude files and directories from CageFS, create a file with the <span class="notranslate"><code>.black.list</code></span> extension inside the <span class="notranslate"><code>/etc/cagefs/</code></span> directory. List the files or directories to exclude, one per line.</p><p>Run the following command to apply the changes:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --force-update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><div class="warning custom-block"><p class="custom-block-title">Important</p><p>Do not edit the <span class="notranslate"><code>/etc/cagefs/black.list</code></span> file directly, as it will be overwritten during CageFS package updates.</p></div><h4 id="excluding-users" tabindex="-1"><a class="header-anchor" href="#excluding-users" aria-hidden="true">#</a> Excluding users</h4><p>To exclude users from CageFS, create a file (any name would work) inside <span class="notranslate"><code>/etc/cagefs/exclude</code></span> folder, and list users that you would like to exclude from CageFS in that file (each user in separate line).</p><p>Then execute the following command to apply changes:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --user-status USER
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>And check that the command shows <span class="notranslate"><code>Disabled</code></span>.</p><h4 id="mount-points" tabindex="-1"><a class="header-anchor" href="#mount-points" aria-hidden="true">#</a> Mount points</h4><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Please do not mount the entire <code>/var</code> directory into CageFS (i.e. do not add the <code>/var</code> to the <code>cagefs.mp</code>). This will break CageFS.</p></div><p>CageFS creates individual namespace for each user, making it impossible for users to see each other&#39;s files and creating high level of isolation. The way namespace is organized:</p><ol><li><span class="notranslate"> /usr/share/cagefs-skeleton </span> with safe files is created</li><li>Any directory from the server that needs to be shared across all users is mounted into <span class="notranslate"><code>/usr/share/cagefs-skeleton</code></span> (a list of such directories is defined in /etc/cagefs/cagefs.mp)</li><li><span class="notranslate"> /var/cagefs/[prefix]/username </span> directory for each user. Prefix is defined as last two digits of user id. User id is taken from <span class="notranslate"> /etc/passwd </span> file.</li><li>Separate /etc directory is created and populated for each user inside <span class="notranslate"> /var/cagefs/[prefix]/username </span></li><li>/tmp directory is mounted for each user separately into <span class="notranslate"> ~username/.cagefs/tmp directory </span></li><li>Additional custom directories can be mounted for each user by defining them in /etc/cagefs/cagefs.mp</li><li>You can define custom directories per user using <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#per-user-virtual-mount-points" class="router-link-active router-link-exact-active">virt.mp</a> files <em>[CageFS 5.1 and higher]</em></li></ol><p>To define individual custom directories in /etc/cagefs/cagefs.mp following format is used:</p><p><span class="notranslate"><code>@/full/path/to/directory,permission notation</code></span></p><p>This is useful when you need to give each user its own copy of a particular system directory, like:</p><p><span class="notranslate"><code>@/var/run/screen,777</code></span></p><p>Such entry would create separate <span class="notranslate"> /var/run/screen </span> for each user, with permissions set to 777</p><p>To modify mount points, edit /etc/cagefs/cagefs.mp. Here is an example of cagefs.mp:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/var/lib/mysql
/var/lib/dav
/var/www/cgi-bin
/var/spool
/dev/pts
/usr/local/apache/domlogs
/proc
/opt
@/var/spool/cron,700
@/var/run/screen,777
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>If you want to change mount points, make sure you re-initialize mount points for all customers:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --remount-all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> This command will kill all current processes and reset mount points. <h4 id="per-user-virtual-mount-points" tabindex="-1"><a class="header-anchor" href="#per-user-virtual-mount-points" aria-hidden="true">#</a> <strong>Per user virtual mount points</strong></h4><p><em>[CageFS 5.1 and higher]</em></p><ul><li><em>Please, see <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#split-by-username" class="router-link-active router-link-exact-active">Split by username</a> feature, as it might be simpler to implement in some cases.</em></li></ul><p>Starting with CageFS 5.1 you can specify additional directories to be mounted inside user&#39;s CageFS. This can be specified for each user. To specify virtual mount points for a user, create a file:</p><p><span class="notranslate"><code>/var/cagefs/[prefix]/[user]/virt.mp</code></span></p><p>Inside that file, you can specify mount points in the following format:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>virtdir1,mask
@subdir1,mask
@subdir2,mask
virdir2,mask
@subdir3,mask
@subdir4,mask
&gt;virtdir3,mask
@subdir5,mask
@subdir6,mask
# comments
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><ul><li><span class="notranslate"><em>mask</em></span> is always optional, if missing 0755 is used</li><li>Create virtual directory <span class="notranslate"><em>subdir/virtdir</em></span> , mount it to: <ul><li><span class="notranslate"> skeleton <em>jaildir/virtdir</em></span></li><li>inside virtual directory, create directories <span class="notranslate"><em>subdir1, subdir2</em></span></li><li>mount <span class="notranslate"><em>virtdir1/subdir1</em></span> to <span class="notranslate"><em>subdir/virtdir/subdir1</em></span></li><li>if <span class="notranslate"><em>virtdir</em></span> is started with &gt;, create directory <span class="notranslate"><em>subdir/virtdir</em></span> , but don&#39;t mount it into <span class="notranslate"><em>jaildir</em></span> . This is needed for cases when <span class="notranslate"><em>virtdir</em></span> is inside home base dir.</li></ul></li><li>if file <em>/var/cagefs/[prefix]/[user]/virt.mp</em> is missing -- no virt directories are loaded for that user.</li></ul><p>Note that CageFS will automatically create those files for Plesk 10 &amp; higher.</p><p>For example if we have Plesk 11.5 with two users <span class="notranslate"><em>cltest1</em></span>, and <span class="notranslate"><em>cltest2</em></span>:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cltest1 uid 10000 has domains: cltest1.com, cltest1-addon.com and sub1.cltest1.com
cltest2 uid 10001 has domains: cltest2.com, cltest2-addon.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>In such case we would have file <em>/var/cagefs/00/cltest1/virt.mp</em> :</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&gt;/var/www/vhosts/system,0755
@cltest1-addon.com,0755
@cltest1.com,0755
@sub1.cltest1.com,0755
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>and file: <em>/var/cagefs/01/cltest2/virt.mp:</em></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&gt;/var/www/vhosts/system
@cltest2-addon.com
@cltest2.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><h4 id="split-by-username" tabindex="-1"><a class="header-anchor" href="#split-by-username" aria-hidden="true">#</a> <strong>Split by username</strong></h4><p><em>[CageFS 5.3.1+]</em></p><p>Sometimes you might need to make sure that directory containing all users would show up as containing just that user inside CageFS. For example, if you have directory structure like:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/home/httpd/fcgi-bin/user1
/home/httpd/fcgi-bin/user2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Then we can add the following line to /etc/cagefs/cagefs.mp file:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>%/home/httpd/fcgi-bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>and execute:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --remount-all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>After that each subdirectory of <span class="notranslate"><em>/home/httpd/fcgi-bin</em></span> will be mounted for appropriate user in CageFS: <span class="notranslate"><em>/home/httpd/fcgi-bin/user1</em></span> will be mounted for <span class="notranslate"> user1 </span> and <span class="notranslate"><em>/home/httpd/fcgi-bin/user2</em></span> will be mounted for <span class="notranslate"> user2 </span> .</p><h4 id="splitted-by-user-s-uid-mounts" tabindex="-1"><a class="header-anchor" href="#splitted-by-user-s-uid-mounts" aria-hidden="true">#</a> Splitted by user’s UID mounts</h4><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Requires CageFS v.7.4.2-1 and later</p></div><p>In addition to <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#split-by-username" class="router-link-active router-link-exact-active">splitted by username mounts</a>, there is an ability to “split” mounts by user’s UID. This feature is useful for systems with non-unique UIDs, i.e. when multiple users have the same UID.</p><p>Using splitted by UID mounts is more preferable over splitted by username mounts, because you can mount the same directory for all users with the same UID. Also, splitted by UID mounts work fine with renaming of the users (when username changes but UID remains the same).</p><p>For example if you have a directory structure like the following:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/data/uids/1000/data.db
/data/uids/1001/data.db
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Then you can add the following line to the <code>/etc/cagefs/cagefs.mp</code> file:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>*/data/uids
and execute
cagefsctl --remount-all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>After that each subdirectory of the <code>/data/uids</code> will be mounted for the appropriate user in CageFS. The <code>/data/uids/1000</code> directory will be mounted for the user with UID 1000 and the <code>/data/uids/1001</code> directory will be mounted for the user with UID 1001.</p><h4 id="mounting-users-home-directory-inside-cagefs" tabindex="-1"><a class="header-anchor" href="#mounting-users-home-directory-inside-cagefs" aria-hidden="true">#</a> <strong>Mounting users home directory inside CageFS</strong></h4><p>CageFS 6.1-1 (and later) has improved mounting user’s home directory that is applied for users with home directories like <span class="notranslate"><em>/home/user</em> or <em>/homeN/user</em></span> (where <span class="notranslate"> N </span> = 0,1,..9).</p><p>In such case, earlier versions of CageFS always mount user’s home directory to <span class="notranslate"><em>/home/user</em></span> and create symlink <span class="notranslate"><em>/homeN -&gt; /home</em></span> when needed, so user’s home directory can be accessed both via <span class="notranslate"><em>/home/user</em></span> and <span class="notranslate"><em>/homeN/user</em></span> . This quirk leads to some rare incompatibilities between CageFS and other software (for example OpenCart), because real path of user’s home directory in CageFS and in real file system can differ.</p><p>New CageFS mounts user’s home directory in a way that its real path in CageFS is always the same as in real file system. Additionally, CageFS searches for symlinks like <span class="notranslate"><em>/homeX -&gt; /homeY</em></span> and <span class="notranslate"><em>/homeX/user -&gt; /homeY/user</em></span> in real system and creates such symlinks in user’s CageFS when found.</p><p>This new mounting mode is enabled by default. You can switch to old mounting mode by executing the following commands:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>touch /etc/cagefs/disable.home.dirs.search
cagefsctl --force-update
cagefsctl --remount-all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>New mounting mode will be disabled automatically when &quot;mounting base home directory&quot; mode is enabled <span class="notranslate"> (<code>mount_basedir=1</code> setting in <em>/etc/cagefs/cagefs.base.home.dirs</em></span> file).</p></div><h4 id="how-to-hide-directory-inside-mount-point" tabindex="-1"><a class="header-anchor" href="#how-to-hide-directory-inside-mount-point" aria-hidden="true">#</a> How to hide directory inside mount point <Badge type="warning" text="CageFS 6.4.7-1 +"></Badge></h4><div class="tip custom-block"><p class="custom-block-title">Note</p><p>For files outside a mount point, use blacklisting, see: <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#excluding-files" class="router-link-active router-link-exact-active">Excluding files</a></p></div><p>To hide directories inside a mount point, create a file in the <span class="notranslate"><code>/etc/cagefs/empty.dirs</code></span> directory (you can use any name) with a list of directories to be hidden (these directories will look like empty for users in CageFS).</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Please do not edit the supplied config file (<span class="notranslate"><code>/etc/cagefs/empty.dirs/emptied_dirs.default</code></span>).</p></div><h4 id="example" tabindex="-1"><a class="header-anchor" href="#example" aria-hidden="true">#</a> Example</h4><p>Let’s take a <span class="notranslate"><code>/var/www</code></span> directory which contains the following folders: <span class="notranslate"><code>icons</code></span> and <span class="notranslate"><code>html</code></span>. To hide the <span class="notranslate"><code>/var/www</code></span> directory content from users inside CageFS, we will do the following:</p><ul><li>Create the <span class="notranslate"><code>custom.empty</code></span> file with a single record: <span class="notranslate"><code>/var/www</code></span></li><li>Place the <span class="notranslate"><code>custom.empty</code></span> file to the <span class="notranslate"><code>/etc/cagefs/empty.dirs</code></span> directory</li><li>Run the <span class="notranslate"><code>cagefsctl --remount-all</code></span> command</li></ul><p>Now, all users inside CageFS will see the <span class="notranslate"><code>/var/www</code></span> directory as an empty directory even if there is <span class="notranslate"><code>/var/www/html</code></span> in the <span class="notranslate"><code>/etc/cagefs/cagefs.mp</code></span>.</p><h4 id="base-home-directory" tabindex="-1"><a class="header-anchor" href="#base-home-directory" aria-hidden="true">#</a> Base home directory</h4><p>If you have a custom setup where home directories are in a special format, like: <span class="notranslate"><em>/home/$USERNAME/data</em></span> , you can specify it using regular expressions. This is needed by CageFS to create safe home space for end user, where no other users are visible.</p><p>We will create empty: <span class="notranslate"><em>/var/cagefs/[prefix]/$USERNAME/home</em></span> , and then mount <span class="notranslate"><em>/home/$USERNAME</em></span> in that directory</p><p>To do that, create a file: <span class="notranslate"><em>/etc/cagefs/cagefs.base.home.dirs</em></span></p><p>With content like:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>^/home/
^/var/www/users/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>If there is no such file, the home directory without last component will be considered as a base dir, like with <span class="notranslate"><em>/home/$USERNAME</em></span> we would create <span class="notranslate"><em>/var/cagefs/[prefix]/$USERNAME/home</em></span> , and then mount <span class="notranslate"><em>/home/$USERNAME</em></span> in there</p><p>With <span class="notranslate"><em>/home/$USERNAME/data</em></span> as a home dir, we would assume that <span class="notranslate"><em>/home/$USERNAME</em></span> is the base directory, and we would create <span class="notranslate"><em>/var/cagefs/[prefix]/$USERNAME/home/$USERNAME/data</em></span> and then we would mount <span class="notranslate"><em>/home/$USERNAME/data</em></span> -- which would cause each user to see empty base directories for other users, exposing user names.</p><p><strong>Sharing home directory structure among users</strong></p><p>When you want to share directory structure among multiple users, you can add following line at the top of the <span class="notranslate"><em>/etc/cagefs/cagefs.base.home.dirs</em></span> file. This is useful on the systems that support sites with multiple users, with different home directories inside the main &#39;site&#39; directory.</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mount_basedir=1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>For example:</p><p><span class="notranslate"> user1 </span> has home directory <span class="notranslate"><em>/var/www/vhosts/sitename.com/web_users/user1</em></span><span class="notranslate"> user2 </span> has home directory <span class="notranslate"><em>/var/www/vhosts/sitename.com/web_users/user2</em></span> site admin has home directory <span class="notranslate"><em>/var/www/vhosts/sitename.com</em></span></p><p>So, content of <span class="notranslate"><em>/etc/cagefs/cagefs.base.home.dirs</em></span> should be the following:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mount_basedir=1
^/var/www/vhosts/[^/]+
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Directory structure in <span class="notranslate"><em>/var/www/vhosts/sitename.com</em></span> will be mounted in CageFS for appropriate users. Each user will have access to whole directory structure in <span class="notranslate"><em>/var/www/vhosts/sitename.com</em></span> (according to their permissions).</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>You should execute <span class="notranslate"><code>cagefsctl --remount-all</code></span> in order to apply changes to CageFS (i.e. remount home directories).</p></div><h4 id="postgresql-support" tabindex="-1"><a class="header-anchor" href="#postgresql-support" aria-hidden="true">#</a> PostgreSQL support</h4><p>CloudLinux OS 7:</p><p>CageFS works with any PostgreSQL version installed from CloudLinux OS or CentOS repositories. PostgreSQL packages for CloudLinux OS 7 come from the upstream (CentOS) unmodified. PostgreSQL’s socket is located in <span class="notranslate"><em>/var/run/postgresql</em></span> directory. This directory is mounted to CageFS by default (in cagefs-5.5-6.34 or later).</p><p>When PostgreSQL has been installed after CageFS install, please add line:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/var/run/postgresql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>tо <em>/etc/cagefs/cagefs.mp</em> file and then execute:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --remount-all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>The steps above are enough to configure CageFS to work with PostgreSQL.</p><p>CloudLinux OS 6:</p><p>CageFS provides separate <em>/tmp</em> directory for each end user. Yet, PostgreSQL keeps its Unix domain socket inside server&#39;s main <em>/tmp</em> directory. In addition to that, the location is hard coded inside PostgreSQL libraries.</p><p>To resolve the issue, CloudLinux OS provides a version of PostgreSQL with modified start up script that can store PostgreSQL&#39;s socket in <span class="notranslate"><em>/var/run/postgres.</em></span> The script automatically creates link from <em>/tmp</em> to that socket to prevent PostgreSQL dependent applications from breaking.</p><p>In addition to that, CageFS knows how to correctly link this socket inside end user&#39;s <em>/tmp</em> directory.</p><p>To enable PostgreSQL support in CageFS:</p><ol><li><p>Make sure you have updated to latest version of PostgreSQL.</p></li><li><p>Edit file <em>/etc/sysconfig/postgres</em>, and uncomment <span class="notranslate"><em>SOCK_DIR</em></span> line.</p></li><li><p>Update CageFS configuration by running:</p></li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl  --reconfigure-cagefs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ol start="4"><li>Restart PostgreSQL by running:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service postgresql restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>If you are using cPanel, you would also need to modify file: <span class="notranslate"><em>/etc/cron.daily/tmpwatch</em></span></p><p>And update line:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>flags=-umc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>to:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>flags=-umcl
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>to prevent symlink from being removed.</p><h4 id="pam-configuration" tabindex="-1"><a class="header-anchor" href="#pam-configuration" aria-hidden="true">#</a> PAM configuration</h4><p>CageFS depends on <span class="notranslate"><strong>pam_lve</strong></span> module for PAM enabled services. When installed, the module is automatically installed for following services:</p><ul><li>sshd</li><li>crond</li><li>su</li></ul><p>The following line is added to corresponding file in <code>/etc/pam.d/</code>:</p><div class="notranslate"> ``` session required pam_lve.so 100 1 ``` </div><p>Where 100 stands for minimum <span class="notranslate"> UID </span> to put into <span class="notranslate">CageFS &amp; LVE</span> , and 1 stands for CageFS enabled.</p><h4 id="filtering-options-for-commands-executed-by-proxyexec" tabindex="-1"><a class="header-anchor" href="#filtering-options-for-commands-executed-by-proxyexec" aria-hidden="true">#</a> Filtering options for commands executed by proxyexec</h4><p>You can disallow a user in CageFS to execute specific commands with some specific <em>dangerous</em> options via proxyexec.</p><p>To do so, you should create <span class="notranslate"><code>&lt;command&gt;.json</code></span> file in the <span class="notranslate"><code>/etc/cagefs/filters</code></span> directory and specify the names of options you want to disable.</p><p>For example, to disable some options of <span class="notranslate"><code>sendmail</code></span> command, <span class="notranslate"><code>/etc/cagefs/filters/sendmail.json</code></span> is created with the following content:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{
  &quot;default&quot;: {
    &quot;deny&quot;: [
      &quot;-be&quot;,
      &quot;-bem&quot;
    ],
    &quot;restrict_path&quot;: [
      &quot;-C&quot;,
      &quot;-D&quot;
    ]
  },
  &quot;/usr/sbin/sendmail&quot;: {
    &quot;deny&quot;: [
      &quot;-be&quot;,
      &quot;-bem&quot;
    ],
    &quot;restrict_path&quot;: [
      &quot;-C&quot;,
      &quot;-D&quot;
    ]
  },
  &quot;/var/qmail/bin/sendmail&quot;: {
    &quot;deny&quot;: [
      &quot;-be&quot;,
      &quot;-bem&quot;
    ],
    &quot;restrict_path&quot;: [
      &quot;-C&quot;,
      &quot;-D&quot;
    ]
  },
  &quot;/usr/sbin/sendmail.sendmail&quot;: {
    &quot;deny&quot;: [
      &quot;-be&quot;,
      &quot;-bem&quot;
    ],
    &quot;restrict_path&quot;: [
      &quot;-C&quot;,
      &quot;-D&quot;
    ]
  },
  &quot;/usr/local/cpanel/bin/sendmail&quot;: {
    &quot;deny&quot;: [
      &quot;-be&quot;,
      &quot;-bem&quot;
    ],
    &quot;restrict_path&quot;: [
      &quot;-C&quot;,
      &quot;-D&quot;
    ]
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>You can specify options for different paths separately (for example, <span class="notranslate"><code>/usr/sbin/sendmail</code></span> or <span class="notranslate"><code>/var/qmail/bin/sendmail</code></span>).</p><p>If the path to the program being executed does not match any path specified in the config file, then default parameters are used.</p><ul><li><span class="notranslate"><code>deny</code></span> list should contain options that should be disallowed for use by users (the black list of options, all other options will be allowed).</li><li>You can specify the white list of options in the <span class="notranslate"><code>allow</code></span> list (all other options will be denied).</li><li>You cannot specify both white and black list (<span class="notranslate"><code>allow</code></span> and <span class="notranslate"><code>deny</code></span>).</li></ul><p>It is possible to verify that a path specified as a parameter for an option does not refer outside of the user’s home directory. This check is performed for options specified in the <span class="notranslate"><code>restrict_path</code></span> list. All issues are reported in <span class="notranslate"><code>/var/log/secure</code></span> log file.</p><blockquote><p>NOTE: By default, option filters only compare the starting parts of arguments with entries specified by lists. For instance, if option &quot;-f&quot; is forbidden, &quot;-f /etc/list&quot; will be forbidden, but &quot;-vf /etc/list&quot; will not.</p></blockquote><p>Starting from cagefs v. #7.4.12-1, specifying a <code>&quot;strict_options&quot;: true</code> switch inside a filter file entry enables an extended parsing mechanism where each short option from a cluster is parsed separately.</p><p>It is recommended to enable this option, unless it causes issues with the restricted command&#39;s functionality.</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{
  &quot;default&quot;: {
    &quot;deny&quot;: [
      &quot;-be&quot;,
      &quot;-bem&quot;
    ],
    &quot;restrict_path&quot;: [
      &quot;-C&quot;,
      &quot;-D&quot;
    ],
    &quot;strict_options&quot;: true
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><h4 id="executing-by-proxy" tabindex="-1"><a class="header-anchor" href="#executing-by-proxy" aria-hidden="true">#</a> Executing by proxy</h4><p>Some software has to run outside CageFS to be able to complete its job. It includes such programs as passwd, sendmail, etc. CageFS provides proxyexec technology to accomplish this goal: you can define any program to run outside CageFS by specifying it in any file located in the <span class="notranslate"><code>/etc/cagefs/</code></span> which ends with <span class="notranslate"><code>.proxy.commands</code></span>. In the examples below we use <span class="notranslate"><code>custom.proxy.commands</code></span>, but you can use any other name, e.g. <span class="notranslate"><code>mysuperfile.proxy.commands</code></span>.</p><div class="tip custom-block"><p class="custom-block-title">Warning</p><p>Do not edit the existing <span class="notranslate"><code>/etc/cagefs/proxy.commands</code></span> file as it will be overwritten with the next CageFS update.</p></div><p>Also you should create a <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#file-system-templates" class="router-link-active router-link-exact-active">config file</a> in <span class="notranslate"><code>/etc/cagefs/conf.d/</code></span> and define there a path to the binary or to one of it&#39;s parent directories.</p><div class="tip custom-block"><p class="custom-block-title">Warning</p><p>Binary shouldn&#39;t be located in one of the directories specified in <span class="notranslate">/etc/cagefs/cagefs.mp</span>. Binaries from directories in <span class="notranslate">/etc/cagefs/cagefs.mp</span> are always executed inside cagefs.</p></div><p>The syntax of the <span class="notranslate"><code>/etc/cagefs/[*.]proxy.commands</code></span> file is as follows:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ALIAS[:wrapper_name]=[username:]path_to_executable
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td><span class="notranslate"><code>ALIAS</code></span></td><td>Any name unique within all <span class="notranslate"><code>/etc/cagefs/\[*.\]proxy.commands</code></span> files. Used as an identifier.</td></tr><tr><td><span class="notranslate"><code>wrapper_name</code></span></td><td>Optional field. The name of the wrapper file which is used as a replacement for an executable file (set by <span class="notranslate"><code>path_to_executable</code></span>) inside CageFS. <br><br>Possible values:<br>- a name of a wrapper you place into the <span class="notranslate"><code>/usr/share/cagefs/safeprograms</code></span> directory;<br>- <span class="notranslate"><code>noproceed</code></span> - a reserved word which means that the wrapper is not needed, e.g. when it is already installed by other ALIAS. Often used for the commands with several ALIAS as in the example below.<br>- omit this field - default wrapper <span class="notranslate"><code>cagefs.proxy.program</code></span> will be used.<br><br>Used in cases when you&#39;d like to give access only to the part of binary functions but it is not possible to do that using <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#filtering-options-for-commands-executed-by-proxyexec" class="router-link-active router-link-exact-active">options filtering</a>.<br><strong>Note</strong>: wrapper works inside CageFS with user rights and executes “real” scripts using proxy daemon.</td></tr><tr><td><span class="notranslate"><code>path_to_executable</code></span></td><td>A path to an executable file that will run via proxyexec.</td></tr><tr><td><span class="notranslate"><code>username</code></span></td><td>Optional field. A name of a user on whose behalf <span class="notranslate"><code>path_to_executable</code></span> will run in the real system. If <span class="notranslate"><code>username</code></span> is not specified, then <span class="notranslate"><code>path_to_executable</code></span> will run on behalf of the same user who is inside CageFS.</td></tr></tbody></table><p>Once the program is defined, run this command to populate the skeleton:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --force-update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="users-with-duplicate-uids" tabindex="-1"><a class="header-anchor" href="#users-with-duplicate-uids" aria-hidden="true">#</a> Users with duplicate UIDs</h4><p>Sometimes hosters may have users with non-unique <span class="notranslate">UIDs</span>. Thus, <span class="notranslate"><code>proxyexec</code></span> may traverse users&#39; directories to find a specific one. That behavior turns into inappropriate if the user&#39;s directory is not cached locally (for example LDAP is used).</p><p>To turn this feature off, run:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>touch /etc/cagefs/proxy.disable.duid
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Or to activate it back, run:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>rm /etc/cagefs/proxy.disable.duid
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="examples" tabindex="-1"><a class="header-anchor" href="#examples" aria-hidden="true">#</a> Examples</h4><p>Let&#39;s have a script that must do some stuff outside CageFS and return a result to a user. Let&#39;s name it <span class="notranslate"><code>superbinary</code></span> and place it into the <span class="notranslate"><code>/my/scripts/</code></span> directory.</p><p>In the examples below, we will use a small script that:</p><ul><li>checks if it works inside or outside of CageFS</li><li>prints a number of users in the <span class="notranslate"><code>/etc/passwd</code></span> file</li></ul><p>We use the <span class="notranslate"><code>/etc/passwd</code></span> file because it is truncated inside the cage by default and we can easily see the difference between CageFS and the “real” system by just counting lines in it.</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cat /opt/scripts/superbinary
............

#!/usr/bin/env bash
if [[ -e /var/cagefs ]]; then
  echo &quot;I am running without CageFS&quot;
else
  echo &quot;I am running in CageFS&quot;
fi;
echo &quot;I am running as: `whoami`&quot;
echo &quot;Number or records in /etc/passwd: `cat /etc/passwd | wc -l`&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>First, let’s check that CageFS works: create a user and disable the cage:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>useradd test
cagefsctl --disable test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Then, run the following command as <span class="notranslate"><code>root</code></span> and you will see the following output:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[root ~]# su - test -c &quot;/my/scripts/superbinary&quot;
I am running without CageFS
I am running as: test
Number or records in /etc/passwd: 49
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Now, enable CageFS for the <span class="notrabslate"><code>test</code></span> user and run the command again:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[root ~]# cagefsctl --enable test
[root ~]# su - test -c &quot;/my/scripts/superbinary&quot;
-bash: /my/scripts/superbinary: No such file or directory
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>As you can see the access to the file is restricted by CageFS.</p><h4 id="example-1-make-users-in-cagefs-be-able-to-execute-a-script-which-must-work-outside-cagefs" tabindex="-1"><a class="header-anchor" href="#example-1-make-users-in-cagefs-be-able-to-execute-a-script-which-must-work-outside-cagefs" aria-hidden="true">#</a> Example 1. Make users in CageFS be able to execute a script which must work outside CageFS</h4><p>Add the following line into the <span class="notranslate"><code>/etc/cagefs/custom.proxy.commands</code></span>:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>MYSUPERBINARY=/my/scripts/superbinary
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Then run the <span class="notranslate"><code>cagefsctl --force-update</code></span>, which will place a special wrapper instead of your script inside CageFS. And run your script again:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[root ~]# su - test -c &quot;/my/scripts/superbinary&quot;
I am running without CageFS
I am running as: test
Number or records in /etc/passwd: 49
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>To compare, let’s count a number of users in the <span class="notranslate"><code>/etc/passwd</code></span> directly:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[root ~]# su - test -c &quot;cat /etc/passwd | wc -l&quot;
25
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>Result</strong>: the script escapes from CageFS and has access to all files which a user with disabled CageFS has.</p><h4 id="example-2-permissions-escalation" tabindex="-1"><a class="header-anchor" href="#example-2-permissions-escalation" aria-hidden="true">#</a> Example 2. Permissions escalation</h4><p>Let&#39;s imagine that you need to give the users the ability to run a script which gets information about their domains from the <span class="notranslate"><code>apache.conf</code></span>. To do that, you need root permissions. You can achieve that with proxyexec.</p><p>First, run the following:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>echo &quot;MYSUPERBINARY=root:/my/scripts/superbinary&quot; &gt; /etc/cagefs/custom.proxy.commands
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>And then, run the example script again:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[root ~]# su - test -c &quot;/my/scripts/superbinary&quot;
I am running without cagefs
I am running as: root
Number or records in /etc/passwd: 49
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>As you can see, the script now works with root permissions, as set in the <span class="notranslate"><code>custom.proxy.commands</code></span> file. In order to get information about a user who runs the script, use the following environment variables:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>PROXYEXEC_UID
PROXYEXEC_GID
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>Example</strong>:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[root ~]# id test
uid=1226(test) gid=1227(test) groups=1227(test)
[root ~]# su - test -c &quot;/my/scripts/superbinary&quot;
I am running without CageFS
I am running as: root
Number or records in /etc/passwd: 49
PROXYEXEC_UID=1226
PROXYEXEC_GID=1227
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>Result</strong>: users can run the script that gains the root permissions and work outside CageFS. Of course, you can set any other user instead of root in the <span class="notranslate"><code>custom.proxy.commands</code></span>.</p><h4 id="example-3-custom-proxyexec-wrapper" tabindex="-1"><a class="header-anchor" href="#example-3-custom-proxyexec-wrapper" aria-hidden="true">#</a> Example 3. Custom proxyexec wrapper</h4><p>Let’s modify the test binary in a next way:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>
[root ~]# cat /my/scripts/superbinary
#!/usr/bin/env bash
FILE=&quot;$1&quot;
if [[ -e /var/cagefs ]]; then
  echo &quot;I am running without CageFS&quot;
else
  echo &quot;I am running in CageFS&quot;
fi;
echo &quot;I am running as: `whoami`&quot;
echo &quot;Number or records in ${FILE}: `cat ${FILE} | wc -l`&quot;
echo &quot;PROXYEXEC_UID=${PROXYEXEC_UID}&quot;
echo &quot;PROXYEXEC_GID=${PROXYEXEC_GID}&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Now users can pass any path to the file as an argument. In order to restrict possible parameters (file paths) that users can pass, you can use the custom proxyexec wrapper.</p><p>First, duplicate the default wrapper and give it a name, e.g. <span class="notranslate"><code>cagefs.proxy.mysuperbinary</code></span>.</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[root ~]# cp /usr/share/cagefs/safeprograms/cagefs.proxy.program /usr/share/cagefs/safeprograms/cagefs.proxy.mysuperbinary
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>The default wrapper already contains a check that does not allow to run it by the root user:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#!/bin/bash
##CageFS proxyexec wrapper - ver 15

if [[ $EUID -eq 0 ]]; then
    echo &#39;Cannot be run as root&#39;
    exit 1
fi
...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Add the new check below:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>if [[ $1 == &quot;/etc/passwd&quot; ]]; then
    echo &quot;it is not allowed for user to view this file!&quot;
    exit 1
fi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Now, set a custom binary name in the <span class="notranslate"><code>custom.proxy.commands</code></span>:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[root ~]# cat /etc/cagefs/custom.proxy.commands
MYSUPERBINARY:cagefs.proxy.mysuperbinary=root:/my/scripts/superbinary
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Run skeleton update and check that everything works as expected:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[root ~]# cagefsctl --force-update
[root ~]# su - test -c &quot;/my/scripts/superbinary /etc/passwd&quot;
it is not allowed for user to view this file!
[root ~]# su - test -c &quot;/my/scripts/superbinary /etc/group&quot;
I am running without CageFS
I am running as: root
Number or records in /etc/group: 76
PROXYEXEC_UID=1226
PROXYEXEC_GID=1227
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="tip custom-block"><p class="custom-block-title">Notes and warnings</p><ol><li>Make sure that a directory with your script is not listed in the <span class="notranslate"><code>/etc/cagefs/cagefs.mp</code></span> (is not mounted inside the cage). Otherwise, the proxyexec will not work because CageFS will not be able to replace your script with a special wrapper inside the cage.</li><li>Use this feature with caution because it gives users the ability to execute specified commands outside CageFS. SUID commands are extremely dangerous because they are executed not as a user, but as an owner of the file (typically root). You should give users the ability to execute safe commands only. These commands should not have known vulnerabilities. You should check that users cannot use these commands to get sensitive information on a server. You can disable specific dangerous options of programs executed via proxyexec using <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#filtering-options-for-commands-executed-by-proxyexec" class="router-link-active router-link-exact-active">filtering options</a>.</li><li>In cPanel, all the scripts located in the <span class="notranslate"><code>/usr/local/cpanel/cgi-sys/</code></span>, that user might need to execute, should be added to the custom <span class="notranslate"><code>*.proxy.commands</code></span> file.</li></ol></div><h4 id="custom-etc-files-per-customer" tabindex="-1"><a class="header-anchor" href="#custom-etc-files-per-customer" aria-hidden="true">#</a> Custom /etc files per customer</h4><p><em>[4.0-5 and later]</em></p><p>To create a custom file in /etc directory for end user, create a directory: <span class="notranslate"><em>/etc/cagefs/custom.etc/[username]</em></span></p><p>Put all custom files, and sub-directories into that direcotry.</p><p>For example, if you want to create custom <span class="notranslate"><em>/etc/hosts</em> file for USER1 </span> , create a directory: <span class="notranslate"><em>/etc/cagefs/custom.etc/USER1</em></span></p><p>Inside that directory, create a <span class="notranslate"><em>hosts</em></span> file, with the content for that user.</p><p>After that execute:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --update-etc USER1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>If you are making changes for multiple users, you can run:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --update-etc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>To remove a custom file, remove it from <span class="notranslate"><em>/etc/cagefs/custom.etc/[USER]</em></span> directory, and re-run:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --update-etc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="moving-cagefs-skeleton-directory" tabindex="-1"><a class="header-anchor" href="#moving-cagefs-skeleton-directory" aria-hidden="true">#</a> Moving cagefs-skeleton directory</h4><p>Sometimes you might need to move <span class="notranslate"> cagefs-skeleton </span> from <span class="notranslate"><em>/usr/share</em></span> to another partition.</p><p>There are two ways:</p><ol><li>If <span class="notranslate"><code>/usr/share/cagefs-skeleton</code></span> is not created yet ( <span class="notranslate"> cagefsctl --init </span> wasn&#39;t executed), then execute:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mkdir /home/cagefs-skeleton
ln -s /home/cagefs-skeleton /usr/share/cagefs-skeleton
cagefsctl --init
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><ol start="2"><li>If <span class="notranslate"><em>/usr/share/cagefs-skeleton</em></span> already exists, see <a href="https://cloudlinux.zendesk.com/hc/en-us/articles/115004560129-How-do-I-move-usr-share-cagefs-skeleton-to-other-place-because-of-low-disk-space" target="_blank" rel="noopener noreferrer">this article</a></li></ol><h4 id="moving-var-cagefs-directory" tabindex="-1"><a class="header-anchor" href="#moving-var-cagefs-directory" aria-hidden="true">#</a> Moving /var/cagefs directory</h4><p>To move <span class="notranslate"><code>/var/cagefs</code></span> to another location:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --disable-cagefs
cagefsctl --unmount-all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Verify that <span class="notranslate"><code>/var/cagefs.bak</code></span> directory does not exist (if it exists - change name &quot;cagefs.bak&quot; to something else)</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cp -rp /var/cagefs /new/path/cagefs
mv /var/cagefs /var/cagefs.bak
ln -s /new/path/cagefs /var/cagefs
cagefsctl --enable-cagefs
cagefsctl --remount-all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Verify that the following command gives empty output:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cat /proc/mounts | grep cagefs.bak
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Then you can safely remove /var/cagefs.bak:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>rm -rf /var/cagefs.bak
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="tmp-directories" tabindex="-1"><a class="header-anchor" href="#tmp-directories" aria-hidden="true">#</a> TMP directories</h4><p>CageFS makes sure that each user has his own <span class="notranslate"><em>/tmp</em></span> directory, and that directory is the part of end-user&#39;s quota.</p><p>The actual location of the directory is <span class="notranslate"><em>$USER_HOME/.cagefs/tmp</em></span></p><p>Once a day, using cron job, <span class="notranslate"> CageFS </span> will clean up user&#39;s <span class="notranslate"><em>/tmp</em></span> directory from all the files that haven&#39;t been accessed during 30 days.</p><p>This can be changed by running:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --set-tmpwatch=&#39;/usr/sbin/tmpwatch -umclq 720&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Where 720 is the number of hours that the file had to be inaccessible to be removed.</p><p>By default this is done at 03:37 AM, but you can also force the clean up outdated files that match &#39;chosen period&#39; of all user&#39;s <span class="notranslate"><em>/tmp</em></span> directories without waiting for a job to be launched by <span class="notranslate"> cronjob </span> . Just run:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --tmpwatch
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>The following paths will be cleaned as well:</p><ul><li><span class="notranslate"><code>/var/cache/php-eaccelerator</code></span> (actual location <span class="notranslate"><code>$USER_HOME/.cagefs/var/cache/php-eaccelerator</code></span>)</li><li><span class="notranslate"><code>/opt/alt/phpNN/var/lib/php/session</code></span> (actual location <span class="notranslate"><code>$USER_HOME/.cagefs/opt/alt/phpNN/var/lib/php/session</code></span>), where NN corresponds to Alt-PHP version.</li></ul><p>You can configure <span class="notranslate"><code>tmpwatch</code></span> to clean custom directories inside <span class="notranslate"> CageFS</span>.</p><p>Create <span class="notranslate"><code>/etc/cagefs/cagefs.ini</code></span> configuration file and specify <span class="notranslate"><code>tmpwatch_dirs</code></span> directive as follows:</p><p><span class="notranslate"><code>tmpwatch_dirs=/dir1,/dir2</code></span></p><p>After that directories <span class="notranslate"><code>/dir1</code></span> and <span class="notranslate"><code>/dir2</code></span> inside CageFS  will be cleaned automatically.</p><p>Note that actual location of those directories in real file system is <span class="notranslate"><code>$USER_HOME/.cagefs/dir1</code></span> and <span class="notranslate"><code>$USER_HOME/.cagefs/dir2</code></span>.</p><p><strong>Cleanup PHP sessions in cPanel</strong></p><p>For cPanel servers, CageFS version 6.0-42 or higher performs cleaning of PHP sessions based on <span class="notranslate"><code>session.gc_maxlifetime</code></span> and <span class="notranslate"><code>session.save_path</code></span> directives specified in proper <span class="notranslate"><code>php.ini</code></span> files.</p><p><span class="notranslate"><code>session.gc_maxlifetime</code></span> directive default value is 1440 seconds. Those session files will be deleted, that were created or had metadata (ctime) changes more time ago than it is specified in <span class="notranslate"><code>session.gc_maxlifetime</code></span>.</p><p>For <span class="notranslate"> Alt-PHP </span> versions <span class="notranslate"><code>session.save_path</code></span> value is normally <span class="notranslate"><code>/tmp</code></span>.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>For new installations of Alt-PHP packages, <span class="notranslate"><code>session.save_path</code></span> will be changed from <code>/tmp</code> to <span class="notranslate"><code>/opt/alt/phpNN/var/lib/php/session</code></span>, where NN corresponds to Alt-PHP version.</p></div><p>This applies to the following <span class="notranslate"> Alt-PHP </span> versions (or later):</p><ul><li>alt-php44-4.4.9-71;</li><li>alt-php51-5.1.6-81;</li><li>alt-php52-5.2.17-107;</li><li>alt-php53-5.3.29-59;</li><li>alt-php54-5.4.45-42;</li><li>alt-php55-5.5.38-24;</li><li>alt-php56-5.6.31-7;</li><li>alt-php70-7.0.23-5;</li><li>alt-php71-7.1.9-5;</li><li>alt-php72-7.2.0-0.rc.2.2.</li></ul><p>When using EasyApache 3, <span class="notranslate"><em>session.save_path</em></span> value is normally <span class="notranslate"><em>/var/cpanel/php/sessions/ea3</em></span> or <span class="notranslate"><em>/tmp</em></span> . Settings for EasyApache 3 are usualy taken from the file <span class="notranslate"><em>/usr/local/lib/php.ini</em> . </span></p><p>When using EasyApache 4, <span class="notranslate"><em>session.save_path</em></span> value is normally <span class="notranslate"><em>/var/cpanel/php/sessions/ea-phpXX</em> , </span> where <span class="notranslate"><em>XX</em></span> corresponds to PHP version.</p><p>Cleaning is started by cron <span class="notranslate"><em>/etc/cron.d/cpanel_php_sessions_cron</em></span> , which starts the script <span class="notranslate"><em>/usr/share/cagefs/clean_user_php_sessions</em></span> twice within one hour.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Script <span class="notranslate"><em>clean_user_php_sessions</em></span> deletes only files which names match mask <span class="notranslate"><code>sess_[a-z0-9]*</code></span>. If php was configured to use non-standart session file prefix in some custom save_handler, these session files wouldn&#39;t be managed by <span class="notranslate"><em>clean_user_php_sessions</em></span>.</p></div><p>The settings for ea-php are located in <span class="notranslate"><em>/opt/cpanel/ea-phpXX/root/etc/php.d/local.ini</em></span> or in <span class="notranslate"><em>/opt/cpanel/ea-phpXX/root/etc/php.ini</em></span> , where <span class="notranslate"><em>XX</em></span> corresponds to the PHP version.</p><p>The settings for alt-php are located in <span class="notranslate"><em>/opt/alt/phpXX/etc/php.ini</em></span> files, where <span class="notranslate"><em>XX</em></span> corresponds to PHP version.</p><p>The cleaning script cleans php sessions for all PHP versions ( <span class="notranslate"><em>ea-php</em></span> and <span class="notranslate"><em>alt-php</em></span> ) regardless of whether a version is used or selected via <span class="notranslate"> MultiPHP Manager </span> or <span class="notranslate"> PHP Selector </span> . When different <span class="notranslate"><em>session.gc_maxlifetime</em></span> values are specified for the same <span class="notranslate"><em>session.save_path</em></span> (for different php versions), the cleaning script will use the least value for cleaning <span class="notranslate"><em>session.save_path</em></span> . So, it is recommended to specify different <span class="notranslate"><em>session.save_path</em></span> for each PHP version.</p><p>Users can define custom value of <span class="notranslate"><em>session.gc_maxlifetime</em> via PHP Selector </span> in order to configure PHP&#39;s garbage collector, but that will not affect the script for cleaning PHP sessions. The script cleans PHP sessions based on global values of <span class="notranslate"><em>session.gc_maxlifetime</em></span> and <span class="notranslate"><em>session.save_path</em></span> directives taken from files mentioned above. Settings in custom users’ <span class="notranslate"> php.ini </span> files are ignored.</p><p><strong>Cleanup PHP session files in Plesk</strong></p><p>For Plesk servers, <span class="notranslate"> CageFS </span> version 6.0-52 or higher is provided with a special cron job for removing obsolete PHP session files. Cleanup script runs once an hour (similar to how it is done in Plesk).</p><p>Each time the script runs, it performs the cleanup of the paths:</p><ol><li><p>set by <span class="notranslate"><code>session.save_path</code></span> directive in <span class="notranslate"><em>/opt/alt/phpXX/etc/php.ini</em></span> files. If <span class="notranslate"> session.save_path </span> is missing, then <span class="notranslate"> /tmp </span> is used. Session files lifetime is set by <span class="notranslate"> session.gc_maxlifetime </span> directive. If it is not found, then 1440 seconds value is used (24 minutes, as in Plesk). Lifetime set in the file is only taken into consideration if it is longer than 1440 seconds, otherwise 1440 seconds is used. All the installed <span class="notranslate"> Alt-PHP </span> versions are processed.</p></li><li><p><span class="notranslate"><em>/var/lib/php/session</em></span> . Files lifetime is only defined by Plesk script <span class="notranslate"><em>/usr/lib64/plesk-9.0/maxlifetime</em></span> . If the script is missing or returns errors, then this directory is not processed.</p></li></ol><p>The following features are applied during the cleanup:</p><ul><li>all the users with <span class="notranslate"> UID </span> higher than specified in <span class="notranslate"><em>/etc/login.defs</em></span> are processed. Each user is processed independently from one another.</li><li>only directories inside <span class="notranslate"> CageFS </span> are being cleaned. The paths of the same name in the physical  file system are not processed.</li><li>in all the detected directories, all the files with the names that correspond to <span class="notranslate"><code>sess_ </code> search </span> mask are removed, the rest of the files are ignored.</li><li>the files older than specified lifetime are removed.</li><li>all non-fatal errors (lack of rights, missing directory) are ignored and do not affect the further work of the script.</li></ul><p><strong>Disable PHP sessions cleanup on cPanel and Plesk</strong></p><p>Here is a possible workaround for PHP session expiration problem (session lives longer than it is possible in a control panel). To use your own custom PHP sessions cleanup scripts - you can turn off built-in sessions cleanup implementation in the following way: add <span class="notranslate"><code>clean_user_php_sessions=false</code> line to <em>/etc/sysconfig/cloudlinux</em></span> .</p><h4 id="syslog" tabindex="-1"><a class="header-anchor" href="#syslog" aria-hidden="true">#</a> Syslog</h4><p>By default, <span class="notranslate"><em>/dev/log</em></span> should be available inside end user&#39;s <span class="notranslate"> CageFS </span> . This is needed so that user&#39;s cronjobs and other things that user <span class="notranslate"><em>dev/log</em></span> would get recorded in the system log files.</p><p>This is controlled using file <span class="notranslate"><em>/etc/rsyslog.d/schroot.conf</em></span> with the following content:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$AddUnixListenSocket /usr/share/cagefs-skeleton/dev/log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>To remove presence of <span class="notranslate"><em>dev/log</em></span> inside CageFS, remove that file, and restart rsyslog service.</p><h4 id="excluding-mount-points" tabindex="-1"><a class="header-anchor" href="#excluding-mount-points" aria-hidden="true">#</a> Excluding mount points</h4><p><strong>How to exclude mounts from namespaces for all LVEs</strong></p><p>By default, all mounts from the real file system is inherited by namespaces of all <span class="notranslate"> LVEs </span> . So, destroying all <span class="notranslate"> LVEs </span> may be required in order to unmount some mount in real file system completely. Otherwise, mount point remains busy after unmounting it in the real file system because this mount exists in namespaces of <span class="notranslate"> LVEs </span> .</p><p><span class="notranslate"><code>lvectl start</code></span> command saves all mounts from real file system as “default namespace” for later use in all <span class="notranslate"> LVEs </span> . <span class="notranslate"><strong>lve_namespaces</strong></span> service executes <span class="notranslate"><code>lvectl start</code></span> command during startup.</p><p>In <span class="notranslate"><strong>lve-utils-2.0-26</strong></span> (and later) there is an ability to exclude specific mounts from namespaces for all <span class="notranslate"> LVEs </span> . In order to do so, please create a file <span class="notranslate"><em>/etc/container/exclude_mounts.conf</em></span> with list of mounts to exclude (one mount per line) as regular expressions, and then execute <span class="notranslate"><code>lvectl start</code></span> :</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cat /etc/container/exclude_mounts.conf
............

^/dir1/
^/dir2$
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>lvectl start
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>After that, all new created <span class="notranslate"> LVEs </span> will be without <span class="notranslate"><em>/dir2</em></span> mount and without mounts that start with <span class="notranslate"><em>/dir1/</em></span> (like <span class="notranslate"><em>/dir1/x</em> , <em>/dir1/x/y</em></span> , etc). To apply changes to existing <span class="notranslate"> LVEs </span> you should recreate <span class="notranslate"> LVEs </span> :</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>lvectl destroy all
lvectl apply all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>You should recreate all LVEs only once after creating <span class="notranslate"><em>/etc/container/exclude_mounts.conf</em></span> file. After that the configuration changes will be applied to all new LVEs automatically.</p></div><h4 id="shared-memory-dev-shm-isolation-in-cagefs" tabindex="-1"><a class="header-anchor" href="#shared-memory-dev-shm-isolation-in-cagefs" aria-hidden="true">#</a> Shared memory (/dev/shm) isolation in CageFS</h4><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Requires <code>cagefs-6.2.1-1</code> or later</p></div><p>The <code>/dev/shm</code> in a real file system directory is “world-writable”. This directory from the real file system is mounted to CageFS by default, so <code>/dev/shm</code> directory is common for all users by default. However, it is possible to improve security and isolate <code>/dev/shm</code> (shared memory) for each user in CageFS.</p><p>To enable <code>/dev/shm</code> isolation, do the following steps:</p><ol><li>Delete <code>/dev/shm</code> line from the <code>/etc/cagefs/cagefs.mp</code> file</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sed -i -e &#39;/^\/dev\/shm/d&#39; /etc/cagefs/cagefs.mp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ol start="2"><li>Create a configuration file with mount options for shared memory</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>echo &#39;mode=0777&#39; &gt; /etc/cagefs/dev.shm.options
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ol start="3"><li>Remount CageFS to apply changes</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --remount-all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>You can also specify additional mount options.</p><p>For example, you can specify the size of shared memory in megabytes:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>echo &#39;mode=0777,size=1m&#39; &gt; /etc/cagefs/dev.shm.options
cagefsctl --remount-all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Or you can specify the size of user’s physical memory limit (PMEM) in percentage:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>echo &#39;mode=0777,size=50%&#39; &gt; /etc/cagefs/dev.shm.options
cagefsctl --remount-all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>To disable <code>/dev/shm</code> isolation, do the following steps:</p><ol><li>Delete configuration file</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>rm -f /etc/cagefs/dev.shm.options
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ol start="2"><li>Validate <code>/etc/cagefs/cagefs.mp</code> file</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --check-mp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ol start="3"><li>Add <code>/dev/shm</code> line to <code>/etc/cagefs/cagefs.mp</code> file</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>echo &#39;/dev/shm&#39; &gt;&gt; /etc/cagefs/cagefs.mp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ol start="4"><li>Remount CageFS to apply changes</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --remount-all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>you should specify <code>mode=0777</code>. It is required for the proper operation of shared memory inside CageFS. This is not a security issue because the <code>/dev/shm</code> directory is isolated for each user and visible inside a user’s CageFS only.</p></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p><code>/dev/shm</code> is mounted with <code>nosuid,nodev,noexec</code> mount options always (both in “isolated <code>/dev/shm</code>” mode and not). You cannot change this behavior.</p></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>“isolated <code>/dev/shm</code>” mode will become the default in the future CageFS releases.</p></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>when the size of the <code>/dev/shm</code> is specified in percentage of user’s physical memory limit (PMEM), you should remount CageFS after changing PMEM limit in order to change the size of shared memory allocated for the <code>/dev/shm</code> in user’s CageFS. To do so, execute <code>cagefsctl --remount-all</code></p></div><h4 id="preventing-process-from-entering-cagefs-on-error" tabindex="-1"><a class="header-anchor" href="#preventing-process-from-entering-cagefs-on-error" aria-hidden="true">#</a> Preventing process from entering CageFS on error</h4><p>Starting from CageFS v.7.2.0-1, you can prevent a process from work if it can&#39;t enter to CageFS. The option is disabled by default.</p><p>To enable it, run the following commands:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>touch /etc/cagefs/fail.on.error
cagefsctl --remount-all (cagefsctl --remount &lt;user&gt;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>To disable it, run the following commands:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>rm -f /etc/cagefs/fail.on.error
cagefsctl --remount-all (cagefsctl --remount &lt;user&gt;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>The message “Act like CageFS is disabled” in the <code>/var/log/messages</code> will be displayed regardless the file <code>/etc/cagefs/fail.on.error</code> is available or not.</p><h3 id="integration-with-control-panels" tabindex="-1"><a class="header-anchor" href="#integration-with-control-panels" aria-hidden="true">#</a> Integration with control panels</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#cpanel" class="router-link-active router-link-exact-active">cPanel</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#plesk" class="router-link-active router-link-exact-active">Plesk</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#ispmanager" class="router-link-active router-link-exact-active">ISPManager</a></li></ul><p>CageFS comes with a plugin for various control panels.</p><p>The plugin allows to:</p><ul><li>Initialize CageFS;</li><li>Select <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#managing-users" class="router-link-active router-link-exact-active">mode of operation</a>;</li><li>See and modify the list of enabled/disabled users;</li><li>Update CageFS skeleton.</li></ul><h4 id="cpanel" tabindex="-1"><a class="header-anchor" href="#cpanel" aria-hidden="true">#</a> cPanel</h4><h5 id="cagefs-plugin" tabindex="-1"><a class="header-anchor" href="#cagefs-plugin" aria-hidden="true">#</a> CageFS Plugin</h5><p>CageFS plugin for cPanel is located in <span class="notranslate"> Plugins </span> section of WHM and called <span class="notranslate"> CageFS User Manager </span>.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Take a note that the configuration of CageFS for users is located at the Users tab in the main menu of LVE Manager and the global CageFS settings (Toggle, update skeleton and others) are located at the Options tab in the main menu of LVE Manager inside the section &quot;CageFS&quot;.</p></div><p>It allows to initialize CageFS, select users CageFS will be enabled for, as well as update CageFS skeleton.</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/img1-zoom73.webp" alt=""></p><p>To enable CageFS for a proper user (users), in <span class="notranslate"> CageFS User Manager </span> choose a user from the list on the right ( <span class="notranslate"> Disabled </span> users) and click <span class="notranslate"> Toggle </span> . The user will move to the list on the left ( <span class="notranslate"> Enabled </span> users).</p><p>To disable a user (users), choose a user from the list on the left ( <span class="notranslate"> Enabled </span> users) and click <span class="notranslate"> Disable CageFS </span> . The user will move to the list on the right ( <span class="notranslate"> Disabled </span> users).</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/cpanel-enable-disable-cagefs.webp" alt=""></p><p>To update CageFS skeleton, click <span class="notranslate"> Update CageFS Skeleton </span> .</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/cpanel-update-cagefs-skeleton.webp" alt=""></p><h5 id="cagefs-inbuilt-in-cloudlinux-manager" tabindex="-1"><a class="header-anchor" href="#cagefs-inbuilt-in-cloudlinux-manager" aria-hidden="true">#</a> CageFS inbuilt in Cloudlinux Manager</h5><p>To enable or disable CageFS for a proper user (users), in <span class="notranslate"> Cloudlinux Manager </span>, go to the Users tab and use the Toggle next to the chosen user(s) from the list under the <span class="notranslate"> CageFS </span> column.</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/cpanel-enable-disable-cagefs2.webp" alt=""></p><p>To update CageFS skeleton, go to <span class="notranslate"> Cloudlinux Manager &gt; Options &gt; CageFS </span> and click on the Update button next to <span class="notranslate"> CageFS </span> Skeleton:</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/cpanel-cagefs-options.webp" alt=""></p><h4 id="plesk" tabindex="-1"><a class="header-anchor" href="#plesk" aria-hidden="true">#</a> Plesk</h4><p>CageFS is an option inbuilt in Cloudlinux Manager that allows initializing and updating CageFS template, as well as managing users and mode of operation for CageFS.</p><p>To enable or disable CageFS for a proper user (users), in <span class="notranslate"> Cloudlinux Manager </span>, go to the Users tab and use the Toggle next to the chosen user(s) from the list under the <span class="notranslate"> CageFS </span> column.</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/enable-disable-cagefs-for-user.webp" alt=""></p><p>To update CageFS skeleton, go to <span class="notranslate"> Cloudlinux Manager &gt; Options &gt; CageFS </span> and click on the Update button next to <span class="notranslate"> CageFS </span> Skeleton:</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/plesk-update-cagefs-skeleton.webp" alt=""></p><h4 id="ispmanager" tabindex="-1"><a class="header-anchor" href="#ispmanager" aria-hidden="true">#</a> ISPManager</h4><p>CageFS comes with plugin for <span class="notranslate"> ISP Manager </span> to enable/disable CageFS on per user base. In edit user section chose <span class="notranslate"> Permission </span> tab. Mark <span class="notranslate"> CageFS User Mode </span> checkbox and click <span class="notranslate"> OK </span> to apply.</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/ispmanager_cagefs_user_zoom98.webp" alt=""></p><p>Or you can manage global CageFS settings via CageFS menu <img src="/images/cloudlinuxos/cloudlinux_os_components/img3.webp" alt=""></p><p>See also <a href="/cloudlinuxos/command-line_tools/#cagefs" class="">CageFS CLI tools</a>.</p><h2 id="mysql-governor" tabindex="-1"><a class="header-anchor" href="#mysql-governor" aria-hidden="true">#</a> MySQL Governor</h2><h3 id="general-information-and-requirements-3" tabindex="-1"><a class="header-anchor" href="#general-information-and-requirements-3" aria-hidden="true">#</a> General information and requirements</h3><div class="warning custom-block"><p class="custom-block-title">Warning</p><p>The &quot;All&quot; mode will be deprecated starting from September 1, 2021. You can read more <a href="https://blog.cloudlinux.com/mysql-governor-moving-from-all-to-abusers" target="_blank" rel="noopener noreferrer">here.</a></p></div><p><span class="notranslate"> MySQL Governor </span> is software to monitor and restrict MySQL usage in shared hosting environment. The monitoring is done via resource usage statistics per each MySQL thread.</p><p><span class="notranslate"> MySQL Governor </span> has two active modes of operations:</p><ul><li><strong>off</strong> - In this mode MySQL Governor will not throttle customer&#39;s queries, instead it will let you monitor the MySQL usage.</li><li><strong>abusers</strong> - In this mode, once user goes over the limits specified in the MySQL Governor, all customer&#39;s queries will execute inside that user&#39;s LVE.</li></ul><p>More details of the governor operation modes are described in the <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#modes-of-operation" class="router-link-active router-link-exact-active">Modes of operation</a> section</p><p><span class="notranslate"> MySQL Governor </span> allows to restrict customers who use too much resources. It supports following limits:</p><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td><span class="notranslate"> CPU </span></td><td>%</td><td><span class="notranslate"> CPU </span> speed relative to one core. 150% would mean one and a half cores</td></tr><tr><td><span class="notranslate"> READ </span></td><td>bytes</td><td>bytes read. Cached reads are not counted, only those that were actually read from disk will be counted</td></tr><tr><td><span class="notranslate"> WRITE </span></td><td>bytes</td><td>bytes written. Cached writes are not counted, only once data is written to disk, it is counted</td></tr></tbody></table><p>You can set different limits for different periods: current, short, med, long. By default those periods are defined as 1 second, 5 seconds, 1 minute and 5 minutes. They can be re-defined using <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#configuration-and-operation" class="router-link-active router-link-exact-active">configuration file</a>. The idea is to use larger acceptable values for shorter periods. Like you could allow a customer to use two cores (200%) for one second, but only 1 core (on average) for 1 minute, and only 70% within 5 minutes. That would make sure that customer can burst for short periods of time.</p><p>Customers will also be limited to a finite number of concurrent connections, this number is 30 by default and can be changed. This is done so they wouldn&#39;t use up all the MySQL connections to the server. <span class="notranslate"> MySQL Governor </span> can also kill off slow <span class="notranslate"> SELECT </span> queries.</p><h3 id="mysql-governor-limits-interaction-with-lve-limits" tabindex="-1"><a class="header-anchor" href="#mysql-governor-limits-interaction-with-lve-limits" aria-hidden="true">#</a> MySQL Governor limits interaction with LVE limits</h3><h4 id="how-is-interaction-between-mysql-governor-and-lve-organized" tabindex="-1"><a class="header-anchor" href="#how-is-interaction-between-mysql-governor-and-lve-organized" aria-hidden="true">#</a> How is interaction between MySQL Governor and LVE organized?</h4><p>The main purpose of MySQL Governor is to monitor how many common resources are used by each user for working with MySQL/MariaDB and to manage usage restrictions for such resources by LVE containers.</p><p>Before any SQL request, MySQL Governor determines which user sent the request and if this user exceed limits, the MySQL Governor pushes the request to appropriate LVE container.</p><p>This is how common server resources can be managed.</p><h4 id="why-the-сpu-io-charts-are-different-for-database-and-lve-usage" tabindex="-1"><a class="header-anchor" href="#why-the-сpu-io-charts-are-different-for-database-and-lve-usage" aria-hidden="true">#</a> Why the СPU/IO charts are different for database and LVE usage?</h4><p>SQL requests are not limited inside LVE, so there are not any calculations for IO usage there. It can be clearly viewed via the lve-stats charts:</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/Chart1.webp" alt=""></p><p><strong>Blue chart (database)</strong>:</p><p>This is the user’s real IO Database usage which was calculated by MySQL Governor.</p><p><strong>Green chart (LVE)</strong>:</p><p>This is the user’s IO Database usage which was calculated by lve-stats.</p><p>Also, for different types of database load (for example in case, there is a huge amount of short requests), CPU usage charts for LVE and database can be different.</p><p>Take a look on this chart:</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/Chart2.webp" alt=""></p><p><strong>Blue (database) CPU usage</strong>:</p><p>It is calculated by MYSQL Governor and the value is identical with top/htop values.</p><p><strong>Green (LVE) CPU usage</strong>:</p><p>It is calculated by lve-stats. The values are less on the LVE CPU usage chart because user requests are placed in the LVE only for part of the time.</p><h4 id="for-what-purpose-are-the-io-limits-of-mysql-governor-used" tabindex="-1"><a class="header-anchor" href="#for-what-purpose-are-the-io-limits-of-mysql-governor-used" aria-hidden="true">#</a> For what purpose are the IO limits of MySQL Governor used?</h4><p>MySQL Governor uses its limits as triggers to place user’s requests to the LVE. If user’s requests exceed MySQL Governor limits they are placed to the LVE, which already limits resource usage. After some timeout (which can be configured in the MySQL Governor config file requests will not be placed to the LVE. The next placing of the SQL requests to the LVE will occur after the next limits are exceeded.</p><h4 id="how-exactly-does-io-limiting-work-for-mysql-mariadb-requests" tabindex="-1"><a class="header-anchor" href="#how-exactly-does-io-limiting-work-for-mysql-mariadb-requests" aria-hidden="true">#</a> How exactly does IO limiting work for MySQL/MariaDB requests?</h4><p>There is no direct IO limitation for database treads. But in case of exceeding governor IO user limits, their requests will be placed into the LVE and CPU LVE limitation will be applied to the requests. And it’s clear that any IO load causes CPU load. So by CPU limits IO usage will be limited indirectly.</p><p>Take a look at the next chart. The I/O load is synchronous with the CPU load.</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/Chart3.webp" alt=""></p><h3 id="installation-and-update-2" tabindex="-1"><a class="header-anchor" href="#installation-and-update-2" aria-hidden="true">#</a> Installation and update</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#installation" class="router-link-active router-link-exact-active">Installation</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#upgrading-database-server" class="router-link-active router-link-exact-active">Upgrading database server</a></li></ul><h4 id="installation" tabindex="-1"><a class="header-anchor" href="#installation" aria-hidden="true">#</a> Installation</h4><div class="danger custom-block"><p class="custom-block-title">IMPORTANT</p><p>Please note that MariaDB 10.4 release isn’t supported by cPanel, thus you can’t install this version with MySQL Governor + cPanel. More details are available here: <a href="https://features.cpanel.net/topic/maria-10-4-support" target="_blank" rel="noopener noreferrer">https://features.cpanel.net/topic/maria-10-4-support</a>.</p></div><div class="danger custom-block"><p class="custom-block-title">IMPORTANT</p><p>Please make full database backup (including system tables) before you upgrade MySQL or switch to MariaDB. This action will prevent data loss in case if something goes wrong.</p></div><p><strong><em>MySQL Governor is compatible only with MySQL 5.x, 8.x, MariaDB and Percona Server 5.6.</em></strong></p><p>To install <span class="notranslate"> MySQL Governor </span> on your server install <span class="notranslate"> governor-mysql </span> package at first:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum remove db-governor db-governor-mysql  # you can ignore errors if you don&#39;t have those packages installed
yum install governor-mysql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Then configure <span class="notranslate"> MySQL Governor </span> properly.</p><p>The installation is currently supported only on <span class="notranslate"> cPanel, Plesk, DirectAdmin, ISPmanager, InterWorx </span> , as well as on servers without control panel.</p><p>If you are installing <span class="notranslate"> CloudLinux OS </span> on a server running MySQL already, set your current MySQL version before calling installation script:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/share/lve/dbgovernor/mysqlgovernor.py --mysql-version=mysqlXX
/usr/share/lve/dbgovernor/mysqlgovernor.py --install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Please make sure to specify your current MySQL version instead of XX as follows:</p><ul><li>55 — MySQL v5.5</li><li>56 — MySQL v5.6</li><li>57 — MySQL v5.7</li><li>80 — MySQL v8.0 (requires MySQL Governor 1.2-37+)</li><li>84 — MySQL v8.4 (requires MySQL Governor 1.2-129+)</li></ul><p>If you are installing <span class="notranslate"> CloudLinux OS </span> on a server running <span class="notranslate"> MariaDB </span> already, do instead:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/share/lve/dbgovernor/mysqlgovernor.py --mysql-version=mariadbXX
/usr/share/lve/dbgovernor/mysqlgovernor.py --install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Please make sure to specify your current <span class="notranslate"> MariaDB </span> version instead of <span class="notranslate"> XX </span> as follows:</p><ul><li>55 — MariaDB v5.5</li><li>100 — MariaDB v10.0</li><li>101 — MariaDB v10.1</li><li>102 — MariaDB v10.2</li><li>103 — MariaDB v10.3 [requires <span class="notranslate"> MySQL Governor 1.2-36+; for cPanel - MySQL Governor 1.2-41+] </span></li><li>104 – MariaDB v10.4 [requires <span class="notranslate">MySQL Governor</span> 1.2-53+]</li><li>105 - MariaDB v10.5 [requires <span class="notranslate">MySQL Governor</span> 1.2-62+]</li><li>106 - MariaDB v10.6 [requires <span class="notranslate">MySQL Governor</span> 1.2-76+]</li><li>1011 - MariaDB v10.11 [requires <span class="notranslate">MySQL Governor</span> 1.2-103+]</li><li>1104 - MariaDB v11.4 [requires <span class="notranslate">MySQL Governor</span> 1.2-122+]</li></ul><div class="tip custom-block"><p class="custom-block-title">Updated note</p><p>MariaDB version 10.4 is available for CloudLinux OS 6.</p></div><p>Installation for <span class="notranslate"> Percona Server 5.6 </span> [requires <span class="notranslate"> MySQL Governor </span> 1.1-22+ or 1.2-21+]:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/share/lve/dbgovernor/mysqlgovernor.py --mysql-version=percona56
/usr/share/lve/dbgovernor/mysqlgovernor.py --install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Please note that <span class="notranslate"> MySQL/MariaDB/Percona </span> will be updated from <span class="notranslate">CloudLinux OS</span> repositories.</p><p>If you are installing <span class="notranslate"> MySQL Governor </span> on a server without MySQL at all, you have an opportunity to choose desired MySQL version to be installed with <span class="notranslate"> MySQL Governor </span> installation script. Use <span class="notranslate"> --mysql-version </span> flag before calling the installation script:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/share/lve/dbgovernor/mysqlgovernor.py --mysql-version=MYSQL_VERSION
/usr/share/lve/dbgovernor/mysqlgovernor.py --install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p><span class="notranslate"> MYSQL_VERSION </span> could be chosen from the list of versions currently supported by <span class="notranslate"> MySQL Governor </span> :</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>mysql51</td><td>MySQL v5.1</td></tr><tr><td>mysql55</td><td>MySQL v5.5</td></tr><tr><td>mysql56</td><td>MySQL v5.6</td></tr><tr><td>mysql57</td><td>MySQL v5.7</td></tr><tr><td>mysql80</td><td>MySQL v8.0 (requires MySQL Governor 1.2-37+)</td></tr><tr><td>mysql84</td><td>MySQL v8.4 (requires MySQL Governor 1.2-129+)</td></tr><tr><td>mariadb55</td><td>MariaDB v5.5</td></tr><tr><td>mariadb100</td><td>MariaDB v10.0</td></tr><tr><td>mariadb101</td><td>MariaDB v10.1</td></tr><tr><td>mariadb102</td><td>MariaDB v 10.2</td></tr><tr><td>mariadb103</td><td>MariaDB v 10.3 [requires <span class="notranslate"> MySQL Governor 1.2-36+; for cPanel - MySQL Governor 1.2-41+] </span></td></tr><tr><td>mariadb104</td><td>MariaDB v 10.4 [requires <span class="notranslate">MySQL Governor</span> 1.2-53+]</td></tr><tr><td>mariadb105</td><td>MariaDB v 10.5 [requires <span class="notranslate">MySQL Governor</span> 1.2-62+]</td></tr><tr><td>mariadb106</td><td>MariaDB v 10.6 [requires <span class="notranslate">MySQL Governor</span> 1.2-76+]</td></tr><tr><td>mariadb1011</td><td>MariaDB v 10.11 [requires <span class="notranslate">MySQL Governor</span> 1.2-103+]</td></tr><tr><td>mariadb1104</td><td>MariaDB v 11.4 [requires <span class="notranslate">MySQL Governor</span> 1.2-122+]</td></tr><tr><td>percona56</td><td><span class="notranslate"> Percona Server v 5.6 </span></td></tr></tbody></table><p>Generally, <span class="notranslate"> stable </span> and <span class="notranslate"> beta </span> channels contain different version of MySQL packages - <span class="notranslate"> beta </span> contains newer version than <span class="notranslate"> stable </span> or the same one. If you would like to install <span class="notranslate"> beta </span> packages, use <span class="notranslate"> --install-beta </span> flag instead of <span class="notranslate"> --install </span> when calling installation script:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/share/lve/dbgovernor/mysqlgovernor.py --install-beta
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Starting with <span class="notranslate"> MySQL Governor </span> version 1.2 when installing <span class="notranslate"> MySQL/MariaDB MySQL Governor </span> asks for a confirmation of a database version to be installed. To avoid such behavior for the automatic installations, please use <span class="notranslate"> --yes </span> flag.</p><p>For example:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/share/lve/dbgovernor/mysqlgovernor.py --install --yes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Please note that restore of previous packages in case of failed installation would also be confirmed with <span class="notranslate"><code>--yes</code></span> flag.</p><div class="danger custom-block"><p class="custom-block-title">IMPORTANT</p><p>Use <span class="notranslate"> --yes </span> flag on your own risk, because it confirms installation in any case - even in case if there are troubles during installation (for example, network problems causing incomplete download of packages), everything would be confirmed.</p></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>See also <a href="/cloudlinuxos/command-line_tools/#mysql-governor" class="">MySQL Governor CLI</a></p></div><h4 id="upgrading-database-server" tabindex="-1"><a class="header-anchor" href="#upgrading-database-server" aria-hidden="true">#</a> Upgrading database server</h4><div class="danger custom-block"><p class="custom-block-title">Important</p><p>Upgrade from MySQL 8 to MariaDB 10.x isn&#39;t supported due to compatibility issues between these database server versions and will break your database server completely. You can find more information about the compatibility issues <a href="https://mariadb.com/kb/en/upgrading-from-mysql-to-mariadb/" target="_blank" rel="noopener noreferrer">here</a></p></div><div class="warning custom-block"><p class="custom-block-title">Warning</p><p>Please note that DB Governor is capable of upgrading your database to a newer version, including sequential upgrades, but we make no guarantee that such upgrades do not affect the operation of the database, its components, control panel operation and other functions of database. Always create a backup copy of your data.</p></div><p>In order to change MySQL version you should run the following commands:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/share/lve/dbgovernor/mysqlgovernor.py --mysql-version=MYSQL_VERSION
/usr/share/lve/dbgovernor/mysqlgovernor.py --install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>where <code>MYSQL_VERSION</code> is the target database server version that should be replaced with the value from the table above.</p><div class="danger custom-block"><p class="custom-block-title">IMPORTANT</p><p>Make sure you have full database backup (including system tables) before you switch. This action will prevent data loss in case if something goes wrong.</p></div><h3 id="uninstalling-1" tabindex="-1"><a class="header-anchor" href="#uninstalling-1" aria-hidden="true">#</a> Uninstalling</h3><p>To remove <span class="notranslate">MySQL Governor</span>:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/share/lve/dbgovernor/mysqlgovernor.py --delete
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>The script will install original MySQL server, and remove <span class="notranslate">MySQL Governor</span>.</p><h3 id="configuration-and-operation" tabindex="-1"><a class="header-anchor" href="#configuration-and-operation" aria-hidden="true">#</a> Configuration and operation</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#configuration-2" class="router-link-active router-link-exact-active">Configuration</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#modes-of-operation" class="router-link-active router-link-exact-active">Modes of operation</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#mysql-governor-limits" class="router-link-active router-link-exact-active">MySQL Governor limits</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#starting-and-stopping" class="router-link-active router-link-exact-active">Starting and stopping</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#mapping-a-user-to-a-database" class="router-link-active router-link-exact-active">Mapping a user to a database</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#log-files" class="router-link-active router-link-exact-active">Log files</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#change-mysql-version" class="router-link-active router-link-exact-active">Change MySQL version</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#privatedevices-mode-support" class="router-link-active router-link-exact-active">PrivateDevices mode support</a></li></ul><h4 id="configuration-2" tabindex="-1"><a class="header-anchor" href="#configuration-2" aria-hidden="true">#</a> Configuration</h4><div class="warning custom-block"><p class="custom-block-title">Warning</p><p>The &quot;All&quot; mode will be deprecated starting from September 1, 2021. You can read more <a href="https://blog.cloudlinux.com/mysql-governor-moving-from-all-to-abusers" target="_blank" rel="noopener noreferrer">here.</a></p></div><p><span class="notranslate"> MySQL Governor </span> configuration is located in <span class="notranslate"> /etc/container/mysql-governor.xml </span></p><p>It is best to modify it using <span class="notranslate"><a href="/cloudlinuxos/command-line_tools/#dbctl" class="">dbctl</a></span> tool.</p><p>Once configuration file is updated, please, restart the <span class="notranslate"> MySQL Governor </span> using:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service db_governor restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Example configuration: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;governor&gt;

&lt;!--  &#39;off&#39; - do not throttle anything, monitoring only --&gt;
&lt;!--  &#39;abusers&#39; - when user reaches the limit, put user&#39;s queries into LVE for that user --&gt;
&lt;!--  &#39;all&#39; - user&#39;s queries always run inside LVE for that user --&gt;
&lt;!--  &#39;single&#39; - single LVE=3 for all abusers. --&gt;
&lt;!-- &#39;on&#39; - deprecated (old restriction type) --&gt;
&lt;!-- To change resource usage of restricted user in LVE mode use command /usr/sbin/lvectl set 3 --cpu=&lt;new value&gt; --ncpu=&lt;new value&gt; --io=&lt;new value&gt; --save-all-parameters --&gt;
&lt;lve use=&quot;on|single|off|abusers|all&quot;/&gt;

&lt;!-- connection information --&gt;
&lt;!-- If host, login and password are not present, this information is taken from /etc/my.cnf and ~root/.my.cnf --&gt;
&lt;!-- Use symbol specified in prefix to figure out hosting accounts (mysql username will be split using prefix_separator, and first part will be used as account name). If prefix is not set, or empty -- don’t use prefixes/accounts --&gt;

&lt;!-- db governor will try to split MySQL user names using prefix separator (if present)and statistics will be aggregated for the prefix (account name) --&gt;
&lt;connector host=&quot;...&quot; login=&quot;...&quot; password=&quot;..&quot; prefix_separator=&quot;_&quot;/&gt;

&lt;!-- Intervals define historical intervals for burstable limits. In seconds --&gt;
&lt;intervals short=&quot;5&quot; mid=&quot;60&quot; long=&quot;300&quot;/&gt;

&lt;!-- log all errors/debug info into this log --&gt;
&lt;log file=”/var/log/dbgovernor-error.log” mode=”DEBUG|ERROR”/&gt;

&lt;!-- s -- seconds, m -- minutes, h -- hours, d -- days --&gt;
&lt;!-- on restart, restrict will disappear --&gt;
&lt;!-- log file will contain information about all restrictions that were take --&gt;
&lt;!-- timeout - penalty period when user not restricted, but if he hit his limit during this period he will be restricted with higher level of restrict (for more long time) --&gt;
&lt;!- level1, level2, level3, level4 - period of restriction user for different level of restriction. During this period all user&#39;s requests will be placed into LVE container --&gt;

&lt;!-- if user hits any of the limits during period of time specified in timeout, higher level of restrict will be used to restrict user. If user was already on level4, level4 will be applied again --&gt;
&lt;!-- attribute format set an restrict log format:
SHORT -  restrict info only
MEDIUM - restrict info, _all_tracked_values_
LONG - restrict info, _all_tracked_values_, load average and vmstat info
VERYLONG - restrict info, _all_tracked_values_, load average and vmstat info, slow query info --&gt;
&lt;!-- script -- path to script to be triggered when account is restricted --&gt;
&lt;!-- user_max_connections - The number of simultaneous connections of blocked user (in LVE mode) --&gt;

&lt;!-- restriction levels/format/script are deprecated --&gt;
&lt;restrict level1=&quot;60s&quot; level2=&quot;15m&quot; level3=&quot;1h&quot; level4=&quot;1d&quot; timeout=&quot;1h&quot;
log=&quot;/var/log/dbgovernor-restrict.log&quot; format=&quot;SHORT|MEDIUM|LONG|VERYLONG&quot;
script=&quot;/path/to/script&quot;
user_max_connections=&quot;30&quot;/&gt;

&lt;!-- period (deprecated) - period based restriction that has multiple levels (see above) --&gt;
&lt;!-- limit (by default) - when user hits limits, the account will be marked as restricted and if user does not hit  limit again during &quot;unlimit=1m&quot; account will be unrestricted. This mode doesn&#39;t have any additional levels/penalties. --&gt;
&lt;restrict_mode use=&quot;period|limit&quot; unlimit=&quot;1m&quot;/&gt;

&lt;!-- killing slow SELECT queries (no other queries will be killed) --&gt;
&lt;!-- if &quot;log&quot; attribute was set all killed queries will be saved in log file --&gt;
&lt;!-- slow parameter in the &lt;limit name=&quot;slow&quot; current=&quot;30&quot;/&gt; will no be applied without enabling slow_queries --&gt;
&lt;slow_queries run=&quot;on|off&quot; log=&quot;/var/log/dbgovernor-kill.log&quot;/&gt;
&lt;!-- Enable or disable saving of statistics for lve-stats - On - enabled, Off-disabled --&gt;
&lt;statistic mode=&quot;on|off&quot;&gt;&lt;/statistic&gt;
&lt;!-- Enable logging user queries on restrict, can be On or Off --&gt;
&lt;!-- Files are saved in /var/lve/dbgovernor-store and being kept here during 10 days --&gt;
&lt;logqueries use=&quot;on|off&quot;&gt;&lt;/logqueries&gt;
&lt;default&gt;
&lt;!-- -1 not use limit(by default, current - required) --&gt;
&lt;limit name=&quot;cpu&quot; current=&quot;150&quot; short=&quot;100&quot; mid=&quot;90&quot; long=&quot;65&quot;/&gt;
&lt;limit name=&quot;read&quot; current=&quot;100000000&quot; short=&quot;90000000&quot; mid=&quot;80000000&quot; long=&quot;70000000&quot;/&gt;
&lt;limit name=&quot;write&quot; current=&quot;100000000&quot; short=&quot;90000000&quot; mid=&quot;80000000&quot; long=&quot;70000000&quot;/&gt;
&lt;!-- Time to kill slow SELECT queries for account, can be different for accounts in seconds(but unit can be specified) --&gt;
&lt;!-- enabled only when slow_queries run=&quot;on&quot; --&gt;
&lt;!-- s -- seconds, m -- minutes, h -- hours, d -- days --&gt;
&lt;!-- Requests are checked at 15 second intervals, so a request will be canceled after a timeout + 15 seconds maximum --&gt;
&lt;limit name=&quot;slow&quot; current=&quot;30&quot;/&gt;
&lt;/default&gt;
&lt;!-- name will matched account name, as extracted via prefix extraction --&gt;

&lt;!-- mysql_name will match exact MySQL user name. If both name and mysql_name are present, system will produce error --&gt;
&lt;!-- mode restrict -- default mode, enforcing restrictions --&gt;
&lt;!-- mode norestrict -- track usage, but don’t restrict user --&gt;
&lt;!-- mode ignore -- don’t track and don’t restrict user --&gt;
&lt;user name=”xxx” mysql_name=”xxx” mode=”restrict|norestrict|ignore”&gt;
&lt;limit...&gt;
&lt;/user&gt;

&lt;!-- debug mode for particular user. The information logged to restrict log. --&gt;
&lt;debug_user name=&quot;xxx&quot;/&gt;

&lt;/governor&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>These values can also be set using <a href="/cloudlinuxos/command-line_tools/#cloudlinux-config" class="">cloudlinux-config</a> CLI utility</p><h4 id="modes-of-operation" tabindex="-1"><a class="header-anchor" href="#modes-of-operation" aria-hidden="true">#</a> Modes of operation</h4><div class="warning custom-block"><p class="custom-block-title">Warning</p><p>The &quot;All&quot; mode will be deprecated starting from September 1, 2021. You can read more <a href="https://blog.cloudlinux.com/mysql-governor-moving-from-all-to-abusers" target="_blank" rel="noopener noreferrer">here.</a></p></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p><span class="notranslate">MySQL Governor</span> 1.0+</p></div><p><strong>Active modes</strong></p><ul><li><strong>abusers - Use LVE for a user to restrict queries (default mode)</strong>: In that mode, once user goes over the limits specified in the MySQL Governor , all customer&#39;s queries will execute inside that user&#39;s LVE. We believe this mode will help with the condition when the site is still fast, but MySQL is slow (restricted) for that user. If someone abuses MySQL, it will cause queries to share LVE with PHP processes, and PHP processes will also be throttled, causing fewer new queries being sent to MySQL. <em>Requires <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#mapping-a-user-to-a-database" class="router-link-active router-link-exact-active"><code>dbuser-map</code> file</a></em>.</li><li><strong>off - Monitor Only</strong>: In that mode MySQL Governor will not throttle customer&#39;s queries, instead it will let you monitor the MySQL usage to see the abusers at any given moment in time (and historically). This mode is good when you are just starting and want to see what is going on.</li></ul><hr><p><strong>Deprecated modes</strong></p><ul><li><strong>all - Always run queries inside user&#39;s LVE (will be deprecated on September 1, 2021)</strong>: This way there is no need for separate limits for MySQL. Depending on overhead we see in the future, we might decide to use it as a primary way of operating MySQL Governor . The benefit of this approach is that limits are applied to both PHP &amp; MySQL at the same time, all the time, preventing any spikes whatsoever. <em>Requires <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#mapping-a-user-to-a-database" class="router-link-active router-link-exact-active"><code>dbuser-map</code> file</a></em>.</li><li><strong>single - Single restricted&#39;s LVE for all restricted customers (deprecated)</strong>: In that mode once customer reaches the limits specified in the MySQL Governor , all customer&#39;s queries will be running inside LVE with id 3. This means that when you have 5 customers restricted at the same time, all queries for all those 5 customers will be sharing the same LVE. The larger the number of restricted customers - the less resources per restricted customer will be available.</li><li><strong>on</strong> - Synonym for <strong>single</strong> mode</li></ul><div class="warning custom-block"><p class="custom-block-title">Note</p><p>After the <code>all</code> mode will be deprecated on September 1, 2021:</p><ul><li>the users, having it, will continue to work with this mode;</li><li>all new installation will not have the <code>all</code> mode;</li><li>moving to the <code>all</code> mode will be forbidden.</li></ul></div><p>If the <code>dbuser-map</code> file is absent on the server, the <code>abusers</code> mode emulates the <code>single</code>.</p><p>With the <code>single</code> and <code>abusers</code> mode, once user is restricted, the queries for that user will be limited as long as user is using more than limits specified. After a minute that user is using less, we will unrestricted that user.</p><p>You can specify modes of operation using <a href="/cloudlinuxos/command-line_tools/#dbctl" class="">dbctl</a> or by changing <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#configuration-3" class="router-link-active router-link-exact-active">configuration file</a>.</p><h4 id="mysql-governor-limits" tabindex="-1"><a class="header-anchor" href="#mysql-governor-limits" aria-hidden="true">#</a> MySQL Governor limits</h4><p><strong>MySQL Governor limit setting recommendations</strong></p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Please note that these recommendations on setting limits for MySQL Governor are general. The exact values of the limits for the effective work of MySQL and the site as a whole depend on many factors.</p></div><p>Here they are:</p><ul><li>the load of the virtual server with incoming requests</li><li>the database size</li><li>SQL queries efficiency</li><li>absolute values of the LVE limits</li></ul><p>MySQL Governor allows setting the burstable limits for accounts. To provide that possibility, four levels of limits are defined: <code>current</code>, <code>short</code>, <code>middle</code>, and <code>long</code>. Correctly set limits can give users more CPU without having a bottleneck on MySQL.</p><p><strong>General principles of choosing the limits</strong>:</p><ul><li><code>current</code> and <code>short</code> can be more than the LVE limit and should not be less</li><li>setting the <code>current</code> and <code>short</code> limits more than the LVE limit prevents bottlenecks in SQL request processing</li><li><code>middle</code> limit can be more or less that the LVE limit</li><li><code>long</code> on the contrary, should not be more than the LVE limit</li><li>setting the <code>middle</code> and <code>long</code> limits less than the LVE limit prevents abuse of other processes in the account (Apache, PHP) by MySQL</li></ul><p><strong>Example of choosing MySQL Governor limits</strong></p><ul><li>With the default LVE SPEED limit is <code>100</code>, the possible values of the MySQL Governor CPU limits can be 100/95/87/75. I.e., we admit the short-term exceeding of the limits for processing SQL requests.</li><li>If you face spike CPU consumption with these limits, it is recommended to reduce the excess of the <code>current</code> and <code>short</code> limits over the LVE limit. For example, to the values 150/110/100/90.</li><li>If the average level of CPU consumption is too high, then it is recommended to reduce the <code>middle</code> and <code>long</code> limits, too. For example, to the values 150/100/80/50.</li><li>Then MySQL processes will fall into LVE and be limited by LVE limits more often.</li><li>The same clues are applicable to the IO limits – the <code>current</code> and <code>short</code> IO limits for MySQL Governor can exceed IO LVE limits, but the <code>middle</code> and <code>long</code> cannot.</li></ul><h4 id="starting-and-stopping" tabindex="-1"><a class="header-anchor" href="#starting-and-stopping" aria-hidden="true">#</a> Starting and stopping</h4><p>To start:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service db_governor start
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>To stop:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service db_governor stop
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="mapping-a-user-to-a-database" tabindex="-1"><a class="header-anchor" href="#mapping-a-user-to-a-database" aria-hidden="true">#</a> Mapping a user to a database</h4><p><strong>[</strong> <span class="notranslate"><strong>MySQL Governor</strong></span> <strong>1.x]</strong></p><p>Traditionally <span class="notranslate"> MySQL Governor </span> used prefixes to map user to database. With the latest version, we automatically generate <span class="notranslate"> user -&gt; database user </span> mapping for <span class="notranslate"> cPanel </span>, <span class="notranslate"> Plesk </span> and <span class="notranslate"> DirectAdmin </span> control panels.</p><p>The mapping file is recreated daily by cron.</p><p>Mapping recreation is also triggered by the following events on cPanel servers:</p><ul><li>creation of user</li><li>modification of user</li><li>removal of user</li></ul><p>You can also rebuild the mapping file manually on cPanel, Plesk and DirectAdmin control panels by running the following command:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/share/lve/dbgovernor/mysqlgovernor.py --dbupdate
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>The mapping file is located in: <span class="notranslate"><code>/etc/container/dbuser-map</code></span></p><p>The format of the file:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[dbuser_name1] [account_name1] [UID1]
...
[dbuser_nameN] [account_nameN] [UIDN]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div> For example: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pupkinas_u2 pupkinas 502
pupkinas_u1 pupkinas 502
pupkinas_u3 pupkinas 502
pupkin2a_uuu1 pupkin2a 505
pupkin10_p10 pupkin10 513
pupkin5a_u1 pupkin5a 508
pupkin3a_qq1 pupkin3a 506
pupkin3a_test22 pupkin3a 506
pupkin3a_12 pupkin3a 506
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>This would specify that db users: <span class="notranslate"> pupkinas_u2, pupkinas_u1, pupkinas_u3 </span> belong to user <span class="notranslate"> pupkinas </span> with uid (lve id) 502 db user <span class="notranslate"> pupkin2a_uuu1 </span> belongs to user <span class="notranslate"> pupkin2a </span> with uid 505, etc...</p><p><code>db_governor</code> service checks this file for modifications every 5 minutes.</p><p>If you need to force reload the mapping file, run:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service db_governor restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="log-files" tabindex="-1"><a class="header-anchor" href="#log-files" aria-hidden="true">#</a> Log files</h4><p><span class="notranslate"><strong>Error_log</strong></span></p><p><span class="notranslate"> MySQL Governor </span> error log is used to track any problems that <span class="notranslate"> MySQL Governor </span> might encounter. Error log is located in <span class="notranslate"> /var/log/dbgovernor-error.log </span></p><p><span class="notranslate"><strong>Restrict_log</strong></span></p><p>Restrict log is located in <span class="notranslate"> /var/log/dbgovernor-restrict.log </span></p><p>Restrictions:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>_timestamp_ _username_ LIMIT_ENFORCED _limit_setting_ __current_value_                         _restrict_level__ SERVER_LOAD TRACKED_VALUES_DUMP
 ...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><ul><li><span class="notranslate"> TRACKED_VALUES_DUMP=busy_time:xx,cpu_time:xx,... </span></li><li><span class="notranslate"> SERVER_LOAD </span> = load averages followed by output of <span class="notranslate"> vmstat </span></li><li><span class="notranslate"> TRACKED_VALUES_DUMP </span> is available with <span class="notranslate"> MEDIUM &amp; LONG </span> format</li><li><span class="notranslate"> SERVER_LOAD </span> is available with <span class="notranslate"> LONG </span> format</li></ul><p><span class="notranslate"><strong>Kill_log</strong></span></p><p><span class="notranslate"> MySQL Governor </span> kill log is optional log located in the <span class="notranslate">/var/log/dbgovernor-kill.log</span>. Kill log is used to track all killed queries</p><h4 id="change-mysql-version" tabindex="-1"><a class="header-anchor" href="#change-mysql-version" aria-hidden="true">#</a> Change MySQL version</h4><p>If you would like to change to a different MySQL version, or switch to <span class="notranslate"> MariaDB </span> you have to start by backing up existing databases.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>For experienced users only. Changing MySQL version is a quite complicated procedure, it causes system table structural changes which can lead to unexpected results. Think twice before proceeding.</p></div><div class="danger custom-block"><p class="custom-block-title">IMPORTANT</p><p>Please make full database backup (including system tables) before you will do upgrade of MySQL or switch to MariaDB. This action will prevent data losing in case if something goes wrong.</p></div><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/share/lve/dbgovernor/mysqlgovernor.py --mysql-version=MYSQL_VERSION
/usr/share/lve/dbgovernor/mysqlgovernor.py --install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><ul><li>If you are using <span class="notranslate"> cPanel </span> or <span class="notranslate"> DirectAdmin </span> - recompile <span class="notranslate"> Apache </span> .</li></ul><p>To install beta version of MySQL:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/share/lve/dbgovernor/mysqlgovernor.py --install-beta
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><span class="notranslate"> MYSQL_VERSION </span> can be one of the following:</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><span class="notranslate"> auto </span></td><td>default version of MySQL for given OS release (or cPanel settings)</td></tr><tr><td>mysql51</td><td>MySQL v5.1</td></tr><tr><td>mysql55</td><td>MySQL v5.5</td></tr><tr><td>mysql56</td><td>MySQL v5.6</td></tr><tr><td>mysql57</td><td>MySQL v5.7</td></tr><tr><td>mysql80</td><td>MySQL v8.0 (requires MySQL Governor 1.2-37+)</td></tr><tr><td>mysql84</td><td>MySQL v8.4 (requires MySQL Governor 1.2-129+)</td></tr><tr><td>mariadb55</td><td>MariaDB v5.5</td></tr><tr><td>mariadb100</td><td>MariaDB v10.0</td></tr><tr><td>mariadb101</td><td>MariaDB v10.1</td></tr><tr><td>mariadb102</td><td>MariaDB v 10.2</td></tr><tr><td>mariadb103</td><td>MariaDB v 10.3 [requires <span class="notranslate"> MySQL Governor 1.2-36+; for cPanel - MySQL Governor 1.2-41+ </span> ]</td></tr><tr><td>mariadb104</td><td>MariaDB v 10.4 [requires <span class="notranslate">MySQL Governor</span> 1.2-53+]</td></tr><tr><td>mariadb105</td><td>MariaDB v 10.5 [requires <span class="notranslate">MySQL Governor</span> 1.2-62+]</td></tr><tr><td>mariadb106</td><td>MariaDB v 10.6 [requires <span class="notranslate">MySQL Governor</span> 1.2-76+]</td></tr><tr><td>mariadb1011</td><td>MariaDB v 10.11 [requires <span class="notranslate">MySQL Governor</span> 1.2-103+]</td></tr><tr><td>mariadb1104</td><td>MariaDB v 11.4 [requires <span class="notranslate">MySQL Governor</span> 1.2-122+]</td></tr><tr><td>percona56</td><td>Percona v 5.6</td></tr></tbody></table><ul><li>We don&#39;t recommend to downgrade from MySQL v5.6, MariaDB 10.x</li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>cPanel does not officially support MariaDB 10.4, that is why we don’t recommend to use it on cPanel servers. Use on your own risk for Plesk servers, because downgrade can corrupt your databases.</p></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>MariaDB version 10.4 is not available for CloudLinux OS 6 yet.</p></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>See also MySQL Governor <a href="/cloudlinuxos/command-line_tools/#mysql-governor" class="">CLI</a></p></div><h4 id="privatedevices-mode-support" tabindex="-1"><a class="header-anchor" href="#privatedevices-mode-support" aria-hidden="true">#</a> PrivateDevices mode support</h4><p>MySQL Governor v. 1.2-66 and later on Cloudlinux OS 7 and 8 supports the PrivateDevices mode for the mysqld service.</p><p>To switch on the PrivateDevices mode, follow these steps.</p><p><strong>On Cloudlinux OS 7</strong></p><ul><li>Make sure that the systemd version is at least <strong>219-78.2.cloudlinux.1</strong></li><li>Add the following instruction into the <em>Service</em> section of the <em>mysqld</em> service file:<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>PrivateDevices=true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>Invoke <code>systemctl daemon-reload</code></li><li>Restart <em>mysqld</em> service</li></ul><p><strong>On Cloudlinux OS 8</strong></p><ul><li>Add the following instructions into the <em>Service</em> section of the <em>mysqld</em> service file:<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>PrivateDevices=true
DeviceAllow=/dev/lve
BindPaths=/dev/lve
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>Invoke <code>systemctl daemon-reload</code></li><li>Restart <em>mysqld</em> service</li></ul><h3 id="backing-up-mysql" tabindex="-1"><a class="header-anchor" href="#backing-up-mysql" aria-hidden="true">#</a> Backing up MySQL</h3><p>On <span class="notranslate"> cPanel </span> server disable MySQL service monitoring before doing the job:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>whmapi1 configureservice service=mysql enabled=1 monitored=0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>The following script could be used before installing MySQL-governor and MySQL/MariaDB packages to create the backup:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/share/lve/dbgovernor/scripts/mysql_backup.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><div class="tip custom-block"><p class="custom-block-title"></p><p>The script <code>mysql_backup.sh</code> is provided starting from the Governor version 1.2-115.</p></div><p>On <span class="notranslate"> cPanel </span> server enable monitoring back:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>whmapi1 configureservice service=mysql enabled=1 monitored=1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>This operation may take some time.</p></div><p>See also <a href="/cloudlinuxos/command-line_tools/#mysql-governor" class="">MySQL Governor CLI tools</a>.</p><h3 id="mysql-governor-improvements-for-cpu-calculation" tabindex="-1"><a class="header-anchor" href="#mysql-governor-improvements-for-cpu-calculation" aria-hidden="true">#</a> MySQL Governor improvements for CPU calculation</h3><p>In MySQL Governor version 1.2-81, we provide improvements in the algorithm of calculation user CPU usage. New behavior helps to increase precision of resource distribution between server users. By default the new type of CPU usage calculation is tuned on.</p><p>Server administrator can turn on/off the new type of CPU usage calculation by using the following command:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>dbctl --lve-improved-accuracy off
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="what-is-the-impact-of-improvements" tabindex="-1"><a class="header-anchor" href="#what-is-the-impact-of-improvements" aria-hidden="true">#</a> What is the impact of improvements?</h4><p>The calculation of CPU usage has become more accurate, so the <code>dbtop</code> utility provides more correct information to the MySQL Governor and it places user’s requests to the LVE in a proper moment. And as a result, such improvements reduce the possibility of absorbing whole server resources by one user.</p><p>One mpre possible outcome of calculation improvements is that some server users will become in need of MySQL Governor limits reconfiguration.</p><h4 id="how-to-view-the-impact-of-improvements" tabindex="-1"><a class="header-anchor" href="#how-to-view-the-impact-of-improvements" aria-hidden="true">#</a> How to view the impact of improvements?</h4><p>Let’s check the CPU usage charts from CloudLinux statistics (lve-stats).</p><p><strong>The new type of  CPU usage calculation is turned off</strong>.</p><p>In this case, CPU usage by database could be less than LVE average CPU usage (blue chart is lower than green chart):</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/NewTurnedOff.webp" alt=""></p><p><strong>The new type of  CPU usage calculation is turned on</strong>.</p><p>In this case, CPU usage by database become more similar to LVE average CPU usage (blue chart and green chart on the sceen):</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/NewTurnedOn.webp" alt=""></p><h3 id="faq" tabindex="-1"><a class="header-anchor" href="#faq" aria-hidden="true">#</a> FAQ</h3><h4 id="how-is-interaction-between-mysql-governor-and-lve-organized-1" tabindex="-1"><a class="header-anchor" href="#how-is-interaction-between-mysql-governor-and-lve-organized-1" aria-hidden="true">#</a> How is interaction between MySQL Governor and LVE organized?</h4><p>The main purpose of MySQL Governor is to monitor how many common resources are used by each user for working with MySQL/MariaDB and to manage usage restrictions for such resources by LVE containers.</p><p>Before any SQL request, MySQL Governor determines which user sent the request and if this user exceed limits, the MySQL Governor pushes the request to appropriate LVE container.</p><p>This is how common server resources can be managed.</p><h4 id="why-the-сpu-io-charts-are-different-for-database-and-lve-usage-1" tabindex="-1"><a class="header-anchor" href="#why-the-сpu-io-charts-are-different-for-database-and-lve-usage-1" aria-hidden="true">#</a> Why the СPU/IO charts are different for database and LVE usage?</h4><p>SQL requests are not limited inside LVE, so there are not any calculations for IO usage there. It can be clearly viewed via the lve-stats charts:</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/Chart1.webp" alt=""></p><p><strong>Blue chart (database)</strong>:</p><p>This is the user’s real IO Database usage which was calculated by MySQL Governor.</p><p><strong>Green chart (LVE)</strong>:</p><p>This is the user’s IO Database usage which was calculated by lve-stats.</p><p>Also for different types of database load (for example in case, there is a huge amount of shot requests), CPU usage charts for LVE and database can be different.</p><p>Take a look on this chart:</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/Chart2.webp" alt=""></p><p><strong>Blue (database) CPU usage</strong>:</p><p>It is calculated by MYSQL Governor and the value is identical with top/htop values.</p><p><strong>Green (LVE) CPU usage</strong>:</p><p>It is calculated by lve-stats. The values are less on the LVE CPU usage chart because user requests are placed in the LVE only for part of the time.</p><h4 id="for-what-purpose-are-the-io-limits-of-mysql-governor-used-1" tabindex="-1"><a class="header-anchor" href="#for-what-purpose-are-the-io-limits-of-mysql-governor-used-1" aria-hidden="true">#</a> For what purpose are the IO limits of MySQL Governor used?</h4><p>MySQL Governor uses its limits as triggers to place user’s requests to the LVE. If user’s requests exceed MySQL Governor limits they are placed to the LVE, which already limits resource usage. After some timeout (which can be configured in the MySQL Governor config file requests will not be placed to the LVE. The next placing of the SQL requests to the LVE will occur after the next limits are exceeded.</p><h4 id="how-exactly-does-io-limiting-work-for-mysql-mariadb-requests-1" tabindex="-1"><a class="header-anchor" href="#how-exactly-does-io-limiting-work-for-mysql-mariadb-requests-1" aria-hidden="true">#</a> How exactly does IO limiting work for MySQL/MariaDB requests?</h4><p>There is no direct IO limitation for database treads. But in case of exceeding governor IO user limits, their requests will be placed into the LVE and CPU LVE limitation will be applied to the requests. And it’s clear that any IO load causes CPU load. So by CPU limits IO usage will be limited indirectly.</p><p>Take a look at the next chart. The I/O load is synchronous with the CPU load.</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/Chart3.webp" alt=""></p><h3 id="troubleshooting-1" tabindex="-1"><a class="header-anchor" href="#troubleshooting-1" aria-hidden="true">#</a> Troubleshooting</h3><p><strong>MariaDB 5.5 and MariaDB 10.0: How to set LimitNOFILE correctly for systemd.</strong></p><p><span class="notranslate"> MariaDB 5.5 </span> and <span class="notranslate"> MariaDB 10.0 </span> have only file for managing the service, but the file has <span class="notranslate"> LSB </span> functions, so it is supported by <span class="notranslate"><code>systemd</code></span> .</p><p>For adding extra limits, do the following:</p><ol><li>Run:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mkdir /etc/systemd/system/mariadb.service.d/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ol start="2"><li>Run:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>touch /etc/systemd/system/mariadb.service.d/limits.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ol start="3"><li>Add the following content to the the file <span class="notranslate"><code>/etc/systemd/system/mariadb.service.d/limits.conf</code></span> :</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[Service]
LimitNOFILE=99999
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>MySQL Governor lost connection to MySQL - “Can&#39;t connect to mysql” messages in /var/log/dbgovernor-error.log (Plesk and DirectAdmin)</strong></p><p>This may be caused by changing root/administrator credentials without updating MySQL <span class="notranslate"> Governor </span> configuration file.</p><p>When you change root or administrator credentials in <span class="notranslate"> Plesk or DirectAdmin, </span> you also need to update MySQL <span class="notranslate"> Governor </span> configuration file. This could be done with the following command (available since <span class="notranslate"> governor-mysql 1.2-38): </span></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/share/lve/dbgovernor/mysqlgovernor.py --update-config-auth
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>The command updates credentials in MySQL <span class="notranslate">Governor</span> configuration file and restarts <span class="notranslate"><code>db_governor</code></span> service afterwards.</p><p>After applying the command MySQL <span class="notranslate">Governor</span> successfully connects to MySQL.</p><p><strong>Handling Missing Libraries in cl-MariaDB-libs for MySQL Governor (libgovernor_stubs.so)</strong></p><p>During the update of latest <code>cl-MariaDB-libs</code>, issues related to the addition or removal of certain shared libraries in cl-MySQL/cl-MariaDB packages may arise. The presence or absence of these libraries can disrupt the functioning of clients&#39; systems.</p><p>When you encounter errors pointing towards missing or newly added libraries after updating the cl-MySQL/cl-MariaDB packages, it&#39;s crucial to adjust and address the configurations to restore normalcy.</p><p>For instance, the error might resemble the following message:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ImportError: libexample_stubs.so: cannot open shared object file: No such file or directory
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>The recommended approach to resolving such issues involves three primary steps:</p><ol><li>Verify the Presence of the Library.</li></ol><p>Use the command to ascertain the library&#39;s presence in the current version:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum provides &#39;*/libexample_stubs.so&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>Recompiling the Affected Package.</li></ol><p>Recompile the affected package for each user, especially if using Python&#39;s mysql package (<code>mysqlclient</code>):</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pip install mysqlclient --force --no-cache-dir
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>However, this is not the ideal solution since sites that are functional may break after a system update.</p><ol start="3"><li>Using Utilities to Modify Binary.</li></ol><p>If recompilation isn&#39;t feasible, <code>patchelf</code> utility can help remove references to the missing library in the binary:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>patchelf --remove-needed libexample_stubs.so path/to/affected/binary.so
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Applying the aforementioned steps should rectify the issues, allowing MySQL <span class="notranslate">Governor</span> to function correctly with the updated libraries in cl-MySQL/cl-MariaDB packages.</p><p>Always remember to back up your data and configurations before making any changes to ensure a safety net in case of any inadvertent errors. If you continue to face challenges, please reach out to our support team for assistance.</p><h3 id="known-limitations" tabindex="-1"><a class="header-anchor" href="#known-limitations" aria-hidden="true">#</a> Known limitations</h3><h4 id="i-o-lve-limits-don-t-work-for-user-s-sql-queries" tabindex="-1"><a class="header-anchor" href="#i-o-lve-limits-don-t-work-for-user-s-sql-queries" aria-hidden="true">#</a> I/O LVE limits don&#39;t work for user’s SQL queries</h4><p>In the MySQL Governor default mode, once users go over the limits, all their SQL queries will execute inside that user&#39;s LVE.</p><p>This technique was provided with the early 1.1.5 version of MySQL Governor.</p><p>It turned out that memory limitation for MySQLrequests causes the OOM (Out Of Memory) issues and as a result database corruptions. So, it was decided not to apply LVE memory limits for SQL queries supplied by MySQL Governor. But the internal implementation of LVE is such that I/O and memory limits work together. That’s why the I/O LVE limits do not apply for user’s SQL queries now.</p><p>Nevertheless, SQL queries inside LVE are restricted by CPU limit which indirectly limits I/O usage, too.</p><h2 id="php-selector" tabindex="-1"><a class="header-anchor" href="#php-selector" aria-hidden="true">#</a> PHP Selector</h2><h3 id="general-information-and-requirements-4" tabindex="-1"><a class="header-anchor" href="#general-information-and-requirements-4" aria-hidden="true">#</a> General information and requirements</h3><p>The main requirements:</p><ul><li>CageFS is installed</li><li>Alt-PHP packages are installed</li><li>Mod_suexec is installed. You can find installation instruction <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#apache-suexec-module" class="router-link-active router-link-exact-active">here</a></li><li>CageFS is initialized without errors</li><li>CageFS is enabled for a domain user-owner</li><li>An appropriate PHP handler is selected for PHP version which is system version. <span class="notranslate"> PHP Selector </span> is <strong>compatible</strong> with the following technologies: <span class="notranslate"><em>suPHP, mod_fcgid, CGI (suexec), LiteSpeed</em></span>. See also <a href="/cloudlinuxos/limits/#compatibility-matrix" class="">Compatibility Matrix</a>.</li><li>PHP version in the CloudLinux OS PHP selector does not equal to the Native PHP version</li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>PHP Selector is not supported for H-Sphere.</p></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>PHP Selector requires native PHP to be installed, otherwise you will get an error message with a proposal to install PHP package. Here are some instructions for different control panels:</p><ol><li><a href="https://documentation.cpanel.net/display/EA4/EasyApache+4+and+the+ea-php-cli+Package" target="_blank" rel="noopener noreferrer">for cPanel</a></li><li><a href="https://support.plesk.com/hc/en-us/articles/115004177974-How-to-install-PHP-by-OS-vendor-in-Plesk-for-Linux" target="_blank" rel="noopener noreferrer">for Plesk</a></li><li><a href="https://help.directadmin.com/item.php?id=345" target="_blank" rel="noopener noreferrer">for DirectAdmin</a></li></ol><p>After installing native PHP, please run the <code>cloudlinux-selector setup --interpreter=php --json</code> command in order to reconfigure CageFS and LVE Manager.</p></div><h3 id="supported-versions" tabindex="-1"><a class="header-anchor" href="#supported-versions" aria-hidden="true">#</a> Supported versions</h3><div class="tip custom-block"><p class="custom-block-title"></p><p>The mark <code>x</code> stands for a supported version.</p></div><table><thead><tr><th style="text-align:center;"></th><th style="text-align:center;">Cloudlinux 6</th><th style="text-align:center;">Cloudlinux 7</th><th style="text-align:center;">Cloudlinux 8</th><th style="text-align:center;">Cloudlinux 9</th><th style="text-align:center;">Cloudlinux 10</th></tr></thead><tbody><tr><td style="text-align:center;">alt-php 5.1</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">–</td><td style="text-align:center;">–</td></tr><tr><td style="text-align:center;">alt-php 5.2</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">–</td></tr><tr><td style="text-align:center;">alt-php 5.3</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">–</td></tr><tr><td style="text-align:center;">alt-php 5.4</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">–</td></tr><tr><td style="text-align:center;">alt-php 5.5</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">–</td></tr><tr><td style="text-align:center;">alt-php 5.6</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td></tr><tr><td style="text-align:center;">alt-php 7.0</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td></tr><tr><td style="text-align:center;">alt-php 7.1</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td></tr><tr><td style="text-align:center;">alt-php 7.2</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td></tr><tr><td style="text-align:center;">alt-php 7.3</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td></tr><tr><td style="text-align:center;">alt-php 7.4</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td></tr><tr><td style="text-align:center;">alt-php 8.0</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td></tr><tr><td style="text-align:center;">alt-php 8.1</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td></tr><tr><td style="text-align:center;">alt-php 8.2</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td></tr><tr><td style="text-align:center;">alt-php 8.3</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td></tr><tr><td style="text-align:center;">alt-php 8.4</td><td style="text-align:center;">–</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td></tr></tbody></table><h3 id="installation-and-update-3" tabindex="-1"><a class="header-anchor" href="#installation-and-update-3" aria-hidden="true">#</a> Installation and update</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#update" class="router-link-active router-link-exact-active">Update</a></li></ul><p>The installation of <span class="notranslate"> PHP Selector </span> presumes that you already have <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#cagefs" class="router-link-active router-link-exact-active">CageFS</a> &amp; <span class="notranslate"><a href="/lve_manager/" class="">LVE Manager</a> installed.</span></p><p>Use <a href="/cloudlinuxos/limits/#compatibility-matrix" class="">compatibility matrix</a> to check if your Web Server/PHP mode is supporting <span class="notranslate"> PHP Selector. </span> If not, you need a change to one of the supported models.</p><p>Installation of different versions of PHP &amp; modules:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum groupinstall alt-php
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Update CageFS &amp; <span class="notranslate"> LVE Manager with support for PHP Alternatives: </span></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ yum update cagefs lvemanager
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><span class="notranslate"><strong>cPanel/WHM</strong>: Make sure &#39;Select PHP version&#39; </span> is enabled in <span class="notranslate"> Feature Manager </span>.</p><div class="warning custom-block"><p class="custom-block-title">IMPORTANT</p><p>Please, do not use settings like <span class="notranslate"><code>SuPHP_ConfigPath</code>, <code>PHPRC</code>, <code>PHP_INI_SCAN_DIR</code></span>. Do not redefine path to <span class="notranslate"><code>php.ini</code></span> and ini-files for PHP modules. Doing that can break <span class="notranslate">PHP Selector</span> functionality.</p></div><p>For example, alternative php5.2 versions should load <span class="notranslate"><code>/opt/alt/php52/etc/php.ini</code></span> file and scan <span class="notranslate"><code>/opt/alt/php52/etc/php.d</code></span> directory for modules:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Configuration File (php.ini) Path         /opt/alt/php52/etc
Loaded Configuration File                 /opt/alt/php52/etc/php.ini
Scan this dir for additional .ini files   /opt/alt/php52/etc/php.d
additional .ini files parsed              /opt/alt/php52/etc/php.d/alt_php.ini
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Those are default locations for <span class="notranslate">alt-php</span>.</p><p>If you need custom PHP settings per user, please change them via <span class="notranslate">&quot;Edit PHP settings&quot;</span> feature of <span class="notranslate"> PHP Selector </span> .</p><p>If a list of default modules is absent on the server in the <span class="notranslate"><code>/etc/cl.selector/defaults.cfg</code></span> file for some alt-PHP version and there is <code>nd_mysqli</code> extension in this version, then on installation/update of the LVE Manager the <code>mysqli</code> extension will be disabled and <code>nd_mysqli</code> extension will be enabled automatically.</p><ul><li>If <em>nd_mysqli</em> module is absent or a list of enabled modules is available, then they won&#39;t be changed automatically.</li><li>If alt-PHP is not installed on LVE Manager installation/update, then they won’t be changed automatically.</li></ul><p>To change the modules status (enabled/disabled) manually, run the following command in a console:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/cloudlinux-selector make-defaults-config --json --interpreter=php
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="update" tabindex="-1"><a class="header-anchor" href="#update" aria-hidden="true">#</a> Update</h4><p>To update PHP Selector, run the following command:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum groupupdate alt-php
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>This command allows to install newly released versions in <span class="notranslate"> PHP Selector. </span></p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>See also PHP Selector <a href="/cloudlinuxos/command-line_tools/#php-selector" class="">CLI</a></p></div><h3 id="installation-instructions-for-cpanel-users" tabindex="-1"><a class="header-anchor" href="#installation-instructions-for-cpanel-users" aria-hidden="true">#</a> Installation instructions for cPanel users</h3><ol><li>Install CageFS as root via SSH:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install cagefs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ol start="2"><li>Install <code>alt-php</code> packages as root:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum groupinstall alt-php
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ol start="3"><li>Install <code>mod_suexec</code> package as root. See installation instructions <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#installation-5" class="router-link-active router-link-exact-active">here</a>.</li><li>Verify that CageFS is initialized successfully.</li></ol><ul><li>via SSH by running the following command:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --check-cagefs-initialized
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li>via cPanel admin interface</li></ul><p>Go to <span class="notranslate">cPanel → Admin interface → LVE Manager → Dashboard</span> → click <span class="notranslate"><em>Refresh</em></span></p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/cageFS-verify.webp" alt=""></p><p>If there is a problem you can see <em>Not initialized</em></p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/not-initialized.webp" alt=""></p><ol start="5"><li>Initilize CageF (if it is not initialized)</li></ol><ul><li>Via SSH</li></ul><div clas="code"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --init
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li><p>Via cPanel admin interface</p><p>Go to cPanel → <span class="notranslate">Admin interface → LVE manager → Options → CageFS INIT</span></p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/CageFS-init.webp" alt=""></p></li></ul><p>If CageFS was initialized after refreshing Dashboard you will see that CageFS is enabled:</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/CageFS-enabled.webp" alt=""></p><ol start="6"><li>Enable CageFS to a user</li></ol><p>Go to <span class="notranslate">cPanel → Admin interface → LVE manager → Users</span></p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/enable-CageFS-to-user.webp" alt=""></p><ul><li>For one user by individual slider (for LVE 1001 in the picture above)</li><li>For a group of user by the <em>CageFS</em> button (for LVE 1002 and 1003 in the picture above)</li></ul><ol start="7"><li>Check that system PHP version is not <code>alt-php</code> (it should be <code>ea-php</code>)</li></ol><p>Go to <span class="notranslate">cPanel → Admin interface → MultiPHP Manager → PHP versions</span></p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/check-ea-php.webp" alt=""></p><ol start="8"><li>Check that an appropriate PHP handler is selected for PHP version which is system version</li></ol><p>Go to <span class="notranslate">cPanel Admin interface → MultiPHP Manager → PHP Handlers</span></p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/php-handlers.webp" alt=""></p><ol start="9"><li>Check version for domain in MultiPHP Selector. It should be equal to the system default version</li></ol><p>Go to <span class="notranslate">cPanel Admin interface → MultiPhp Manager → PHP versions</span> → scroll to <span class="notranslate"><em>Set PHP Version per Domain</em></span></p><ol start="10"><li>Version for domain in User’s interface in PHP Selector should not be equal to the <span class="notranslate">Native</span> version.</li></ol><h3 id="litespeed-support" tabindex="-1"><a class="header-anchor" href="#litespeed-support" aria-hidden="true">#</a> LiteSpeed support</h3><div class="tip custom-block"><p class="custom-block-title">Note</p><p>LiteSpeed detects CloudLinux OS and applies all settings out-of-the-box.</p></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>If your LiteSpeed is installed to a non-standard, custom location path, create a symlink: <code>ln -s /path/to/custom/lsws /usr/local/lsws</code> then run <code>cagefsctl --setup-cl-selector</code>.</p></div><p>If the settings were not applied, you can use the following steps to set up LiteSpeed to use <span class="notranslate"> PHP Selector. </span></p><ol><li>Follow PHP Selector <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#installation-and-update-4" class="router-link-active router-link-exact-active">installation guide</a>.</li><li>Make sure the following settings are set in the LSWS Web Admin console:</li></ol><ul><li>Configuration ➞ Server ➞ General ➞ CloudLinux OS: <code>CageFS</code> or <code>CageFS without suEXEC</code></li><li>Configuration ➞ Server ➞ General ➞ PHP suEXEC: <code>Yes</code></li></ul><p><strong>How to set up LiteSpeed version 5.3+ to use PHP Selector</strong></p><p><strong>For Plesk</strong></p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/LiteSpeedForPlesk.webp" alt=""></p><p><strong>For other control panels</strong></p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/LiteSpeedForOtherCP.webp" alt=""></p><p>Additionally, we recommend setting up the following parameters:</p><ul><li>Configuration ➞ Server ➞ PHP:</li><li>Click <em>Edit</em> in the PHP Handler Defaults section</li><li>Set <em>Yes</em> in the <em>Run On Startup</em></li><li>Make sure to set <em>Max Idle Time</em> (for example to 140)</li></ul><p><img src="/images/cloudlinuxos/cloudlinux_os_components/LiteSpeedAdditionSettings.webp" alt=""></p><p><strong>How to set up LiteSpeed version lower than 5.3 to use PHP Selector</strong></p><p>Go to the <em>External App</em> tab, <em>External Application</em> ➞ Add.</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/LiteSpeedExternalAppTab.webp" alt=""></p><ul><li>The <em>Command line</em> should be <code>/var/www/cgi-bin/cgi_wrapper/cloudlinux_wrapper</code> on Plesk.</li><li>For other control panels, the <em>Command line</em> should be <code>/usr/local/bin/lsphp</code>.</li><li>The <em>Run On Start Up</em> line must contain <code>Yes</code> or <code>No</code>.</li></ul><p><strong>For Plesk</strong></p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/LiteSpeedPlesk.webp" alt=""></p><p><strong>For other control panels</strong></p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/LiteSpeedOtherCP.webp" alt=""></p><p>Settings in text format:</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><span class="notranslate">Name</span></td><td><span class="notranslate"><code>lsphp_selector</code></span></td></tr><tr><td><span class="notranslate">Address</span></td><td><span class="notranslate"><code>uds://tmp/lshttpd/lsphp_selector.sock</code></span></td></tr><tr><td><span class="notranslate">Notes</span></td><td><span class="notranslate">Not Set</span></td></tr><tr><td><span class="notranslate">Max Connections</span></td><td><code>35</code></td></tr><tr><td><span class="notranslate">Environment</span></td><td><span class="notranslate"><code>PHP_LSAPI_MAX_REQUESTS=5000</code></span><br><span class="notranslate"><code>PHP_LSAPI_CHILDREN=35</code></span></td></tr><tr><td><span class="notranslate">Initial Request Timeout (secs)</span></td><td><code>60</code></td></tr><tr><td><span class="notranslate">Retry Timeout (secs)</span></td><td><code>0</code></td></tr><tr><td><span class="notranslate">Persistent Connection</span></td><td><span class="notranslate"><code>Yes</code></span></td></tr><tr><td><span class="notranslate">Connection Keepalive Timeout</span></td><td><span class="notranslate">Not Set</span></td></tr><tr><td><span class="notranslate">Response Buffering</span></td><td><span class="notranslate"><code>No</code></span></td></tr><tr><td><span class="notranslate">Auto Start</span></td><td><span class="notranslate"><code>Through CGI Daemon (Async)</code></span></td></tr><tr><td><span class="notranslate">Command</span></td><td>* For Plesk <span class="notranslate"><code>/var/www/cgi-bin/cgi_wrapper/cloudlinux_wrapper</code></span><br>* For other control panels <span class="notranslate"><code>/usr/local/bin/lsphp</code></span></td></tr><tr><td><span class="notranslate">Back Log</span></td><td><code>100</code></td></tr><tr><td><span class="notranslate">Instances</span></td><td><code>1</code></td></tr><tr><td><span class="notranslate">suEXEC User</span></td><td><span class="notranslate">Not Set</span></td></tr><tr><td><span class="notranslate">suEXEC Group</span></td><td><span class="notranslate">Not Set</span></td></tr><tr><td><span class="notranslate">umask</span></td><td><span class="notranslate">Not Set</span></td></tr><tr><td><span class="notranslate">Run On Start Up</span></td><td><span class="notranslate"><code>Yes</code></span></td></tr><tr><td><span class="notranslate">Max Idle Time</span></td><td><code>70</code></td></tr><tr><td><span class="notranslate">Priority</span></td><td><code>0</code></td></tr><tr><td><span class="notranslate">Memory Soft Limit (bytes)</span></td><td><code>2047M</code></td></tr><tr><td><span class="notranslate">Memory Hard Limit (bytes)</span></td><td><code>2047M</code></td></tr><tr><td><span class="notranslate">Process Soft Limit</span></td><td><code>400</code></td></tr><tr><td><span class="notranslate">Process Hard Limit</span></td><td><code>500</code></td></tr></tbody></table><p>Go to the <em>Script Handler</em> tab. For required suffixes, change the <em>Handler Name</em> to <code>lsphp_selector</code>.</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/LiteSpeedHandlerName.webp" alt=""></p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/LiteSpeedScriptHandler.webp" alt=""></p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>In order to use PHP Selector and custom php.ini, lsphp5 needs to be in SuEXEC non-daemon mode.</p></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Some PHP configurations require more memory for SuExec to work properly. If you are getting error 500 after switching suEXEC to non-daemon mode, try to increase Memory Soft Limit and Memory Hard Limit for external App to at least 650/800M.</p></div><h3 id="ispmanager-support" tabindex="-1"><a class="header-anchor" href="#ispmanager-support" aria-hidden="true">#</a> ISPmanager support</h3><p>As of July 2013, <span class="notranslate"> PHP Selector </span> support for <span class="notranslate"> ISPmanager </span> is limited to command line utilities. You should still be able to use it.</p><p>As always, <span class="notranslate"> PHP Selector </span> requires <span class="notranslate"> CGI, FCGI </span> or <span class="notranslate"> suPHP </span> to work.</p><p>You will need to do following modifications:</p><p>Create new file <span class="notranslate"> /usr/local/bin/php-cgi-etc: </span></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#!/bin/bash
/usr/bin/php-cgi -c /etc/php.ini &quot;$@&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div> Make that file executable: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>chmod +x /usr/local/bin/php-cgi-etc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Edit file <span class="notranslate"> /usr/local/ispmgr/etc/ispmgr.conf </span><p>Add a line:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>path phpcgibinary /usr/local/bin/php-cgi-etc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Make sure there is no other lines with <span class="notranslate"><code>path phpcgibinary</code></span> defined in the file.</p><p>Restart <span class="notranslate"> ISPmanager </span> :</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>killall ispmgr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>After that <span class="notranslate"> FCGID </span> wrappers <span class="notranslate">(<code>/var/www/[USER]/data/php-bin/php</code>)</span> for new users will be like this:</p><p><span class="notranslate"> #!/usr/local/bin/php-cgi-etc </span></p><p>You might need to edit/modify wrappers for existing users if you want them to be able to use <span class="notranslate">PHP Selector</span>. You can leave them as is for users that don&#39;t need such functionality.</p><h3 id="uninstalling-2" tabindex="-1"><a class="header-anchor" href="#uninstalling-2" aria-hidden="true">#</a> Uninstalling</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#disabling-php-extension-globally" class="router-link-active router-link-exact-active">Disabling PHP extension globally</a></li></ul><p>It is not possible to remove <span class="notranslate"> PHP Selector </span> from the system completely as it is an essential part of <span class="notranslate"> LVE Manager </span> and CageFS packages. However, you can make PHP Selector unavailable for cPanel and Plesk users.</p><p>To do so, go to <span class="notranslate"><em>LVE Manager → PHP Selector</em></span> and check <span class="notranslate"><em>Disabled</em> as PHP Selector </span> status. Doing so allows you to disable web-interface of the <span class="notranslate"> PHP Selector </span> in the user interface but does not reset custom settings (choosing a version of PHP and modules).</p><p>To disable <span class="notranslate"> PHP Selector </span> and make it has no effect on a PHP version on the sites, run the following command:</p><ul><li>this command resets PHP versions to Native:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --cl-selector-reset-versions
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li>this command resets PHP modules to Default:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --cl-selector-reset-modules
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><div class="danger custom-block"><p class="custom-block-title"></p><p>These commands can affect PHP version of your clients’ web sites. Use them with caution as improper usage might cause your clients’ web sites down.</p></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>It is possible to manually uninstall the integral parts of PHP Selector - <strong>alt-php</strong> packages. However, since CloudLinux OS components heavily rely on them, we do not recommend doing so. Proceed with caution and keep an eye on yum dependencies if you decide to uninstall the packages.</p></div><h4 id="disabling-php-extension-globally" tabindex="-1"><a class="header-anchor" href="#disabling-php-extension-globally" aria-hidden="true">#</a> Disabling PHP extension globally</h4><p>If you want to disable PHP extension globally, you don&#39;t need to remove file <span class="notranslate"> /opt/alt/phpXX/etc/php.d.all/$EXTENSION.ini </span> . You should just comment out <span class="notranslate"> &quot;extension=&quot; </span> directives in it.</p><p>The extension will be visible in <span class="notranslate">PHP Selector</span> interface, but selecting it in users&#39;s interface will take no effect - extension will be disabled in fact.</p><p>Reinstalling of <span class="notranslate"><code>alt-php</code></span> packages will not reset settings (will not enable extension again).</p><h3 id="configuration-and-using" tabindex="-1"><a class="header-anchor" href="#configuration-and-using" aria-hidden="true">#</a> Configuration and using</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#setting-default-version-and-modules" class="router-link-active router-link-exact-active">Setting default version and modules</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#individual-php-ini-files" class="router-link-active router-link-exact-active">Individual PHP.ini files</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#how-to-add-additional-php-ini-file-for-a-user-inside-cagefs" class="router-link-active router-link-exact-active">How to add additional php.ini file for a user inside CageFS</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#substitute-global-php-ini-for-individual-customer" class="router-link-active router-link-exact-active">Substitute global php.ini for individual customer</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#how-to-substitute-global-php-ini-for-individual-customer-on-cpanel-server-with-easyapache4" class="router-link-active router-link-exact-active">How to substitute global php.ini for individual customer on cPanel server with EasyApache4</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#managing-interpreter-version" class="router-link-active router-link-exact-active">Managing interpreter version</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#including-php-selector-only-with-some-packages-cpanel" class="router-link-active router-link-exact-active">Including PHP Selector only with some packages - cPanel</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#php-extensions" class="router-link-active router-link-exact-active">PHP extensions</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#ffmpeg" class="router-link-active router-link-exact-active">FFmpeg</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#native-php-configuration" class="router-link-active router-link-exact-active">Native PHP configuration</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#how-to-configure-alt-php72-zts-to-use-with-php-selector" class="router-link-active router-link-exact-active">How to configure alt-php72-zts to use with PHP Selector</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#using" class="router-link-active router-link-exact-active">Using</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#custom-php-ini-options" class="router-link-active router-link-exact-active">Custom PHP.ini options</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#end-user-files-and-directories" class="router-link-active router-link-exact-active">End user files and directories</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#compiling-your-own-extensions" class="router-link-active router-link-exact-active">Compiling your own extensions</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#roll-your-own-php" class="router-link-active router-link-exact-active">Roll your own PHP</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#detect-user-s-php-version" class="router-link-active router-link-exact-active">Detect user&#39;s PHP version</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#php-selector-without-cagefs" class="router-link-active router-link-exact-active">PHP Selector without CageFS</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#configuring-global%E2%80%9D-php-ini-options-for-all-alt-php-versions" class="router-link-active router-link-exact-active">Configuring &quot;global” php.ini options for all Alt-PHP versions</a></li></ul><h4 id="setting-default-version-and-modules" tabindex="-1"><a class="header-anchor" href="#setting-default-version-and-modules" aria-hidden="true">#</a> Setting default version and modules</h4><p>Administrator can set default interpreter version and extensions for all users. All file operations are actually done by CageFS. CageFS takes settings from <span class="notranslate"> /etc/cl.selector/defaults.cfg. </span> Currently the <span class="notranslate"> /etc/cl.selector/defaults.cfg </span> is created and handled by <span class="notranslate"> CloudLinux OS PHP Selector </span> scripts. It has the following format:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[global]
selector=enabled

[versions]
php=5.4

[php5.4]
modules=json,phar

[php5.3]
modules=json,zip,fileinfo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>To reset the extensions for end users to the default list of extensions as defined in the <code>defaults.cfg</code> file, you can run the following command:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --list-enabled | grep -v enabled | grep -v &#39;^$&#39; | while read -r line; do \
    id &quot;$line&quot; &amp;&gt;/dev/null &amp;&amp; selectorctl --reset-user-extensions --version=8.4 --user=&quot;$line&quot; || echo &quot;User $line does not exist, skipping&quot;; \
done
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This command will reset the extensions for all users on PHP version 8.4 to the default list. You can specify a different PHP version by modifying the <code>--version</code> argument in the command above.</p><p>To reset the extensions for a specific user, you can use the following command:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>selectorctl --reset-user-extensions --version=8.4 --user=user1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="individual-php-ini-files" tabindex="-1"><a class="header-anchor" href="#individual-php-ini-files" aria-hidden="true">#</a> Individual PHP.ini files</h4><p>For each customer, inside CageFS, file <span class="notranslate"> alt_php.ini is located in /etc/cl.php.d/alt-phpXX (XX </span> - version of PHP, like 52 or 53). The file contains PHP extension settings and extension directives selected by customer. This file exists for each customer, for each PHP version.</p><p>Note, that this is <span class="notranslate"> &#39;local&#39; to CageFS, </span> and different users will have different files. The file is not visible in <span class="notranslate"> /etc/cl.php.d </span> outside CageFS. If you would like to view that file, use:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># cagefsctl -e USERNAME
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>to enter into CageFS for that user. Then type: <span class="notranslate"><code>exit</code></span> ; to exit from CageFS</p><p>This file has to be updated using <span class="notranslate"><code>cagefsctl --rebuild-alt-php-ini</code></span> after updating <span class="notranslate"> alt-php </span> RPMs</p><p>Admin can change individual settings for PHP extensions by changing that extension&#39;s ini file, like editing <span class="notranslate"> /opt/alt/php54/etc/php.d.all/eaccelerator.ini </span> and then running:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --rebuild-alt-php-ini
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> to propagate the change. <h4 id="how-to-add-additional-php-ini-file-for-a-user-inside-cagefs" tabindex="-1"><a class="header-anchor" href="#how-to-add-additional-php-ini-file-for-a-user-inside-cagefs" aria-hidden="true">#</a> How to add additional php.ini file for a user inside CageFS</h4><p>If you want to create additional <code>php.ini</code> file for a user inside CageFS in order to change some specific PHP options for that user, you can execute the following:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>su -s /bin/bash - USER
cd /etc/cl.php.d/alt-php72/
echo &quot;upload_tmp_dir=/tmp&quot; &gt;&gt; custom.ini
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>The commands above create <code>custom.ini</code> file that will be used for <code>alt-php72</code>. By default this approach is valid only for alt-php version selected via <span class="notranslate">PHP Selector</span>. When <span class="notranslate"><code>/etc/cl.selector/symlinks.rules</code></span> file contains <span class="notranslate"><code>php.d.location = selector</code></span> line, then the approach is valid for all alt-php versions regardless whether it is selected in PHP Selector or not.</p><p>You can find more details <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#bundled-php-extensions" class="router-link-active router-link-exact-active">here</a>.</p><p>But the recommended way is to modify PHP options via PHP Selector web or CLI interfaces, as described <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#custom-php-ini-options" class="router-link-active router-link-exact-active">here</a>.</p><h4 id="substitute-global-php-ini-for-individual-customer" tabindex="-1"><a class="header-anchor" href="#substitute-global-php-ini-for-individual-customer" aria-hidden="true">#</a> Substitute global php.ini for individual customer</h4><p>Sometimes you might want to have a single customer with a different php.ini, than the rest of your customers.</p><p>To do that, you will use <span class="notranslate"><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#custom-etc-files-per-customer" class="router-link-active router-link-exact-active">custom.etc directory functionality</a></span></p><ol><li>Move default php.ini into <span class="notranslate"><em>/etc</em></span> directory and create a symlink to it:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mv /usr/local/lib/php.ini /etc/php.ini
ln -fs /etc/php.ini /usr/local/lib/php.ini
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><ol start="2"><li>Change path to php.ini in <span class="notranslate"><em>/etc/cl.selector/native.conf</em></span> file to:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>php.ini=/etc/php.ini
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ol start="3"><li>For each user that needs custom file, create directory <span class="notranslate"><em>/etc/cagefs/custom.etc/USER_NAME/php.ini</em></span> .</li></ol><p>For example if you want to create custom for <span class="notranslate"> USER1 </span> and <span class="notranslate"> USER2 </span> you would create files: <span class="notranslate"><em>/etc/cagefs/custom.etc/USER1/php.ini</em></span><span class="notranslate"><em>/etc/cagefs/custom.etc/USER2/php.ini</em></span></p><p>Create such files for each user that should have custom file.</p><ol start="4"><li>Execute:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --force-update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><div class="tip custom-block"><p class="custom-block-title">Notes</p><ol><li><p>Make sure that <code>php.ini</code> load path is set to <span class="notranslate"><code>/etc/php.ini</code></span></p></li><li><p>Users will be able to override settings of those php.ini files (global or custom) via <span class="notranslate">PHP Selector</span>. If you want to prevent that, you should disable <span class="notranslate">PHP Selector</span> feature.</p></li><li><p>Even if <span class="notranslate">PHP Selector</span> is disabled, user can override PHP settings by using <span class="notranslate"><code>ini_set() php</code></span> function in PHP script, or by <span class="notranslate"><code>php -c</code></span> command line option.</p></li><li><p>If you modify anything in <span class="notranslate"><code>/etc/cagefs/custom.etc</code></span> directory, you should execute:</p></li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --update-etc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>in order to apply changes to CageFS for all users.</p><p>OR</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --update-etc user1 user2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>to apply changes to CageFS for specific users.</p></div><h4 id="how-to-substitute-global-php-ini-for-individual-customer-on-cpanel-server-with-easyapache4" tabindex="-1"><a class="header-anchor" href="#how-to-substitute-global-php-ini-for-individual-customer-on-cpanel-server-with-easyapache4" aria-hidden="true">#</a> How to substitute global php.ini for individual customer on cPanel server with EasyApache4</h4><div class="tip custom-block"><p class="custom-block-title">Note</p><p>It is enough to put <code>php.ini</code> in the directory where PHP script is located in order to run the PHP script with a custom <code>php.ini</code> when using SuPHP. Also, you can use <span class="notranslate">cPanel MultiPHP Manager</span> to create user’s custom <code>php.ini</code> file, and this approach should work for CGI, FCGI, and LSAPI. Recommended ways to manage <code>php.ini</code> settings per user are to use <span class="notranslate">cPanel MultiPHP</span> or <span class="notranslate">CloudLinux OS PHP Selector</span> interfaces.</p></div><ol><li><p>For each user that needs custom file, create directory <span class="notranslate"><code>/etc/cagefs/custom.etc/USER_NAME/php.ini</code></span>.</p><p>For example, if you want to create a custom file for USER1 and USER2 you would create files:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/etc/cagefs/custom.etc/USER1/php.ini
/etc/cagefs/custom.etc/USER2/php.ini
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Create such files for each user that should have a custom file.</p></li><li><p>Execute the following command:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ cagefsctl --force-update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div></li><li><p>Configure <code>php.ini</code> load path for user’s domains.</p></li></ol><ul><li><p>When using <strong>suphp</strong> handler, you should use <code>SuPHP_ConfigPath</code> directive in virtual host configuration for these domains, or use this directive in <code>.htaccess</code> files: <code>suPHP_ConfigPath/etc</code>.</p></li><li><p>When using <strong>mod_lsapi</strong>, you should use <code>lsapi_phprc</code> directive in virtual host configuration: <code>lsapi_phprc/etc/</code>. You can find the detailed description of <code>mod_lsapi</code> directives <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#configuration-references" class="router-link-active router-link-exact-active">here</a>.</p></li><li><p>When using <strong>FCGI</strong> or <strong>CGI</strong>, you should implement custom PHP wrapper and redefine the path to <code>php.ini</code> via <code>-c</code> command line option, like below:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#!/bin/bash
[ -f /etc/php.ini ] &amp;&amp; exec /usr/bin/php -c /etc/php.ini
exec /usr/bin/php
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div></li></ul><p><strong>Notes:</strong></p><ol><li><p>You should restart Apache web server after modifying virtual host configuration for the domains.</p></li><li><p>Custom <code>php.ini</code> may break switching PHP version via <span class="notranslate">CloudLinux OS PHP Selector</span> or <span class="notranslate">cPanel MultiPHP Manager</span> for the appropriate users or domains.</p></li><li><p>When using cPanel ea-php for the domains, additional <code>php.ini</code> files may not be loaded, so you should load all needed PHP extensions in custom <code>/etc/php.ini</code> file: <img src="/images/cloudlinuxos/cloudlinux_os_components/custom_file_cPanel1.webp" alt=""></p></li><li><p>When using CloudLinux OS alt-php, additional <code>php.ini</code> files will be loaded: <img src="/images/cloudlinuxos/cloudlinux_os_components/custom_file_cPanel2.webp" alt=""></p></li><li><p>If you have modified anything in <code>/etc/cagefs/custom.etc</code> directory, you should execute one of the following:</p><ul><li>to apply changes to CageFS for all users, run:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --update-etc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li>to apply changes to CageFS for specific users, run:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --update-etc user1 user2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div></li></ol><h4 id="managing-interpreter-version" tabindex="-1"><a class="header-anchor" href="#managing-interpreter-version" aria-hidden="true">#</a> Managing interpreter version</h4><p>Managing interpreter versions is done by means of manipulating a set of symbolic links that point to different versions of interpreter binaries. For example, if default PHP binary is <span class="notranslate"><code>/usr/local/bin/php</code></span> :</p><ul><li>First we move the default binary inside CageFS to <span class="notranslate"><code>/usr/share/cagefs-skeleton/usr/selector</code></span> , and make <span class="notranslate"> /usr/local/bin/php </span> a symlink pointing to <span class="notranslate"> /etc/cl.selector/php </span> . This operation is done as part of CageFS deployment.</li><li>Next suppose we have additional PHP version, say 7.2.5. The information about all additional interpreter binaries and paths for them is kept in <span class="notranslate"> /etc/cl.selector/selector.conf </span> . This config file is updated by RPM package manager each time alternative PHP package is added, removed or updated</li><li><span class="notranslate"><code>/usr/bin/selectorctl --list --interpreter=php</code></span> will get us list of all available PHP interpreter versions out of <span class="notranslate"> /etc/cl.selector/selector.conf file </span> . Next we want to know which PHP version is active for a given user (to supply a selected option in options list). We type:</li><li><span class="notranslate"><code>/usr/bin/selectorctl --user USERNAME --interpreter=php --user-current</code></span> will retrieve PHP version set for a particular user. The script gets the path from <span class="notranslate"><code>/var/cagefs/LAST_TWO_DIGITS_OF_UID/USERNAME/etc/cl.selector/php</code></span> symlink, compares it with contents of <span class="notranslate"> /etc/cl.selector/selector.conf </span> file and if path is valid, prints out the current interpreter version.</li><li><span class="notranslate"><code>/usr/bin/selectorctl --user USERNAME --interpreter=php --set-user-current=7.2</code></span> sets the current PHP version for particular user by creating symlink in <span class="notranslate"><code>/var/cagefs/LAST_TWO_DIGITS_OF_UID/USERNAME/etc/cl.selector</code></span> directory. All old symlinks are removed, and new symlinks are set.</li></ul><h4 id="including-php-selector-only-with-some-packages-cpanel" tabindex="-1"><a class="header-anchor" href="#including-php-selector-only-with-some-packages-cpanel" aria-hidden="true">#</a> Including PHP Selector only with some packages (cPanel)</h4><p><span class="notranslate"> cPanel </span> has a &#39; <span class="notranslate"> Feature Manager </span> &#39; in WHM that allows you to disable <span class="notranslate"> PHP Selector </span> for some of the packages that you offer.</p><p>In reality it only disables the icon in <span class="notranslate"> cPanel </span> interface. Yet, in most cases it should be enough in shared hosting settings.</p><p>You can find more info on &#39; <span class="notranslate"> Feature Manager </span> &#39; here: <a href="http://docs.cpanel.net/twiki/bin/view/11_30/WHMDocs/FeatureManager" target="_blank" rel="noopener noreferrer">http://docs.cpanel.net/twiki/bin/view/11_30/WHMDocs/FeatureManager</a></p><p>Once <span class="notranslate"> PHP Selector </span> is enabled, you can find it in the <span class="notranslate"> Feature Manager </span> . Disabling it in <span class="notranslate"> Feature Manager </span> , will remove the icon for users that are using that particular <span class="notranslate"> &#39;Feature List&#39; </span></p><img src="/images/cloudlinuxos/cloudlinux_os_components/screen1-phpselector-featuremanager.webp" width="478" height="575"><h4 id="php-extensions" tabindex="-1"><a class="header-anchor" href="#php-extensions" aria-hidden="true">#</a> PHP extensions</h4><p><strong>Configuring Alt-PHP modules loading</strong></p><p><span class="notranslate"> CloudLinux OS PHP Selector </span> and Alt-PHP can be used in conjunction with <span class="notranslate"> Plesk PHP Selector </span> and <span class="notranslate"> cPanel MultiPHP </span> . To be compatible, <span class="notranslate"> CloudLinux OS PHP Selector </span> works as follows: modules that are selected in <span class="notranslate"> CloudLinux OS PHP Selector </span> are loaded for Alt-PHP version selected in <span class="notranslate"> CloudLinux OS PHP Selector </span> only. For the rest Alt-PHP versions default module set is loaded <span class="notranslate"> ( <em>/opt/alt/phpXX/etc/php.d/default.ini</em> ) </span> . Described above is default behavior.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>If system default PHP version selected in <span class="notranslate"> cPanel MultiPHP Manager is not ea-php, then default module set is loaded for all Alt-PHP versions by default (/opt/alt/phpXX/etc/php.d/default.ini). </span></p><p>When <span class="notranslate"> &quot;php.d.location = selector&quot; option is in effect, modules selected via PHP Selector </span> will be loaded for all alt-php versions.</p></div><p>This behavior is implemented in CageFS-6.1-10 and later.</p><p>In <span class="notranslate"> LVE Manager </span> 1.0-9.40+ this behavior can be modified so that modules selected in <span class="notranslate"> CloudLinux OS PHP Selector </span> would be loaded for all Alt-PHP versions (with CageFS enabled), which can be quite useful if you use  ‘ <span class="notranslate"> per directory </span> ’ or ‘ <span class="notranslate"> per domain </span> ’ Alt-PHP configuration and want to select modules using <span class="notranslate"> CloudLinux OS PHP Selector </span> .</p><p>To modify it, create a file <span class="notranslate"><em>/etc/cl.selector/symlinks.rules</em></span> (read-only for regular users) with the following content: <span class="notranslate"><em>php.d.location = selector</em></span></p><p>And run the command to apply changes:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --apply-symlinks-rules
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> To revert to the default behavior: <ul><li>Delete <span class="notranslate"><em>/etc/cl.selector/symlinks.rules</em></span> file.</li><li>Alternatively remove <span class="notranslate"><em>php.d.location</em></span> option from the file.</li><li>Alternatively set <span class="notranslate"><em>default</em></span> value for <span class="notranslate"><em>php.d.location</em></span> option.</li></ul><p>And run the command to apply changes:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --apply-symlinks-rules
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="ffmpeg" tabindex="-1"><a class="header-anchor" href="#ffmpeg" aria-hidden="true">#</a> FFmpeg</h4><div class="tip custom-block"><p class="custom-block-title">Note</p><p>The PHP-FFmpeg project has not been renewed for the last few years and is not compatible with the RHEL 8 based systems. Since code for alt-PHP-FFmpeg is outdated and FFmpeg has a lot of third-party dependencies, this module is not available for CloudLinux OS 8.</p></div><p>Due to possible patent issues CloudLinux OS does not provide <span class="notranslate"> FFmpeg </span> libraries ( <a href="https://ffmpeg.org/legal.html" target="_blank" rel="noopener noreferrer">https://ffmpeg.org/legal.html</a> ). We highly recommend researching if you can legally install <span class="notranslate"> FFmpeg </span> extension on your server. This might differ based on where you and your servers are located. More information can be found on the link: <a href="https://ffmpeg.org/legal.html" target="_blank" rel="noopener noreferrer">https://ffmpeg.org/legal.html</a></p><p>For your convenience we provide <span class="notranslate"> FFMPEG PHP </span> binding. For them to work, you need to install <span class="notranslate"> FFmpeg </span> package from the “<span class="notranslate">Nux Dextop</span>” repository following the <a href="http://li.nux.ro/repos.html" target="_blank" rel="noopener noreferrer">instructions</a>.</p><p>Once <span class="notranslate"> FFmpeg </span> is installed you can install PHP bindings, by running:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install alt-php*ffmpeg
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Enable <span class="notranslate"> PHP-FFmpeg </span> extension via <span class="notranslate"> PHP Selector </span> :</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>selectorctl --enable-extensions=ffmpeg --user USERNAME --version X.Y
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="native-php-configuration" tabindex="-1"><a class="header-anchor" href="#native-php-configuration" aria-hidden="true">#</a> Native PHP configuration</h4><p><span class="notranslate">PHP Selector</span> requires access to the <span class="notranslate">native PHP</span> version for proper work. It is specified in the file <span class="notranslate"><code>/etc/cl.selector/native.conf</code></span> of the following content (example):</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>php=/usr/bin/php-cgi
php-cli=/usr/bin/php
php.ini=/etc/php.ini
lsphp=/usr/local/bin/lsphp
php-fpm=/usr/local/sbin/php-fpm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Then execute the following command to apply changes.</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --setup-cl-selector
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>The file is created when installing CageFS on the servers with <span class="notranslate"> cPanel, Plesk, DA, Interworx and ISP Manager </span> , if it is missing. On all other servers the file is not being created at all.</p><p>That is why, if the file is not created automatically, then it must be created manually and correct paths must be written to its directives.</p><p>Access permission 644 must be set:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>chmod 0644 /etc/cl.selector/native.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="how-to-configure-alt-php72-zts-to-use-with-php-selector" tabindex="-1"><a class="header-anchor" href="#how-to-configure-alt-php72-zts-to-use-with-php-selector" aria-hidden="true">#</a> How to configure alt-php72-zts to use with PHP Selector</h4><p><strong>Requirements</strong></p><p>To use <code>alt-php72-zts</code> with PHP Selector you need the following:</p><ul><li><code>cagefs-6.1.8-1</code> or later</li><li><code>alt-php72-zts-7.2.21-4</code> or later</li></ul><p><strong>Using zts PHP</strong></p><ol><li>Install <code>alt-php72-zts</code> with the following command:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install alt-php72-zts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ol start="2"><li>Make sure that <span class="notranslate"><code>/etc/cl.selector/selector.conf</code></span> file contains correct paths to the PHP <code>zts</code> binaries.</li></ol><p>You should remove the old lines:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>php 7.2 7.2.20 /opt/alt/php72/usr/bin/php-cgi
php-cli 7.2 7.2.20 /opt/alt/php72/usr/bin/php
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>And replace them with the lines with the new paths:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>php 7.2 7.2.20 /opt/alt/php72/usr/bin/zts-php-cgi
php-cli 7.2 7.2.20 /opt/alt/php72/usr/bin/zts-php
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><ol start="3"><li>Make sure that <span class="notranslate"><code>/opt/alt/php72/etc/php.d.all</code></span> path refers to the directory containing <code>ini</code> files for <code>zts</code> PHP extensions:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cd /opt/alt/php72/etc
ln -fsn php.d.all.zts php.d.all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><ol start="4"><li>Execute the following command:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --setup-cl-selector
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>Using non-zts PHP</strong></p><ol><li>Make sure that <span class="notranslate"><code>/etc/cl.selector/selector.conf</code></span> file contains correct paths to the <code>non-zts</code> PHP binaries.</li></ol><p>You should remove the old lines:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>php 7.2 7.2.20 /opt/alt/php72/usr/bin/zts-php-cgi
php-cli 7.2 7.2.20 /opt/alt/php72/usr/bin/zts-php
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>And replace them with the lines with the new paths:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>php 7.2 7.2.20 /opt/alt/php72/usr/bin/php-cgi
php-cli 7.2 7.2.20 /opt/alt/php72/usr/bin/php
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><ol start="2"><li>Make sure that <span class="notranslate"><code>/opt/alt/php72/etc/php.d.all</code></span> path refers to the directory containing <code>ini</code> files for <code>non-zts</code> PHP extensions:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cd /opt/alt/php72/etc
ln -fsn php.d.all.def php.d.all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><ol start="3"><li>Execute the following command:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --setup-cl-selector
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="using" tabindex="-1"><a class="header-anchor" href="#using" aria-hidden="true">#</a> Using</h4><p>Once <span class="notranslate">PHP Selector</span> is installed, you will see the <span class="notranslate"><a href="/cloudlinuxos/lve_manager/#selector-tab" class=""><strong>Selector</strong></a></span> tab in the <span class="notranslate"><strong>LVE Manager</strong></span>.</p><p>Customers can use <a href="/cloudlinuxos/lve_manager/#php-selector-client-plugin" class="">PHP Selector client plugin</a> to change their PHP Selctor related settings.</p><h4 id="custom-php-ini-options" tabindex="-1"><a class="header-anchor" href="#custom-php-ini-options" aria-hidden="true">#</a> Custom PHP.ini options</h4><p><span class="notranslate">PHP Selector</span> allows customer to edit php.ini settings. Admin has a full control over which settings can be modified.</p><p>To allow settings to be modifiable, it has to be whitelisted in <span class="notranslate"><code>/etc/cl.selector/php.conf</code></span>.</p><p>Here are some of the examples of allowed directives:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Directive = safe_mode
Type      = bool
Remark    = &lt;5.4.0
Comment   = Enables PHP safe mode. This mode puts a number of restrictions on scripts (say, access to file system) mainly for security reasons.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Directive = safe_mode_include_dir
Type      = value
Remark    = &lt;5.4.0
Comment   = If PHP is in the safe mode and a script tries to access some files, files from this directory will bypass security (UID/GID) checks. The directory must also be in include_path. For example: /dir/inc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>Directive</td><td>php.ini setting</td></tr><tr><td>Type</td><td>bool, value (any text), list</td></tr><tr><td>Range</td><td>list of values for list Type</td></tr><tr><td>Comment</td><td>explanation of the setting to display in UI</td></tr></tbody></table><p>Default values, that are shown in <span class="notranslate"> PHP Selector </span> web interface, are taken from <span class="notranslate"> &#39;/opt/alt/phpXX/usr/bin/php -i&#39; </span> runtime values, if directive is not there, it will use the output of phpinfo() function. So, if you wish to change default value of any option for &quot;alternative&quot; php version, please modify <span class="notranslate"> /opt/alt/phpXX/etc/php.ini </span> files (where XX = 55, 54, 53, etc according to php version).</p><p>Admin can modify the settings using <span class="notranslate"><a href="/cloudlinuxos/command-line_tools/#selectorctl" class="">selectorctl</a></span> command.</p><p>Users can use web interface to modify php.ini settings:</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/php_selector_options.webp" alt=""></p><h4 id="end-user-files-and-directories" tabindex="-1"><a class="header-anchor" href="#end-user-files-and-directories" aria-hidden="true">#</a> End user files and directories</h4><p>The following files and directories are created inside CageFS for each customer:</p><p><span class="notranslate"> /etc/cl.selector </span> - PHP binaries symbolic links.</p><p><span class="notranslate"> /usr/selector/php - Native PHP </span> binaries.</p><p><span class="notranslate"> /etc/cl.php.d/alt-php* </span> - Links to enabled modules.</p><p><span class="notranslate"> /home/user/.cl.selector/alt_phpXX.cfg </span> - Config file for custom PHP options.</p><p>like:</p><p><span class="notranslate"> /etc/cl.php.d/alt-php54/fileinfo.ini - /opt/alt/php54/etc/php.d.all/fileinfo.ini </span></p><h4 id="compiling-your-own-extensions" tabindex="-1"><a class="header-anchor" href="#compiling-your-own-extensions" aria-hidden="true">#</a> Compiling your own extensions</h4><p>Sometimes you might want to compile your own PHP extension for your users to use. In most cases, it is better to contact our support by sending us a support <a href="https://cloudlinux.zendesk.com/hc/requests/new" target="_blank" rel="noopener noreferrer">ticket</a> . We will try to provide such extension for you via regular updates within 5-7 days.</p><p>If you have decided that you want to build it on your own, you would need to build it for each and every supported version of PHP that you have installed. The module installation process is a bit different from standard - you would need to use the version of phpize and php-config binaries that come with particular <span class="notranslate"> Alt-PHP </span> version.</p><p>The full process for PHP 5.X and 7.X looks as follows:</p><ol><li><p>Download and unpack extension, cd into it&#39;s directory.</p></li><li><p>Execute our version of phpize if necessary:</p></li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/opt/alt/phpXX/usr/bin/phpize
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ol start="3"><li>Execute configure with our binary:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>./configure --with-php-config=/opt/alt/phpXX/usr/bin/php-config
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ol start="4"><li>Make the <span class="notranslate"> .so </span> file:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>make
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ol start="5"><li>Copy it to the modules directory (on 32-bit server, use <span class="notranslate"> usr/lib/php/modules </span> ).</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cp -rp modules/*.so /opt/alt/phpXX/usr/lib64/php/modules/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ol start="6"><li><p>Add ini file for module to <span class="notranslate"><code>/opt/alt/phpXX/etc/php.d.all</code> . </span></p></li><li><p>Register new <span class="notranslate"> Alt-PHP </span> version with:</p></li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --setup-cl-selector
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="roll-your-own-php" tabindex="-1"><a class="header-anchor" href="#roll-your-own-php" aria-hidden="true">#</a> Roll your own PHP</h4><p>To add your own PHP version in <span class="notranslate"> PHP Selector </span> :</p><ul><li>Create directory in (like: /opt/alt/php51), and mimic directory structure inside to be similar to the one of PHP versions bundled by <span class="notranslate"> CloudLinux OS </span>.</li><li>Put all the ini files for all the modules into <span class="notranslate"> /opt/alt/php51/etc/php.d.all </span></li><li>Create a symbolic link <span class="notranslate"> /opt/alt/php51/etc/php.d -&gt; /etc/cl.php.d/alt-php51 </span></li></ul><p>Place all such files into <span class="notranslate"> /opt/alt/php51/usr/lib/php/modules </span></p><p>Add an absolute path to PHP binaries into <span class="notranslate"> /etc/cl.selector/selector.conf </span> using the following format:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>php     5.1 5.1.2 /opt/alt/php51/usr/bin/php-cgi
php-cli 5.1 5.1.2 /opt/alt/php51/usr/bin/php
php-fpm 5.1 5.1.2 /opt/alt/php51/usr/sbin/php-fpm
   ^     ^    ^                ^----- absolute path
   |     |    |---------------------- real version
   |     | -------------------------- version to display
   |--------------------------------- binary to &#39;substitute&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Execute:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --setup-cl-selector
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>The new PHP version must be available now for selection in <span class="notranslate">PHP Selector</span>.</p><h4 id="detect-user-s-php-version" tabindex="-1"><a class="header-anchor" href="#detect-user-s-php-version" aria-hidden="true">#</a> Detect user&#39;s PHP version</h4><div class="tip custom-block"><p class="custom-block-title">Note</p><p><span class="notranslate">LVE Manager</span> 0.5-63 or higher</p></div><p><span class="notranslate"> PHP Selector </span> provides an easy way to figure out which versions are available and selected for end user from the command line. You can get this information by running:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>selectorctl --interpreter=php --user-summary --user=USERNAME
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>The output:
5.2 e - -
5.3 e - s
5.4 e - -
5.5 e - -
native e d -
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>The first column defines the PHP version. <span class="notranslate"><em>Native</em></span> means native PHP version, like the one installed by cPanel with EasyApache.</p><p>The second column will contain either <span class="notranslate"><strong>e</strong></span> or <strong>-.</strong> If <span class="notranslate"><strong>e</strong></span> is present, it means that given version is enabled, and can be selected by the end user.</p><p>The third column can have values <span class="notranslate"><strong>d</strong></span> or <strong>-.</strong> If <span class="notranslate"><strong>d</strong></span> is present, that version is considered a &#39;default&#39; version. Only one PHP version will have <strong>d</strong> indicator.</p><p>The fourth column can have values <span class="notranslate"><strong>s</strong></span> or <strong>-.</strong> If <span class="notranslate"><strong>s</strong> is present, that is the selected version, currently being used by the end user. Only one PHP version will have <span class="notranslate"><strong>s</strong></span> indicator. </span></p><p>In case a user is not inside CageFS, and as such doesn&#39;t use <span class="notranslate"> PHP Selector </span> , you will see the following error message:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ERROR:User USERNAME not in CageFS
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="php-selector-without-cagefs" tabindex="-1"><a class="header-anchor" href="#php-selector-without-cagefs" aria-hidden="true">#</a> PHP Selector without CageFS</h4><p><strong>[LVE Manager 2.0-11.1 or higher]</strong></p><p><span class="notranslate"> PHP Selector </span> can now be used with CageFS turned off (in case when there is only one user account on the server).</p><p>To install run:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum groupinstall alt-php
yum install cagefs lvemanager
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>(no need to initialize or turn on CageFS)</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>selectorctl --setup-without-cagefs USER
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>( <span class="notranslate"> USER </span> - the name of a user who is using selector. If not specified, the first available cPanel account username will be used).</p><p>When executing <span class="notranslate"><code>--setup-without-cagefs</code></span>, the following actions are performed:</p><ul><li><p>Creating symlinks to the user modules and options for each <span class="notranslate"> Alt-PHP </span> version: <span class="notranslate"><em>/opt/alt/php55/link/conf/alt_php.ini -&gt; /home/USER/.cl.selector/alt_php55.ini</em></span></p></li><li><p>In user home directory creating: <span class="notranslate"><em>.cl.selector/</em></span></p></li></ul><p>“Backup” settings files (selected version, modules, options): <span class="notranslate"><em>.cl.selector/defaults.cfg</em></span><span class="notranslate"><em>.cl.selector/alt_php44.cfg</em></span></p><p>Symlinks to the selected version: <span class="notranslate"><em>.cl.selector/lsphp -&gt; /opt/alt/php44/usr/bin/lsphp</em></span><span class="notranslate"><em>.cl.selector/php.ini -&gt; /opt/alt/php44/etc/php.ini</em></span><span class="notranslate"><em>.cl.selector/php-cli -&gt; /opt/alt/php44/usr/bin/php</em></span><span class="notranslate"><em>.cl.selector/php -&gt; /opt/alt/php44/usr/bin/php-cgi</em></span></p><p>Additional symlinks for environment variable <span class="notranslate"> $PATH </span> (search path) in the file <span class="notranslate"> ~/.bashrc </span> : <span class="notranslate"><em>.cl.selector/selector.path/</em></span><span class="notranslate"><em>.cl.selector/selector.path/php-cgi -&gt; ../php</em></span><span class="notranslate"><em>.cl.selector/selector.path/php -&gt; ../php-cli</em></span></p><p>Generated ini files with selected modules and options for each version: <span class="notranslate"><em>.cl.selector/alt_php44.ini</em></span><span class="notranslate"><em>.cl.selector/alt_php51.ini</em></span><span class="notranslate"><em>.cl.selector/alt_php52.ini</em></span><span class="notranslate"><em>.cl.selector/alt_php53.ini</em></span><span class="notranslate"><em>.cl.selector/alt_php54.ini</em></span><span class="notranslate"><em>.cl.selector/alt_php55.ini</em></span><span class="notranslate"><em>.cl.selector/alt_php56.ini</em></span><span class="notranslate"><em>.cl.selector/alt_php70.ini</em></span><span class="notranslate"><em>.cl.selector/alt_php71.ini</em></span></p><p>Symlinks above are being created according to the settings in <span class="notranslate"> ~/.cl.selector/defaults.cfg </span> and <span class="notranslate"> ~/.cl.selector/alt_php44.cfg </span> files (44 - corresponding PHP version), which are storing <span class="notranslate"> PHP Selector </span> settings for the user. These files are usually taken from user home directory backup or when migrating account from another server. Thus, when migrating account from server to server, <span class="notranslate"> PHP Selector </span> settings are saved.</p><p>If no <span class="notranslate"> PHP Selector </span> settings backup files are found when running <span class="notranslate"><code>selectorctl --setup-without-cagefs</code></span>, then default settings from <span class="notranslate"><code>/etc/cl.selector/defaults.cfg</code></span> global file are applied (as in selector normal mode). If the file is absent, then native PHP version will be selected for the user.</p><ul><li>The following line: <span class="notranslate"><em>PATH=$HOME/.cl.selector/selector.path:$HOME/.cl.selector:$PATH</em></span></li></ul><p>is being added to the user file <span class="notranslate"><code>~/.bashrc</code></span></p><p><span class="notranslate"> Apache </span> PHP handlers settings are not changed.</p><ul><li><p>Also <span class="notranslate"><code>selectorctl --setup-without-cagefs</code></span> command does the following:</p><ul><li>Turns off link traversal protection (linksafe);</li><li>Turns off cagefs service.</li></ul></li></ul><p>To get back to the selector normal mode (“with CageFS”) run:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>selectorctl --revert-to-cagefs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>(CageFS should be initialized by using <span class="notranslate"><code>cagefsctl --init</code></span> command before running the command above)</p><p>This command removes symlinks: <span class="notranslate"><code>/opt/alt/php55/link/conf/alt_php.ini</code> -&gt; <code>/home/USER/.cl.selector/alt_php55.ini</code></span> turns on link traversal protection (linksafe) and cagefs service.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>See also PHP Selector <a href="/cloudlinuxos/command-line_tools/#php-selector" class="">CLI</a></p></div><h4 id="configuring-global-php-ini-options-for-all-alt-php-versions" tabindex="-1"><a class="header-anchor" href="#configuring-global-php-ini-options-for-all-alt-php-versions" aria-hidden="true">#</a> Configuring &quot;global” php.ini options for all Alt-PHP versions</h4><div class="tip custom-block"><p class="custom-block-title">Note</p><p>CageFS 6.0-33 or higher, <span class="notranslate">LVE Manager</span> 2.0-11.2 or higher</p></div><p>There is <span class="notranslate"><code>/etc/cl.selector/global_php.ini</code></span> file, where you can specify values of PHP options that should be applied for all <span class="notranslate"> Alt-PHP </span> versions that are installed on a server. These settings will also be automatically applied to the new <span class="notranslate"> Alt-PHP </span> versions that will be installed later.</p><p>Example: <span class="notranslate"><em># cat /etc/cl.selector/global_php.ini</em></span><span class="notranslate"><em>[Global PHP Settings]</em></span><span class="notranslate"><em>date.timezone = Europe/Warsaw</em></span><span class="notranslate"><em>error_log = error_log</em></span><span class="notranslate"><em>memory_limit = 192M</em></span> Sections are ignored. Only name of an option and a value have meaning.</p><p>When an option is absent in <span class="notranslate"><em>/etc/cl.selector/global_php.ini</em></span> file, than it is not changed (applied) to php.ini for <span class="notranslate"> Alt-PHP </span> versions.</p><p><span class="notranslate"> date.timezone </span> and <span class="notranslate"> error_log </span> options are handled differently than the others. When these options are not in <span class="notranslate"><em>/etc/cl.selector/global_php.ini</em></span> file, than values for the options will be taken from <span class="notranslate"> &quot;native&quot; </span> php.ini file. And when the option is in php.ini for some <span class="notranslate"> Alt-PHP </span> version already (and its value is not empty), than value from <span class="notranslate"><em>/etc/cl.selector/global_php.ini</em></span> will be NOT applied.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>CageFS version 6.1.5-1 or later</p></div><p>The behavior above is changed for cPanel servers with EasyApache 4. The <span class="notranslate"><code>/usr/local/lib/php.ini</code></span> file is removed for new installations of cPanel v80 and later.</p><ul><li>When <span class="notranslate"><code>/usr/local/lib/php.ini</code></span> file exists, <span class="notranslate"><code>error_log</code></span> and <span class="notranslate"><code>date.timezone</code></span> options will be taken from that <span class="notranslate"><code>php.ini</code></span> file.</li><li>When <span class="notranslate"><code>/usr/local/lib/php.ini</code></span> file does not exist, <span class="notranslate"><code>error_log</code></span> and <span class="notranslate"><code>date.timezone</code></span> options will be taken from the <span class="notranslate"><code>php.ini</code></span> file for system default PHP version selected in MultiPHP Manager.</li></ul><p>This functionality works when the system default PHP version is <span class="notranslate"><code>ea-php</code></span> only. When the system default PHP version is <span class="notranslate"><code>alt-php</code>, <code>error_log</code></span> and <span class="notranslate"><code>date.timezone</code></span> directives will be NOT taken from that <span class="notranslate"><code>php.ini</code></span> file.</p><p>To confirm changes (not affecting <span class="notranslate"> &quot;date.timezone&quot; </span> and <span class="notranslate"> &quot;error_log&quot; </span> options) please run:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/cagefsctl --setup-cl-selector
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>To confirm changes (including <span class="notranslate"><code>date.timezone</code></span> and <span class="notranslate"><code>error_log</code></span> options) please run:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --apply-global-php-ini
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> or <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/cagefsctl --apply-global-php-ini
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> (two commands above work the same way). <p>If you don&#39;t want to change <span class="notranslate"><code>error_log</code></span>, but want to change <span class="notranslate"><code>date.timezone</code></span>, you can execute:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>selectorctl --apply-global-php-ini date.timezone
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Similarly, command <span class="notranslate"><code>selectorctl --apply-global-php-ini error_log</code></span> applies <span class="notranslate"> error_log </span> and all other options specified in <span class="notranslate"><em>/etc/cl.selector/global_php.ini</em></span> file, except <span class="notranslate"> date.timezone </span> .</p><p>So, you can specify 0, 1 or 2 parameters from the list: <span class="notranslate"> error_log, date.timezone </span> .</p><p>Using <span class="notranslate"><code>--apply-global-php-ini</code></span> without arguments applies all global PHP options including two above.</p><p>Example:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>selectorctl --apply-global-php-ini error_log
selectorctl --apply-global-php-ini date.timezone
selectorctl --apply-global-php-ini date.timezone error_log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>The latter command has the same effect as <span class="notranslate"><code>/usr/bin/selectorctl --apply-global-php-ini</code></span>.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>See also PHP Selector <a href="/cloudlinuxos/command-line_tools/#php-selector" class="">CLI</a></p></div><h3 id="integration-with-control-panels-1" tabindex="-1"><a class="header-anchor" href="#integration-with-control-panels-1" aria-hidden="true">#</a> Integration with control panels</h3><ul><li><a href="https://cloudlinux.zendesk.com/hc/en-us/articles/360014084800-PHP-Selector-Integration-with-cPanel" target="_blank" rel="noopener noreferrer">PHP Selector integration with cPanel/WHM</a></li><li><a href="https://cloudlinux.zendesk.com/hc/en-us/articles/115004582105-PHP-Selector-Integration-with-Plesk-Panel" target="_blank" rel="noopener noreferrer">PHP Selector integration with Plesk</a></li><li><a href="https://cloudlinux.zendesk.com/hc/en-us/articles/360010322460-PHP-Selector-Integration-with-DirectAdmin" target="_blank" rel="noopener noreferrer">PHP Selector integration with DirectAdmin</a></li></ul><p>This is the list of commands that we use to integrate <span class="notranslate">PHP Selector</span> with control panels.</p><p><strong>PHP summary:</strong></p><p>Command:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --summary
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Result: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>4.4 e -
5.1 e -
5.2 e -
5.3 e -
5.4 e -
5.5 e -
5.6 e -
7.0 e -
7.1 e -
native e d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div> When native PHP version needs to be displayed: <p>Command:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --summary --show-native-version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Result:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>4.4 e -
5.1 e -
5.2 e -
5.3 e -
5.4 e -
5.5 e -
5.6 e -
7.0 e -
7.1 e -
native(5.6) e d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>The first column: PHP version The second column: enabled or not ( <span class="notranslate"> e </span> - enabled) The third column: if selected as default ( <span class="notranslate"> d </span> - default)</p><p><strong>Set default version:</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --set-current=_VERSION_
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>Disable version:</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --disable-alternative=_VERSION_
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>Enable version:</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --enable-alternative=_VERSION_
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>List extensions for a version:</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --list-extensions --version=5.6
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Result:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>- apc
- bcmath
- big_int
- bitset
- bloomy
~ bz2
- bz2_filter
~ calendar
- coin_acceptor
- crack
~ ctype
+ curl
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>+: enabled ~: included in php binary (cannot be disabled) or enabled in php global config file <span class="notranslate"><em>/opt/alt/phpXX/etc/php.ini</em></span> -: disabled</p><p><strong>Select default extensions (enable comma-separated list of extensions globally for a version):</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --version=5.6 --enable-extensions=pdo,json,mysql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>Deselect default extensions (disable comma-separated list of extensions globally for a version):</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --version=5.6 --disable-extensions=pdo,json,mysql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>Replace extensions with comma-separated list of extensions for a version globally:</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --version=5.6 --replace-extensions=pdo,json,mysql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>Select PHP version for a user:</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --set-user-current=_VERSION_ --user=_USER_
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>List enabled extensions for a user:</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --list-user-extensions --user=_USER_ --version=_VERSION_
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>Enable comma-separated list of extensions for a user:</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --enable-user-extensions=pdo,json,mysql --user=_USER_ --version=_VERSION_
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>Reset user’s extensions to defaults:</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --reset-user-extensions --user=_USER_ --version=_VERSION_
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>Replace user extensions with comma-separated list of extensions:</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --replace-user-extensions=EXT_LIST --user=_USER_ --version=_VERSION_
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><span class="notranslate"><em>EXT_LIST</em></span> <em>a is comma separated list of PHP extensions (for example:</em> <span class="notranslate"><em>pdo,json,mysql</em></span> )</p><p><strong>List available options for php.ini editing:</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --print-options --user=_USER_ --version=_VERSION_ [--json]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>List available options for php.ini editing (print safe strings):</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --print-options-safe --user=_USER_ --version=_VERSION_ [--json]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>Set php.ini options for end user:</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/selectorctl --user=_USER_ --version=_VERSION_ --replace-options=_OPTIONS_ --base64 [--json]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Here is an example of how you can generate <span class="notranslate"><em>OPTIONS</em> in base64 </span> format:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>OPTIONS=`echo disable_functions:exec,syslog|base64 -w 0`,`echo display_errors:off|base64 -w 0`,`echo post_max_size:128M|base64 -w 0`
echo $OPTIONS
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>See also <a href="/command-line_tools/#php-selector" class="">PHP Selector CLI tools</a>.</p><h3 id="bundled-php-extensions" tabindex="-1"><a class="header-anchor" href="#bundled-php-extensions" aria-hidden="true">#</a> Bundled PHP extensions</h3><p>You can find this information in the corresponding section of the TuxCare documentation: <a href="https://docs.tuxcare.com/els-for-runtimes/php/#php-extensions-list" target="_blank" rel="noopener noreferrer">List of extensions supported by the ALT&amp;EA team for each version of PHP</a></p><h2 id="python-selector" tabindex="-1"><a class="header-anchor" href="#python-selector" aria-hidden="true">#</a> Python Selector</h2><h3 id="general-information" tabindex="-1"><a class="header-anchor" href="#general-information" aria-hidden="true">#</a> General information</h3><p><span class="notranslate">Python Selector</span> is a CloudLinux OS component that allows each user to easily deploy and manage Python applications. Users can manage applications at the control panel interface level or from the command line (CLI).</p><h3 id="requirements" tabindex="-1"><a class="header-anchor" href="#requirements" aria-hidden="true">#</a> Requirements</h3><ul><li>cPanel or DirectAdmin control panel. Plesk isn&#39;t supported.</li><li>Apache or LiteSpeed webserver. Apache + Nginx (as a reverse proxy) combination is also supported.</li><li>Python Selector uses <span class="notranslate"><code>mod_passenger</code></span> to host Python. For more details about <span class="notranslate"><code>mod_passenger</code></span>, please read <a href="https://www.phusionpassenger.com/" target="_blank" rel="noopener noreferrer">documentation</a>. The needed version will be installed along with Python Selector.</li></ul><div class="tip custom-block"><p class="custom-block-title">Note!</p><p>OpenLiteSpeed is not compatible with Python Selector due to lack of <code>.htaccess</code> support.</p></div><h3 id="supported-versions-1" tabindex="-1"><a class="header-anchor" href="#supported-versions-1" aria-hidden="true">#</a> Supported versions</h3><table><thead><tr><th>CloudLinux 6</th><th>CloudLinux 7</th><th>CloudLinux 8</th><th>CloudLinux 9</th><th>CloudLinux 10</th></tr></thead><tbody><tr><td>alt-python 2.7</td><td>alt-python 2.7</td><td>alt-python 2.7</td><td>alt-python 2.7</td><td>alt-python 2.7</td></tr><tr><td>alt-python 3.3</td><td>alt-python 3.3</td><td>alt-python 3.3</td><td>alt-python 3.3</td><td>alt-python 3.6</td></tr><tr><td>alt-python 3.4</td><td>alt-python 3.4</td><td>alt-python 3.4</td><td>alt-python 3.4</td><td>alt-python 3.8</td></tr><tr><td>alt-python 3.5</td><td>alt-python 3.5</td><td>alt-python 3.5</td><td>alt-python 3.5</td><td>alt-python 3.9</td></tr><tr><td>alt-python 3.6</td><td>alt-python 3.6</td><td>alt-python 3.6</td><td>alt-python 3.6</td><td>alt-python 3.11</td></tr><tr><td>alt-python 3.7</td><td>alt-python 3.7</td><td>alt-python 3.7</td><td>alt-python 3.7</td><td>alt-python 3.12</td></tr><tr><td>alt-python 3.8</td><td>alt-python 3.8</td><td>alt-python 3.8</td><td>alt-python 3.8</td><td>alt-python 3.13</td></tr><tr><td>alt-python 3.9</td><td>alt-python 3.9</td><td>alt-python 3.9</td><td>alt-python 3.9</td><td></td></tr><tr><td>alt-python 3.11</td><td>alt-python 3.10</td><td>alt-python 3.10</td><td>alt-python 3.10</td><td></td></tr><tr><td></td><td>alt-python 3.11</td><td>alt-python 3.11</td><td>alt-python 3.11</td><td></td></tr><tr><td></td><td>alt-python 3.12</td><td>alt-python 3.12</td><td>alt-python 3.12</td><td></td></tr></tbody></table><h3 id="installation-1" tabindex="-1"><a class="header-anchor" href="#installation-1" aria-hidden="true">#</a> Installation</h3><p>You can install Python Selector using the <a href="/cloudlinuxos/lve_manager/#cloudlinux-os-shared-installation-wizard" class="">CloudLinux OS Installation Wizard</a>.</p><p>After installation, please make sure that you have set appropriate checkboxes in CloudLinux Manager Options tab to show Python App in the web-interface.</p><h4 id="manual-installation" tabindex="-1"><a class="header-anchor" href="#manual-installation" aria-hidden="true">#</a> Manual installation</h4><p>Here you can find the installation steps for supported control panels:</p><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#cpanel-1" class="router-link-active router-link-exact-active">cPanel</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#directadmin" class="router-link-active router-link-exact-active">DirectAdmin</a></li></ul><h4 id="cpanel-1" tabindex="-1"><a class="header-anchor" href="#cpanel-1" aria-hidden="true">#</a> cPanel</h4><p>To use Python Selector, it is required to install the following:</p><ul><li>alternative Python packages by running the following command:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum groupinstall alt-python
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li>CloudLinux Manager, LVE Utils and Phusion Passenger to create isolated Python environments by running the following command:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install lvemanager lve-utils alt-python-virtualenv
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Phusion Passenger could be installed by using <strong>either</strong> <code>ea-ruby24-mod_passenger</code> <strong>or</strong> <code>ea-ruby27-mod_passenger</code>. <code>ea-ruby27-mod_passenger</code> is <strong>not</strong> compatible with systems running CloudLinux OS 6. CloudLinux OS 7 supports <strong>both</strong> <code>ea-ruby24-mod_passenger</code> and <code>ea-ruby27-mod_passenger</code>. If your system runs CloudLinux OS 8, you can <strong>only</strong> use <code>ea-ruby27-mod_passenger</code>.</p><p>Adding Python module requires executing permissions to <span class="notranslate"><code>gcc/make</code></span> binaries. Please enable compilers in Compiler Access section of WHM, then run:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cagefsctl --force-update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li>We recommend use CageFS for better security. See <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#cagefs" class="router-link-active router-link-exact-active">CageFS documentation for details</a>.</li></ul><h4 id="directadmin" tabindex="-1"><a class="header-anchor" href="#directadmin" aria-hidden="true">#</a> DirectAdmin</h4><p>To use Python Selector, it is required to install the following:</p><ul><li>alternative Python packages by running the following command:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum groupinstall alt-python
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li>CloudLinux Manager, LVE Utils and Phusion Passenger to create isolated Python environments by running the following command:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install lve-utils lvemanager alt-python-virtualenv alt-mod-passenger
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li><p>We recommend use CageFS for better security. See <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#cagefs" class="router-link-active router-link-exact-active">CageFS documentation for details</a>.</p></li><li><p>See also <a href="/cloudlinuxos/lve_manager/#python-selector" class="">Python Selector UI</a>.</p></li><li><p>See also <a href="/cloudlinuxos/command-line_tools/#python-selector" class="">Python Selector CLI</a>.</p></li></ul><h2 id="ruby-selector" tabindex="-1"><a class="header-anchor" href="#ruby-selector" aria-hidden="true">#</a> Ruby Selector</h2><h3 id="general-information-and-requirements-5" tabindex="-1"><a class="header-anchor" href="#general-information-and-requirements-5" aria-hidden="true">#</a> General information and requirements</h3><p>We have the ability to deploy <span class="notranslate">Ruby</span> applications via an application server. <span class="notranslate">Ruby Selector</span> uses <span class="notranslate"><code>mod_passenger</code></span> to host <span class="notranslate"> Ruby</span> applications.</p><p>Ruby Selector works only on cPanel/WHM servers.</p><h3 id="supported-versions-2" tabindex="-1"><a class="header-anchor" href="#supported-versions-2" aria-hidden="true">#</a> Supported versions</h3><p><img src="/images/cloudlinuxos/cloudlinux_os_components/Ruby_supported_versions.webp" alt=""></p><h3 id="installation-and-update-4" tabindex="-1"><a class="header-anchor" href="#installation-and-update-4" aria-hidden="true">#</a> Installation and update</h3><div class="tip custom-block"><p class="custom-block-title">Note</p><p>The instructions below are suitable only for EasyApache 3 and EasyApache 4. You should follow <a href="https://www.litespeedtech.com/support/wiki/doku.php/litespeed_wiki:cloudlinux:enable_ruby_python_selector" target="_blank" rel="noopener noreferrer">this instruction</a> if you use LiteSpeed.</p></div><p>To use <span class="notranslate">Ruby Selector</span> install alternative <span class="notranslate">Ruby</span> packages:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum groupinstall alt-ruby
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>After installation, please make sure that you have unmarked appropriate checkboxes in <span class="notranslate"> VE Manager Options</span> tab to show <span class="notranslate">Ruby App</span> in web-interface. Find the instructions on the <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#hide-ruby-selector-icon" class="router-link-active router-link-exact-active">link</a>.</p></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Adding Ruby modules requires executing permissions to <span class="notranslate"><code>gcc/make</code></span> binaries. Please enable compilers in Compiler Access section of WHM, then run: <span class="notranslate"><code>cagefsctl --force-update</code></span></p></div><h3 id="configuration-and-using-1" tabindex="-1"><a class="header-anchor" href="#configuration-and-using-1" aria-hidden="true">#</a> Configuration and using</h3><ul><li><a href="/cloudlinuxos/lve_manager/#ruby-selector-client-plugin" class="">End user access</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#hide-ruby-selector-icon" class="router-link-active router-link-exact-active">Hide Ruby Selector icon</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#deploying-redmine-using-ruby-selector" class="router-link-active router-link-exact-active">Deploying Redmine using Ruby Selector</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#easyapache-4-2" class="router-link-active router-link-exact-active">EasyApache 4</a></li></ul><h4 id="end-user-access" tabindex="-1"><a class="header-anchor" href="#end-user-access" aria-hidden="true">#</a> End user access</h4><p>You can find an example of Ruby application setup <a href="https://cloudlinux.zendesk.com/hc/en-us/articles/115004495049-How-to-run-Redmine-with-Ruby-Selector" target="_blank" rel="noopener noreferrer">here</a></p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>See also Ruby Selector <a href="/cloudlinuxos/command-line_tools/#ruby-selector" class="">CLI</a> section.</p></div><h4 id="hide-ruby-selector-icon" tabindex="-1"><a class="header-anchor" href="#hide-ruby-selector-icon" aria-hidden="true">#</a> Hide Ruby Selector icon</h4><p>It is possible to hide or show <span class="notranslate">Ruby Selector</span> icon by marking or unmarking proper checkboxes in <span class="notranslate"> LVE Manager Options</span> tab.</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/CL-hide-ruby.webp" alt=""></p><p>The same result can be accomplished in CLI by running:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cloudlinux-config set --json --data &#39;{&quot;options&quot;:{&quot;uiSettings&quot;:{&quot;hideRubyApp&quot;:false}}}&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>If you are using cPanel/WHM, you can also configure hide/show <span class="notranslate">CloudLinux OS Ruby Selectors</span> in <span class="notranslate">WHM | Feature Manager</span>. For that, you’d need to first uncheck <span class="notranslate"><code>Hide Ruby App in web-interface</code></span> in the <span class="notranslate">LVE Manager</span>. This will make the menu appear for all accounts. After that, you are free to disable this app in <span class="notranslate">WHM | Feature Manager</span> for the required feature lists.</p></div><h4 id="deploying-redmine-using-ruby-selector" tabindex="-1"><a class="header-anchor" href="#deploying-redmine-using-ruby-selector" aria-hidden="true">#</a> Deploying Redmine using Ruby Selector</h4><div class="tip custom-block"><p class="custom-block-title">Note</p><p>You can find <span class="notranslate"> Redmine </span> version 2.6.0 and newer deployment guide <a href="https://cloudlinux.zendesk.com/hc/en-us/articles/115004495049-How-to-run-Redmine-with-Ruby-Selector" target="_blank" rel="noopener noreferrer">here</a></p></div><h4 id="easyapache-4" tabindex="-1"><a class="header-anchor" href="#easyapache-4" aria-hidden="true">#</a> EasyApache 4</h4><div class="tip custom-block"><p class="custom-block-title">Note</p><p><code>ea-apache24-mod-alt-passenger</code> is deprecated in favor of <code>ea-ruby24-mod_passenger</code> and <code>ea-ruby27-mod_passenger</code></p></div><p>Starting with cPanel/WHM version 66 provides <span class="notranslate"><code>ea-ruby24-mod_passenger</code></span> (more information on the <a href="https://documentation.cpanel.net/display/66Docs/Application+Manager" target="_blank" rel="noopener noreferrer">link</a>), this allows creating <span class="notranslate"> Ruby </span> applications with cPanel application manager.</p><p>CloudLinux OS features its own <span class="notranslate">Python and Ruby Selectors</span>, which allow creating applications with one of <span class="notranslate"><code>mod_passenger</code></span> Apache modules:</p><ul><li><code>ea-ruby24-mod_passenger</code></li><li><code>ea-ruby27-mod_passenger</code></li></ul><p><code>ea-ruby27-mod_passenger</code> is <strong>not</strong> compatible with systems running CloudLinux OS 6. CloudLinux OS 7 supports <strong>both</strong> <code>ea-ruby24-mod_passenger</code> and <code>ea-ruby27-mod_passenger</code>. If your system runs CloudLinux OS 8, you can <strong>only</strong> use <code>ea-ruby27-mod_passenger</code>.</p><p>The <span class="notranslate"><code>ea-ruby2X-mod_passenger</code></span> allows you to run applications via <span class="notranslate"> cPanel application manager </span> and <span class="notranslate"> Ruby Selector</span>.</p><p>To install, run:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install lvemanager alt-python-virtualenv
yum install ea-ruby24-mod_passenger
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>or:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install lvemanager alt-python-virtualenv
yum install ea-ruby27-mod_passenger
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>See also <a href="/cloudlinuxos/command-line_tools/#ruby-selector" class="">Ruby Selector CLI tools</a>.</p><h2 id="node-js-selector" tabindex="-1"><a class="header-anchor" href="#node-js-selector" aria-hidden="true">#</a> Node.js Selector</h2><h3 id="general-information-and-requirements-6" tabindex="-1"><a class="header-anchor" href="#general-information-and-requirements-6" aria-hidden="true">#</a> General information and requirements</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#requirements-3" class="router-link-active router-link-exact-active">Requirements</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#limitations" class="router-link-active router-link-exact-active">Limitation</a></li></ul><p><span class="notranslate"> Node.js Selector </span> is a CloudLinux OS component that allows each user to easily create Node.js applications, choose Node.js version and other parameters for applications based on their needs.</p><h3 id="supported-versions-3" tabindex="-1"><a class="header-anchor" href="#supported-versions-3" aria-hidden="true">#</a> Supported versions</h3><table><thead><tr><th>CloudLinux 6</th><th>CloudLinux 7</th><th>CloudLinux 8</th><th>CloudLinux 9</th><th>CloudLinux 10</th></tr></thead><tbody><tr><td>alt‑nodejs 6.x</td><td>alt‑nodejs 6.x</td><td>alt‑nodejs 6.x</td><td>alt‑nodejs 6.x</td><td>alt‑nodejs 12.x</td></tr><tr><td>alt‑nodejs 8.x</td><td>alt‑nodejs 8.x</td><td>alt‑nodejs 8.x</td><td>alt‑nodejs 8.x</td><td>alt‑nodejs 14.x</td></tr><tr><td>alt‑nodejs 9.x</td><td>alt‑nodejs 9.x</td><td>alt‑nodejs 9.x</td><td>alt‑nodejs 9.x</td><td>alt‑nodejs 16.x</td></tr><tr><td>alt‑nodejs 10.x</td><td>alt‑nodejs 10.x</td><td>alt‑nodejs 10.x</td><td>alt‑nodejs 10.x</td><td>alt‑nodejs 18.x</td></tr><tr><td>alt‑nodejs 11.x</td><td>alt‑nodejs 11.x</td><td>alt‑nodejs 11.x</td><td>alt‑nodejs 11.x</td><td>alt‑nodejs 20.x</td></tr><tr><td>alt‑nodejs 12.x</td><td>alt‑nodejs 12.x</td><td>alt‑nodejs 12.x</td><td>alt‑nodejs 12.x</td><td>alt‑nodejs 22.x</td></tr><tr><td>alt‑nodejs 14.x</td><td>alt‑nodejs 14.x</td><td>alt‑nodejs 14.x</td><td>alt‑nodejs 14.x</td><td>alt‑nodejs 24.x</td></tr><tr><td>—</td><td>alt‑nodejs 16.x</td><td>alt‑nodejs 16.x</td><td>alt‑nodejs 16.x</td><td>—</td></tr><tr><td>—</td><td>alt‑nodejs 18.x</td><td>alt‑nodejs 18.x</td><td>alt‑nodejs 18.x</td><td>—</td></tr><tr><td>—</td><td>alt‑nodejs 19.x</td><td>alt‑nodejs 19.x</td><td>alt‑nodejs 19.x</td><td>—</td></tr><tr><td>—</td><td>alt‑nodejs 20.x</td><td>alt‑nodejs 20.x</td><td>alt‑nodejs 20.x</td><td>—</td></tr><tr><td>—</td><td>—</td><td>alt‑nodejs 22.x</td><td>alt‑nodejs 22.x</td><td>—</td></tr><tr><td>—</td><td>—</td><td>alt‑nodejs 24.x</td><td>alt‑nodejs 24.x</td><td>—</td></tr></tbody></table><h4 id="requirements-1" tabindex="-1"><a class="header-anchor" href="#requirements-1" aria-hidden="true">#</a> <strong>Requirements</strong></h4><ul><li><span class="notranslate"> Node.js Selector requires LVE Manager 4.0 </span> or later.</li><li>It supports cPanel and DirectAdmin servers as well as non-panel installations (Plesk is not supported as it already has Node.js support.) For more details, please go to Plesk &amp; Node.js documentation <a href="https://www.plesk.com/blog/product-technology/node-js-plesk-onyx/" target="_blank" rel="noopener noreferrer">here</a> and <a href="https://docs.plesk.com/en-US/onyx/administrator-guide/website-management/nodejs-support.76652/" target="_blank" rel="noopener noreferrer">here</a> .</li><li>Node.js Selector uses <span class="notranslate"><code>mod_passenger</code></span> to host Node.js. For more details about <span class="notranslate"> mod_passenger </span> and Node.js, please read documentation <a href="https://www.phusionpassenger.com/library/walkthroughs/deploy/nodejs/" target="_blank" rel="noopener noreferrer">here</a> and <a href="https://www.phusionpassenger.com/library/walkthroughs/deploy/nodejs/ownserver/apache/oss/el7/deploy_app.html" target="_blank" rel="noopener noreferrer">here</a> .</li><li><span class="notranslate"> Node.js Selector </span> supports both EasyApache 3 and EasyApache 4.</li></ul><div class="tip custom-block"><p class="custom-block-title">Note!</p><p>OpenLiteSpeed is not compatible with Node.js Selector due to lack of <code>.htaccess</code> support.</p></div><h4 id="limitations" tabindex="-1"><a class="header-anchor" href="#limitations" aria-hidden="true">#</a> <strong>Limitations</strong></h4><p>Since Node.js Selector uses <span class="notranslate"><code>mod_passenger</code></span> to host Node.js, then Node.js Selector has the same limitations as Phusion Passenger. Phusion Passenger cannot load ECMAScript modules and can only load Common js modules. If you get an ERR_REQUIRE_ESM error when starting an application app.js.</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Error [ERR_REQUIRE_ESM]: Must use import to load ES Module: app.js
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>In this case you can use the following cjs wrapper app_wrapper.cjs to load esm script app.js:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cat app_wrapper.cjs
(() =&gt; import(&#39;app.js&#39;))();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="installation-and-update-5" tabindex="-1"><a class="header-anchor" href="#installation-and-update-5" aria-hidden="true">#</a> Installation and update</h3><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Node.js Selector support is added to LiteSpeed Web Server starting from the 5.3RC1 release. See details <a href="https://www.litespeedtech.com/support/wiki/doku.php/litespeed_wiki:cloudlinux:node.js_selector" target="_blank" rel="noopener noreferrer">here</a>.</p></div><p><strong>cPanel</strong></p><p>To use <span class="notranslate">Node.js Selector</span>, install <span class="notranslate">Node.js</span> packages by running the following command:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum groupinstall alt-nodejs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Also, please install <span class="notranslate"> LVE Manager, LVE Utils and Phusion Passenger </span> by running the following command: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install lvemanager lve-utils
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Phusion Passenger could be installed by using <strong>either</strong> <code>ea-ruby24-mod_passenger</code> <strong>or</strong> <code>ea-ruby27-mod_passenger</code>. <code>ea-ruby27-mod_passenger</code> is <strong>not</strong> compatible with systems running CloudLinux OS 6. CloudLinux OS 7 supports <strong>both</strong> <code>ea-ruby24-mod_passenger</code> and <code>ea-ruby27-mod_passenger</code>. If your system runs CloudLinux OS 8, you can <strong>only</strong> use <code>ea-ruby27-mod_passenger</code>.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p><code>ea-apache24-mod-alt-passenger</code> is deprecated in favor of <code>ea-ruby24-mod_passenger</code> and <code>ea-ruby27-mod_passenger</code></p></div><p>For EasyApache 3:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install lvemanager lve-utils alt-mod-passenger
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> And we recommend to install CageFS for better security (not mandatory) by running the following command: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install cagefs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>If during Node.js Selector usage on cPanel servers you get &quot;ENOMEM npm ERR! errno-12&quot; error, try to increase Memory limit in <span class="notranslate"> cPanel WHM → Server Configuration → Tweak Settings → System → Max cPanel process memory, </span> then restart cPanel service with the following command to apply changes.</p></div><p>CloudLinux OS 7:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>systemctl restart cpanel.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>CloudLinux OS 6:</p><div class="notranslate"> ``` service cpanel restart ``` </div><p><strong>DirectAdmin</strong></p><p>To use <span class="notranslate"> Node.js Selector, please install Node.js </span> packages by running the following command:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum groupinstall alt-nodejs6 alt-nodejs8 alt-nodejs9
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Also, please install <span class="notranslate"> LVE Manager, LVE Utils and Fusion Passenger </span> by running the following command: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install lvemanager lve-utils alt-mod-passenger
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> And we recommend to install CageFS for better security (not mandatory) by running the following command: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install cagefs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h3 id="node-js-deployment" tabindex="-1"><a class="header-anchor" href="#node-js-deployment" aria-hidden="true">#</a> Node.js deployment</h3><ul><li><p>The first approach - remote usage of Node.js Interpreters of different versions</p></li><li><p>The second approach - remote usage of the cloudlinux-selector utility.</p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#remote-usage-of-node-js-interpreters" class="router-link-active router-link-exact-active">Remote usage of Node.js interpreters</a></p></li><li><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#remote-usage-of-the-cloudlinux-selector-utility" class="router-link-active router-link-exact-active">Remote usage of the cloudlinux-selector utility</a></p></li></ul><h4 id="remote-usage-of-node-js-interpreters" tabindex="-1"><a class="header-anchor" href="#remote-usage-of-node-js-interpreters" aria-hidden="true">#</a> Remote usage of Node.js interpreters</h4><ol><li>Create a Node.js project in <span class="notranslate"> IntelliJ IDEA/WebStorm </span> . You can download <a href="https://docs.cloudlinux.com/nodejs_example.zip" target="_blank" rel="noopener noreferrer">this archive</a> and use it as a basis.</li><li>Install <span class="notranslate"> alt-nodejs </span> packages on the server in use. See <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#installation-and-update-7" class="router-link-active router-link-exact-active">installation instructions</a>.</li><li>Create an application on the server. You can do it by three ways:</li></ol><ul><li>Via UI of the Node.js plugin.</li><li>Using the following command to create an application:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cloudlinux-selector create --interprete=nodejs --json --app-root=&lt;USER_NAME&gt; --app-uri=&lt;APP_NAME&gt; --app-mode=develompent --version=&lt;VERSION&gt; --domain=&lt;DOMAIN&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>In the <span class="notranslate"> IntelliJ IDEA </span> you can create and run any remote script <span class="notranslate"> (Preferences — Remote SSH External Tools — Add).</span></p></div><p><img src="/images/cloudlinuxos/cloudlinux_os_components/createapp_zoom70.webp" alt=""></p><ul><li>Choose a location of the application on the server and synchronize the files with the <span class="notranslate"> IntelliJ IDEA </span> project.</li></ul><ol start="4"><li>Set up <span class="notranslate"> Run/Debug Configurations </span> in the project created.</li></ol><p><img src="/images/cloudlinuxos/cloudlinux_os_components/setconfiguration_zoom70.webp" alt=""></p><ul><li>Specify a path to the remote Node.js interpreter. To be able to specify the remote interpreter, you should install the <span class="notranslate"><em>Node.js Remote Interpreter</em></span> plugin first. Please find more information <a href="https://www.jetbrains.com/help/idea/configure-node-js-remote-interpreter.html" target="_blank" rel="noopener noreferrer">here</a> , using server access credentials for a user <span class="notranslate"><em>(Main menu → Run → Edit configurations...)</em></span> .</li><li>Specify initial <em>JavaScript file</em> that will be run with the <span class="notranslate"><em>node</em></span> command (it is the <em>app.js</em> file from the archive).</li><li>Specify <span class="notranslate"><em>Path Mappings</em></span> between a local and a remote project <span class="notranslate"><em>(Preferences → Deployments → Add)</em></span> . If you have created your application with the <span class="notranslate"><em>cloudlinux-selector utility</em></span> or via plugin UI the <span class="notranslate"><em>Path Mappings</em></span> should be as follows:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/home/&lt;USER_NAME&gt;/&lt;APP_NAME&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ol start="5"><li>Synchronize the project directories on the local and the remote machine as per <span class="notranslate"><em>Path Mappings</em></span> specified.</li><li>Deploy the modules on the remote and the local machine with the <span class="notranslate"><strong><em>npm install</em></strong></span> command (if there are dependent modules). In the UI you can click the <span class="notranslate"><em>Run NPM Install</em></span> button.</li><li>Run Node.js application with the configuration set at the 4th step <span class="notranslate"><em>(Main menu → Run → Run… → Select configuration)</em></span> .</li></ol><p><img src="/images/cloudlinuxos/cloudlinux_os_components/runapp_zoom60.webp" alt=""></p><ol start="8"><li>If you are using the application from the archive attached, you can see the running application on port 3003 — <span class="notranslate"><em>http://DOMAIN:3003</em> . </span></li></ol><div class="tip custom-block"><p class="custom-block-title">Note</p><p>The port should be available to a server user.</p></div><p><img src="/images/cloudlinuxos/cloudlinux_os_components/runningappdomain_zoom70.webp" alt=""></p><p>The following information should be displayed on this page:</p><ul><li>A version of the running Node.js interpreter;</li><li>Current environment variables;</li><li>The current time.</li></ul><p>So that, you can be sure that deployed modules are used properly.</p><p>If you’d like to use a different version of Node.js to run an application, change a path to the interpreter in the configuration settings of the running. To apply all changes to the project, synchronize all changes with the server and restart the running application.</p><ol start="9"><li>To debug a script, set breakpoints in the code and run the configuration via Main Menu <span class="notranslate"><em>(Main menu → Run → Debug… → Select configuration)</em></span> .</li></ol><p>Useful links:</p><ul><li><span class="notranslate"> IntelliJ IDEA </span> : <a href="https://www.jetbrains.com/help/idea/configure-node-js-remote-interpreter.html" target="_blank" rel="noopener noreferrer">https://www.jetbrains.com/help/idea/configure-node-js-remote-interpreter.html</a></li><li>Plugin <span class="notranslate"><em>Node.js Remote Interpreter</em></span> : <a href="https://plugins.jetbrains.com/plugin/8116-node-js-remote-interpreter" target="_blank" rel="noopener noreferrer">https://plugins.jetbrains.com/plugin/8116-node-js-remote-interpreter</a></li><li><span class="notranslate"> WebStorm </span> : <a href="https://www.jetbrains.com/help/webstorm/configure-node-js-remote-interpreter.html" target="_blank" rel="noopener noreferrer">https://www.jetbrains.com/help/webstorm/configure-node-js-remote-interpreter.html</a></li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>It is not required to install <span class="notranslate"><em>Passenger</em></span> while working in <span class="notranslate"> IDE </span> if you are using this approach.</p></div><h4 id="remote-usage-of-the-cloudlinux-selector-utility" tabindex="-1"><a class="header-anchor" href="#remote-usage-of-the-cloudlinux-selector-utility" aria-hidden="true">#</a> Remote usage of the cloudlinux-selector utility</h4><ol><li>Create an application via UI or with the command as described in the Remote Usage of Node.js Interpreters approach, step 3 (a,b).</li><li>Set up project mapping on the local machine with the created remote application <span class="notranslate"><em>/home/&lt;USER_NAME&gt;/&lt;APP_NAME&gt; (Preferences → Deployments → Add)</em></span>.</li><li>Set up the remote commands of <span class="notranslate"> cloudlinux-selector <em>(Preferences → Remote SSH External Tools → Add)</em></span> for the following actions:</li></ol><ul><li><p>Restart application;</p></li><li><p>Install packages;</p></li><li><p>Run script;</p></li><li><p>Change Node.js version for the application. You can see the running app at <span class="notranslate"> http://DOMAIN/APPLICATION_URL </span> To apply all changes, restart the application.</p></li><li><p>See also <a href="/cloudlinuxos/command-line_tools/#node-js-selector" class="">Node.js Selector CLI tools</a>.</p></li><li><p>See also <a href="/cloudlinuxos/lve_manager/#node-js-selector-2" class="">Node.js Selector UI</a>.</p></li></ul><h3 id="troubleshooting-2" tabindex="-1"><a class="header-anchor" href="#troubleshooting-2" aria-hidden="true">#</a> Troubleshooting</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#debugging-errors" class="router-link-active router-link-exact-active">Debugging errors</a></li></ul><h4 id="debugging-errors" tabindex="-1"><a class="header-anchor" href="#debugging-errors" aria-hidden="true">#</a> Debugging errors</h4><p>Since <span class="notranslate"> alt-mod-passenger-5.3.7-2,</span> directives such as PassengerFriendlyErrorPages and PassengerAppEnv are available for use from htaccess file. This allows end users to see errors from their application during the development process. For example, if you add one of the following lines to the htaccess file on the application page, you will see the information (if there was an error) similar to one on the picture.</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>PassengerAppEnv development
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> or <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>PassengerFriendlyErrorPages on
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><img src="/images/cloudlinuxos/cloudlinux_os_components/errorapplog.webp" alt=""></p><p>This is a much more convenient approach to developing an application and debugging errors. On the other hand, if these directives are turned off you will see:</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/errorapplogsorry.webp" alt=""></p><p>In this case, there is no useful information for debugging errors and this is suitable for production mode. More information about <a href="https://www.phusionpassenger.com/library/config/apache/reference/#passengerfriendlyerrorpages" target="_blank" rel="noopener noreferrer">PassengerFriendlyErrorPages</a> and <a href="https://www.phusionpassenger.com/library/config/apache/reference/#passengerappenv" target="_blank" rel="noopener noreferrer">PassengerAppEnv</a>.</p><h4 id="known-restrictions-and-issues" tabindex="-1"><a class="header-anchor" href="#known-restrictions-and-issues" aria-hidden="true">#</a> Known Restrictions and Issues</h4><ol><li><p>In some cases running commands e.g. <code>npm build</code> can produce an Out Of Memory error.</p><p>When the error is encountered in Nodejs Selector UI or in the web browser terminal, check the physical and virtual memory LVE limits. Also check the process limits through <code>ulimit -v -m</code> command in Terminal UI or &quot;Max data size&quot;, &quot;Max address space&quot; or &quot;Max resident set&quot; values inside the <code>/proc/&lt;process_id&gt;/limits</code> file. Increase the limits if necessary.</p><p>On cPanel, increase the default process memory limit:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>whmapi1 set_tweaksetting key=maxmem value=8192
/usr/local/cpanel/scripts/restartsrv_cpsrvd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Due to bug CPANEL-43590 a server reload might be required for the new maxmem value to become applied.</p><p>In some cases, due to bugs in underlying Node.js frameworks (e.g. <a href="https://github.com/nodejs/node/issues/41319#issuecomment-1001025128" target="_blank" rel="noopener noreferrer">Out of memory: wasm memory</a>) it could be necessary to increase <code>maxmem</code> up to 50 Gb (<code>value=51200</code>) or even to <code>unlimited</code>.</p></li><li><p>Sometimes an Out Of Memory error appears in the web browser terminal in cPanel. Because of CPANEL-39397 bug terminal inherences limits of <code>cpsrvd</code> process. As a workaround, you could increase <code>maxmem</code> value as described above.</p><p>Alternetive workaround: override soft and hard virtual memory limit only for the user encountering the problem. Override hard limit by adding the following line to the <code>/etc/security/limits.conf</code> file:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>username	hard	as	unlimited
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Override soft limit by adding into <code>$USER_HOME/.bashrc</code>:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ulimit -S -v unlimited
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h2 id="apache-mod-lsapi-pro" tabindex="-1"><a class="header-anchor" href="#apache-mod-lsapi-pro" aria-hidden="true">#</a> Apache mod_lsapi PRO</h2><h3 id="general-information-and-requirements-7" tabindex="-1"><a class="header-anchor" href="#general-information-and-requirements-7" aria-hidden="true">#</a> General information and requirements</h3><p>mod_lsapi PRO is an <a href="https://httpd.apache.org/" target="_blank" rel="noopener noreferrer">Apache HTTP Server</a> module based on <a href="https://www.litespeedtech.com/open-source/litespeed-sapi" target="_blank" rel="noopener noreferrer">LiteSpeed Technologies API</a> . It serves to execute PHP scripts on a web-server by analogy with other modules like mod_suphp, php-fpm, mod_php. However, mod_lsapi PRO usage offers excellent PHP performance, low memory footprint coupled with great security and support for opcode caching.</p><p><strong>How does it work?</strong></p><ol><li>Apache passes handling for PHP request to mod_lsapi PRO;</li><li>mod_lsapi PRO use liblsapi to transfer request to lsphp parent process;</li><li>lsphp is forking child process which executes the request and returns data to mod_lsapi PRO; <img src="/images/cloudlinuxos/cloudlinux_os_components/mod_lsapidiagrammnew.webp" alt=""><em>mod_lsapi PRO integrates with Apache, allows to handle concurrent requests and manages the lsphp processes</em></li></ol><ul><li>If there are no requests for lsapi_backend_pgrp_max_idle seconds, lsphp parent process will be  terminated;</li><li>If there are no lsphp child processes available when a new request comes, the new lsphp child process will be created;</li><li>lsphp child processes handle concurrent requests simultaneously.;</li><li>The maximum number of simultaneously running lsphp child processes can be set by the lsapi_backend_children directive.</li></ul><p><strong>What is lsphp?</strong></p><p>lsphp - PHP + LSAPI. What is PHP LSAPI? <a href="https://www.litespeedtech.com/open-source/litespeed-sapi/php" target="_blank" rel="noopener noreferrer">LiteSpeed Server Application Programming Interface</a> (LSAPI) is designed specifically for seamless, optimized communication between LiteSpeed Web Server and third-party web applications. Now with mod_lsapi PRO this protocol is available for Apache 2.2/2.4.</p><p>Using mod_lsapi PRO, we have seen the higher performance than Apache with mod_php, easier installation than php-fpm and easier integration with any control panel. mod_lsapi PRO means faster and more stable dynamic web pages.</p><p><strong>Requirements</strong></p><p>Currently, the mod_lsapi is not compatible with:</p><ul><li>Apache mod_ruid2 - should be disabled;</li><li>Apache mod_itk - should be disabled;</li><li>PHP-FPM - should be disabled because PHP-FPM is also a PHP Handler just as mod_lsapi.</li></ul><p><strong>Optional requirements</strong></p><ul><li>Configured LVE containers for end-users ( <strong>recommended - higher security level</strong> );</li><li>Installed and configured mod_hostinglimitsfor Apache ( <strong>recommended - higher security level</strong> );</li><li>Installed mod_suexec for Apache and configured <a href="https://httpd.apache.org/docs/2.4/mod/mod_suexec.html#page-header" target="_blank" rel="noopener noreferrer">SuExecUserGroup</a> directive for each virtual host ( <strong>recommended - higher security level</strong> );</li><li>Enabled CageFS for end-users ( <strong>recommended - higher security level</strong> );</li><li>PHP Selector with alt-php - an easy way to select different PHP versions for each end-user provided by CloudLinux OS;</li><li>ea-php - alternative to alt-php provided by cPanel (for cPanel only).</li></ul><h3 id="installation-2" tabindex="-1"><a class="header-anchor" href="#installation-2" aria-hidden="true">#</a> Installation</h3><p>mod_lsapi PRO can be installed through YUM package manager, however, the installation process varies depending on the control panel.</p><p>Select the control panel you are using:</p><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#installing-on-cpanel-servers-with-easyapache-4" class="router-link-active router-link-exact-active">cPanel</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#installing-on-plesk-servers" class="router-link-active router-link-exact-active">Plesk</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#installing-on-directadmin-servers" class="router-link-active router-link-exact-active">DirectAdmin</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#installing-on-servers-with-no-control-panel" class="router-link-active router-link-exact-active">No control panel</a></li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>See also <a href="/cloudlinuxos/command-line_tools/#apache-mod-lsapi-pro" class="">mod_lsapi PRO</a>.</p></div><h4 id="installing-on-cpanel-servers-with-easyapache-4" tabindex="-1"><a class="header-anchor" href="#installing-on-cpanel-servers-with-easyapache-4" aria-hidden="true">#</a> Installing on cPanel servers with EasyApache 4</h4><p>Install mod_lsapi PRO and related packages through YUM package manager as follows:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install liblsapi liblsapi-devel
yum install ea-apache24-mod_lsapi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div> After installing mod_lsapi PRO packages run the next command to setup mod_lsapi to cPanel: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/switch_mod_lsapi --setup
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Now, when the module is installed, restart Apache to ensure that the mod_lsapi PRO is enabled: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service httpd restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Now the lsapi handler is available for managing through cPanel MultiPHP Manager. <p>For more details about switch_mod_lsapi, please visit <a href="/cloudlinuxos/command-line_tools/#apache-mod-lsapi-pro" class="">switch_mod_lsapi tool</a>.</p><h4 id="installing-on-plesk-servers" tabindex="-1"><a class="header-anchor" href="#installing-on-plesk-servers" aria-hidden="true">#</a> Installing on Plesk servers</h4><p>Install mod_lsapi PRO and related packages through YUM package manager as follows:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install liblsapi liblsapi-devel
yum install mod_lsapi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div> Once completed, run the command to setup mod_lsapi PRO and register LSPHP handlers to Plesk Panel: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/switch_mod_lsapi --setup
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Now, when the module is installed, restart Apache to ensure that mod_lsapi PRO is enabled:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service httpd restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Now LSPHPXY alt-php PHP handlers are available for managing through Plesk PHP Settings.</p><p><img src="/images/cloudlinuxos/cloudlinux_os_components/plesk-php-settings.webp" alt=""></p><p>For more details about switch_mod_lsapi, please visit <a href="/cloudlinuxos/command-line_tools/#apache-mod-lsapi-pro" class="">switch_mod_lsapi tool</a>.</p><h4 id="installing-on-directadmin-servers" tabindex="-1"><a class="header-anchor" href="#installing-on-directadmin-servers" aria-hidden="true">#</a> Installing on DirectAdmin servers</h4><p>Installation process is done with custombuild script:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install liblsapi liblsapi-devel
cd /usr/local/directadmin/custombuild
./build update
./build set php1_mode lsphp
./build php n
./build apache
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div> Restart Apache afterwards: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service httpd restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Now all domains under php1_mode are using lsphp handler and no further actions are required to enable mod_lsapi PRO on DirectAdmin. <h4 id="installing-on-servers-with-no-control-panel" tabindex="-1"><a class="header-anchor" href="#installing-on-servers-with-no-control-panel" aria-hidden="true">#</a> Installing on servers with no control panel</h4><div class="tip custom-block"><p class="custom-block-title">Note</p><p>If there is a php.conf file in Apache&#39;s conf.d, which is usually brought by the php or php-fpm packages, then it should be deleted or renamed.</p><p>For example, <code>php.conf</code> can be renamed into <code>php.conf.NO</code>.</p></div><p>Install mod_lsapi PRO and related packages through YUM package manager as follows:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install liblsapi liblsapi-devel
yum install mod_lsapi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div> Once completed, run a command to setup mod_lsapi PRO: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/switch_mod_lsapi --setup
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Now, when the module is installed, restart Apache to ensure that mod_lsapi PRO is enabled: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service httpd restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>If you are using an alternative Apache - <a href="https://www.cloudlinux.com/cloudlinux-os-blog/entry/httpd24-updated-for-cloudlinux-6" target="_blank" rel="noopener noreferrer">httpd24</a> , then install mod_lsapi as follows:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install liblsapi liblsapi-devel
yum install httpd24-mod_lsapi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div> Once completed, run a command to setup mod_lsapi PRO: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/opt/rh/httpd24/root/usr/bin/switch_mod_lsapi --setup
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Now, when the module is installed, restart Apache to ensure that mod_lsapi PRO is enabled: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service httpd24-httpd restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>For more details about switch_mod_lsapi, please visit <a href="/cloudlinuxos/command-line_tools/#apache-mod-lsapi-pro" class="">switch_mod_lsapi tool</a>.</p><h3 id="uninstalling-3" tabindex="-1"><a class="header-anchor" href="#uninstalling-3" aria-hidden="true">#</a> Uninstalling</h3><p>Uninstall mod_lsapi PRO is performed depending on your control panel.</p><p>Select the control panel you are using:</p><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#uninstall-procedure-for-cpanel-servers-with-easyapache-4" class="router-link-active router-link-exact-active">cPanel</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#uninstall-procedure-for-plesk-servers" class="router-link-active router-link-exact-active">Plesk</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#uninstall-procedure-for-directadmin-servers" class="router-link-active router-link-exact-active">DirectAdmin</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#uninstall-procedure-for-servers-with-no-control-panel" class="router-link-active router-link-exact-active">No control panel</a></li></ul><h4 id="uninstall-procedure-for-cpanel-servers-with-easyapache-4" tabindex="-1"><a class="header-anchor" href="#uninstall-procedure-for-cpanel-servers-with-easyapache-4" aria-hidden="true">#</a> Uninstall procedure for cPanel servers with EasyApache 4</h4><div class="tip custom-block"><p class="custom-block-title">Note</p><p>If there is a php.conf file in Apache&#39;s conf.d, which is usually brought by the php or php-fpm packages, then it should be deleted or renamed.</p><p>For example, <code>php.conf</code> can be renamed into <code>php.conf.NO</code>.</p></div><p>To remove lsapi handler from cPanel MultiPHP Manager and uninstall mod_lsapi PRO, run a command:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/switch_mod_lsapi --uninstall
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Then remove packages with YUM package manager: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum erase liblsapi liblsapi-devel ea-apache24-mod_lsapi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Restart Apache afterwards: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service httpd restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Now mod_lsapi PRO is fully uninstalled. <h4 id="uninstall-procedure-for-plesk-servers" tabindex="-1"><a class="header-anchor" href="#uninstall-procedure-for-plesk-servers" aria-hidden="true">#</a> Uninstall procedure for Plesk servers</h4><p>To unregister LSPHP handlers and uninstall mod_lsapi PRO, run the command:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/switch_mod_lsapi --uninstall
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Then remove packages with YUM package manager: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum erase liblsapi liblsapi-devel mod_lsapi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Restart Apache afterwards: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service httpd restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Now LSPHPXY alt-php PHP handlers and mod_lsapi PRO are fully uninstalled. <h4 id="uninstall-procedure-for-directadmin-servers" tabindex="-1"><a class="header-anchor" href="#uninstall-procedure-for-directadmin-servers" aria-hidden="true">#</a> Uninstall procedure for DirectAdmin servers</h4><p>Uninstall is done with custombuild script:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cd /usr/local/directadmin/custombuild
./build update
./build set php1_release [any other php mode]
./build php n
./build apache
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div> The following PHP modes are available for DirectAdmin: <ul><li>mod_php</li><li>fastcgi</li><li>php-fpm</li><li>suphp</li></ul><p>Restart Apache afterwards:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service httpd restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Now all domains under php1_mode are using the chosen handler and mod_lsapi PRO is fully uninstalled. <h4 id="uninstall-procedure-for-servers-with-no-control-panel" tabindex="-1"><a class="header-anchor" href="#uninstall-procedure-for-servers-with-no-control-panel" aria-hidden="true">#</a> Uninstall procedure for servers with no control panel</h4><p>To uninstall mod_lsapi PRO, run the command:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/switch_mod_lsapi --uninstall
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Then remove packages with YUM package manager: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum erase liblsapi liblsapi-devel mod_lsapi
rm [path to mod_lsapi.conf]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div> Restart Apache to restore the standard PHP handler: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service httpd restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>If you are using an alternative Apache: - <a href="https://www.cloudlinux.com/cloudlinux-os-blog/entry/httpd24-updated-for-cloudlinux-6" target="_blank" rel="noopener noreferrer">httpd24</a>, then uninstall mod_lsapi PRO as follows:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/bin/switch_mod_lsapi --uninstall
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Then remove packages with YUM package manager: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum erase liblsapi liblsapi-devel httpd24-mod_lsapi
rm [path to mod_lsapi.conf]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div> Restart Apache afterwards: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service httpd24 restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Now mod_lsapi PRO is fully uninstalled. <h3 id="configuration-3" tabindex="-1"><a class="header-anchor" href="#configuration-3" aria-hidden="true">#</a> Configuration</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#configuration-references" class="router-link-active router-link-exact-active">Configuration references</a></li></ul><p>In order to get mod_lsapi PRO work properly, you&#39;ll need to configure Apache. To do this, we use a separate <em>lsapi.conf</em> file.</p><p>First of all, for the mod_lsapi PRO work, you need to ensure that the module is loaded. In your lsapi.conf you need to make sure the <a href="http://httpd.apache.org/docs/current/mod/mod_so.html#loadmodule" target="_blank" rel="noopener noreferrer">LoadModule</a> directive has not been commented out. A correctly configured directive may look like this:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>LoadModule lsapi_module modules/mod_lsapi.so
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>In order to enable the module to process requests, you need to add the lsapi_engine directive to your <em>lsapi.conf</em> file as follows:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>lsapi_engine On
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>The mod_lsapi PRO handler can be enabled using the <a href="https://httpd.apache.org/docs/2.4/mod/mod_mime.html#addtype" target="_blank" rel="noopener noreferrer">AddType</a> directive. The AddType directive tells Apache that a given filename extension should be handled by mod_lsapi PRO. Apache will assume that and will attempt to execute it when that particular resource is requested by a client.</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>AddType application/x-httpd-lsphp .php
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>If no handler is explicitly set for a request, the specified content type will be used as the handler name, therefore, please disable php.conf or any other PHP handler for using mod_lsapi PRO. In this example application/x-httpd-lsphp is a default handler by which mod_lsapi PRO process requests with lsphp binary from <em>/usr/local/bin/</em> directory.</p><p>The final lsapi.conf configuration might look like this:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>LoadModule lsapi_module modules/mod_lsapi.so


&lt;IfModule lsapi_module&gt;
	lsapi_engine On
	AddType application/x-httpd-lsphp .php
	lsapi_backend_connect_timeout 100000
	lsapi_backend_connect_tries 10
	lsapi_backend_children 20
	lsapi_backend_pgrp_max_idle 30
	lsapi_backend_max_process_time 300
	lsapi_debug Off
&lt;/IfModule&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>In order to mod_lsapi PRO work lsapi.conf should be loaded to Apache through <a href="https://httpd.apache.org/docs/2.4/mod/core.html#include" target="_blank" rel="noopener noreferrer">Include</a> directive.</p><p>For more detailed description of the module directives please visit <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#configuration-references" class="router-link-active router-link-exact-active">Configuration reference</a>. For installation guide mod_lsapi PRO please visit <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#installation-2" class="router-link-active router-link-exact-active">Installation</a>.</p><h4 id="using-alternative-lve-id-for-virtual-hosts" tabindex="-1"><a class="header-anchor" href="#using-alternative-lve-id-for-virtual-hosts" aria-hidden="true">#</a> Using alternative LVE id for Virtual Hosts</h4><p>Starting from 1.1-79 version mod_lsapi supports possibility to use alternative LVE id for different Virtual Hosts. While the main LVE for user account is created automatically on account creation, alternative LVEs must be created manually using lvectl CLI utility. For example, if we already created user1 user account, LVE with the same LVE id as account uid is already created:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[root@ ~]# id user1
uid=1001(user1) gid=1004(user1) groups=1004(user1)
[root ~]# lvectl list
      ID   SPEED    PMEM    VMEM      EP   NPROC      IO    IOPS
 default     100   1024M      0K      20     100    1024    1024
    1001      50   1024M      0K      40      90    1024    1024
   limit       0      0K      0K       0       0       0       0

[root@ ~]#
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Let&#39;s use 11001 LVE id for alternative LVE for this account, create this LVE and set LVE limits for it:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[root ~]# lvectl set 11001 --speed=50% --pmem=512M --io=2048 --ep=10 --nproc=50
[root ~]# lvectl limits 11001
      ID   SPEED    PMEM    VMEM      EP   NPROC      IO    IOPS
   11001      50    512M      0K      10      50    2048    1024

[root ~]#
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now we can use different LVEs for different Virtual Hosts bound to the same user account user1 by setting different <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lveid" class="router-link-active router-link-exact-active">LVEid</a> values:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;VirtualHost 10.193.208.48:80&gt;
    ServerName user1.example.com
    DocumentRoot /home/user1/public_html
        &lt;IfModule hostinglimits_module&gt;
            &lt;Directory &quot;/home/user1/public_html&quot;&gt;
                LVEId 11001
            &lt;/Directory&gt;
        &lt;/IfModule&gt;
        &lt;IfModule lsapi_module&gt;
            lsapi_user_group user1 user1
            lsapi_per_user Off
        &lt;/IfModule&gt;
 &lt;/VirtualHost&gt;

 &lt;VirtualHost 10.193.208.48:80&gt;
    ServerName sub.user1.example.com
    DocumentRoot /home/user1/sub.user1.example.com
        &lt;IfModule hostinglimits_module&gt;
            &lt;Directory &quot;/home/user1/sub.user1.example.com&quot;&gt;
                LVEId 1001
            &lt;/Directory&gt;
        &lt;/IfModule&gt;
        &lt;IfModule lsapi_module&gt;
            lsapi_user_group user1 user1
            lsapi_per_user Off
        &lt;/IfModule&gt;
 &lt;/VirtualHost&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Please note that in the example above 2 different Virtual Hosts use different LVEs but the same account user1. Also <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-per-user" class="router-link-active router-link-exact-active">lsapi_per_user</a> config directive must be set to Off in order to allow using of dedicated lsphp backend for every Virtual Host.</p><h4 id="configuration-references" tabindex="-1"><a class="header-anchor" href="#configuration-references" aria-hidden="true">#</a> Configuration references</h4><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#mod-lsapi-customization" class="router-link-active router-link-exact-active">mod_lsapi customization</a>:</p><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-engine" class="router-link-active router-link-exact-active">lsapi_engine</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-socket-path" class="router-link-active router-link-exact-active">lsapi_socket_path</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-poll-timeout" class="router-link-active router-link-exact-active">lsapi_poll_timeout</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-per-user" class="router-link-active router-link-exact-active">lsapi_per_user</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-output-buffering" class="router-link-active router-link-exact-active">lsapi_output_buffering</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-disable-reject-mode" class="router-link-active router-link-exact-active">lsapi_disable_reject_mode</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-terminate-backends-on-exit" class="router-link-active router-link-exact-active">lsapi_terminate_backends_on_exit</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-avoid-zombies" class="router-link-active router-link-exact-active">lsapi_avoid_zombies</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-use-req-hostname" class="router-link-active router-link-exact-active">lsapi_use_req_hostname</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-debug" class="router-link-active router-link-exact-active">lsapi_debug</a></li></ul><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#tuning-lsphp-backend" class="router-link-active router-link-exact-active">Tuning LSPHP backend</a>:</p><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-set-env" class="router-link-active router-link-exact-active">lsapi_set_env</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-set-env-path" class="router-link-active router-link-exact-active">lsapi_set_env_path</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-children" class="router-link-active router-link-exact-active">lsapi_backend_children</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-connect-tries" class="router-link-active router-link-exact-active">lsapi_backend_connect_tries</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-connect-timeout" class="router-link-active router-link-exact-active">lsapi_backend_connect_timeout</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-max-process-time" class="router-link-active router-link-exact-active">lsapi_backend_max_process_time</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-pgrp-max-idle" class="router-link-active router-link-exact-active">lsapi_backend_pgrp_max_idle</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-use-own-log" class="router-link-active router-link-exact-active">lsapi_backend_use_own_log</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-common-own-log" class="router-link-active router-link-exact-active">lsapi_backend_common_own_log</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-coredump" class="router-link-active router-link-exact-active">lsapi_backend_coredump</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-accept-notify" class="router-link-active router-link-exact-active">lsapi_backend_accept_notify</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-pgrp-max-reqs" class="router-link-active router-link-exact-active">lsapi_backend_pgrp_max_reqs</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-pgrp-max-crashes" class="router-link-active router-link-exact-active">lsapi_backend_pgrp_max_crashes</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-loglevel-info" class="router-link-active router-link-exact-active">lsapi_backend_loglevel_info</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-oom-score-adj" class="router-link-active router-link-exact-active">lsapi_backend_oom_score_adj</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-server-tweak" class="router-link-active router-link-exact-active">lsapi-server-tweak</a> Beta</li></ul><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#connection-pool-mode" class="router-link-active router-link-exact-active">Connection pool mode</a>:</p><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-with-connection-pool" class="router-link-active router-link-exact-active">lsapi_with_connection_pool</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-max-idle" class="router-link-active router-link-exact-active">lsapi_backend_max_idle</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-max-reqs" class="router-link-active router-link-exact-active">lsapi_backend_max_reqs</a></li></ul><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#criu-support-cloudlinux7-only" class="router-link-active router-link-exact-active">CRIU support</a>:</p><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-criu" class="router-link-active router-link-exact-active">lsapi_criu</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-criu-socket-path" class="router-link-active router-link-exact-active">lsapi_criu_socket_path</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-criu-imgs-dir-path" class="router-link-active router-link-exact-active">lsapi_criu_imgs_dir_path</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-initial-start" class="router-link-active router-link-exact-active">lsapi_backend_initial_start</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-criu-use-shm" class="router-link-active router-link-exact-active">lsapi_criu_use_shm</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-semtimedwait" class="router-link-active router-link-exact-active">lsapi_backend_semtimedwait</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-reset-criu-on-apache-restart" class="router-link-active router-link-exact-active">lsapi_reset_criu_on_apache_restart</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-criu-debug" class="router-link-active router-link-exact-active">lsapi_criu_debug</a></li></ul><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#php-configuration-management" class="router-link-active router-link-exact-active">PHP configuration management</a>:</p><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-process-phpini" class="router-link-active router-link-exact-active">lsapi_process_phpini</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-phpini" class="router-link-active router-link-exact-active">lsapi_phpini</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-phprc" class="router-link-active router-link-exact-active">lsapi_phprc</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-tmpdir" class="router-link-active router-link-exact-active">lsapi_tmpdir</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-enable-user-ini" class="router-link-active router-link-exact-active">lsapi_enable_user_ini</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-user-ini-homedir" class="router-link-active router-link-exact-active">lsapi_user_ini_homedir</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-keep-http200" class="router-link-active router-link-exact-active">lsapi_keep_http200</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-mod-php-behaviour" class="router-link-active router-link-exact-active">lsapi_mod_php_behaviour</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#php-valuephp-admin-valuephp-flagphp-admin-flag" class="router-link-active router-link-exact-active">php_value, php_admin_value, php_flag, php_admin_flag</a></li></ul><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#security" class="router-link-active router-link-exact-active">Security</a>:</p><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-use-suexec" class="router-link-active router-link-exact-active">lsapi_use_suexec</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-user-group" class="router-link-active router-link-exact-active">lsapi_user_group</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-uid-gid" class="router-link-active router-link-exact-active">lsapi_uid_gid</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-use-default-uid" class="router-link-active router-link-exact-active">lsapi_use_default_uid</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-target-perm" class="router-link-active router-link-exact-active">lsapi_target_perm</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-paranoid" class="router-link-active router-link-exact-active">lsapi_paranoid</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-check-document-root" class="router-link-active router-link-exact-active">lsapi_check_document_root</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-disable-forced-pwd-var" class="router-link-active router-link-exact-active">lsapi_disable_forced_pwd_var</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-max-resend-buffer" class="router-link-active router-link-exact-active">lsapi_max_resend_buffer</a></li></ul><h4 id="mod-lsapi-customization" tabindex="-1"><a class="header-anchor" href="#mod-lsapi-customization" aria-hidden="true">#</a> <strong>mod_lsapi customization</strong></h4><h4 id="lsapi-engine" tabindex="-1"><a class="header-anchor" href="#lsapi-engine" aria-hidden="true">#</a> <strong>lsapi_engine</strong></h4><p><strong>Syntax</strong> : lsapi_engine on/off <strong>Default</strong> : lsapi_engine off <strong>Context</strong> : httpd.conf, htaccess</p><p><strong>Description</strong> : Switching mod_lsapi handler on or off.</p><hr><h4 id="lsapi-socket-path" tabindex="-1"><a class="header-anchor" href="#lsapi-socket-path" aria-hidden="true">#</a> <strong>lsapi_socket_path</strong></h4><p><strong>Syntax</strong> : lsapi_socket_path [path] <strong>Default</strong> : lsapi_socket_path <code>/var/mod_lsapi</code><strong>Context</strong> : httpd.conf</p><p><strong>Description:</strong> Path to backend lsphp sockets. By default <code>/var/mod_lsapi</code></p><hr><h4 id="lsapi-poll-timeout" tabindex="-1"><a class="header-anchor" href="#lsapi-poll-timeout" aria-hidden="true">#</a> <strong>lsapi_poll_timeout</strong></h4><p><strong>Syntax</strong> : lsapi_poll_timeout [number] <strong>Default</strong> : lsapi_poll_timeout 300 <strong>Context</strong> : httpd.conf, htaccess</p><p><strong>Description</strong> : Time to wait for response from the lsphp daemon, in seconds. 0 stands for infinity. For preventing long running processes which can use EP (limit number of entry processes). Default value is 300. Should be more or equal to 0. In the case of wrong format, the default value will be used.</p><hr><h4 id="lsapi-per-user" tabindex="-1"><a class="header-anchor" href="#lsapi-per-user" aria-hidden="true">#</a> <strong>lsapi_per_user</strong></h4><p><strong>Syntax</strong> : lsapi_per_user On/Off <strong>Default</strong> : lsapi_per_user Off <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : Invoke master lsPHP process not per VirtualHost but per account. When On, invoke backend not per VirtualHost but per account. Default value is Off. It is possible, for example, to set it to On in global config file and to Off in config files of some particular Virtual Hosts. Then these Virtual Hosts will have a dedicated backend process, while others will have backend processes shared on account basis.</p><hr><h4 id="lsapi-output-buffering" tabindex="-1"><a class="header-anchor" href="#lsapi-output-buffering" aria-hidden="true">#</a> <strong>lsapi_output_buffering</strong></h4><p><strong>Syntax</strong> : lsapi_output_buffering On/Off <strong>Default</strong> : lsapi_output_buffering On <strong>Context</strong> : httpd.conf, virtualhost, htaccess</p><p><strong>Description</strong> : Enable or disable output buffering on Apache level. Default value is On.</p><hr><h4 id="lsapi-disable-reject-mode" tabindex="-1"><a class="header-anchor" href="#lsapi-disable-reject-mode" aria-hidden="true">#</a> <strong>lsapi_disable_reject_mode</strong></h4><p><strong>Syntax</strong> : lsapi_disable_reject_mode On/Off <strong>Default</strong> : lsapi_disable_reject_mode Off <strong>Context</strong> : httpd.conf, virtualhost</p><p><strong>Description</strong> : If a new HTTP request is coming to LSPHP daemon when all LSPHP workers are still busy, it can process this situation in two different ways. In REJECT mode LSPHP daemon will reject such request immediately. Otherwise, in legacy mode, LSPHP daemon will put this request into infinite queue, until one or more LSPHP daemon becomes free. When HTTP request is rejected in REJECT mode, mod_lsapi will write into Apache error_log the following message: Connect to backend rejected, and the client will receive 507 HTTP response. By default LSPHP daemon in CloudLinux OS uses REJECT mode. It can be switched off with this option.</p><hr><h4 id="lsapi-terminate-backends-on-exit" tabindex="-1"><a class="header-anchor" href="#lsapi-terminate-backends-on-exit" aria-hidden="true">#</a> <strong>lsapi_terminate_backends_on_exit</strong></h4><p><strong>Syntax</strong> : lsapi_terminate_backends_on_exit On/Off <strong>Default</strong> : lsapi_terminate_backends_on_exit On <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : httpd.conf, On - stop lsphp services on apache restart, Off - leave live started lsphp services on apache restart (for php+opcache). The lsphp will not restart, even if Apache gets restarted.</p><hr><h4 id="lsapi-avoid-zombies" tabindex="-1"><a class="header-anchor" href="#lsapi-avoid-zombies" aria-hidden="true">#</a> <strong>lsapi_avoid_zombies</strong></h4><p><strong>Syntax</strong> : lsapi_avoid_zombies On/Off <strong>Default</strong> : lsapi_avoid_zombies Off <strong>Context</strong> : httpd.conf, virtualhost</p><p><strong>Description</strong> : Enable or disable a mechanism to avoid creation of zombie processes by lsphp. Default value is Off.</p><hr><h4 id="lsapi-use-req-hostname" tabindex="-1"><a class="header-anchor" href="#lsapi-use-req-hostname" aria-hidden="true">#</a> <strong>lsapi_use_req_hostname</strong></h4><p><strong>Syntax</strong> : lsapi_use_req_hostname On/Off <strong>Default</strong> : lsapi_use_req_hostname Off <strong>Context</strong> : httpd.conf, virtualhosts</p><p><strong>Description</strong> : By default, we are using hostname from the server_rec structure (off), it means that mod_lsapi takes hostname from the VirtualHost section of the configuration file. Using hostname from the request_rec structure (On) means that mod_lsapi takes hostname from the HOST section of the request. It could be useful for those who use dynamically generated configs for virtual hosts for example with mod_lua.</p><hr><h4 id="lsapi-sentry" tabindex="-1"><a class="header-anchor" href="#lsapi-sentry" aria-hidden="true">#</a> <strong>lsapi_sentry</strong></h4><p><strong>Syntax</strong> : lsapi_sentry On/Off <strong>Default</strong> : lsapi_sentry On <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : When this option is enabled, errors that occur in the operation of the mod_lsapi will be sent to the remote sentry server. You can see the error messages that were sent to the sentry server in the directory /var/log/mod_lsapi. If you do not want to send error notifications from your server, you can disable this directive in lsapi.conf.</p><hr><h4 id="lsapi-debug" tabindex="-1"><a class="header-anchor" href="#lsapi-debug" aria-hidden="true">#</a> <strong>lsapi_debug</strong></h4><p><strong>Syntax</strong> : lsapi_debug On/Off <strong>Default</strong> : lsapi_debug Off <strong>Context</strong> : httpd.conf, virtualhost</p><p><strong>Description</strong> : Extended debug logging.</p><hr><h4 id="tuning-lsphp-backend" tabindex="-1"><a class="header-anchor" href="#tuning-lsphp-backend" aria-hidden="true">#</a> <strong>Tuning LSPHP backend</strong></h4><h4 id="lsapi-set-env" tabindex="-1"><a class="header-anchor" href="#lsapi-set-env" aria-hidden="true">#</a> <strong>lsapi_set_env</strong></h4><p><strong>Syntax</strong> : lsapi_set_env VAR_NAME [VAR_VALUE] <strong>Default</strong> : - <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : Pass env variable to lsphp. By default lsphp environment have only TEMP, TMP and PATH variables set. Example: lsapi_set_env TMP &quot;/var/lsphp-tmp&quot; Note: PATH env var default &quot;/usr/local/bin:/usr/bin:/bin&quot; cannot be changed because of security reasons. To change it, use explicitly lsapi_set_env_path option.</p><div class="tip custom-block"><p class="custom-block-title">Beta</p><p>When the <code>lsapi_server_tweak</code> option is switched <code>On</code>, this option can be used in the virtualhost context.</p></div><hr><h4 id="lsapi-set-env-path" tabindex="-1"><a class="header-anchor" href="#lsapi-set-env-path" aria-hidden="true">#</a> <strong>lsapi_set_env_path</strong></h4><p><strong>Syntax</strong> : lsapi_set_env_path [path(s)] <strong>Default</strong> : lsapi_set_env_path /usr/local/bin:/usr/bin:/bin <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : Change PATH variable in the environment of lsPHP processes. Default path /usr/local/bin:/usr/bin:/bin will be used if not set.</p><div class="tip custom-block"><p class="custom-block-title">Beta</p><p>When the <code>lsapi_server_tweak</code> option is switched <code>On</code>, this option can be used in the virtualhost context.</p></div><hr><h4 id="lsapi-backend-children" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-children" aria-hidden="true">#</a> <strong>lsapi_backend_children</strong></h4><p><strong>Syntax</strong> : lsapi_backend_children [number] <strong>Default</strong> : lsapi_backend_children [EP] <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : Sets maximum number of simultaneously running child backend processes. Optional, a default directive value is equal to 120. LSAPI_CHILDREN environment variable is set according to the following rules:</p><ul><li>If NPROC and EP are unlimited, the directive value is used.</li><li>If NPROC is set to any limited value and the directive value is set to a number less than NPROC-1, the directive value is used.</li><li>If the value is bigger than NPROC-1 and EP is set to unlimited, NPROC-1 is used.</li><li>If the value is bigger than NPROC-1 and EP is set to any limited value, EP+1 is used.</li></ul><p>For example, with the default lve settings NPROC=100 and EP=20, the effective LSAPI_CHILDREN will be EP+1, that is LSAPI_CHILDREN=21.</p><hr><h4 id="lsapi-backend-connect-tries" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-connect-tries" aria-hidden="true">#</a> <strong>lsapi_backend_connect_tries</strong></h4><p><strong>Syntax</strong> : lsapi_backend_connect_tries [number] <strong>Default</strong> : lsapi_backend_connect_tries 20 <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : Number of retries to connects to lsPHP daemon.</p><hr><h4 id="lsapi-backend-connect-timeout" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-connect-timeout" aria-hidden="true">#</a> <strong>lsapi_backend_connect_timeout</strong></h4><p><strong>Syntax</strong> : lsapi_backend_connect_timeout [number] <strong>Default</strong> : lsapi_backend_connect_timeout 500000 <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : Number of usec to wait while lsPHP starts (if not started on request).</p><hr><h4 id="lsapi-backend-max-process-time" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-max-process-time" aria-hidden="true">#</a> <strong>lsapi_backend_max_process_time</strong></h4><p><strong>Syntax</strong> : lsapi_backend_max_process_time [number] <strong>Default</strong> : lsapi_backend_max_process_time 300 <strong>Context</strong> : httpd.conf, virtualhost</p><p><strong>Description</strong> : Sets env variable LSAPI_MAX_PROCESS_TIME Optional. Default value is 300. Timeout to kill runaway processes.</p><hr><h4 id="lsapi-backend-pgrp-max-idle" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-pgrp-max-idle" aria-hidden="true">#</a> <strong>lsapi_backend_pgrp_max_idle</strong></h4><p><strong>Syntax</strong> : lsapi_backend_pgrp_max_idle [number] <strong>Default</strong> : lsapi_backend_pgrp_max_idle 30 <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : Sets env variable LSAPI_PGRP_MAX_IDLE, in seconds. Controls how long a control process will wait for a new request before it exits. # 0 stands for infinite. Optional, default value is 30. Should be more or equal to 0.</p><hr><h4 id="lsapi-backend-use-own-log" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-use-own-log" aria-hidden="true">#</a> <strong>lsapi_backend_use_own_log</strong></h4><p><strong>Syntax</strong> : lsapi_backend_use_own_log On/Off <strong>Default</strong> : lsapi_backend_use_own_log Off <strong>Context</strong> : httpd.conf, virtualhost</p><p><strong>Description</strong> : Redirecting log output of backend processes from Apache error_log to dedicated log file or files, depending on value of lsapi_backend_common_own_log option. If Off, use Apache error log file for backend output, or separate file otherwise.</p><hr><h4 id="lsapi-backend-common-own-log" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-common-own-log" aria-hidden="true">#</a> <strong>lsapi_backend_common_own_log</strong></h4><p><strong>Syntax</strong> : lsapi_backend_common_own_log On/Off <strong>Default</strong> : lsapi_backend_common_own_log Off <strong>Context</strong> : httpd.conf, virtualhost</p><p><strong>Description</strong> : It will be used only when lsapi_backend_use_own_log set to On. On - backend processes of the all virtual hosts will share the common log file. Off - every virtual host will have its own backend log file.</p><hr><h4 id="lsapi-backend-coredump" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-coredump" aria-hidden="true">#</a> <strong>lsapi_backend_coredump</strong></h4><p><strong>Syntax</strong> : lsapi_backend_coredump On/Off <strong>Default</strong> : lsapi_backend_coredump Off <strong>Context</strong> : httpd.conf, htaccess</p><p><strong>Description</strong> : env variable LSAPI_ALLOW_CORE_DUMP (On or Off). Pass LSAPI_ALLOW_CORE_DUMP to lsphp or not. If it will be passed - core dump on lsphp crash will be created. Off by default. By default LSAPI application will not leave a core dump file when crashed. If you want to have LSAPI PHP dump a core file, you should set this environment variable. If set, regardless the value has been set to, core files will be created under the directory that the PHP script in.</p><hr><h4 id="lsapi-backend-accept-notify" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-accept-notify" aria-hidden="true">#</a> <strong>lsapi_backend_accept_notify</strong></h4><p><strong>Syntax</strong> : lsapi_backend_accept_notify On/Off <strong>Default</strong> : lsapi_backend_accept_notify On <strong>Context</strong> : httpd.conf, virtualhost</p><p><strong>Description</strong> : Switch LSAPI_ACCEPT_NOTIFY mode for lsphp. This option can be used both in Global and VirtualHost scopes.This mode is incompatible with PHP 4.4.</p><hr><h4 id="lsapi-backend-pgrp-max-reqs" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-pgrp-max-reqs" aria-hidden="true">#</a> <strong>lsapi_backend_pgrp_max_reqs</strong></h4><p><strong>Syntax</strong> : lsapi_backend_prgrp_max_reqs [number] <strong>Default</strong> : lsapi_backend_max_reqs 0 <strong>Context</strong> : httpd.conf, virtualhost</p><p><strong>Description</strong> : Controls how many requests a control process will process before it exits. Should be more or equal to 0. In the case of wrong format, a default value will be used. Optional, the default value is 0, which means an unlimited number of requests.</p><hr><h4 id="lsapi-backend-pgrp-max-crashes" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-pgrp-max-crashes" aria-hidden="true">#</a> <strong>lsapi_backend_pgrp_max_crashes</strong></h4><p><strong>Syntax</strong> : lsapi_backend_prgrp_max_crashes [number] <strong>Default</strong> : lsapi_backend_max_crashes 0 <strong>Context</strong> : httpd.conf, virtualhost</p><p><strong>Description</strong> : Controls how many crashes of its worker processes a control process will detect before it exits. Should be more or equal to 0. In the case of wrong format, a default value will be used. Optional, the default value is 0, which means an unlimited number of crashes.</p><hr><h4 id="lsapi-backend-loglevel-info" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-loglevel-info" aria-hidden="true">#</a> <strong>lsapi_backend_loglevel_info</strong></h4><p><strong>Syntax</strong>: lsapi_backend_loglevel_info [On/Off]</p><p><strong>Default</strong>: lsapi_backend_loglevel_info Off</p><p><strong>Context</strong>: httpd.conf, virtualhost</p><p><strong>Description</strong>: Controls which log level will be used to write PHP warnings and notices into Apache’s error_log. Optional, the default value is <code>Off</code>. In that case <code>LOG_WARNING</code> log level will be used. Otherwise, with <code>On</code> value, <code>LOG_INFO</code> log level will be used.</p><hr><h4 id="lsapi-backend-oom-score-adj" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-oom-score-adj" aria-hidden="true">#</a> <strong>lsapi_backend_oom_score_adj</strong></h4><p><strong>Syntax</strong>: lsapi_backend_oom_score_adj [number]</p><p><strong>Default</strong>: lsapi_backend_oom_score_adj 0</p><p><strong>Context</strong>: httpd.conf, virtualhost</p><p><strong>Description</strong>: This option can be used to apply <strong>oom_score_adj</strong> values for PHP processes created by mod_lsapi. Value is an integer in the -1000 to 1000 range. The lower the value, the lower the chance that the process will be killed. When your server becomes low on free memory and an OOM killer is invoked then desirable that lsphp processes are sacrificed to free up memory. To do this, you need to set oom_score_adj to a large value. For more information on setting value <strong>oom_score_adj</strong>, see the page <a href="https://man7.org/linux/man-pages/man5/proc.5.html" target="_blank" rel="noopener noreferrer">https://man7.org/linux/man-pages/man5/proc.5.html</a></p><hr><h4 id="lsapi-server-tweak" tabindex="-1"><a class="header-anchor" href="#lsapi-server-tweak" aria-hidden="true">#</a> <strong>lsapi_server_tweak</strong> <Badge type="info" text="beta"></Badge></h4><p><strong>Syntax</strong>: lsapi_server_tweak [On/Off]</p><p><strong>Default</strong>: lsapi_server_tweak Off</p><p><strong>Context</strong>: httpd.conf</p><p><strong>Description</strong>: This option, when switched on, allows the use of <code>lsapi_set_env</code> and <code>lsapi_set_env_path</code> config options in the virtualhost context.</p><hr><h4 id="connection-pool-mode" tabindex="-1"><a class="header-anchor" href="#connection-pool-mode" aria-hidden="true">#</a> <strong>Connection pool mode</strong></h4><h4 id="lsapi-with-connection-pool" tabindex="-1"><a class="header-anchor" href="#lsapi-with-connection-pool" aria-hidden="true">#</a> <strong>lsapi_with_connection_pool</strong></h4><p><strong>Syntax</strong> : lsapi_with_connection_pool On/Off <strong>Default</strong> : lsapi_with_connection_pool Off <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : On/Off - disable enable connect pool, default is Off.</p><hr><h4 id="lsapi-backend-max-idle" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-max-idle" aria-hidden="true">#</a> <strong>lsapi_backend_max_idle</strong></h4><p><strong>Syntax</strong> : lsapi_backend_max_idle [number] <strong>Default</strong> : lsapi_backend_max_idle 300 <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : It is relevant only with lsapi_with_connection_pool option switched on. Controls how long a worker process will wait for a new request before it exits. 0 stands for infinite. Should be more or equal to 0. In the case of wrong format default value will be used. Optional, default value is 300.</p><hr><h4 id="lsapi-backend-max-reqs" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-max-reqs" aria-hidden="true">#</a> <strong>lsapi_backend_max_reqs</strong></h4><p><strong>Syntax</strong> : lsapi_backend_max_reqs [number] <strong>Default</strong> : lsapi_backend_max_reqs 10000 <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : It is relevant only with lsapi_with_connection_pool option switched on. Controls how many requests a worker process will process before it exits. Should be more than 0. In the case of wrong format default value will be used. Optional, default value is 10000.</p><hr><h4 id="criu-support" tabindex="-1"><a class="header-anchor" href="#criu-support" aria-hidden="true">#</a> <strong>CRIU support</strong></h4><h4 id="lsapi-criu" tabindex="-1"><a class="header-anchor" href="#lsapi-criu" aria-hidden="true">#</a> <strong>lsapi_criu</strong></h4><p><strong>Syntax</strong> : lsapi_criu On/Off <strong>Default</strong> : lsapi_criu Off <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : Enable/disable CRIU for lsphp freezing. Default: Off.</p><hr><h4 id="lsapi-criu-socket-path" tabindex="-1"><a class="header-anchor" href="#lsapi-criu-socket-path" aria-hidden="true">#</a> <strong>lsapi_criu_socket_path</strong></h4><p><strong>Syntax</strong> : lsapi_criu_socket_path [path] <strong>Default</strong> : lsapi_criu_socket_path /var/run/criu/criu_service.socket <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : Set path to socket for communication with criu service. Default: /var/run/criu/criu_service.socket.</p><hr><h4 id="lsapi-criu-imgs-dir-path" tabindex="-1"><a class="header-anchor" href="#lsapi-criu-imgs-dir-path" aria-hidden="true">#</a> <strong>lsapi_criu_imgs_dir_path</strong></h4><p><strong>Syntax</strong> : lsapi_criu_imgs_dir_path [path] <strong>Default</strong> : lsapi_criu_imgs_dir_path /var/mod_lsapi/ <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : Path to folder where images of freezed PHP will be stored. Should be path. Default: /var/mod_lsapi/</p><hr><h4 id="lsapi-backend-initial-start" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-initial-start" aria-hidden="true">#</a> <strong>lsapi_backend_initial_start</strong></h4><p><strong>Syntax</strong> : lsapi_backend_initial_start [number] <strong>Default</strong> : lsapi_backend_initial_start 0 <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : Number of requests to virtualhost, when lsphp will be freezed. Default: 0 - means disable freezing.</p><hr><h4 id="lsapi-criu-use-shm" tabindex="-1"><a class="header-anchor" href="#lsapi-criu-use-shm" aria-hidden="true">#</a> <strong>lsapi_criu_use_shm</strong></h4><p><strong>Syntax</strong> : lsapi_criu_use_shm Off/Signals <strong>Default</strong> : lsapi_criu_use_shm Off <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : Method of requests counting. Off - use shared memory. Signals - use signals from child processes to parent. Default: Off</p><hr><h4 id="lsapi-backend-semtimedwait" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-semtimedwait" aria-hidden="true">#</a> <strong>lsapi_backend_semtimedwait</strong></h4><p><strong>Syntax</strong> : lsapi_backend_semtimedwait On/Off <strong>Default</strong> : lsapi_backend_semtimedwait On <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : Use semaphore for checking when lsphp process will be started. Speed of start lsphp increased with semaphore using. This method avoid cycles of waiting for lsphp start. Default: On.</p><hr><h4 id="lsapi-reset-criu-on-apache-restart" tabindex="-1"><a class="header-anchor" href="#lsapi-reset-criu-on-apache-restart" aria-hidden="true">#</a> <strong>lsapi_reset_criu_on_apache_restart</strong></h4><p><strong>Syntax</strong> : lsapi_reset_criu_on_apache_restart On/Off <strong>Default</strong> : lsapi_reset_criu_on_apache_restart Off <strong>Context</strong> : httpd.conf, virtualhost</p><p><strong>Description</strong> : This option allows cleaning all CRIU images on Apache restart. Setting lsapi_reset_criu_on_apache_restart to On means that on each Apache restart the CRIU images which are stored in directory specified by lsapi_criu_imgs_dir_path directive will be recreated on new request to domain(only after restart). If this option set to Off then CRIU images won’t be recreated on Apache restart.</p><hr><h4 id="lsapi-criu-debug" tabindex="-1"><a class="header-anchor" href="#lsapi-criu-debug" aria-hidden="true">#</a> <strong>lsapi_criu_debug</strong></h4><p><strong>Syntax</strong>: lsapi_criu_debug On/Off <strong>Default</strong>: lsapi_criu_debug Off <strong>Context</strong>: httpd.conf, virtualhost</p><p><strong>Description</strong> : Enable/disable CRIU related debug logging.</p><hr><h4 id="php-configuration-management" tabindex="-1"><a class="header-anchor" href="#php-configuration-management" aria-hidden="true">#</a> <strong>PHP configuration management</strong></h4><h4 id="lsapi-process-phpini" tabindex="-1"><a class="header-anchor" href="#lsapi-process-phpini" aria-hidden="true">#</a> <strong>lsapi_process_phpini</strong></h4><p><strong>Syntax</strong> : lsapi_process_phpini On/Off <strong>Default</strong> : lsapi_process_phpini Off <strong>Context</strong> : httpd.conf, virtualhost, directory</p><p><strong>Description</strong> : Enable or disable phpini_* directive processing. Default value is Off.</p><hr><h4 id="lsapi-phpini" tabindex="-1"><a class="header-anchor" href="#lsapi-phpini" aria-hidden="true">#</a> <strong>lsapi_phpini</strong></h4><p><strong>Syntax</strong> : lsapi_phpini [path] <strong>Default</strong> : lsapi_phpini - <strong>Context</strong> : httpd.conf, virtualhost, htaccess</p><p><strong>Description</strong> : When lsapi_process_phpini option switched to Off, these values will be silently ignored. lsapi_phpini values with absolute filename of php.ini file can be inserted into .htaccess files in order to set custom php.ini which will override/complement settings from system default php.ini.</p><hr><h4 id="lsapi-phprc" tabindex="-1"><a class="header-anchor" href="#lsapi-phprc" aria-hidden="true">#</a> <strong>lsapi_phprc</strong></h4><p><strong>Syntax</strong> : lsapi_phprc [No | Env | Auto | DocRoot] <strong>Default</strong> : lsapi_phprc No <strong>Context</strong> : httpd.conf, virtualhost</p><p><strong>Description</strong> : The value of PHPRC env variable. Special values are &quot;No&quot;, &quot;Env&quot;, &quot;Auto&quot; and &quot;DocRoot&quot;. Default value is &quot;No&quot; - without PHPRC at all. &quot;Auto&quot; value stands for php.ini from DocumentRoot of the corresponding VirtualHost if it is present, or from user&#39;s home directory otherwise &quot;DocRoot&quot; value stands for php.ini from DocumentRoot of the corresponding VirtualHost. &quot;Env&quot; value for using PHPRC from the environment, to set it with SetEnv config option, for example lsapi_phprc No lsapi_phprc Auto lsapi_phprc DocRoot lsapi_phprc Env lsapi_phprc /etc/</p><hr><h4 id="lsapi-tmpdir" tabindex="-1"><a class="header-anchor" href="#lsapi-tmpdir" aria-hidden="true">#</a> <strong>lsapi_tmpdir</strong></h4><p><strong>Syntax</strong> : lsapi_tmpdir [path] <strong>Default</strong> : lsapi_tmpdir /tmp <strong>Context</strong> : httpd.conf, virtualhost</p><p><strong>Description</strong> : Set alternate request body temporary files directory.</p><hr><h4 id="lsapi-enable-user-ini" tabindex="-1"><a class="header-anchor" href="#lsapi-enable-user-ini" aria-hidden="true">#</a> <strong>lsapi_enable_user_ini</strong></h4><p><strong>Syntax</strong> : lsapi_enable_user_ini On/Off <strong>Default</strong> : lsapi_enable_user_ini Off <strong>Context</strong> : httpd.conf, virtualhost</p><p><strong>Description</strong> : Enable .user.ini files for backend. Same as suphp, php-fpm and fcgid mechanism of .user.ini. Default value is Off.</p><hr><h4 id="lsapi-user-ini-homedir" tabindex="-1"><a class="header-anchor" href="#lsapi-user-ini-homedir" aria-hidden="true">#</a> <strong>lsapi_user_ini_homedir</strong></h4><p><strong>Syntax</strong> : lsapi_user_ini_homedir On/Off <strong>Default</strong> : lsapi_user_ini_homedir Off <strong>Context</strong> : httpd.conf, virtualhost</p><p><strong>Description</strong> : If lsapi_enable_user_ini option is set to On, then enable/disable processing .user.ini file in home directory also. Default value is Off.</p><hr><h4 id="lsapi-keep-http200" tabindex="-1"><a class="header-anchor" href="#lsapi-keep-http200" aria-hidden="true">#</a> <strong>lsapi_keep_http200</strong></h4><p><strong>Syntax</strong> : lsapi_keep_http200 On/Off <strong>Default</strong> : lsapi_keep_http200 Off <strong>Context</strong> : httpd.conf, .htaccess</p><p><strong>Description</strong> : If set to On, always keep backend&#39;s response status as mod_php does. If set to Off, response status can be overridden by Apache as suphp does (in case of call via ErrorDocument directive).</p><hr><h4 id="lsapi-mod-php-behaviour" tabindex="-1"><a class="header-anchor" href="#lsapi-mod-php-behaviour" aria-hidden="true">#</a> <strong>lsapi_mod_php_behaviour</strong></h4><p><strong>Syntax</strong> : lsapi_mod_php_behaviour On/Off <strong>Default</strong> : lsapi_mod_php_behaviour On <strong>Context</strong> : httpd.conf, virtualhost, directory</p><p><strong>Description</strong> : On/Off - disable php_* directives, default On.</p><hr><h4 id="php-value-php-admin-value-php-flag-php-admin-flag" tabindex="-1"><a class="header-anchor" href="#php-value-php-admin-value-php-flag-php-admin-flag" aria-hidden="true">#</a> <strong>php_value, php_admin_value, php_flag, php_admin_flag</strong></h4><p><strong>Syntax</strong> : [php_value|php_admin_value|php_flag|php_admin_flag] <strong>Default</strong> : <strong>Context</strong> : httpd.conf, virtualhost, htaccess</p><p><strong>Description</strong> : mod_php emulation.</p><hr><h4 id="security" tabindex="-1"><a class="header-anchor" href="#security" aria-hidden="true">#</a> <strong>Security</strong></h4><h4 id="lsapi-use-suexec" tabindex="-1"><a class="header-anchor" href="#lsapi-use-suexec" aria-hidden="true">#</a> <strong>lsapi_use_suexec</strong></h4><p><strong>Syntax</strong> : lsapi_use_suexec On/Off <strong>Default</strong> : lsapi_use_suexec On <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : Use or not suexec to a target user.</p><hr><h4 id="lsapi-user-group" tabindex="-1"><a class="header-anchor" href="#lsapi-user-group" aria-hidden="true">#</a> <strong>lsapi_user_group</strong></h4><p><strong>Syntax</strong> : lsapi_user_group [user_name] [group_name] <strong>Default</strong> : - <strong>Context</strong> : httpd.conf, virtualhost, directory</p><p><strong>Description</strong> : Set user &amp; group for requests.</p><hr><h4 id="lsapi-uid-gid" tabindex="-1"><a class="header-anchor" href="#lsapi-uid-gid" aria-hidden="true">#</a> <strong>lsapi_uid_gid</strong></h4><p><strong>Syntax</strong> : lsapi_uid_gid [uid] [gid] <strong>Default</strong> : - <strong>Context</strong> : httpd.conf, virtualhost, directory</p><p><strong>Description</strong> : Set user &amp; group for request.</p><hr><h4 id="lsapi-use-default-uid" tabindex="-1"><a class="header-anchor" href="#lsapi-use-default-uid" aria-hidden="true">#</a> <strong>lsapi_use_default_uid</strong></h4><p><strong>Syntax</strong> : lsapi_use_default_uid On/Off <strong>Default</strong> : lsapi_use_default_uid On <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : Use default Apache UID/GID if no uid/gid set. Values: On/Off. If Off, and no UID/GID set, error 503 will be returned.</p><hr><h4 id="lsapi-target-perm" tabindex="-1"><a class="header-anchor" href="#lsapi-target-perm" aria-hidden="true">#</a> <strong>lsapi_target_perm</strong></h4><p><strong>Syntax</strong> : lsapi_target_perm On/Off <strong>Default</strong> : lsapi_target_perm Off <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : Check target PHP script permissions. If set to On, lsapi will check that script is owned by the same user, as user under which it is being executed. Return 503 error if they don&#39;t match. Default: Off.</p><hr><h4 id="lsapi-paranoid" tabindex="-1"><a class="header-anchor" href="#lsapi-paranoid" aria-hidden="true">#</a> <strong>lsapi_paranoid</strong></h4><p><strong>Syntax</strong> : lsapi_paranoid On/Off <strong>Default</strong> : lsapi_paranoid Off <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : Check or not permissions of target php scripts. Optional, default value is Off.</p><hr><h4 id="lsapi-check-document-root" tabindex="-1"><a class="header-anchor" href="#lsapi-check-document-root" aria-hidden="true">#</a> <strong>lsapi_check_document_root</strong></h4><p><strong>Syntax</strong> : lsapi_check_document_root On/Off <strong>Default</strong> : lsapi_check_document_root On <strong>Context</strong> : httpd.conf</p><p><strong>Description</strong> : Check or not owner of DOCUMENT_ROOT. Optional, default value is On.</p><hr><h4 id="lsapi-disable-forced-pwd-var" tabindex="-1"><a class="header-anchor" href="#lsapi-disable-forced-pwd-var" aria-hidden="true">#</a> <strong>lsapi_disable_forced_pwd_var</strong></h4><p><strong>Syntax</strong> : lsapi_disable_forced_pwd_var On/Off <strong>Default</strong> : lsapi_disable_forced_pwd_var Off <strong>Context</strong> : httpd.conf, virtualhost</p><p><strong>Description</strong> : To disable addition of PWD variable. Default value is Off. If set to On, the PWD variable will not be added into a backend environment.</p><hr><h4 id="lsapi-max-resend-buffer" tabindex="-1"><a class="header-anchor" href="#lsapi-max-resend-buffer" aria-hidden="true">#</a> <strong>lsapi_max_resend_buffer</strong></h4><p><strong>Syntax</strong> : lsapi_max_resend_buffer [number]tmp <strong>Default</strong> : lsapi_max_resend_buffer 200 <strong>Context</strong> : httpd.conf, virtualhost</p><p><strong>Description</strong> : Maximum buffer in KiB to resend for request that has a body (like POST request body).</p><p>See also <a href="/cloudlinuxos/command-line_tools/#apache-mod-lsapi-pro" class="">Apache mod_lsapi PRO CLI tools</a>.</p><h3 id="troubleshooting-3" tabindex="-1"><a class="header-anchor" href="#troubleshooting-3" aria-hidden="true">#</a> Troubleshooting</h3><p><strong>Debugging mod_lsapi issues: error_log &amp; sulsphp_log</strong></p><p>mod_lsapi errors will be located in error_log and sulsphp_log. Note that errors can appear in both logs at the same time, and you might need to refer to both of them to solve the issue.</p><p>See next table for more details:</p><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td><strong>error_log</strong></td><td><strong>sulsphp_log</strong></td><td><strong>Solution</strong></td></tr><tr><td>Could not connect to lsphp backend: connect to lsphp failed: 111 Connection refused. Increase memory limit for LVE ID</td><td>uid: (xxx/xxxxxxxx) gid: (xxx/xxxxxxxxxx) cmd: /usr/local/bin/lsphp</td><td>Increase pmem or vmem limits for the user uid.</td></tr><tr><td>Error sending request: ReceiveLSHeader: nothing to read from backend socket</td><td>No need to check this log.</td><td>lsphp was killed. It can be due to apache restart or lfd. If you see this message too often - change <span class="notranslate"> lsapi_terminate_backends_on_exit </span> to <span class="notranslate"> Off </span> in lsapi.conf or add to <span class="notranslate"> /etc/csf/csf.pignore </span> the following lines: <span class="notranslate"> exe:/usr/local/bin/lsphp </span> pexe:/opt/alt/php.*/usr/bin/lsphp</td></tr><tr><td>Error sending request (lsphp is killed?): ReceiveLSHeader: nothing to read from backend socket, referer: http://XXXXXXX Child process with pid: XXXXX was killed by signal: 11, core dump: 0</td><td>No need to check this log.</td><td>lsphp has crashed. Next slide will explain what to do (core dump creating). Also, check configuration options for apc and suhosin in php.ini. Once you have a core file generated at DocumentRoot contact <a href="https://cloudlinux.zendesk.com/hc/" target="_blank" rel="noopener noreferrer">https://cloudlinux.zendesk.com/</a> so we can investigate the cause.</td></tr><tr><td>Could not connect to lsphp backend: connect to lsphp failed: 111 Connection refused</td><td>file is writable by others: (///usr/local/bin/lsphp)</td><td>Incorrect lsphp file permissions. For fixing: <span class="notranslate"> chmod 755 /usr/local/bin/lsphp </span> cagefsctl --force-update.</td></tr><tr><td>Could not determine uid/gid for request</td><td>No need to check this log.</td><td>UID/GID are not set in virtualhost. Set <span class="notranslate"> lsapi_use_default_uid On </span> in lsapi.conf (it is <span class="notranslate"> On </span> by default since 0.1-98 version, this solution is for older versions).</td></tr><tr><td>Own id for script file (/xxxx/xxx/xxxx) is xxx; should be xxxx</td><td>No need to check this log.</td><td>File is not owned by the user PHP executed by. To overwrite (insecure), set <span class="notranslate"> lsapi_target_perm Off </span> in lsapi.conf.</td></tr><tr><td>Could not connect to lsphp backend: connect to lsphp failed: 111 Connection refused</td><td>Entering jail error</td><td>Check if СageFS enabled. Try running <span class="notranslate"> cagefsctl --remount-all. </span></td></tr><tr><td>Backend error on sending request(GET /XXXX HTTP/1.1); uri(/XXXX) content-length(0) (lsphp is killed?): ReceiveAckHdr: backend process reset connection: errno 104 (possibly memory limit for LVE ID XXXX too small)</td><td>uid: (xxx/xxxxxxxx) gid: (xxx/xxxxxxxxxx) cmd: /usr/local/bin/lsphp</td><td>Increase PMEM limits for the user UID.</td></tr><tr><td>Reached max children process limit: XX, extra: 0, current: XX, please increase LSAPI_CHILDREN.<br><br>Backend error on sending request(GET /XXXX HTTP/1.1); uri(/XXXX) content-length(0) (lsphp is killed?): ReceiveAckHdr: backend process reset connection: errno 104 (possibly memory limit for LVE ID XXXX too small)</td><td>uid: (xxx/xxxxxxxx) gid: (xxx/xxxxxxxxxx) cmd: /usr/local/bin/lsphp</td><td>Increase value of <span class="notranslate"> lsapi_backend_children </span> for UID in vhost.conf or globally in lsapi.conf.</td></tr><tr><td>fork() failed, please increase process limit: Cannot allocate memory<br><br>Backend error on sending request(GET /XXXX HTTP/1.1); uri(/XXXX) content-length(0) (lsphp is killed?): ReceiveAckHdr: backend process reset connection: errno 104 (possibly memory limit for LVE ID XXXX too small)</td><td>uid:(xxx); gid:(xxx); uid limit warning: EP should be &lt; than NPROC, current EP: XX, NPROC: XX<br><br>uid: (xxx/xxxxxxxx) gid: (xxx/xxxxxxxxxx) cmd: /usr/local/bin/lsphp</td><td>Increase NPROC limits for the UID. It should be greater than EP and <span class="notranslate"> lsapi_backend_children. </span></td></tr><tr><td>Child process with pid: XXXXXX was killed by signal: 9, core dump: 0<br><br>Backend error on sending request(GET /XXXX HTTP/1.1); uri(/XXXX) content-length(0) (lsphp is killed?): ReceiveAckHdr: nothing to read from backend socket (LVE ID XXXX</td><td>uid: (xxx/xxxxxxxx) gid: (xxx/xxxxxxxxxx) cmd: /usr/local/bin/lsphp</td><td>These errors occurs when the amount of PMEM limits is incommensurable with the number of EP. Increase PMEM limits or decrease EP number for the user UID.</td></tr><tr><td>totBytesRead (X) != bodyLen (X), referer: XXXX<br><br>Backend error on sending request(POST /XXXX HTTP/1.1); uri(/XXXX) content-length(X) (lsphp is killed?): ReceiveAckHdr: nothing to read from backend socket (LVE ID XXXX)<br><br>lsphp(XXXX): Child process with pid: XXXX was killed by signal: 15, core dump: 0</td><td>No need to check this log.</td><td>Increase LimitRequestBody (Apache) or/and SecRequestBodyNoFilesLimit (mod_security) configuration limits</td></tr><tr><td>Connect to backend failed: connect to lsphp failed: 13</td><td>No need to check this log.</td><td>Check that <code>mod_ruid2</code> is disabled</td></tr><tr><td>Connect to backend rejected on sending request(POST /XXXXX HTTP/1.1); uri(/XXXXX)</td><td>No need to check this log.</td><td>Set <span class="notranslate"><code>lsapi_disable_reject_mode On</code></span> in your <span class="notranslate"><code>lsapi.conf</code></span> and reload Apache. This way LSPHP daemon will put requests that cannot be served by LSPHP daemon right away into infinite queue, until one or more LSPHP daemon becomes free. Visit <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#configuration-references" class="router-link-active router-link-exact-active">Configuration Reference</a> for more info.</td></tr></tbody></table><p><strong>Non-standard apache user</strong></p><p>If apache runs under a username other than <span class="notranslate"> &quot;apache&quot; </span> or <span class="notranslate"> &quot;nobody&quot; </span> , you should rebuild sulsphp (where username is built in for security reasons) with corresponding username:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install liblsapi liblsapi-devel
cd ~$ wget [https://repo.cloudlinux.com/cloudlinux/sources/da/mod_lsapi.tar.gz](https://repo.cloudlinux.com/cloudlinux/sources/da/mod_lsapi.tar.gz)
tar zxvf mod_lsapi.tar.gz
cd mod-lsapi-0.1-37
cmake -DHTTPD_USER=&lt;new user name&gt; .
make
make install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div> This will:<br> - Install: <span class="notranslate"> /usr/lib/apache/mod_lsapi. </span> so (or to another correct httpd modules path)<br> - Install: <span class="notranslate"> /usr/sbin/sulsphp </span><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Starting from 1.1-80 version mod_lsapi uses Apache user name specified in the Apache config file along with user name precompiled with HTTPD_USER definition. So there is no need to change HTTPD_USER definition anymore.</p></div><p><strong>lsphp started under user apache/nobody</strong></p><p>Check if SuExecUserGroup specified for virtual hosts. This parameter is used by mod_lsapi for user identification.</p><p><strong>Could not connect to lsphp backend: connect failed: 111 Connection refused</strong></p><ul><li><p>Switch in lsapi.conf or <span class="notranslate"> mod_lsapi.conf </span> value to: <span class="notranslate"> lsapi_terminate_backends_on_exit Off </span></p></li><li><p>Check if empty: <span class="notranslate"> cat /etc/cron.d/kill_orphaned_php-cron | grep lsphp </span> , then run:</p></li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install lve-utils
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Then restart cron service. <p><strong>Running PHP for users with UID &lt; 99</strong></p><p>If you need to run PHP using mod_lsapi using users with UID &lt; 99, you would need to re-compile sulsphp:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install liblsapi liblsapi-devel
cd ~
wget [https://repo.cloudlinux.com/cloudlinux/sources/da/mod_lsapi.tar.gz](https://repo.cloudlinux.com/cloudlinux/sources/da/mod_lsapi.tar.gz)
tar zxvf mod_lsapi.tar.gz
cd mod-lsapi-0.1-XX
cmake -DUID_MIN=80 -DGID_MIN=80 .
make
make install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div> will be installed<br> - Installing: <span class="notranslate"> /usr/lib/apache/mod_lsapi.so </span> (or another httpd modules path)<br> - Installing: <span class="notranslate"> /usr/sbin/sulsphp </span><p><strong>Apache binary called not httpd (httpd.event, httpd.worker)</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install liblsapi liblsapi-devel
cd ~
wget https://repo.cloudlinux.com/cloudlinux/sources/da/mod_lsapi.tar.gz
tar zxvf mod_lsapi.tar.gz
cd mod-lsapi-0.1-XX
cmake -DPARENT_NAME=&quot;&lt;apache binary name&gt;&quot;.
make
make install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div> Will be installed:<br> - Installing: <span class="notranslate"> /usr/lib/apache/mod_lsapi.so </span> (or another httpd modules path)<br> - Installing: <span class="notranslate"> /usr/sbin/sulsphp </span><p><strong>WHMCS Status page not accessible after installing CL and mod_lsapi (cPanel).</strong></p><ul><li>add <span class="notranslate"> user: useradd </span> userstat</li><li>add to file (to the end of file before <span class="notranslate"> &lt;/IfModule&gt;) /usr/local/apache/conf/conf.d/lsapi.conf: &lt;Directory /usr/local/apache/htdocs/&gt; </span> lsapi_user_group userstat userstat &lt;/Directory&gt;</li><li>service httpd restart</li></ul><p>This is safe solution for easyapache rebuilding and cpanel-mod-lsapi updating.</p><p><strong>PHP page with Suhosin return 503 error</strong></p><p>Make php.ini for suhosin as recommended below:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[suhosin]
suhosin.simulation = Off
suhosin.mail.protect = 1
suhosin.cookie.disallow_nul = Off
suhosin.cookie.max_array_depth = 1000
suhosin.cookie.max_array_index_length = 500
suhosin.cookie.max_name_length = 500
suhosin.cookie.max_totalname_length = 500
suhosin.cookie.max_value_length = 200000
suhosin.cookie.max_vars = 16384
suhosin.get.disallow_nul = Off
suhosin.get.max_array_depth = 1000
suhosin.get.max_array_index_length = 500
suhosin.get.max_name_length = 500
suhosin.get.max_totalname_length = 500
suhosin.get.max_value_length = 1000000
suhosin.get.max_vars = 16384
suhosin.post.disallow_nul = Off
suhosin.post.max_array_depth = 1000
suhosin.post.max_array_index_length = 500
suhosin.post.max_name_length = 500
suhosin.post.max_totalname_length = 500
suhosin.post.max_value_length = 1000000
suhosin.post.max_vars = 16384
suhosin.request.disallow_nul = Off
suhosin.request.max_array_depth = 1000
suhosin.request.max_array_index_length = 500
suhosin.request.max_totalname_length = 500
suhosin.request.max_value_length = 1000000
suhosin.request.max_vars = 16384
suhosin.request.max_varname_length = 524288
suhosin.upload.max_uploads = 300
suhosin.upload.disallow_elf = Off
suhosin.session.cryptua = Off
suhosin.session.encrypt = Off
suhosin.session.max_id_length = 1024
suhosin.executor.allow_symlink = Off
suhosin.executor.disable_eval = Off
suhosin.executor.disable_emodifier = Off
suhosin.executor.include.max_traversal = 8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p><strong>PHP page with APC return 503 error</strong></p><p>Make php.ini for APC as recommended below:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[apc]...apc.shm_segments=1apc.shm_size=32...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> shared memory should be not less than 32MB <p><strong>Messages appearing in error_log: Child process with pid: XXXXX was killed by signal: 11, core dump: 0</strong></p><p>This means that lsphp was crashed. The solution is:</p><ul><li>Check if apc for user enabled. Tune its options as described in previous slide.</li><li>Check if suhosin is enabled for user. Tune its options as described in this article.</li><li>If previous items do not help, contact us at <a href="https://helpdesk.cloudlinux.com/" target="_blank" rel="noopener noreferrer">https://helpdesk.cloudlinux.com/</a></li></ul><p><strong>How to get lsphp core dump on crash</strong></p><ul><li>Configure mod_lsapi to allow lsphp to generate core dumps. In mod_lsapi.conf:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>lsapi_backend_coredump On
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li>Enable core file generation in sysctl:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sysctl -w ‘kernel.core_uses_pid=1’
sysctl -w ‘kernel.core_pattern=core.%p’
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><ul><li>Configure system to change max size of core files. In <span class="notranslate">/etc/security/limits.conf</span> add:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>user1 soft core unlimited
user1 hard core unlimited
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div> where <span class="notranslate">user1</span> is the username for which lsphp crashes. <ul><li>If <span class="notranslate">/etc/profile.d/limits.sh</span> exists, look up for the following lines:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>if [ &quot;$LIMITUSER&quot; != &quot;root&quot; ]; then
ulimit -n 100 -u 35 -m 200000 -d 200000 -s 8192 -c 200000 -v unlimited 2&gt;/dev/null
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div> Substring <span class="notranslate">“-c 200000”</span> must be replaced with <span class="notranslate">“-c unlimited”</span> . <ul><li><p>Add line into <span class="notranslate">ulimit -c unlimited into apachectl</span> script just after another invokes of the <span class="notranslate">ulimit</span> command.</p></li><li><p>Do cold restart of Apache with the command like this:</p></li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service httpd stop; sleep 2; killall lsphp; service httpd start
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><ul><li>You can make sure that ulimit for lsphp is changed to unlimited successfully with the following command:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cat /proc/PID/limits | grep ‘Max core file size’
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>where PID is a pid of any lsphp process. <span class="notranslate">ps -u user1 | grep lsphp </span></p><ul><li>Core dump of lsphp will be created in the DocumentRoot of the corresponding virtual server. On cPanel server it should map to</li></ul><p><strong>mod_lsapi is not included in output of httpd -M after installation and setup command for cPanel EasyApache 3</strong></p><ol><li><p>Check if the file <span class="notranslate"><em>/usr/local/apache/conf/conf.d/lsapi.conf</em></span> exists and not empty;</p></li><li><p>Check if output of the command</p></li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cat /usr/local/apache/conf/httpd.conf | grep &quot;/usr/local/apache/conf/conf.d/\*\.conf&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> is not empty. <p>If it is empty:</p><ol><li>Add to <span class="notranslate"> &quot;include&quot; </span> section of <span class="notranslate"><em>/var/cpanel/conf/apache/main</em></span> string:</li></ol><p><span class="notranslate"></span></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&quot;include&quot;: &#39;&quot;/usr/local/apache/conf/conf.d/*.conf&quot;&#39;
 &quot;include&quot;:
 &quot;directive&quot;: &#39;include&#39;
 &quot;items&quot;:
 ...
 -
 &quot;include&quot;: &#39;&quot;/usr/local/apache/conf/conf.d/*.conf&quot;&#39;
 &quot;listen&quot;:
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>Do:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mkdir -p /usr/local/apache/conf/conf.d/;
cp /usr/share/lve/modlscapi/confs/lsapi.conf /usr/local/apache/conf/conf.d/lsapi.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><ol start="3"><li>Call:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/scripts/rebuildhttpdconf/scripts/restartsrv_httpd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>See also mod_lsapi PRO FAQ <a href="https://cloudlinux.zendesk.com/hc/articles/360025828414-Apache-mod-lsapi-PRO-FAQ" target="_blank" rel="noopener noreferrer">here</a>.</p><h3 id="criu-support-1" tabindex="-1"><a class="header-anchor" href="#criu-support-1" aria-hidden="true">#</a> CRIU Support</h3><div class="tip custom-block"><p class="custom-block-title">Note</p><p><span class="notranslate"> CloudLinux OS </span> 7, <span class="notranslate"> CloudLinux OS </span> 7 Hybrid, and <span class="notranslate"> CloudLinux OS </span> 8 only</p></div><p>CRIU is <span class="notranslate"><em>Checkpoint/Restore In Userspace</em></span> , (pronounced <span class="notranslate"> kree-oo </span> ), is a software tool for Linux operating system. Using this tool, you can freeze a running application (or part of it) and checkpoint it as a collection of files on disk. You can then use the files to restore the application and run it exactly as it was during the time of freeze (more information on the link <a href="https://criu.org/Main_Page" target="_blank" rel="noopener noreferrer">https://criu.org/Main_Page</a> ).</p><p>mod_lsapi-1.1-1 is the first beta version with freezing PHP implemented. mod_lsapi now supports the following parameters:</p><table><thead><tr><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td><strong>Option name</strong></td><td><strong>Description</strong></td><td><strong>Values</strong></td><td><strong>Default</strong></td></tr><tr><td>lsapi_criu</td><td>Enable/disable CRIU for lsphp freezing.</td><td><span class="notranslate"> On/Off </span></td><td><span class="notranslate"> Off </span></td></tr><tr><td>lsapi_criu_socket_path</td><td>Set path to socket for communication with criu service.</td><td>[path to socket]</td><td><span class="notranslate"> /var/run/criu/criu_service.socket </span></td></tr><tr><td>lsapi_backend_semtimedwait</td><td>Enable/disable flag for notification about lsphp started. This method avoid cycles of waiting for lsphp start.</td><td><span class="notranslate"> On/Off </span></td><td><span class="notranslate"> On </span></td></tr><tr><td>lsapi_backend_initial_start</td><td>Number of request when lsphp should be freezed.</td><td>[number] 0 - no freezing</td><td>0</td></tr><tr><td>lsapi_criu_use_shm</td><td>Method of requests counting. <span class="notranslate"> Off </span> - use shared memory. <span class="notranslate"> Signals </span> - use signals from child processes to parent.</td><td><span class="notranslate"> Off/Signals </span></td><td><span class="notranslate"> Off </span></td></tr><tr><td>lsapi_criu_imgs_dir_path</td><td>Path to folder where imgs of freezed PHP will be stored.</td><td>[path]</td><td><span class="notranslate"> /var/mod_lsapi/ </span></td></tr><tr><td>lsapi_criu_debug</td><td>Enable/Disable CRIU related debug logging.</td><td><span class="notranslate"> On/Off </span></td><td><span class="notranslate"> Off </span></td></tr></tbody></table><p>Example:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>lsapi_criu On
lsapi_criu_socket_path /var/run/criu/criu_service.socket
lsapi_backend_semtimedwait On
lsapi_backend_initial_start 15
lsapi_criu_use_shm Off
lsapi_criu_debug Off
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>When Apache module mod_lsapi detects CRIU enabled (lsapi_criu On) it prepares a directory for images (on the first request of virtualhost) to store ( <span class="notranslate"> lsapi_criu_imgs_dir_path /var/mod_lsapi/[dir_name] </span> ), and starts lsphp process. Lsphp increases counter ( <span class="notranslate"> lsapi_criu_use_shm Off|Signals </span> ) via shared memory or signals, when counter reaches limit ( <span class="notranslate"> lsapi_backend_initial_start 15 </span> ), lsphp sends the request to CRIU for freezing. CRIU service makes images of requested processes. Lsphp will not be frozen if counter has not reached the limit. The next time when lsphp will be stopped, it will be unfrozen from the images.</p><p>The images of the processes will be saved even if Apache is restarted. But all images will be deleted after server restart by default configuration. This can be modified by setting the new path <span class="notranslate"> lsapi_criu_imgs_dir_path </span> .</p><div class="warning custom-block"><p class="custom-block-title">Important!</p><p>If php.ini or configuration file from php.d is changed, the images must be deleted manually.</p></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>CRIU (version lower than criu-lve-3.6-1) can&#39;t correctly freeze <span class="notranslate"> lsphp </span> with <span class="notranslate"> PrivateTmp </span> enabled. For correct work, <span class="notranslate"> PrivateTmp </span> must be disabled in <span class="notranslate"> httpd.service file </span> .</p></div><p>To disable it, copy <span class="notranslate"><em>httpd.service</em></span> to <span class="notranslate"><em>/etc/systemd/system</em></span> and change there <span class="notranslate"> PrivateTmp:   </span></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cat httpd.service
............

[Unit]
Description=Apache web server managed by cPanel Easy
ApacheConditionPathExists=!/etc/httpddisable
ConditionPathExists=!/etc/apachedisable
ConditionPathExists=!/etc/httpdisable

[Service]Type=forking
ExecStart=/usr/local/cpanel/scripts/restartsrv_httpd --no-verbose
PIDFile=/var/run/apache2/httpd.pid
PrivateTmp=false

[Install]
WantedBy=multi-user.target
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div> Or it would be technically better to provide a small override of service file rather than copying the whole new version in <span class="notranslate"> /etc/systemd/system </span><p><a href="http://www.freedesktop.org/software/systemd/man/systemd.unit.html" target="_blank" rel="noopener noreferrer">http://www.freedesktop.org/software/systemd/man/systemd.unit.html</a></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mkdir /etc/systemd/system/httpd.service.d
echo &quot;[Service]&quot; &gt;  /etc/systemd/system/httpd.service.d/nopt.conf
echo &quot;PrivateTmp=false&quot; &gt;&gt; /etc/systemd/system/httpd.service.d/nopt.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>and</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>systemctl daemon-reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="criu-installation" tabindex="-1"><a class="header-anchor" href="#criu-installation" aria-hidden="true">#</a> CRIU Installation</h4><p>Criu is installed with dependency to mod_lsapi package. To activate it:</p><ol><li>Enable service and start it:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>systemctl enable criu
systemctl start criu
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><ol start="2"><li>Edit lsapi.conf file, turn CRIU On and set some defaults:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>lsapi_criu On
lsapi_criu_socket_path /var/run/criu/criu_service.socket
lsapi_backend_semtimedwait On
lsapi_backend_initial_start 15
lsapi_criu_use_shm Off
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><ol start="3"><li>Restart apache:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service httpd restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="criu-image-cleanup" tabindex="-1"><a class="header-anchor" href="#criu-image-cleanup" aria-hidden="true">#</a> CRIU Image Cleanup</h4><ol><li>An option added to the Apache configuration for cleaning all the images earlier saved by CRIU.</li></ol><table><thead><tr><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td><strong>Option name</strong></td><td><strong>Description</strong></td><td><strong>Value</strong></td><td><strong>Default</strong></td></tr><tr><td><span class="notranslate">lsapi_reset_criu_on_apache_restart</span></td><td>This option allows cleaning all CRIU images on Apache restart.</td><td><span class="notranslate"> On/Off </span></td><td><span class="notranslate"> Off </span></td></tr></tbody></table><p>On the next restart of Apache all of the images will be cleaned.</p><p>It can be enabled by writing <span class="notranslate">lsapi_reset_criu_on_apache_restart On </span> in <em>lsapi.conf</em> (Virtual Host and .htaccess do not allow to use this option).</p><p>Note that this option works only if <span class="notranslate">lsapi_terminate_backends_on_exit</span> is <span class="notranslate"> On </span> (default value is <span class="notranslate"> On </span> , it is set in <em>lsapi.conf</em> too).</p><ol start="2"><li><p>If you need to clean CRIU images for one user you can simply add file to the user&#39;s directory with CRIU images (default <span class="notranslate"><em>/var/mod_lsapi/lsapi</em> * <em>criu_imgs</em></span> ). On the next restart of lsphp the images will be cleaned.</p></li><li><p>Global reset flag for cleaning all earlier saved images by CRIU.</p></li></ol><p>Current mod_lsapi allows cleaning all images only with one flag file.</p><p>Create <span class="notranslate"> /usr/share/criu/mod_lsapi/lsphp.criu.reset </span> file. Also don&#39;t forget to set such permissions <span class="notranslate"> [nobody:nobody] </span> (or <span class="notranslate"> [apache:apache] </span> for non cPanel) and access mode [700] to the <span class="notranslate"> /usr/share/criu/mod_lsapi </span> directory.</p><p>Steps to do :</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mkdir /usr/share/criumkdir /usr/share/criu/mod_lsapi
chown nobody:nobody /usr/share/criu/mod_lsapi
touch /usr/share/criu/mod_lsapi/lsphp.criu.reset
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>On the next requests to all virtual hosts images will be recreated (deleted first and created again later - it depends on lsapi_backend_initial_start value).</p><ol start="4"><li>Аdded possibility to clean CRIU images from user space.</li></ol><p>If a user needs to clean CRIU images for lsphp, he should create a file: <span class="notranslate"> ~/mod_lsapi_reset_me_[vhost_name] </span>. Where <span class="notranslate"> [vhost_name] </span> is a ServerName from the VirtualHost block in the configuration file. On the next restart of lsphp, the images will be cleaned.</p><p><em>Example:</em></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cd; touch mod_lsapi_reset_me_criu.test.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>where <em>vhost.conf</em> contains: <span class="notranslate"><code>ServerName criu.test.com</code></span></p><p>This mode is enabled by default and creates a separate lsphp process for each virtual host.</p><p><span class="notranslate"><code>mod_lsapi_reset_me[vhost_name]</code></span> flag will not work for a user when lsapi_per_user option is <span class="notranslate"><code>On</code></span>.</p><ol start="5"><li>There is (default <span class="notranslate"><code>off</code></span>) option in mod_lsapi that creates only one lsphp process for a user, regardless of the number of his virtual hosts. We don&#39;t recommend to use this option with CRIU, but if you use it, make sure that your virtual hosts (under the same user) have the same environment configurations. If they are not the same, this may cause undesirable lsphp process operation.</li></ol><h2 id="nginx-lsapi-module" tabindex="-1"><a class="header-anchor" href="#nginx-lsapi-module" aria-hidden="true">#</a> NGINX LSAPI Module</h2><h3 id="general-information-and-requirements-8" tabindex="-1"><a class="header-anchor" href="#general-information-and-requirements-8" aria-hidden="true">#</a> General information and requirements</h3><p>The NGINX LSAPI Module is an extension for the <a href="https://www.nginx.com/" target="_blank" rel="noopener noreferrer">NGINX</a> web server, designed to seamlessly integrate the lightweight, high-performance <a href="https://www.litespeedtech.com/open-source/litespeed-sapi" target="_blank" rel="noopener noreferrer">LiteSpeed</a> PHP processing capability directly within the NGINX architecture. This module enables NGINX to efficiently handle PHP requests using the LiteSpeed SAPI, offering an alternative to traditional PHP-FPM or mod_php approaches. It aims to leverage the speed and flexibility of LiteSpeed&#39;s PHP processing in environments where the NGINX is the preferred web server.</p><p><strong>How does it work?</strong></p><ol><li>NGINX passes handling for PHP request to NGINX LSAPI Module;</li><li>NGINX LSAPI Module uses liblsapi to transfer request to the lsphp parent process;</li><li>lsphp forks the child process, which executes the request and returns data to NGINX LSAPI Module;</li></ol><ul><li>If there are no requests for lsapi_backend_pgrp_max_idle seconds, lsphp parent process will be terminated;</li><li>If there are no lsphp child processes available when a new request comes, the new lsphp child process will be created;</li><li>lsphp children process concurrent requests simultaneously;</li><li>The maximum number of simultaneously running lsphp child processes can be set by the lsapi_backend_children directive.</li></ul><p><strong>What is lsphp?</strong></p><p>lsphp - PHP + LSAPI. What is PHP LSAPI? <a href="https://www.litespeedtech.com/open-source/litespeed-sapi/php" target="_blank" rel="noopener noreferrer">LiteSpeed Server Application Programming Interface</a> (LSAPI) is designed specifically for seamless, optimized communication between the LiteSpeed Web Server and third-party web applications. With NGINX LSAPI Module, this protocol is now available for NGINX.</p><p>Using NGINX LSAPI Module, we have seen higher performance than NGINX with fastcgi+php-fpm, easier installation than php-fpm and easier integration with any control panel. NGINX LSAPI Module means faster and more stable dynamic web pages.</p><p><strong>Optional requirements</strong></p><ul><li>Configured LVE containers for end-users ( <strong>recommended - control over resource consumption</strong> );</li><li>Enabled CageFS for end-users ( <strong>recommended - higher security level</strong> );</li><li>PHP Selector with alt-php - an easy way to select different PHP versions for each end-user provided by CloudLinux OS;</li><li>ea-php - alternative to alt-php provided by cPanel (for cPanel only).</li></ul><h3 id="installation-3" tabindex="-1"><a class="header-anchor" href="#installation-3" aria-hidden="true">#</a> Installation</h3><p>NGINX LSAPI Module can be installed through YUM package manager. However, the installation process varies depending on the control panel.</p><p>Select the control panel you are using:</p><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#installing-on-cpanel-servers-with-ea-nginx" class="router-link-active router-link-exact-active">cPanel</a></li><li>No control panel - In progress</li><li>Plesk - In progress</li><li>DirectAdmin - In progreess</li></ul><h4 id="installing-on-cpanel-servers-with-ea-nginx" tabindex="-1"><a class="header-anchor" href="#installing-on-cpanel-servers-with-ea-nginx" aria-hidden="true">#</a> Installing on cPanel servers with ea-nginx</h4><p>Install NGINX LSAPI Module and related packages through YUM package manager as follows:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install ea-nginx-mod-lsapi --enablerepo=cl-ea4-testing
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Now, when the module is installed, restart NGINX to ensure that NGINX LSAPI Module is enabled: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service nginx restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Use Apache2MaxWebserver to set up NGINX hosting on the server and automatically convert .htaccess files into corresponding NGINX configuration. For more details, please visit <a href="/cloudlinuxos/apache2max_webserver/#apache2nginx" class="">Apache2MaxWebserver</a>.</p><h3 id="uninstalling-4" tabindex="-1"><a class="header-anchor" href="#uninstalling-4" aria-hidden="true">#</a> Uninstalling</h3><p>The uninstallation process of the NGINX LSAPI Module also varies depending on your control panel.</p><p>Select the control panel you are using:</p><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#uninstallation-procedure-for-cpanel-servers-with-ea-nginx" class="router-link-active router-link-exact-active">cPanel</a></li><li>No control panel - In progress</li><li>Plesk - In progress</li><li>DirectAdmin - In progreess</li></ul><h4 id="uninstallation-procedure-for-cpanel-servers-with-ea-nginx" tabindex="-1"><a class="header-anchor" href="#uninstallation-procedure-for-cpanel-servers-with-ea-nginx" aria-hidden="true">#</a> Uninstallation procedure for cPanel servers with ea-nginx</h4><p>Remove packages with YUM package manager:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum erase ea-nginx-mod-lsapi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> Restart NGINX afterwards: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service nginx restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>To remove NGINX from your system and restore Apache configuration, please visit <a href="/cloudlinuxos/apache2max_webserver/#switch-back-to-apache-hosting" class="">Apache2MaxWebserver</a>.</p><h4 id="uninstallation-procedure-for-servers-with-no-control-panel" tabindex="-1"><a class="header-anchor" href="#uninstallation-procedure-for-servers-with-no-control-panel" aria-hidden="true">#</a> Uninstallation procedure for servers with no control panel</h4><p>Remove packages with YUM package manager:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum erase ea-nginx-mod-lsapi
rm [path to nginx-mod-lsapi.conf]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div> Restart NGINX to restore the standard PHP handler: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service nginx restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h3 id="configuration-4" tabindex="-1"><a class="header-anchor" href="#configuration-4" aria-hidden="true">#</a> Configuration</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#configuration-references-1" class="router-link-active router-link-exact-active">Configuration references</a></li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>If using Apache2MaxWebserver, no configuration is required for NGINX LSAPI Module. The module is automatically configured to process PHP requests.</p></div><p>In order to get NGINX LSAPI Module to work properly, you&#39;ll need to configure NGINX. To do this, we use a separate <em>lsapi.conf</em> file.</p><p>First of all, you need to make sure that the appropriate LSAPI module configuration exists and contains the correct content.</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[root@nginx]# cat /usr/share/nginx/modules/ngx-mod-lsapi.conf
load_module &quot;/usr/lib64/nginx/modules/ngx_http_lsapi_module.so&quot;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>In case of ea-nginx the file can be: <code>/etc/nginx/conf.d/modules/ea-nginx-lsapi-module.conf</code></p><p>Then make sure that the loading of dynamic modules is not omitted in your main nginx configuration (<em>nginx.conf</em>).</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>include /usr/share/nginx/modules/*.conf;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div> In order to enable the module to process requests, you need to add the lsapi_engine directive to your _lsapi.conf_ file as follows: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>lsapi_engine on;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>The lsapi_engine parameter is supported in global, server, and local configurations. Therefore, it can be enabled/disabled globally, only for the server, and also only for a specific location.</p><p>The LSPHP handler can be enabled using the lsapi_handler directive. The lsapi_handler directive tells NGINX that the files with .php extension should be handled by NGINX LSAPI Module with the selected handler.</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code> lsapi_handler application/x-httpd-lsphp;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>If no handler is explicitly set for a request, the specified content type will be used as the handler name, therefore, please disable php.conf or any other PHP handler for using NGINX LSAPI Module. In this example application/x-httpd-lsphp is a default handler by which NGINX LSAPI Module processes requests with the lsphp binary from <em>/usr/local/bin/</em> directory.</p><p>The final lsapi.conf configuration might look like this:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>server {
	listen          80;
	server_name     testlsapi.com;
	root            /home/testlsapi/public_html;

	location ~ \.php$ {
		lsapi_engine    on;
		lsapi_handler    application/x-httpd-lsphp;
		lsapi_user       testlsapi;
	}

	error_page  500 502 503 504  /50x.html;
	location = /50x.html {
		root   html;
	}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>In order for NGINX LSAPI Module to work lsapi.conf should be loaded to NGINX through <a href="https://nginx.org/en/docs/ngx_core_module.html#include" target="_blank" rel="noopener noreferrer">Include</a> directive.</p><p>For a more detailed description of the module directives please visit the <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#configuration-references-2" class="router-link-active router-link-exact-active">Configuration reference</a>. For the installation guide for NGINX LSAPI Module please visit <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#installation-3" class="router-link-active router-link-exact-active">Installation</a>.</p><h4 id="configuration-references-1" tabindex="-1"><a class="header-anchor" href="#configuration-references-1" aria-hidden="true">#</a> Configuration references</h4><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#nginx-lsapi-module-customization" class="router-link-active router-link-exact-active">NGINX LSAPI Module customization</a>:</p><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-enabled" class="router-link-active router-link-exact-active">lsapi_engine</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-sock-path" class="router-link-active router-link-exact-active">lsapi_sock_path</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-per-user-1" class="router-link-active router-link-exact-active">lsapi_per_user</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-disable-reject-mode-1" class="router-link-active router-link-exact-active">lsapi_disable_reject_mode</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-terminate-backends-on-exit" class="router-link-active router-link-exact-active">lsapi_terminate_backends_on_exit</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-avoid-zombies" class="router-link-active router-link-exact-active">lsapi_avoid_zombies</a></li></ul><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#tuning-lsphp-backend-1" class="router-link-active router-link-exact-active">Tuning LSPHP backend</a>:</p><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-set-env-1" class="router-link-active router-link-exact-active">lsapi_set_env</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-set-env-path-1" class="router-link-active router-link-exact-active">lsapi_set_env_path</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-children-1" class="router-link-active router-link-exact-active">lsapi_backend_children</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-connect-tries-1" class="router-link-active router-link-exact-active">lsapi_backend_connect_tries</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-max-process-time-1" class="router-link-active router-link-exact-active">lsapi_backend_max_process_time</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-pgrp-max-idle-1" class="router-link-active router-link-exact-active">lsapi_backend_pgrp_max_idle</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-use-own-log-1" class="router-link-active router-link-exact-active">lsapi_backend_use_own_log</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-common-own-log-1" class="router-link-active router-link-exact-active">lsapi_backend_common_own_log</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-coredump-1" class="router-link-active router-link-exact-active">lsapi_backend_coredump</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-accept-notify-1" class="router-link-active router-link-exact-active">lsapi_backend_accept_notify</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-pgrp-max-reqs-1" class="router-link-active router-link-exact-active">lsapi_backend_pgrp_max_reqs</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-pgrp-max-crashes-1" class="router-link-active router-link-exact-active">lsapi_backend_pgrp_max_crashes</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-loglevel-info-1" class="router-link-active router-link-exact-active">lsapi_backend_loglevel_info</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-oom-score-adj-1" class="router-link-active router-link-exact-active">lsapi_backend_oom_score_adj</a></li></ul><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#connection-pool-mode-1" class="router-link-active router-link-exact-active">Connection pool mode</a>:</p><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-with-connection-pool" class="router-link-active router-link-exact-active">lsapi_with_connection_pool</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-pool-size" class="router-link-active router-link-exact-active">lsapi_pool_size</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-max-idle-1" class="router-link-active router-link-exact-active">lsapi_backend_max_idle</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-max-reqs-1" class="router-link-active router-link-exact-active">lsapi_backend_max_reqs</a></li></ul><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#criu-support-2" class="router-link-active router-link-exact-active">CRIU support</a>:</p><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-criu" class="router-link-active router-link-exact-active">lsapi_criu</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-criu-socket-path" class="router-link-active router-link-exact-active">lsapi_criu_socket_path</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-criu-imgs-dir-path" class="router-link-active router-link-exact-active">lsapi_criu_imgs_dir_path</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-backend-initial-start-1" class="router-link-active router-link-exact-active">lsapi_backend_initial_start</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-criu-use-shm-1" class="router-link-active router-link-exact-active">lsapi_criu_use_shm</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-reset-criu-on-restart" class="router-link-active router-link-exact-active">lsapi_reset_criu_on_restart</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-criu-debug-1" class="router-link-active router-link-exact-active">lsapi_criu_debug</a></li></ul><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#php-configuration-management-1" class="router-link-active router-link-exact-active">PHP configuration management</a>:</p><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-process-phpini-1" class="router-link-active router-link-exact-active">lsapi_process_phpini</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-phpini-1" class="router-link-active router-link-exact-active">lsapi_phpini</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-phprc-1" class="router-link-active router-link-exact-active">lsapi_phprc</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-tmpdir-1" class="router-link-active router-link-exact-active">lsapi_tmpdir</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-enable-user-ini-1" class="router-link-active router-link-exact-active">lsapi_enable_user_ini</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-user-ini-homedir-1" class="router-link-active router-link-exact-active">lsapi_user_ini_homedir</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-mod-php-behaviour-1" class="router-link-active router-link-exact-active">lsapi_mod_php_behaviour</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-param" class="router-link-active router-link-exact-active">lsapi_param</a></li></ul><p><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#security-1" class="router-link-active router-link-exact-active">Security</a>:</p><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-use-suexec-1" class="router-link-active router-link-exact-active">lsapi_use_suexec</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-user" class="router-link-active router-link-exact-active">lsapi_user</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-uid-gid-1" class="router-link-active router-link-exact-active">lsapi_uid_gid</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-paranoid-1" class="router-link-active router-link-exact-active">lsapi_paranoid</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lsapi-check-document-root-1" class="router-link-active router-link-exact-active">lsapi_check_document_root</a></li></ul><h4 id="nginx-lsapi-module-customization" tabindex="-1"><a class="header-anchor" href="#nginx-lsapi-module-customization" aria-hidden="true">#</a> <strong>NGINX LSAPI Module customization</strong></h4><h4 id="lsapi-engine-1" tabindex="-1"><a class="header-anchor" href="#lsapi-engine-1" aria-hidden="true">#</a> <strong>lsapi_engine</strong></h4><p><strong>Syntax</strong> : lsapi_engine [on/off] <strong>Example</strong> : lsapi_engine on; <strong>Default</strong> : off <strong>Context</strong> : main config, server config, local config. <strong>Type</strong> : Mandatory</p><p><strong>Description</strong> : Enable/disable LSAPI module for nginx, server, or local directory.</p><hr><h4 id="lsapi-sock-path" tabindex="-1"><a class="header-anchor" href="#lsapi-sock-path" aria-hidden="true">#</a> <strong>lsapi_sock_path</strong></h4><p><strong>Syntax</strong> : lsapi_sock_path [path] <strong>Example</strong> : lsapi_sock_path /var/ngx_lsapi; <strong>Default</strong> : <code>/var/ngx_lsapi</code><strong>Context</strong> : main config <strong>Type</strong> : Optional</p><p><strong>Description:</strong> Path to backend lsphp sockets. By default <code>/var/ngx_lsapi</code></p><hr><h4 id="lsapi-per-user-1" tabindex="-1"><a class="header-anchor" href="#lsapi-per-user-1" aria-hidden="true">#</a> <strong>lsapi_per_user</strong></h4><p><strong>Syntax</strong> : lsapi_per_user [on/off] <strong>Example</strong> : lsapi_per_user off; <strong>Default</strong> : off <strong>Context</strong> : server config, location config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Invoke the master lsPHP process not per VirtualHost, but per account. When On, invoke backend not per VirtualHost but per account. Default value is off. It is possible, for example, to set it to On in global config file and to Off in config files of some particular Virtual Hosts. Then these Virtual Hosts will have a dedicated backend process, while others will have backend processes shared on account basis.</p><hr><h4 id="lsapi-disable-reject-mode-1" tabindex="-1"><a class="header-anchor" href="#lsapi-disable-reject-mode-1" aria-hidden="true">#</a> <strong>lsapi_disable_reject_mode</strong></h4><p><strong>Syntax</strong> : lsapi_disable_reject_mode [on/off] <strong>Example</strong> : lsapi_disable_reject_mode on; <strong>Default</strong> : off <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : If a new HTTP request is coming to LSPHP daemon when all LSPHP workers are still busy, it can process this situation in two different ways. In REJECT mode LSPHP daemon will reject such requests immediately. Otherwise, in legacy mode, LSPHP daemon will put this request into an infinite queue, until one of LSPHP daemons becomes free. When a HTTP request is rejected in REJECT mode, mod_lsapi will write the following message into the NGINX error.log: <code>Connect to backend rejected</code>, and the client will receive a 507 HTTP response. By default, the LSPHP daemon in CloudLinux OS uses the REJECT mode. It can be switched off with this option.</p><hr><h4 id="lsapi-terminate-backends-on-exit-1" tabindex="-1"><a class="header-anchor" href="#lsapi-terminate-backends-on-exit-1" aria-hidden="true">#</a> <strong>lsapi_terminate_backends_on_exit</strong></h4><p><strong>Syntax</strong> : lsapi_terminate_backends_on_exit [on/off] <strong>Example</strong> : lsapi_terminate_backends_on_exit on; <strong>Default</strong> : on <strong>Context</strong> : main config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : nginx.conf, on - stop lsphp services on nginx restart, off - leave live started lsphp services on nginx restart (for php+opcache). The lsphp will not restart, even if NGINX gets restarted.</p><hr><h4 id="lsapi-avoid-zombies-1" tabindex="-1"><a class="header-anchor" href="#lsapi-avoid-zombies-1" aria-hidden="true">#</a> <strong>lsapi_avoid_zombies</strong></h4><p><strong>Syntax</strong> : lsapi_avoid_zombies [on/off] <strong>Example</strong> : lsapi_avoid_zombies on; <strong>Default</strong> : off <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Enable or disable a mechanism to avoid the creation of zombie processes by lsphp. The default value is Off.</p><hr><h4 id="lsapi-starter-sock" tabindex="-1"><a class="header-anchor" href="#lsapi-starter-sock" aria-hidden="true">#</a> <strong>lsapi_starter_sock</strong></h4><p><strong>Syntax</strong> : lsapi_starter_sock [path] <strong>Example</strong> : lsapi_starter_sock /var/run/lsapi-starter.sock; <strong>Default</strong> : /var/ngx_lsapi/starter.sock <strong>Context</strong> : main config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : This parameter configures the socket address for the lsphp backend spawner process.</p><hr><h4 id="lsapi-starter-log" tabindex="-1"><a class="header-anchor" href="#lsapi-starter-log" aria-hidden="true">#</a> <strong>lsapi_starter_log</strong></h4><p><strong>Syntax</strong> : lsapi_starter_log [path] <strong>Example</strong> : lsapi_starter_log /var/log/lsapi-starter.log; <strong>Default</strong> : - <strong>Context</strong> : main config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : This parameter configures the log file address for the lsphp backend spawner process.</p><hr><h4 id="lsapi-log" tabindex="-1"><a class="header-anchor" href="#lsapi-log" aria-hidden="true">#</a> <strong>lsapi_log</strong></h4><p><strong>Syntax</strong> : lsapi_log [path] <strong>Example</strong> : lsapi_log /var/log/lsapi.log; <strong>Default</strong> : - <strong>Context</strong> : main config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : This parameter configures the log file address for the NGINX LSAPI module context. <strong>Note</strong> : This parameter only works if the NGINX LSAPI module is built with the NGX_LSAPI_CUSTOM_LOGGER flag. Otherwise, the NGINX logger will be used for LSAPI module logging.</p><hr><h4 id="tuning-lsphp-backend-1" tabindex="-1"><a class="header-anchor" href="#tuning-lsphp-backend-1" aria-hidden="true">#</a> <strong>Tuning LSPHP backend</strong></h4><h4 id="lsapi-set-env-1" tabindex="-1"><a class="header-anchor" href="#lsapi-set-env-1" aria-hidden="true">#</a> <strong>lsapi_set_env</strong></h4><p><strong>Syntax</strong> : lsapi_set_env [var] [value] <strong>Example</strong>: lsapi_set_env TMP &quot;/var/lsphp-tmp&quot;; <strong>Default</strong> : - <strong>Context</strong> : main config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Pass an environment variable to lsphp. By default the lsphp environment has only TEMP, TMP and PATH variables set. Note: PATH env var default &quot;/usr/local/bin:/usr/bin:/bin&quot; cannot be changed because of security reasons.</p><hr><h4 id="lsapi-set-env-path-1" tabindex="-1"><a class="header-anchor" href="#lsapi-set-env-path-1" aria-hidden="true">#</a> <strong>lsapi_set_env_path</strong></h4><p><strong>Syntax</strong> : lsapi_set_env_path [path(s)] <strong>Default</strong> : lsapi_set_env_path /usr/local/bin:/usr/bin:/bin <strong>Context</strong> : main config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Change PATH variable in the environment of lsphp processes. Default path /usr/local/bin:/usr/bin:/bin will be used if not set.</p><hr><h4 id="lsapi-backend-children-1" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-children-1" aria-hidden="true">#</a> <strong>lsapi_backend_children</strong></h4><p><strong>Syntax</strong> : lsapi_backend_children [number] <strong>Example</strong> : lsapi_backend_children 300; <strong>Default</strong> : 120 <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Sets the maximum number of simultaneously running child backend processes. Optional - a default directive value is equal to 120.</p><hr><h4 id="lsapi-backend-connect-tries-1" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-connect-tries-1" aria-hidden="true">#</a> <strong>lsapi_backend_connect_tries</strong></h4><p><strong>Syntax</strong> : lsapi_backend_connect_tries [number] <strong>Example</strong> : lsapi_backend_connect_tries 20; <strong>Default</strong> : 10 <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Number of retries for connections to the lsPHP daemon.</p><hr><h4 id="lsapi-backend-max-process-time-1" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-max-process-time-1" aria-hidden="true">#</a> <strong>lsapi_backend_max_process_time</strong></h4><p><strong>Syntax</strong> : lsapi_backend_max_process_time [number] <strong>Example</strong> : lsapi_backend_max_process_time 300; <strong>Default</strong> : 300 <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Sets the env variable LSAPI_MAX_PROCESS_TIME. Optional - default value is 300. Timeout to kill runaway processes.</p><hr><h4 id="lsapi-backend-common-own-log-1" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-common-own-log-1" aria-hidden="true">#</a> <strong>lsapi_backend_common_own_log</strong></h4><p><strong>Syntax</strong> : lsapi_backend_common_own_log [on/off] <strong>Example</strong> : lsapi_backend_common_own_log on; <strong>Default</strong> : off <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : It will be used only when lsapi_backend_use_own_log is set to On. On-backend processes of the all virtual hosts will share the common log file. Off - every virtual host will have its own backend log file.</p><hr><h4 id="lsapi-backend-use-own-log-1" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-use-own-log-1" aria-hidden="true">#</a> <strong>lsapi_backend_use_own_log</strong></h4><p><strong>Syntax</strong> : lsapi_backend_use_own_log [on/off] <strong>Example</strong> : lsapi_backend_use_own_log on; <strong>Default</strong> : off <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Redirecting log output of backend processes from NGINX error.log to dedicated log file or files, depending on the value of the lsapi_backend_common_own_log option. If off, use the NGINX error log file for backend output, or a separate file otherwise.</p><hr><h4 id="lsapi-backend-pgrp-max-crashes-1" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-pgrp-max-crashes-1" aria-hidden="true">#</a> <strong>lsapi_backend_pgrp_max_crashes</strong></h4><p><strong>Syntax</strong> : lsapi_backend_pgrp_max_crashes [number] <strong>Example</strong> : lsapi_backend_pgrp_max_crashes 300; <strong>Default</strong> : 300 <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Controls how many crashes of its worker processes a control process will detect before it exits. Should be more or equal to 0. In the case of a wrong format, a default value will be used. Optional, the default value is 0, which means an unlimited number of crashes.</p><hr><h4 id="lsapi-backend-pgrp-max-idle-1" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-pgrp-max-idle-1" aria-hidden="true">#</a> <strong>lsapi_backend_pgrp_max_idle</strong></h4><p><strong>Syntax</strong> : lsapi_backend_pgrp_max_idle [number] <strong>Example</strong> : lsapi_backend_pgrp_max_idle 30; <strong>Default</strong> : 30 <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Sets env variable LSAPI_PGRP_MAX_IDLE, in seconds. Controls how long a control process will wait for a new request before it exits. 0 stands for infinite. Optional, default value is 30. Should be more or equal to 0.</p><hr><h4 id="lsapi-backend-pgrp-max-reqs-1" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-pgrp-max-reqs-1" aria-hidden="true">#</a> <strong>lsapi_backend_pgrp_max_reqs</strong></h4><p><strong>Syntax</strong> : lsapi_backend_pgrp_max_reqs [number] <strong>Example</strong> : lsapi_backend_pgrp_max_reqs 0; <strong>Default</strong> : 0 <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Controls how many requests a control process will process before it exits. Should be more or equal to 0. In the case of a wrong format, the default value will be used. Optional, the default value is 0, which means an unlimited number of requests.</p><hr><h4 id="lsapi-backend-loglevel-info-1" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-loglevel-info-1" aria-hidden="true">#</a> <strong>lsapi_backend_loglevel_info</strong></h4><p><strong>Syntax</strong>: lsapi_backend_loglevel_info [on/off] <strong>Example</strong>: lsapi_backend_loglevel_info on; <strong>Example</strong>: off <strong>Context</strong>: server config, location config <strong>Type</strong> : Optional</p><p><strong>Description</strong>: Controls which log level will be used to write PHP warnings and notices into NGINX’s error.log. Optional, the default value is <code>off</code>. In that case, the <code>warn</code> log level will be used. Otherwise, with <code>on</code> value, the <code>info</code> log level will be used.</p><hr><h4 id="lsapi-backend-oom-score-adj-1" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-oom-score-adj-1" aria-hidden="true">#</a> <strong>lsapi_backend_oom_score_adj</strong></h4><p><strong>Syntax</strong> : lsapi_backend_oom_score_adj [number] <strong>Example</strong> : lsapi_backend_oom_score_adj 100; <strong>Default</strong> : 0 <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : This option can apply oom_score_adj values for PHP processes created by mod_lsapi. Value is an integer in the -1000 to 1000 range. The lower the value, the lower the chance that the process will be killed. When your server becomes low on free memory and an OOM killer is invoked, then it may be desirable for lsphp processes to be sacrificed to free up memory. To do this, you need to set oom_score_adj to a large value. For more information on setting a proper value for oom_score_adj, see the page https://man7.org/linux/man-pages/man5/proc.5.html</p><hr><h4 id="lsapi-dump-debug-info" tabindex="-1"><a class="header-anchor" href="#lsapi-dump-debug-info" aria-hidden="true">#</a> <strong>lsapi_dump_debug_info</strong></h4><p><strong>Syntax</strong> : lsapi_dump_debug_info [on/off] <strong>Example</strong> : lsapi_dump_debug_info on; <strong>Default</strong> : off <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Enable or not lsphp backend debug information dump.</p><hr><h4 id="lsapi-backend-accept-notify-1" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-accept-notify-1" aria-hidden="true">#</a> <strong>lsapi_backend_accept_notify</strong></h4><p><strong>Syntax</strong> : lsapi_backend_accept_notify [on/off] <strong>Example</strong> : lsapi_backend_accept_notify on; <strong>Default</strong> : off <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Switch LSAPI_ACCEPT_NOTIFY mode for lsphp. This option can be used both in Global and VirtualHost scopes. This mode is incompatible with PHP 4.4.</p><hr><h4 id="lsapi-backend-coredump-1" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-coredump-1" aria-hidden="true">#</a> <strong>lsapi_backend_coredump</strong></h4><p><strong>Syntax</strong> : lsapi_backend_coredump [on/off] <strong>Example</strong> : lsapi_backend_coredump on; <strong>Default</strong> : off <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : env variable LSAPI_ALLOW_CORE_DUMP (On or Off). Pass LSAPI_ALLOW_CORE_DUMP to lsphp or not. If it is passed - a core dump on lsphp crash will be created. Off by default. By default LSAPI application will not leave a core dump file when crashed. If you want to have LSAPI PHP dump a core dump file, you should set this environment variable. If set, regardless of the value is has been set to, core dump files will be created under the directory that the PHP script is in.</p><hr><h4 id="lsapi-pwd-disabled" tabindex="-1"><a class="header-anchor" href="#lsapi-pwd-disabled" aria-hidden="true">#</a> <strong>lsapi_pwd_disabled</strong></h4><p><strong>Syntax</strong> : lsapi_pwd_disabled [on/off] <strong>Example</strong> : lsapi_pwd_disabled on; <strong>Default</strong> : off <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : To disable the addition of the PWD variable. The default value is Off. If set to On, the PWD variable will not be added to a backend environment.</p><hr><h4 id="lsapi-handler" tabindex="-1"><a class="header-anchor" href="#lsapi-handler" aria-hidden="true">#</a> <strong>lsapi_handler</strong></h4><p><strong>Syntax</strong> : lsapi_handler [string] <strong>Example</strong> : lsapi_handler application/x-httpd-lsphp; <strong>Default</strong> : - <strong>Context</strong> : server config <strong>Type</strong> : Mandatory</p><p><strong>Description</strong> : Sets LSPHP handler for server (virtual host) configuration.</p><hr><h4 id="connection-pool-mode-1" tabindex="-1"><a class="header-anchor" href="#connection-pool-mode-1" aria-hidden="true">#</a> <strong>Connection pool mode</strong></h4><h4 id="lsapi-with-connection-pool-1" tabindex="-1"><a class="header-anchor" href="#lsapi-with-connection-pool-1" aria-hidden="true">#</a> <strong>lsapi_with_connection_pool</strong></h4><p><strong>Syntax</strong> : lsapi_with_connection_pool [on/off] <strong>Example</strong> : lsapi_with_connection_pool off; <strong>Default</strong> : on <strong>Context</strong> : main config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Enable/disable LSAPI connection pool mode.</p><hr><h4 id="lsapi-backend-max-idle-1" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-max-idle-1" aria-hidden="true">#</a> <strong>lsapi_backend_max_idle</strong></h4><p><strong>Syntax</strong> : lsapi_backend_max_idle [number] <strong>Example</strong> : lsapi_backend_max_idle 300; <strong>Default</strong> : 300 <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : It is relevant only with lsapi_with_connection_pool option switched on. Controls how long a worker process will wait for a new request before it exits. 0 stands for infinite. Should be more or equal to 0. In the case of a wrong format the default value will be used. Optional, default value is 300.</p><hr><h4 id="lsapi-backend-max-reqs-1" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-max-reqs-1" aria-hidden="true">#</a> <strong>lsapi_backend_max_reqs</strong></h4><p><strong>Synt-backendax</strong>-1 : lsapi_backend_max_reqs [number] -backend <strong>-1Example</strong> : lsapi_backend_max_reqs 20000; -backend<strong>Default-1</strong> : 10000 <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : It is relevant only with lsapi_with_connection_pool option switched on. Controls how many requests a worker process will process before it exits. Should be more than 0. In the case of a wrong format the default value will be used. Optional, default value is 10000.</p><hr><h4 id="lsapi-pool-size" tabindex="-1"><a class="header-anchor" href="#lsapi-pool-size" aria-hidden="true">#</a> <strong>lsapi_pool_size</strong></h4><p><strong>Syntax</strong> : lsapi_pool_size [number] <strong>Example</strong> : lsapi_pool_size 20; <strong>Default</strong> : 50 <strong>Context</strong> : main config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : The parameter sets the connection pool size for each virtual host.</p><hr><h4 id="criu-support-2" tabindex="-1"><a class="header-anchor" href="#criu-support-2" aria-hidden="true">#</a> <strong>CRIU support</strong></h4><h4 id="lsapi-criu-1" tabindex="-1"><a class="header-anchor" href="#lsapi-criu-1" aria-hidden="true">#</a> <strong>lsapi_criu</strong></h4><p><strong>Syntax</strong> : lsapi_criu [on/off] <strong>Example</strong> : lsapi_criu on; <strong>Default</strong> : off <strong>Context</strong> : main config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Enable/disable CRIU for lsphp freezing. Default: Off.</p><hr><h4 id="lsapi-criu-socket-path-1" tabindex="-1"><a class="header-anchor" href="#lsapi-criu-socket-path-1" aria-hidden="true">#</a> <strong>lsapi_criu_socket_path</strong></h4><p><strong>Syntax</strong> : lsapi_criu_socket_path [path] <strong>Example</strong> : lsapi_criu_socket_path /var/run/criu/criu_service.socket; <strong>Default</strong> : /var/run/criu/criu_service.socket <strong>Context</strong> : main config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Set path to socket for communication with criu service.</p><hr><h4 id="lsapi-criu-imgs-dir-path-1" tabindex="-1"><a class="header-anchor" href="#lsapi-criu-imgs-dir-path-1" aria-hidden="true">#</a> <strong>lsapi_criu_imgs_dir_path</strong></h4><p><strong>Syntax</strong> : lsapi_criu_imgs_dir_path [path] <strong>Example</strong> : lsapi_criu_imgs_dir_path /var/ngx_lsapi/criu; <strong>Default</strong> : /var/ngx_lsapi/criu <strong>Context</strong> : main config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Path to the folder where images of frozen PHP will be stored. Should be a path.</p><hr><h4 id="lsapi-criu-use-shm-1" tabindex="-1"><a class="header-anchor" href="#lsapi-criu-use-shm-1" aria-hidden="true">#</a> <strong>lsapi_criu_use_shm</strong></h4><p><strong>Syntax</strong> : lsapi_criu_use_shm [off/signals] <strong>Example</strong> : lsapi_criu_use_shm signals; <strong>Default</strong> : off <strong>Context</strong> : main config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : The method of request counting. Off - use shared memory. Signals - use signals from child processes to parents. Default: off</p><hr><h4 id="lsapi-reset-criu-on-restart" tabindex="-1"><a class="header-anchor" href="#lsapi-reset-criu-on-restart" aria-hidden="true">#</a> <strong>lsapi_reset_criu_on_restart</strong></h4><p><strong>Syntax</strong> : lsapi_reset_criu_on_restart [on/off] <strong>Example</strong> : lsapi_reset_criu_on_restart off; <strong>Default</strong> : off <strong>Context</strong> : main config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : This option allows cleaning all CRIU images on NGINX restart. Setting lsapi_reset_criu_on_restart to on means that on each NGINX restart the CRIU images, which are stored in the directory specified by lsapi_criu_imgs_dir_path directive, will be recreated upon a new request to domain (only after restart).</p><hr><h4 id="lsapi-criu-debug-1" tabindex="-1"><a class="header-anchor" href="#lsapi-criu-debug-1" aria-hidden="true">#</a> <strong>lsapi_criu_debug</strong></h4><p><strong>Syntax</strong>: lsapi_criu_debug [on/off] <strong>Example</strong>: lsapi_criu_debug off; <strong>Default</strong> : off <strong>Context</strong> : main config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Enable/disable CRIU related debug logging.</p><hr><h4 id="lsapi-backend-initial-start-1" tabindex="-1"><a class="header-anchor" href="#lsapi-backend-initial-start-1" aria-hidden="true">#</a> <strong>lsapi_backend_initial_start</strong></h4><p><strong>Syntax</strong> : lsapi_backend_initial_start [number] <strong>Example</strong> : lsapi_backend_initial_start 15; <strong>Default</strong> : 0 <strong>Context</strong> : main config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Number of requests to virtualhost, when lsphp will be freezed. Default: 0 - means disable freezing.</p><hr><h4 id="php-configuration-management-1" tabindex="-1"><a class="header-anchor" href="#php-configuration-management-1" aria-hidden="true">#</a> <strong>PHP configuration management</strong></h4><h4 id="lsapi-process-phpini-1" tabindex="-1"><a class="header-anchor" href="#lsapi-process-phpini-1" aria-hidden="true">#</a> <strong>lsapi_process_phpini</strong></h4><p><strong>Syntax</strong> : lsapi_process_phpini [on/off] <strong>Example</strong> : lsapi_process_phpini on; <strong>Default</strong> : off <strong>Context</strong> : server config, location config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Enable or disable phpini_* directive processing. Default value is off.</p><hr><h4 id="lsapi-phpini-1" tabindex="-1"><a class="header-anchor" href="#lsapi-phpini-1" aria-hidden="true">#</a> <strong>lsapi_phpini</strong></h4><p><strong>Syntax</strong> : lsapi_phpini [value] <strong>Example</strong>: lsapi_phpini /usr/home/lsapiuser/public_html/php.ini; <strong>Default</strong> : - <strong>Context</strong> : server config, location <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Sets custom php.ini within server or location configuration. Absolute file path is required. When lsapi_process_phpini configuration directive is switched to Off, the value for the lsapi_phpini will be silently ignored.</p><hr><h4 id="lsapi-phprc-1" tabindex="-1"><a class="header-anchor" href="#lsapi-phprc-1" aria-hidden="true">#</a> <strong>lsapi_phprc</strong></h4><p><strong>Syntax</strong> : lsapi_phprc [No | Env | Auto | DocRoot] <strong>Example</strong> : lsapi_phprc No; <strong>Default</strong> : No <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : The value of PHPRC env variable. Special values are &quot;No&quot;, &quot;Env&quot;, &quot;Auto&quot; and &quot;DocRoot&quot;. Default value is &quot;No&quot; - without PHPRC at all. The &quot;Auto&quot; value stands for php.ini from DocumentRoot of the corresponding VirtualHost if it is present, or from the user&#39;s home directory otherwise &quot;DocRoot&quot; value stands for php.ini from DocumentRoot of the corresponding VirtualHost. &quot;Env&quot; value for using PHPRC from the environment, to set it with SetEnv config option, for example: lsapi_phprc No; lsapi_phprc Auto; lsapi_phprc DocRoot; lsapi_phprc Env; lsapi_phprc /etc/;</p><hr><h4 id="lsapi-tmpdir-1" tabindex="-1"><a class="header-anchor" href="#lsapi-tmpdir-1" aria-hidden="true">#</a> <strong>lsapi_tmpdir</strong></h4><p><strong>Syntax</strong> : lsapi_tmpdir [path] <strong>Example</strong> : lsapi_tmpdir /usr/tmp; <strong>Default</strong> : /tmp <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Set an alternate request body temporary files directory.</p><hr><h4 id="lsapi-enable-user-ini-1" tabindex="-1"><a class="header-anchor" href="#lsapi-enable-user-ini-1" aria-hidden="true">#</a> <strong>lsapi_enable_user_ini</strong></h4><p><strong>Syntax</strong> : lsapi_enable_user_ini [on/off] <strong>Example</strong> : lsapi_enable_user_ini off; <strong>Default</strong> : off <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Enable .user.ini files for backend. Same as suphp, php-fpm and fcgid mechanism of .user.ini. Default value is off.</p><hr><h4 id="lsapi-user-ini-homedir-1" tabindex="-1"><a class="header-anchor" href="#lsapi-user-ini-homedir-1" aria-hidden="true">#</a> <strong>lsapi_user_ini_homedir</strong></h4><p><strong>Syntax</strong> : lsapi_user_ini_homedir [on/off] <strong>Example</strong> : lsapi_user_ini_homedir on; <strong>Default</strong> : off <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : If the lsapi_enable_user_ini option is set to On, then enable/disable processing .user.ini file in the home directory also. The default value is Off.</p><hr><h4 id="lsapi-mod-php-behaviour-1" tabindex="-1"><a class="header-anchor" href="#lsapi-mod-php-behaviour-1" aria-hidden="true">#</a> <strong>lsapi_mod_php_behaviour</strong></h4><p><strong>Syntax</strong> : lsapi_mod_php_behaviour [on/off] <strong>Example</strong> : lsapi_mod_php_behaviour off; <strong>Default</strong> : on <strong>Context</strong> : server config, location config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : on/off - disable php_* directives, default On.</p><hr><h4 id="lsapi-param" tabindex="-1"><a class="header-anchor" href="#lsapi-param" aria-hidden="true">#</a> <strong>lsapi_param</strong></h4><p><strong>Syntax</strong> : lsapi_param [var] [value] <strong>Example</strong>: lsapi_param PHP_ADMIN_VALUE &quot;memory_limit=1024M&quot;; <strong>Default</strong> : - <strong>Context</strong> : server config, location config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Sets a parameter that should be passed to the LSPHP handler. The value can contain text, variables, and their combinations. Supported directives: PHP_ADMIN_VALUE PHP_VALUE PHP_ADMIN_FLAG PHP_FLAG Examples: lsapi_param PHP_ADMIN_VALUE &quot;memory_limit=1024M \n max_execution_time=600&quot;; lsapi_param PHP_FLAG &quot;display_startup_errors=on&quot;; lsapi_param PHP_ADMIN_FLAG &quot;html_errors=on&quot;; lsapi_param PHP_VALUE &quot;max_file_uploads=20&quot;; lsapi_param QUERY_STRING $query_string; lsapi_param REQUEST_METHOD $request_method; lsapi_param CONTENT_TYPE $content_type; lsapi_param CONTENT_LENGTH $content_length;</p><hr><h4 id="security-1" tabindex="-1"><a class="header-anchor" href="#security-1" aria-hidden="true">#</a> <strong>Security</strong></h4><h4 id="lsapi-use-suexec-1" tabindex="-1"><a class="header-anchor" href="#lsapi-use-suexec-1" aria-hidden="true">#</a> <strong>lsapi_use_suexec</strong></h4><p><strong>Syntax</strong> : lsapi_use_suexec [on/off] <strong>Example</strong> : lsapi_use_suexec on; <strong>Default</strong> : on <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Enable or disable suexec usage with a target user.</p><hr><h4 id="lsapi-user" tabindex="-1"><a class="header-anchor" href="#lsapi-user" aria-hidden="true">#</a> <strong>lsapi_user</strong></h4><p><strong>Syntax</strong> : lsapi_user [username] [group] <strong>Example</strong> : lsapi_user testlsapi testlsapi; <strong>Default</strong> : - <strong>Context</strong> : server config, local config <strong>Type</strong> : Mandatory</p><p><strong>Description</strong> : Set user &amp; group for requests. This parameter can take only one argument for username or two arguments for username and group.</p><hr><h4 id="lsapi-paranoid-1" tabindex="-1"><a class="header-anchor" href="#lsapi-paranoid-1" aria-hidden="true">#</a> <strong>lsapi_paranoid</strong></h4><p><strong>Syntax</strong> : lsapi_paranoid [on/off] <strong>Example</strong> : lsapi_paranoid on; <strong>Default</strong> : off <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Enable or disable permission checking for the target php scripts.</p><hr><h4 id="lsapi-check-owner" tabindex="-1"><a class="header-anchor" href="#lsapi-check-owner" aria-hidden="true">#</a> <strong>lsapi_check_owner</strong></h4><p><strong>Syntax</strong> : lsapi_check_owner [on/off] <strong>Example</strong> : lsapi_check_owner on; <strong>Default</strong> : off <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Enable or disable checking the owner of the target PHP scripts.</p><hr><h4 id="lsapi-check-document-root-1" tabindex="-1"><a class="header-anchor" href="#lsapi-check-document-root-1" aria-hidden="true">#</a> <strong>lsapi_check_document_root</strong></h4><p><strong>Syntax</strong> : lsapi_check_document_root [on/off] <strong>Example</strong> : lsapi_check_document_root on; <strong>Default</strong> : off <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Enable or disable checking the owner of DOCUMENT_ROOT.</p><hr><h4 id="lsapi-check-script" tabindex="-1"><a class="header-anchor" href="#lsapi-check-script" aria-hidden="true">#</a> <strong>lsapi_check_script</strong></h4><p><strong>Syntax</strong> : lsapi_check_script [on/off] <strong>Example</strong> : lsapi_check_script on; <strong>Default</strong> : off <strong>Context</strong> : server config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Enable or disable checking the owner of target php scripts before sending the request to the lsphp backend. Optional, the default value is On.</p><hr><h4 id="lsapi-uid-gid-1" tabindex="-1"><a class="header-anchor" href="#lsapi-uid-gid-1" aria-hidden="true">#</a> <strong>lsapi_uid_gid</strong></h4><p><strong>Syntax</strong> : lsapi_uid_gid [uid] [gid] <strong>Example</strong> : lsapi_uid_gid 1001 1001; <strong>Default</strong> : - <strong>Context</strong> : local config <strong>Type</strong> : Optional</p><p><strong>Description</strong> : Set user &amp; group for requests.</p><hr><h3 id="troubleshooting-4" tabindex="-1"><a class="header-anchor" href="#troubleshooting-4" aria-hidden="true">#</a> Troubleshooting</h3><p><strong>Debugging NGINX LSAPI Module issues: error.log &amp; sulsphp.log</strong></p><p>NGINX LSAPI Module errors will be located in error_log and sulsphp_log. Note that errors can appear in both logs at the same time, and you might need to refer to both of them to solve the issue.</p><p>See the following table for more details:</p><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td><strong>error_log</strong></td><td><strong>sulsphp_log</strong></td><td><strong>Solution</strong></td></tr><tr><td>Could not connect to lsphp backend: connect to lsphp failed: 111 Connection refused. Increase memory limit for LVE ID</td><td>uid: (xxx/xxxxxxxx) gid: (xxx/xxxxxxxxxx) cmd: /usr/local/bin/lsphp</td><td>Increase pmem or vmem limits for the user uid.</td></tr><tr><td>Error sending request: ReceiveLSHeader: nothing to read from backend socket</td><td>No need to check this log.</td><td>lsphp was killed. It can be due to nginx restart or lfd. If you see this message too often - change <span class="notranslate"> lsapi_terminate_backends_on_exit </span> to <span class="notranslate"> off </span> in lsapi.conf or add to <span class="notranslate"> /etc/csf/csf.pignore </span> the following lines: <span class="notranslate"> exe:/usr/local/bin/lsphp </span> pexe:/opt/alt/php.*/usr/bin/lsphp</td></tr><tr><td>Error sending request (lsphp is killed?): ReceiveLSHeader: nothing to read from backend socket, referer: http://XXXXXXX Child process with pid: XXXXX was killed by signal: 11, core dump: 0</td><td>No need to check this log.</td><td>lsphp has crashed. Next slide will explain what to do (core dump creating). Also, check configuration options for apc and suhosin in php.ini. Once you have a core file generated at DocumentRoot contact <a href="https://cloudlinux.zendesk.com/hc/" target="_blank" rel="noopener noreferrer">https://cloudlinux.zendesk.com/</a> so we can investigate the cause.</td></tr><tr><td>Could not connect to lsphp backend: connect to lsphp failed: 111 Connection refused</td><td>file is writable by others: (///usr/local/bin/lsphp)</td><td>Incorrect lsphp file permissions. For fixing: <span class="notranslate"> chmod 755 /usr/local/bin/lsphp </span> cagefsctl --force-update.</td></tr><tr><td>Backend error on sending request(GET /XXXX HTTP/1.1); uri(/XXXX) content-length(0) (lsphp is killed?): ReceiveAckHdr: backend process reset connection: errno 104 (possibly memory limit for LVE ID XXXX too small)</td><td>uid: (xxx/xxxxxxxx) gid: (xxx/xxxxxxxxxx) cmd: /usr/local/bin/lsphp</td><td>Increase PMEM limits for the user UID.</td></tr><tr><td>Reached max children process limit: XX, extra: 0, current: XX, please increase LSAPI_CHILDREN.<br><br>Backend error on sending request(GET /XXXX HTTP/1.1); uri(/XXXX) content-length(0) (lsphp is killed?): ReceiveAckHdr: backend process reset connection: errno 104 (possibly memory limit for LVE ID XXXX too small)</td><td>uid: (xxx/xxxxxxxx) gid: (xxx/xxxxxxxxxx) cmd: /usr/local/bin/lsphp</td><td>Increase value of <span class="notranslate"> lsapi_backend_children </span> for UID in vhost.conf or globally in lsapi.conf.</td></tr><tr><td>Connect to backend rejected on sending request(POST /XXXXX HTTP/1.1); uri(/XXXXX)</td><td>No need to check this log.</td><td>Set <span class="notranslate"><code>lsapi_disable_reject_mode on</code></span> in your <span class="notranslate"><code>lsapi.conf</code></span> and reload NGINX. This way LSPHP daemon will put requests that cannot be served by LSPHP daemon right away into infinite queue, until one or more LSPHP daemon becomes free. Visit <a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#configuration-references-2" class="router-link-active router-link-exact-active">Configuration Reference</a> for more info.</td></tr></tbody></table><h3 id="criu-support-3" tabindex="-1"><a class="header-anchor" href="#criu-support-3" aria-hidden="true">#</a> CRIU Support</h3><div class="tip custom-block"><p class="custom-block-title">Note</p><p><span class="notranslate"> CloudLinux OS </span> 7, <span class="notranslate"> CloudLinux OS </span> 7 Hybrid, and <span class="notranslate"> CloudLinux OS </span> 8 only</p></div><p>CRIU is <span class="notranslate"><em>Checkpoint/Restore In Userspace</em></span> , (pronounced <span class="notranslate"> kree-oo </span> ), is a software tool for the Linux operating system. Using this tool, you can freeze a running application (or part of it) and checkpoint it as a collection of files on disk. You can then use the files to restore the application and run it exactly as it was at the time of freeze (more information on the link <a href="https://criu.org/Main_Page" target="_blank" rel="noopener noreferrer">https://criu.org/Main_Page</a> ).</p><p>NGINX LSAPI Module now supports the following parameters:</p><table><thead><tr><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td><strong>Option name</strong></td><td><strong>Description</strong></td><td><strong>Values</strong></td><td><strong>Default</strong></td></tr><tr><td>lsapi_criu</td><td>Enable/disable CRIU for lsphp freezing.</td><td><span class="notranslate"> on/off </span></td><td><span class="notranslate"> off </span></td></tr><tr><td>lsapi_criu_socket_path</td><td>Set path to socket for communication with criu service.</td><td>[path to socket]</td><td><span class="notranslate"> /var/run/criu/criu_service.socket </span></td></tr><tr><td>lsapi_backend_initial_start</td><td>Number of request when lsphp should be freezed.</td><td>[number] 0 - no freezing</td><td>0</td></tr><tr><td>lsapi_criu_use_shm</td><td>Method of requests counting. <span class="notranslate"> off </span> - use shared memory. <span class="notranslate"> Signals </span> - use signals from child processes to parent.</td><td><span class="notranslate"> off/signals </span></td><td><span class="notranslate"> off </span></td></tr><tr><td>lsapi_criu_imgs_dir_path</td><td>Path to folder where imgs of freezed PHP will be stored.</td><td>[path]</td><td><span class="notranslate"> /var/nginx-mod-lsapi/ </span></td></tr><tr><td>lsapi_criu_debug</td><td>Enable/Disable CRIU related debug logging.</td><td><span class="notranslate"> on/off </span></td><td><span class="notranslate"> off </span></td></tr></tbody></table><p>Example:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>lsapi_criu on;
lsapi_criu_socket_path /var/run/criu/criu_service.socket;
lsapi_backend_initial_start 15;
lsapi_criu_use_shm off;
lsapi_criu_debug off;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>When NGINX module NGINX LSAPI Module detects CRIU enabled (lsapi_criu On), it prepares a directory for images (on the first request of virtualhost) to store ( <span class="notranslate"> lsapi_criu_img_path /var/ngx_lsapi/criu/[dir_name] </span> ), and starts the lsphp process. Lsphp increases a counter ( <span class="notranslate"> lsapi_criu_use_shm off|Signals </span> ) via shared memory or signals, and when counter reaches the limit ( <span class="notranslate"> lsapi_backend_initial_start 15 </span> ), lsphp sends the freezing request to CRIU. The CRIU service makes images of requested processes. Lsphp will not be frozen if counter does not reach the limit. The next time when lsphp will be stopped, it will be unfrozen from the images.</p><p>The images of the processes will be saved even if NGINX is restarted. However, all images will be deleted after a server restart by default. This can be modified by setting the new path <span class="notranslate"> lsapi_criu_imgs_dir_path </span> .</p><div class="warning custom-block"><p class="custom-block-title">Important!</p><p>If php.ini or the configuration file from php.d is changed, the images must be deleted manually.</p></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>CRIU (version lower than criu-lve-3.6-1) can&#39;t correctly freeze <span class="notranslate"> lsphp </span> with <span class="notranslate"> PrivateTmp </span> enabled. For correct functionality, <span class="notranslate"> PrivateTmp </span> must be disabled in <span class="notranslate"> nginx.service file </span> .</p></div><p>To disable it, copy <span class="notranslate"><em>nginx.service</em></span> to <span class="notranslate"><em>/etc/systemd/system</em></span> and change there <span class="notranslate"> PrivateTmp:   </span></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cat nginx.service
............

[Unit]
Description=The nginx HTTP and reverse proxy server
After=network-online.target remote-fs.target nss-lookup.target
Wants=network-online.target

[Service]
Type=forking
PIDFile=/run/nginx.pid
ExecStartPre=/usr/bin/rm -f /run/nginx.pid
ExecStartPre=/usr/sbin/nginx -t
ExecStart=/usr/sbin/nginx
ExecReload=/usr/sbin/nginx -s reload
KillSignal=SIGQUIT
TimeoutStopSec=5
KillMode=mixed
PrivateTmp=false

[Install]
WantedBy=multi-user.target
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div> Alternatively, it could be technically preferable to provide a small override of the service file, rather than copying the whole new version in <span class="notranslate"> /etc/systemd/system </span><p><a href="http://www.freedesktop.org/software/systemd/man/systemd.unit.html" target="_blank" rel="noopener noreferrer">http://www.freedesktop.org/software/systemd/man/systemd.unit.html</a></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mkdir /etc/systemd/system/nginx.service.d
echo &quot;[Service]&quot; &gt;  /etc/systemd/system/nginx.service.d/nopt.conf
echo &quot;PrivateTmp=false&quot; &gt;&gt; /etc/systemd/system/nginx.service.d/nopt.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>and</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>systemctl daemon-reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="criu-installation-1" tabindex="-1"><a class="header-anchor" href="#criu-installation-1" aria-hidden="true">#</a> CRIU Installation</h4><p>CRIU is installed as a dependency to the NGINX LSAPI Module package. To activate it:</p><ol><li>Enable service and start it:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>systemctl enable criu
systemctl start criu
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><ol start="2"><li>Edit lsapi.conf file, turn CRIU On and set some defaults:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>lsapi_criu on;
lsapi_criu_socket_path /var/run/criu/criu_service.socket;
lsapi_backend_initial_start 15;
lsapi_criu_use_shm off;
lsapi_criu_debug off;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><ol start="3"><li>Restart NGINX:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service nginx restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="criu-image-cleanup-1" tabindex="-1"><a class="header-anchor" href="#criu-image-cleanup-1" aria-hidden="true">#</a> CRIU Image Cleanup</h4><ol><li>An option added to the NGINX configuration for cleaning all the images earlier saved by CRIU.</li></ol><table><thead><tr><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td><strong>Option name</strong></td><td><strong>Description</strong></td><td><strong>Value</strong></td><td><strong>Default</strong></td></tr><tr><td><span class="notranslate">lsapi_reset_criu_on_restart</span></td><td>This option allows cleaning all CRIU images on NGINX restart.</td><td><span class="notranslate"> on/off </span></td><td><span class="notranslate"> Off </span></td></tr></tbody></table><p>On the next restart of NGINX all of the images will be cleaned.</p><p>It can be enabled by writing <span class="notranslate">lsapi_reset_criu_on_restart on; </span> in <em>lsapi.conf</em></p><p>Note that this option works only if <span class="notranslate">lsapi_terminate_backends_on_exit</span> is <span class="notranslate"> on </span> (default value is <span class="notranslate"> On </span> , it is set in <em>lsapi.conf</em> too).</p><ol start="2"><li><p>If you need to clean CRIU images for one user you can simply add file to the user&#39;s directory with CRIU images (default <span class="notranslate"><em>/var/ngx_lsapi/criu/lsapi</em> * <em>criu_imgs</em></span> ). On the next restart of lsphp the images will be cleaned.</p></li><li><p>Global reset flag for cleaning all earlier saved images by CRIU.</p></li></ol><p>The current NGINX LSAPI Module allows cleaning all images only with one flag file.</p><p>Create <span class="notranslate"> /usr/share/criu/mod_lsapi/lsphp.criu.reset </span> file. Also don&#39;t forget to set permissions as follows: <span class="notranslate"> [nobody:nobody] </span> (or <span class="notranslate"> [nginx:nginx] </span> for non cPanel) and access mode [700] to the <span class="notranslate"> /usr/share/criu/mod_lsapi </span> directory.</p><p>Steps to do :</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mkdir /usr/share/criumkdir /usr/share/criu/mod_lsapi
chown nobody:nobody /usr/share/criu/mod_lsapi
touch /usr/share/criu/mod_lsapi/lsphp.criu.reset
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Upon the next incoming request to all virtual hosts, images will be recreated (deleted first and created again later - it depends on lsapi_backend_initial_start value).</p><ol start="4"><li>Аdded possibility to clean CRIU images from user space.</li></ol><p>If a user needs to clean CRIU images for lsphp, he should create a file: <span class="notranslate"> ~/mod_lsapi_reset_me_[server_name] </span>. Where <span class="notranslate"> [server_name] </span> is a server_name from the server block in the configuration file. On the next restart of lsphp, the images will be cleaned.</p><p><em>Example:</em></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cd; touch mod_lsapi_reset_me_criu.test.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>where <em>vhost.conf</em> contains: <span class="notranslate"><code>server_name criu.test.com;</code></span></p><p>This mode is enabled by default and creates a separate lsphp process for each virtual host.</p><p><span class="notranslate"><code>mod_lsapi_reset_me[server_name]</code></span> flag will not work for a user when lsapi_per_user option is <span class="notranslate"><code>on</code></span>.</p><ol start="5"><li>There is an (default <span class="notranslate"><code>off</code></span>) option in NGINX LSAPI Module that creates only one lsphp process for a user, regardless of the number of his virtual hosts. We don&#39;t recommend to use this option with CRIU, but if you use it, make sure that your virtual hosts (under the same user) have the same environment configurations. If they are not the same, this may cause undesirable lsphp process operations.</li></ol><h2 id="additional-integration-components" tabindex="-1"><a class="header-anchor" href="#additional-integration-components" aria-hidden="true">#</a> Additional integration components</h2><p>CloudLinux OS uses various ways to integrate with existing system.</p><h3 id="lve-pam-module" tabindex="-1"><a class="header-anchor" href="#lve-pam-module" aria-hidden="true">#</a> LVE PAM module</h3><p>pam_lve.so is a PAM module that sets up LVE environment. It provides easy way to setup LVE for SSH sessions, as well as other PAM enabled applications, such as crontab, su, etc.</p><p>pam_lve.so is installed by default when you convert existing server.</p><p>Installation:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install pam_lve
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>After you install <span class="notranslate"> RPM </span>, add the following line to the PAM config file for the required application:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>session    required     pam_lve.so 500 1 wheel,other
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>In this line:</p><ul><li>500 stands for minimum UID for which LVE will be setup. For any user with UID &lt; 500, LVE will not be setup. If <span class="notranslate">CageFS</span> is installed, use: <span class="notranslate"><code>cagefsctl --set-min-uid UID</code></span> to setup minimum UID. The parameter in PAM files will be ignored in that case.</li><li>1 stands for <span class="notranslate">CageFS</span> enabled (0 – <span class="notranslate">CageFS</span> disabled)</li><li>3rd optional argument defines group of users that will not be placed into LVE or <span class="notranslate">CageFS</span>. Starting with <strong>pam_lve 0.3-7</strong> you can specify multiple groups, comma separated.</li></ul><div class="tip custom-block"><p class="custom-block-title">Warning</p><p>It is crucial to place all users that su or sudo to root into that group. Otherwise, once such user gains root, user will be inside LVE, and all applications restarted by that user will be inside that user LVE as well.</p></div><div class="tip custom-block"><p class="custom-block-title">Warning</p><p>Please do not add the <code>pam_lve.so</code> in the PAM configuration for sudo. It can affect user’s work with the resource usage plugin, and Python/Node.js/PHP selector plugins.</p></div><p>For example, to enable LVE for SSH access, add that line to the <code>/etc/pam.d/sshd</code>. To enable LVE for SU, add that line to the <code>/etc/pam.d/su</code>.</p><p>By default, module will not place users with group wheel into lve. If you want to use different group to define users that will not be placed into LVE by pam_lve - pass it as the 3rd argument.</p><div class="tip custom-block"><p class="custom-block-title">Warning</p><p>Be careful when you test it, as if you incorrectly add this line to the <code>/etc/pam.d/sshd</code>, it will lock you out ssh. Don&#39;t log out of your current SSH session, until you sure it works.</p></div><p>For preventing cases when user enters under usual user (using ssh) and then tries to enter as super user (via sudo or su) - pam_sulve was created, which tries to enter to LVE=1 and leaves it right away. If action fails, user gets message:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>!!!!  WARNING: YOU ARE INSIDE LVE !!!!
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>To check if pam_sulve is enabled on the server:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>grep pam_sulve.so /etc/pam.d/*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>should not be empty.</p><h3 id="lve-wrappers" tabindex="-1"><a class="header-anchor" href="#lve-wrappers" aria-hidden="true">#</a> LVE wrappers</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#placing-programs-inside-lve" class="router-link-active router-link-exact-active">Placing programs inside LVE</a></li></ul><p>LVE wrappers are the set of tools that allow system administrator to run various users, programs &amp; daemons within Lightweight Virtual Environment. This allows system administrator to have control over system resources such program can have. Additionally it prevents misbehaving programs running within LVE to drain system resources and slow down or take down the whole system. The tools are provided by lve-wrappers RPM.</p><p>You can install them by running:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install lve-wrappers
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="placing-programs-inside-lve" tabindex="-1"><a class="header-anchor" href="#placing-programs-inside-lve" aria-hidden="true">#</a> Placing programs inside LVE</h4><p>LVE Wrappers provide two tools for placing programs inside LVE: <span class="notranslate"><code>lve_wrapper</code></span> and <code>lve_suwrapper</code>.</p><p><code>/bin/lve_wrapper</code> can be used by any non-root user, as long as that user is in group lve (see <code>/etc/groups</code> file).</p><p><strong>Syntax</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>lve_wrapper &lt;command_to_run&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>Example</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>lve_wrapper make install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>The program will be executed within LVE with ID matching user&#39;s id.</p><p><code>/bin/lve_suwrapper</code> can be used by root user or any user in group lve (see <code>/etc/groups</code> file) to execute command within specified LVE.</p><p><strong>Syntax</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>lve_suwrapper LVE_ID &lt;command_to_run&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>Example</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>lve_suwrapper 10000 /etc/init.d/postgresql start
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>Switches</strong></p><ul><li><code>-f</code> - force namespace</li><li><code>-n</code> - without namespace</li><li><code>-c</code> - remove CPU limits (requires <code>lve_wrapper</code> &gt;= 2.1.2)</li></ul><h3 id="mpm-itk" tabindex="-1"><a class="header-anchor" href="#mpm-itk" aria-hidden="true">#</a> MPM ITK</h3><p>CloudLinux OS <span class="notranslate">httpd RPM</span> comes with <span class="notranslate"> MPM ITK </span> built in. Yet, if you would like to build your own Apache, you need to apply our patch for <span class="notranslate"> MPM ITK </span></p><ul><li>Download file: <a href="https://repo.cloudlinux.com/cloudlinux/sources/da/cl-apache-patches.tar.gz" target="_blank" rel="noopener noreferrer">https://repo.cloudlinux.com/cloudlinux/sources/da/cl-apache-patches.tar.gz</a></li><li>Extract: <span class="notranslate">apache2.2-mpm-itk-seculrelve12.patch</span></li><li>And apply this patch to your Apache source code.</li></ul><p>When running <span class="notranslate"> MPM ITK </span>, you should disable <span class="notranslate">mod_hostinglimits</span>. All the functionality needed by <span class="notranslate"> MPM ITK </span> is already built into the patch.</p><p>Directives which can be used by Apache with <span class="notranslate"> ITK </span> patch:</p><ul><li><span class="notranslate"><code>AssignUserID</code></span> - uses ID as LVE ID</li><li><span class="notranslate"><code>LVEErrorCodeITK</code></span> - error code to display on LVE error (508 by default)</li><li><span class="notranslate"><code>LVERetryAfterITK</code></span> - same as <span class="notranslate"><code>LVERetryAfter</code></span> - respond with <span class="notranslate"><code>Retry-After</code></span> header when LVE error 508 occurs</li><li><span class="notranslate"><code>LVEId</code></span> - ovverides id used for LVE ID instead of <span class="notranslate"><code>AssignUserID</code></span></li><li><span class="notranslate"><code>LVEUser</code></span> - overrides user to use to retrieve LVE ID, instead of AssignUserID</li></ul><h3 id="hostinglimits-module-for-apache" tabindex="-1"><a class="header-anchor" href="#hostinglimits-module-for-apache" aria-hidden="true">#</a> HostingLimits module for Apache</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#additional-notes" class="router-link-active router-link-exact-active">Additional notes</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#installation-4" class="router-link-active router-link-exact-active">Installation</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#directives" class="router-link-active router-link-exact-active">Directives</a><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#securelinks" class="router-link-active router-link-exact-active">SecureLinks</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#skiperrors" class="router-link-active router-link-exact-active">SkipErrors</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#allowedhandlers" class="router-link-active router-link-exact-active">AllowedHandlers</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#denyhandlers" class="router-link-active router-link-exact-active">DenyHandlers</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lveerrorcode" class="router-link-active router-link-exact-active">LVEErrorCode</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lveid" class="router-link-active router-link-exact-active">LVEid</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lveuser" class="router-link-active router-link-exact-active">LVEUser</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lveusergroupid" class="router-link-active router-link-exact-active">LVEUserGroupID</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lveretryafter" class="router-link-active router-link-exact-active">LVERetryAfter</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lvesitesdebug" class="router-link-active router-link-exact-active">LVESitesDebug</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lveparsemode" class="router-link-active router-link-exact-active">LVEParseMode</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lvepathregexp" class="router-link-active router-link-exact-active">LVEPathRegexp</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lvelimitrechecktimeout" class="router-link-active router-link-exact-active">LVELimitRecheckTimeout</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#lveuse429" class="router-link-active router-link-exact-active">LVEUse429</a></li></ul></li></ul><p>mod_hostinglimits works with existing <span class="notranslate"> CGI/PHP </span> modules, to put them into LVE context. In most cases the <span class="notranslate"> CGI/PHP </span> process will be placed into LVE with the ID of the user that sites belongs to. mod_hostinglimits detects the user from <code>SuexecUserGroup</code> (<span class="notranslate">suexec</span> module), <span class="notranslate"><code>SuPHP_UserGroup</code></span> (from mod_suphp), <code>AssignUserID</code> (<span class="notranslate">MPM ITK</span>), <span class="notranslate"><code>RUidGid</code> (mod_ruid2 </span> ) directives.</p><p>This can be overwritten via LVEId or LVEUser parameter on the Directory level.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Those parameters will not work with mod_fcgid and mod_cgid.</p></div><p>The order of detection looks as follows:</p><ul><li>LVEId</li><li>LVEUser</li><li>SuexecUserGroup</li><li>suPHP_UserGroup</li><li>RUidGid</li><li>AssignUserID</li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>LVE doesn&#39;t work for mod_include #include due to its &quot;filter&quot; nature.</p></div><p>Example:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>LoadModule hostinglimits_module modules/mod_hostinglimits.so
&lt;IfModule mod_hostinglimits.c&gt;
 AllowedHandlers cgi-script php5-script php4-script
 SecureLinks On
&lt;/IfModule&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><h4 id="additional-notes" tabindex="-1"><a class="header-anchor" href="#additional-notes" aria-hidden="true">#</a> <strong>Additional notes</strong></h4><p><strong>mod_hostinglimits</strong> (since version 1.0-22) supports <span class="notranslate"><code>min-uid - cagefsctl --set-min-uid=600</code></span>.</p><p>Min UID is read on Apache start/restart and stored in the memory during apache runtime.</p><p>If the min UID has changed, you should restart Apache for <strong>mod_hostinglimits</strong> applying new min UID value. Full min UID is supported only with APR.</p><p>The following message should appear:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[notice] mod_hostinglimits: found apr extention version 3.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>This means that the correct APR is installed with mod_hostinglimits.</p><p>mod_hostinglimist has variable for Apache CustomLog format string <span class="notranslate"><code>%{LVE_ID}y</code></span>.</p><p><strong>How to use</strong>:</p><p>LogFormat</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&quot;%h %l %u %t &quot;%r&quot; %&gt;s %b &quot;%{Referer}i&quot; &quot;%{User-Agent}i&quot; req for lve &quot;%{LVE_ID}y&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>combined</p><p>shows in access_log the following info:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>*.*.*.* - - [09/Apr/2015:07:17:06 -0400] &quot;GET /1.php HTTP/1.1&quot; 200 43435 &quot;-&quot; &quot;Mozilla/5.0 (X11; Linux x86_64; rv:24.0) Gecko/20100101 Firefox/24.0&quot; req for lve 500

*.*.*.* - - [09/Apr/2015:07:17:06 -0400] &quot;GET /1.php?=PHPE9568F34-D428-11d2-A769-00AA001ACF42 HTTP/1.1&quot; 200 2524 &quot;************/1.php&quot;&quot;Mozilla/5.0 (X11; Linux x86_64; rv:24.0) Gecko/20100101 Firefox/24.0&quot; req for lve 500

*.*.*.* - - [09/Apr/2015:07:17:06 -0400] &quot;GET /1.php?=PHPE9568F35-D428-11d2-A769-00AA001ACF42 HTTP/1.1&quot; 200 2146 &quot;************/1.php&quot;&quot;Mozilla/5.0 (X11; Linux x86_64; rv:24.0) Gecko/20100101 Firefox/24.0&quot; req for lve 500
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><h4 id="installation-4" tabindex="-1"><a class="header-anchor" href="#installation-4" aria-hidden="true">#</a> Installation</h4><p><strong>cPanel</strong></p><p>Installed by default during EasyApache build. Requires <span class="notranslate"><code>lve-stats</code></span> &amp; <span class="notranslate"><code>lve-utils</code></span> packages to be installed.</p><p><strong>DirectAdmin</strong></p><p>Can be built using <span class="notranslate"> custombuild</span>:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install liblve-devel
cd /usr/local/directadmin/custombuild
./build update
./build set cloudlinux yes
./build apache
./build rewrite_confs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>If you run <code>suphp</code>, then run the following:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>./build suphp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>Plesk</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install mod_hostinglimits
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>ISPmanager</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install mod_hostinglimits
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>InterWorx</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install mod_hostinglimits
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>H-Sphere</strong></p><p>Included by default in H-Sphere 3.5+</p><p><strong>Standard Apache from RPM</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install mod_hostinglimits
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>Custom Apache installation</strong></p><p>Compile from the source: <a href="https://repo.cloudlinux.com/cloudlinux/sources/mod_hostinglimits.tar.gz" target="_blank" rel="noopener noreferrer">https://repo.cloudlinux.com/cloudlinux/sources/mod_hostinglimits.tar.gz</a></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>wget https://repo.cloudlinux.com/cloudlinux/sources/mod_hostinglimits.tar.gz
yum install cmake
tar -zxvf mod_hostinglimits*.tar.gz
cd mod_hostinglimits*
cmake .
make
make install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><ul><li>Apache Module Identifier: <code>hostinglimits_module</code></li><li>Source Files: <code>mod_hostinglimits.c</code></li><li>Compatibility: MPM prefork, worker, event, ITK</li></ul><h4 id="directives" tabindex="-1"><a class="header-anchor" href="#directives" aria-hidden="true">#</a> Directives</h4><div class="notranslate"><h4 id="securelinks" tabindex="-1"><a class="header-anchor" href="#securelinks" aria-hidden="true">#</a> <strong>SecureLinks</strong></h4></div><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>Description</strong></td><td>Makes sure that for any virtual hosts, only files owned by user specified via SuexecUserGroup or other ways as described above are served. For files owned by any other user apache will return <span class="notranslate"><code>Access Denied</code></span> error. The directive will not affect VirtualHost without user id specified, or with uid &lt; 100</td></tr><tr><td><strong>Syntax</strong></td><td><span class="notranslate"><code>SecureLinks On</code></span></td></tr><tr><td><strong>Default</strong></td><td><span class="notranslate"><code>SecureLinks Off</code></span></td></tr><tr><td><strong>Context</strong></td><td>server config</td></tr></tbody></table><p>Prevents apache from serving files not owned by user, stopping symlink attacks against php config files.</p><p><strong>Example</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>SecureLinks On
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><hr><div class="notranslate"><h4 id="skiperrors" tabindex="-1"><a class="header-anchor" href="#skiperrors" aria-hidden="true">#</a> <strong>SkipErrors</strong></h4></div><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>Description</strong></td><td>Allow apache to continue if LVE is not available</td></tr><tr><td><strong>Syntax</strong></td><td><span class="notranslate"><code>SkipErrors On</code></span></td></tr><tr><td><strong>Default</strong></td><td><span class="notranslate"><code>SkipErrors On</code></span></td></tr><tr><td><strong>Context</strong></td><td>server config</td></tr><tr><td><strong><font color="Red">Status</font></strong></td><td><font color="Red">deprecated</font></td></tr></tbody></table><p>Prevents Apache from exiting if LVE is not available.</p><p><strong>Example</strong></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>SkipErrors Off
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><hr><div class="notranslate"><h4 id="allowedhandlers" tabindex="-1"><a class="header-anchor" href="#allowedhandlers" aria-hidden="true">#</a> <strong>AllowedHandlers</strong></h4></div><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>Description</strong></td><td>List of handlers that should be placed into LVE, support regexp</td></tr><tr><td><strong>Syntax</strong></td><td><code>AllowedHandlers cgi-script %^php% my-script</code></td></tr><tr><td><strong>Default</strong></td><td>cgi-script %php% fcgid-script application/x-miva-compiled</td></tr><tr><td><strong>Context</strong></td><td>server config</td></tr></tbody></table><p>This directive allows to list handlers which will be intercepted and placed into LVE.</p><p><strong>Examples</strong></p><ul><li><p>Match requests handled by cgi-script handler:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>AllowedHandlers cgi-script
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div></li><li><p>Match all requests:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>AllowedHandlers *
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div></li><li><p>Match all requests that handled by handler that contains PHP:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>AllowedHandlers %php%
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div></li><li><p>Match all requests handled by handler that starts with PHP:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>AllowedHandlers %^php%
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div></li></ul><p>The default modhostinglimits module configuration only handles cgi scripts and ignores static content like html files and images. With the default configuration, an Apache server denial of service situation can occur when there are many requests for large html files and images. But on the other hand, processing all static files is unprofitable, since when processing many small files, the load average will increase significantly due to the overhead of entering/exiting lve. Therefore, it is better to enable processing only for a subset of static files based on criteria such as file location or file name extension using Apache directives as Location, Directory and Files.</p><p>This functionality is available since version 1.0-40.</p><p>In the following example, the module hostinglimits will process files for a URLs starting with weightcontent, for files with an .avi extension, and for files from the video subdirectory.</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;IfModule mod_hostinglimits.c&gt;

 SkipErrors Off
 AllowedHandlers cgi-script %php% fcgid-script application/x-miva-compiled

&lt;LocationMatch &quot;^/weigthcontent/&quot;&gt;
 AllowedHandlers *
&lt;/LocationMatch&gt;

&lt;Files &quot;*.avi&quot;&gt;
 AllowedHandlers *
&lt;/Files&gt;

&lt;DirectoryMatch &quot;/home/user[0-5]/public_html/video/&quot;&gt;
 AllowedHandlers *
&lt;/DirectoryMatch&gt;

&lt;/IfModule&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><div class="notranslate"><h4 id="denyhandlers" tabindex="-1"><a class="header-anchor" href="#denyhandlers" aria-hidden="true">#</a> <strong>DenyHandlers</strong></h4></div><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>Description</strong></td><td>List of handlers that should not be placed into LVE, support regexp</td></tr><tr><td><strong>Syntax</strong></td><td><span class="notranslate"><code>DenyHandlers text/html</code></span></td></tr><tr><td><strong>Default</strong></td><td>none</td></tr><tr><td><strong>Context</strong></td><td>server config</td></tr></tbody></table><p>This directive works together with AllowHandlers, to exclude some handlers from being allowed in LVE.</p><p><strong>Example</strong>:</p><p>Match all requests, but <span class="notranslate"><code>text/*</code></span></p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>AllowedHandlers *DenyHandlers %text/*%
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><hr><div class="notranslate"><h4 id="lveerrorcode" tabindex="-1"><a class="header-anchor" href="#lveerrorcode" aria-hidden="true">#</a> <strong>LVEErrorCode</strong></h4></div><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>Description</strong></td><td>Error code to display once entry is rejected due to maxEntryProcs</td></tr><tr><td><strong>Syntax</strong></td><td>values from 500 to 510</td></tr><tr><td><strong>Default</strong></td><td>508</td></tr><tr><td><strong>Context</strong></td><td>directory config</td></tr></tbody></table><p>Specifies ErrorCode to use on LVE error (like too many concurrent processes running).</p><p>The message that will be displayed by default is:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Resource Limit Is Reached.

The website is temporarily unable to serve your request as it exceeded resource limit.

Please try again later.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>You can redefine error message using <code>ErrorDocument</code> directive</p><p>Example:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>LVEErrorCode 508ErrorDocument 508 508.html
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><hr><div class="notranslate"><h4 id="lveid" tabindex="-1"><a class="header-anchor" href="#lveid" aria-hidden="true">#</a> <strong>LVEid</strong></h4></div><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>Description</strong></td><td>Allows to setup separate LVE ID on per directory level. If not set, user ID of a corresponding user is used.</td></tr><tr><td><strong>Syntax</strong></td><td><span class="notranslate"><code>LVEId number</code></span></td></tr><tr><td><strong>Default</strong></td><td>User Id is used</td></tr><tr><td><strong>Context</strong></td><td>directory config</td></tr></tbody></table><p>Specifies LVE id for particular directory</p><p><strong>Example</strong>:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;Directory &quot;/home/user1/domain.com/forums&quot;&gt;
 LVEId 10001
&lt;/Directory&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><hr><div class="notranslate"><h4 id="lveuser" tabindex="-1"><a class="header-anchor" href="#lveuser" aria-hidden="true">#</a> <strong>LVEUser</strong></h4></div><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>Description</strong></td><td>Allows to setup separate LVE ID on per directory level.</td></tr><tr><td><strong>Syntax</strong></td><td><span class="notranslate"><code>LVEUser username</code></span></td></tr><tr><td><strong>Default</strong></td><td>none</td></tr><tr><td><strong>Context</strong></td><td>directory config</td></tr></tbody></table><p>Specifies LVE ID for particular directory.</p><p><strong>Example</strong>:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;Directory &quot;/home/user1/domain.com/forums&quot;&gt;
       LVEUser user1
&lt;/Directory&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><hr><div class="notranslate"><h4 id="lveusergroupid" tabindex="-1"><a class="header-anchor" href="#lveusergroupid" aria-hidden="true">#</a> <strong>LVEUserGroupID</strong></h4></div><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>Description</strong></td><td>Use group ID instead of user ID for LVE container number.</td></tr><tr><td><strong>Syntax</strong></td><td><span class="notranslate"><code>LVEUserGroupID On/Off</code></span></td></tr><tr><td><strong>Default</strong></td><td>User Id is used</td></tr><tr><td><strong>Context</strong></td><td>global config only</td></tr></tbody></table><ul><li>If the option enabled, group ID will be used instead of a user ID. Apache will display the following string in error logs:</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mod_hostinglimits: use GroupID instead of UID
mod_hostinglimits: found apr extension version 2
mod_hostinglimits: apr_lve_environment_init_group check ok
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><ul><li>If a compatible apr library is not found, the following error message will be display in error logs.</li></ul><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mod_hostinglimits:  apr_lve_* not found!!!
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>Example</strong>:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;Directory &quot;/home/user1/domain.com/forums&quot;&gt;
       LVEUserGroupID On
&lt;/Directory&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><hr><div class="notranslate"><h4 id="lveretryafter" tabindex="-1"><a class="header-anchor" href="#lveretryafter" aria-hidden="true">#</a> <strong>LVERetryAfter</strong></h4></div><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>Description</strong></td><td>Returns Retry-After header when LVE error 508 occurs.</td></tr><tr><td><strong>Syntax</strong></td><td><code>LERetryAfter MINUTES</code></td></tr><tr><td><strong>Default</strong></td><td>240 minutes</td></tr><tr><td><strong>Context</strong></td><td>directory config</td></tr></tbody></table><p>Specifies interval for <span class="notranslate"><code>Retry-After</code></span> header. The <span class="notranslate"><code>Retry-After</code></span> response-header field can be used to indicate how long the service is expected to be unavailable to the requesting client.</p><p><strong>Example</strong>:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>LVERetryAfter 180
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><hr><div class="notranslate"><h4 id="lvesitesdebug" tabindex="-1"><a class="header-anchor" href="#lvesitesdebug" aria-hidden="true">#</a> <strong>LVESitesDebug</strong></h4></div><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>Description</strong></td><td>Provides extended debug info for listed sites.</td></tr><tr><td><strong>Syntax</strong></td><td><span class="notranslate"><code>LVESitesDebug test.com test2.com</code></span></td></tr><tr><td><strong>Default</strong></td><td><span class="notranslate"> none </span></td></tr><tr><td><strong>Context</strong></td><td>directory config</td></tr></tbody></table><p>Specifies virtual hosts to provide extra debugging information.</p><p><strong>Example</strong>:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;Directory &quot;/home/user1/domain.com/forums&quot;&gt;
       LVESitesDebug abc.com yx.cnet
&lt;/Directory&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><hr><div class="notranslate"><h4 id="lveparsemode" tabindex="-1"><a class="header-anchor" href="#lveparsemode" aria-hidden="true">#</a> <strong>LVEParseMode</strong></h4></div><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>Description</strong></td><td>Determines the way LVE ID will be extraced. In Conf</td></tr><tr><td><strong>Syntax</strong></td><td><code>LVEParseMode CONF</code> <code>PATH</code> <code>OWNER</code> <a href="/cloudlinuxos/limits/#redis-support-for-hostinglimits" class=""><code>REDIS</code></a></td></tr><tr><td>Default:</td><td><span class="notranslate"><code>CONF</code></span></td></tr><tr><td>Context:</td><td>directory config</td></tr></tbody></table><ul><li><p>In <code>CONF</code> mode, standard way to extract LVE ID is used (SuexecUserGroup, LVEId, or similar directives).</p></li><li><p>In <span class="notranslate"><code>PATH</code></span> mode, username is extracted from the home directory path. The default way to match username is via the following regexp: <span class="notranslate"><code>/home/([^/]*)/</code></span> . Custom regexp can be specified in LVEPathRegexp.</p></li><li><p>In <span class="notranslate"><code>OWNER</code></span> mode, the owner of the file is used as an LVE ID.</p></li><li><p>In <span class="notranslate"><a href="/cloudlinuxos/limits/#redis-support-for-hostinglimits" class=""><code>REDIS</code></a></span> mode, LVE ID is retrieved from Redis database.</p></li></ul><p><strong>Example</strong>:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>LVEParseMode CONF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><hr><div class="notranslate"><h4 id="lvepathregexp" tabindex="-1"><a class="header-anchor" href="#lvepathregexp" aria-hidden="true">#</a> <strong>LVEPathRegexp</strong></h4></div><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>Description</strong></td><td>Regexp used to extract username from the path. Used in conjuction with <code>LVEParseMode PATH</code></td></tr><tr><td><strong>Syntax</strong></td><td><code>LVEPathRegexp regexp</code></td></tr><tr><td><strong>Default</strong></td><td><span class="notranslate"><code>/home/([^/]*)/</code></span></td></tr><tr><td><strong>Context</strong></td><td>directory config</td></tr></tbody></table><p>Used to extract usersname via path.</p><p><strong>Example</strong>:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>LVEPathRegexp /home/([^/]*)/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><hr><div class="notranslate"><h4 id="lvelimitrechecktimeout" tabindex="-1"><a class="header-anchor" href="#lvelimitrechecktimeout" aria-hidden="true">#</a> <strong>LVELimitRecheckTimeout</strong></h4></div><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>Description</strong></td><td>Timeout in milliseconds, a site will return EP without lve_enter for LA decreasing after this time</td></tr><tr><td><strong>Syntax</strong></td><td><code>LVELimitRecheckTimeout number</code></td></tr><tr><td><strong>Default</strong></td><td>0</td></tr><tr><td><strong>Context</strong></td><td>httpd.conf, virtualhost</td></tr></tbody></table><p>Example: <span class="notranslate"></span></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>LVELimitRecheckTimeout 1000
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="notranslate"><h4 id="lveuse429" tabindex="-1"><a class="header-anchor" href="#lveuse429" aria-hidden="true">#</a> <strong>LVEUse429</strong></h4></div><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>Description</strong></td><td>Use 429 error code as code returned on max entry limits ( <span class="notranslate"> on/off </span> ).</td></tr><tr><td><strong>Syntax</strong></td><td><code>LVEUse429 on</code></td></tr><tr><td><strong>Default</strong></td><td><span class="notranslate"><code>off</code></span></td></tr><tr><td><strong>Context</strong></td><td>httpd.conf, virtualhost</td></tr></tbody></table><p><strong>Example</strong>:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>LVEUse429 on
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Available for RPM based panels, EasyApache 4 and DirectAdmin.</p><h3 id="cpanel-whm-json-api" tabindex="-1"><a class="header-anchor" href="#cpanel-whm-json-api" aria-hidden="true">#</a> cPanel/WHM JSON API</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#parameters" class="router-link-active router-link-exact-active">Parameters</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#manage-reseller-limits-users-packages-via-cpanel-whm-json-api-jsonhandler" class="router-link-active router-link-exact-active">Manage reseller limits/users/packages via cPanel/WHM JSON API - JSONHandler</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#using-a-whm-api-token" class="router-link-active router-link-exact-active">Using a WHM API token</a></li></ul><p>CloudLinux OS offers JSON API for <a href="/cloudlinuxos/command-line_tools/#lvectl" class="">lvectl</a> and <a href="/cloudlinuxos/command-line_tools/#cloudlinux-limits" class="">cloudlinux-limits</a> via WHM. You can access it using the following URL:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>https://IP:2087/cpsess_YOURTOKEN/cgi/CloudLinux.cgi?cgiaction=jsonhandler&amp;command=lvectl&amp;handler=list
https://IP:2087/cpsess_YOURTOKEN/cgi/CloudLinux.cgi?cgiaction=jsonhandler&amp;command=cloudlinux-limits&amp;handler=get
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>The output will look as follows:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{&quot;data&quot;:[{&quot;ID&quot;:&quot;default&quot;,&quot;CPU&quot;:&quot;30&quot;,&quot;NCPU&quot;:&quot;1&quot;,&quot;PMEM&quot;:&quot;1024M&quot;,&quot;VMEM&quot;:&quot;1024M&quot;,&quot;EP&quot;:&quot;28&quot;,&quot;NPROC&quot;:&quot;0&quot;,&quot;IO&quot;:&quot;2048&quot;}]}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h4 id="parameters" tabindex="-1"><a class="header-anchor" href="#parameters" aria-hidden="true">#</a> <strong>Parameters</strong></h4><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><span class="notranslate"><code>cgiaction</code></span></td><td>always <span class="notranslate"><code>jsonhandler</code></span></td></tr><tr><td><span class="notranslate"><code>command</code></span></td><td><span class="notranslate"><code>lvectl</code></span> or <span class="notranslate"><code>cloudlinux-limits</code></span> (default <span class="notranslate"><code>lvectl</code></span>)</td></tr><tr><td><span class="notranslate"><code>handler</code></span></td><td>should match <a href="/cloudlinuxos/command-line_tools/#lvectl" class="">lvectl</a> or <a href="/cloudlinuxos/command-line_tools/#cloudlinux-limits" class="">cloudlinux-limits</a> command</td></tr></tbody></table><p>For commands like <span class="notranslate"><code>set</code>, <code>destroy</code></span> &amp; <span class="notranslate"><code>delete</code></span>, where you need to specify LVE (user) ID, like <code>lveid=500</code> (matches user ID 500).</p><p><strong>Example</strong>:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>https://IP:2087/cpsess_YOURTOKEN/cgi/CloudLinux.cgi?cgiaction=jsonhandler&amp;command=lvectl&amp;handler=set&amp;lveid=500&amp;speed=30%&amp;io=2048

https://IP:2087/cpsess_YOURTOKEN/cgi/CloudLinux.cgi?cgiaction=jsonhandler&amp;command=lvectl&amp;handler=set&amp;lveid=500&amp;speed=300Mhz&amp;io=2048

https://IP:2087/cpsess_YOURTOKEN/cgi/CloudLinux.cgi?cgiaction=jsonhandler&amp;command=lvectl&amp;handler=set&amp;lveid=500&amp;speed=3Ghz&amp;io=2048

https://IP:2087/cpsess_YOURTOKEN/cgi/CloudLinux.cgi?cgiaction=jsonhandler&amp;command=cloudlinux-limits&amp;handler=set&amp;lveid=500&amp;inodes=9090,8989
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p><strong>Speed</strong> limit can be specified in several units of measure - <span class="notranslate"> %, MHz, GHz </span>. The figures will be different according to the unit of measure.</p></div><p><strong>Output</strong>:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{&quot;status&quot;:&quot;OK&quot;}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>To do <code>set default</code>, use <code>lveid=0</code>, like:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>https://IP:2087/cpsess_YOURTOKEN/cgi/CloudLinux.cgi?cgiaction=jsonhandler&amp;handler=set&amp;lveid=0&amp;speed=30%&amp;io=2048
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>For commands like <span class="notranslate"><code>apply all</code>, <code>destroy all</code></span>, use:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>handler=apply-all

handler=destroy-all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>You can use the following commands that allow to specify user name instead of user ID:</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><span class="notranslate"><code>set-user</code></span></td><td>Set parameters for a LVE and/or create a LVE using username instead of ID.</td></tr><tr><td><span class="notranslate"><code>list-user </code></span></td><td>List loaded LVEs, display username instead of user ID.</td></tr><tr><td><span class="notranslate"><code>delete-user </code></span></td><td>Delete LVE and set configuration for that user to defaults.</td></tr></tbody></table><p>If the limits for users are set with <span class="notranslate"> cPanel LVE Extension</span>, then turnkey billing solutions can be applied (e.g. WHMCS).</p><h4 id="manage-reseller-limits-users-packages-via-cpanel-whm-json-api-jsonhandler" tabindex="-1"><a class="header-anchor" href="#manage-reseller-limits-users-packages-via-cpanel-whm-json-api-jsonhandler" aria-hidden="true">#</a> Manage reseller limits/users/packages via cPanel/WHM JSON API (JSONHandler)</h4><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td><strong>Action</strong></td><td><strong>lvectl command</strong></td><td><strong>JSONHandler</strong></td></tr><tr><td>enable reseller limits</td><td><span class="notranslate"><code>lvectl set-reseller res1 --speed=35%</code></span></td><td><code>https://IP:2087/cpsess_YOURTOKEN/cgi/CloudLinux.cgi/CloudLinux.cgi?cgiaction=jsonhandler&amp;handler=set-reseller&amp;lveid=res1&amp;speed=30%&amp;io=2048</code></td></tr><tr><td>disable reseller limits</td><td><span class="notranslate"><code>lvectl remove-reseller res1</code></span></td><td><code>https://IP:2087/cpsess_YOURTOKEN/cgi/CloudLinux.cgi/CloudLinux.cgi?cgiaction=jsonhandler&amp;handler=remove-reseller&amp;lveid=res1</code></td></tr><tr><td>set default limits for reseller</td><td><span class="notranslate"><code>lvectl set-reseller-default res1 --speed=91%</code></span></td><td><code>https://IP:2087/cpsess_YOURTOKEN/cgi/CloudLinux.cgi/CloudLinux.cgi?cgiaction=jsonhandler&amp;handler=set-reseller-default&amp;lveid=res1&amp;speed=30%</code></td></tr><tr><td>set limits for package, created by reseller</td><td><span class="notranslate"><code>lvectl package-set res1_pack1 --reseller res1 --speed=88%</code></span></td><td><code>https://IP:2087/cpsess_YOURTOKEN/cgi/CloudLinux.cgi/CloudLinux.cgi?cgiaction=jsonhandler&amp;handler=package-set&amp;lveid=res1_pack1&amp;reseller=res1&amp;speed=30%</code></td></tr><tr><td>set limits for user, created by reseller</td><td><span class="notranslate"><code>lvectl set-user r1user1 --reseller res1 --speed=77%</code></span></td><td><code>https://IP:2087/cpsess_YOURTOKEN/cgi/CloudLinux.cgi/CloudLinux.cgi?cgiaction=jsonhandler&amp;handler=set-user&amp;lveid=r1user1&amp;reseller=res1&amp;speed=30%</code></td></tr><tr><td>set unlimited for user, created by reseller</td><td><span class="notranslate"><code>lvectl set-user r1user1 --reseller res1 --unlimited</code></span></td><td><code>https://IP:2087/cpsess_YOURTOKEN/cgi/CloudLinux.cgi/CloudLinux.cgi?cgiaction=jsonhandler&amp;handler=set-user&amp;lveid=r1user1&amp;reseller=res1&amp;unlimited</code></td></tr><tr><td>set inodes limit</td><td><span class="notranslate"><code>cloudlinux-limits set --username=r1user1 --inodes=9090,8989</code></span></td><td><code>https://IP:2087/cpsess_YOURTOKEN/cgi/CloudLinux.cgi?cgiaction=jsonhandler&amp;command=cloudlinux-limits&amp;handler=set&amp;username=r1user1&amp;inodes=9090,8989</code></td></tr></tbody></table><h4 id="using-a-whm-api-token" tabindex="-1"><a class="header-anchor" href="#using-a-whm-api-token" aria-hidden="true">#</a> Using a WHM API token</h4><p>You can use a WHM API token with curl as follows:</p><div clas="code"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>curl -X POST -k -s -H &quot;Authorization: whm root:WHM_TOKEN&quot; &quot;https://SERVER_IP:2087/cgi/CloudLinux.cgi?cgiaction=jsonhandler&amp;handler=LVE_METHOD&amp;PARAMETERS
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Where:</p><ul><li><span class="notranslate"><code>WHM_TOKEN</code></span> – a generated WHM API token (see: <a href="https://documentation.cpanel.net/display/DD/Guide+to+API+Authentication+-+API+Tokens+in+WHM#0ac291c40e454694a8b981c45988c1cb" target="_blank" rel="noopener noreferrer">Creating an API token</a>)</li><li><span class="notranslate"><code>LVE_METHOD</code></span> – lvectl method (for example: <span class="notranslate"><code>list</code></span>. See also: <a href="/command-line_tools/#lvectl" class="">lvectl</a>)</li><li><span class="notranslate"><code>PARAMETERS</code></span> – all other parametrs and options for a method according to the <a href="/command-line_tools/#lvectl" class="">documentation</a></li></ul><h3 id="mod-proctitle" tabindex="-1"><a class="header-anchor" href="#mod-proctitle" aria-hidden="true">#</a> mod_proctitle</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#how-to-read-mod-proctitle-information" class="router-link-active router-link-exact-active">How to read mod_proctitle information</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#tuning-parameters" class="router-link-active router-link-exact-active">Tuning parameters</a></li></ul><p>mod_proctitle is a module for gathering URL information per request. It is available only for Apache 2.4 now.</p><p><strong>For installation:</strong></p><p>cPanel EasyApache 3 and non cPanel ( <em>CloudLinux 7 only for non cPanel</em> ):</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install mod_proctitle --enablerepo=cloudlinux-updates-testing
service httpd restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>cPanel EasyApache 4:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install ea-apache24-mod_proctitle
service httpd restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div> DirectAdmin: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cd /usr/local/directadmin/custombuild
./build update
./build mod_procticle
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><h4 id="how-to-read-mod-proctitle-information" tabindex="-1"><a class="header-anchor" href="#how-to-read-mod-proctitle-information" aria-hidden="true">#</a> How to read mod_proctitle information</h4><p><strong>How to read information gathered by the module</strong></p><p>For reading information saved by module use the following script (the script is not in the package):</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#!/bin/bash

httpd=httpd

for pid in `/usr/bin/pgrep $httpd`; do
    for tid in `ls /proc/$pid/task`; do
		found=no
		for shm in `ls /dev/shm/apache_title_shm_${pid}_${tid}_* 2&gt;/dev/null`; do
			found=yes
			title=`/usr/bin/tr -d &#39;\0&#39; &lt; $shm`
			thread_id=`/bin/basename &quot;${shm}&quot; | sed &quot;s/apache_title_shm_${pid}_${tid}_//&quot;`
			echo &quot;$pid.$tid - $thread_id - $title&quot;
		break
		done
	if [ &quot;$found&quot; = &quot;no&quot; ]; then
		echo &quot;$pid.$tid not found&quot;
	fi
    done
done
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div> Here are the examples of saved by module: <div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># sh proctitles_info.sh
571258.571258 NOT FOUND
571300.571300 NOT FOUND
571303.571303 - 000000000000000 - 1466513333.6 test.cloudlinux.com GET /1.php HTTP/1.1
571304.571304 - 000000000000000 - 1466513335.3 test.cloudlinux.com GET /1.php HTTP/1.1
571305.571305 - 000000000000000 - httpd
571306.571306 - 000000000000000 - httpd
571307.571307 - 000000000000000 - httpd
571372.571372 - 000000000000000 - httpd
571374.571374 - 000000000000000 - httpd

Item info:
[pid].[tid] - [posix thread id] - [request info]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Request information can contain:</p><p><span class="notranslate"><em>NOT FOUND</em></span> - means that process of Apache doesn&#39;t handle requests.<br><span class="notranslate"><em>httpd</em></span> - request is active and waiting for new connection.<br><span class="notranslate"><em>[seconds].[tenths of second] [host] [METHOD] [URL] [PROTOCOL]</em></span></p><h4 id="tuning-parameters" tabindex="-1"><a class="header-anchor" href="#tuning-parameters" aria-hidden="true">#</a> Tuning parameters</h4><p><strong>Module parameters for tuning</strong></p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>WatchHandlers</td><td>List of handlers for monitoring (httpd.conf, virtualhost).</td></tr><tr><td>ProctitleUseFilter On/Off</td><td>Use old method of cleaning information or new via filter (for prefork better to use <span class="notranslate"> Off </span> )</td></tr></tbody></table><h3 id="alt-suexec" tabindex="-1"><a class="header-anchor" href="#alt-suexec" aria-hidden="true">#</a> alt-suexec</h3><p><strong>What is <span class="notranslate">alt-suexec</span> package needed for?</strong></p><p>If you use standard httpd from our repository, but your users&#39; sites do not match standard Apache location of <span class="notranslate"><code>/var/www</code></span>, then you should use alt-suexec. alt-suexec package brings suEXEC binaries pre-compiled for specific locations, like <span class="notranslate"> /home </span> .</p><p><strong>How to switch suEXEC with alt-suexec</strong></p><p>Based on httpd 2.2.16 basic for Cloudlinux OS 6, httpd 2.4.6 basic for CloudLinux OS 7 and httpd 2.4.37 basic for CloudLinux OS 8, the package brings to a server a set of suEXECs with different <span class="notranslate">DOCUMENT ROOTs</span> and <span class="notranslate">MIN_UID/MIN_GID</span> parameters. The first set of suEXECs is listed by such modes:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>switch_suexec -h
............

USE_BIZ - DOCUMENT ROOT /biz/ MIN_UID 500 MIN_GID 100 CALLER apache
USE_HOSTING - DOCUMENT ROOT /hosting/ MIN_UID 500 MIN_GID 100 CALLER apache
USE_HSPHERE - DOCUMENT ROOT /hsphere/local MIN_UID 100 MIN_GID 100 CALLER httpd
USE_HOME - DOCUMENT ROOT /home/ MIN_UID 500 MIN_GID 100 CALLER apache
USE_WWW - DOCUMENT ROOT /var/www/ MIN_UID 500 MIN_GID 100 CALLER apache
USE_FSROOT - DOCUMENT ROOT / MIN_UID 500 MIN_GID 100 CALLER apache
USE_STORAGE - DOCUMENT ROOT /storage/content/ MIN_UID 500 MIN_GID 100 CALLER apache
USE_DATAS - DOCUMENT ROOT /datas/ MIN_UID 500 MIN_GID 100 CALLER apache
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div> The package also brings its own utility for installing specific suEXEC: <table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>-l</td><td>list of available suexec</td></tr><tr><td>-u</td><td>update suexec according to <span class="notranslate"> /etc/sysconfig/alt-suexec </span></td></tr><tr><td>-s</td><td>set new suexec and install it</td></tr><tr><td>-p</td><td>set new suexec path and install it</td></tr><tr><td>-o</td><td>set new suexec owners and install it</td></tr><tr><td>-r</td><td>restore native apache suexec</td></tr></tbody></table><p>There are two ways to set up new suEXEC binary:</p><ol><li>via config file <span class="notranslate"><em>/etc/sysconfig/alt-suexec</em></span></li><li>via utility <em>switch_suexec</em></li></ol><p>Here are the examples of how to set up suEXEC with <span class="notranslate"> DOC_ROOT = &quot;/home&quot;: </span></p><p><strong>1.</strong></p><ol><li>add string <span class="notranslate"> &quot;USE_HOME&quot; </span> to <span class="notranslate"><em>/etc/sysconfig/alt-suexec</em></span></li><li>run the command <span class="notranslate"> switch_suexec -u </span></li></ol><p><strong>2.</strong></p><ol><li><span class="notranslate"> switch_suexec -sUSE_HOME </span></li></ol><p>Result of both methods:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cat /etc/sysconfig/alt-suexec
............

USE_HOME
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Here is standard suEXEC for CloudLinux OS 6 clean server:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/suexec -V
............

-D AP_DOC_ROOT=&quot;/var/www&quot;
-D AP_GID_MIN=100
-D AP_HTTPD_USER=&quot;apache&quot;
-D AP_LOG_EXEC=&quot;/var/log/httpd/suexec.log&quot;
-D AP_SAFE_PATH=&quot;/usr/local/bin:/usr/bin:/bin&quot;
-D AP_UID_MIN=500
-D AP_USERDIR_SUFFIX=&quot;public_html&quot;
-D AP_SAFE_DIRECTORY=&quot;/usr/local/safe-bin&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Here is output of new suEXEC after <span class="notranslate"> USE_HOME </span> installtion:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/usr/sbin/suexec -V
............

-D AP_DOC_ROOT=&quot;/home/&quot;
-D AP_GID_MIN=100
-D AP_HTTPD_USER=&quot;apache&quot;
-D AP_LOG_EXEC=&quot;/var/log/httpd/suexec.log&quot;
-D AP_SAFE_PATH=&quot;/usr/local/bin:/usr/bin:/bin&quot;
-D AP_UID_MIN=500
-D AP_USERDIR_SUFFIX=&quot;public_html&quot;
-D AP_SAFE_DIRECTORY=&quot;/usr/local/safe-bin&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>Description of other switch_suexec parameters:</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>-p</td><td>if suexec binary file will be placed not in standard way <span class="notranslate"> /usr/sbin </span> - specify this new path with p-option</td></tr><tr><td>-o</td><td>if suexec binary file not owned by <span class="notranslate"> root:apache </span> - specify new owner with o-option</td></tr></tbody></table><p>For most cases -p and -o options for standard Apache are useless.</p><p>Correct suEXEC will be restored even after httpd update or reinstall.</p><p>List of pre-built suEXEC binary files stored without suid bit and not executable.</p><p><strong>How to install alt-suexec?</strong></p><p>For installation run the command:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install alt-suexec
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p><strong>New suexec with custom parameters</strong></p><p>If you need suEXEC with custom parameters absent in current set of alt-suexec, please submit a ticket on <a href="https://cloudlinux.zendesk.com/" target="_blank" rel="noopener noreferrer">https://cloudlinux.zendesk.com</a> and we will add new suEXEC with needed parameters.</p><h3 id="cpanel-nginx-and-application-selectors" tabindex="-1"><a class="header-anchor" href="#cpanel-nginx-and-application-selectors" aria-hidden="true">#</a> cPanel Nginx and application selectors</h3><p>Recently, cPanel added support for the <a href="https://documentation.cpanel.net/display/CKB/Nginx" target="_blank" rel="noopener noreferrer">Nginx</a> web server and for <a href="https://documentation.cpanel.net/display/CKB/How+to+Install+a+Python+WSGI+Application" target="_blank" rel="noopener noreferrer">Python</a> and <a href="https://documentation.cpanel.net/display/CKB/How+to+Install+a+Node.js+Application" target="_blank" rel="noopener noreferrer">Node.js</a> applications.</p><p>We have checked the compatibility of ea-nginx and cPanel application Selectors with CloudLinux OS LVE and CageFS. All tests passed successfully and all processes started by ea-nginx and cPanel selectors are launched inside LVE and CageFS.</p><p>Don’t forget, you can use Ruby/Python/Node.js Selectors from CloudLinux OS. Here you can find a large number of supported versions for Ruby/Python/Node.js applications.</p><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#python-selector" class="router-link-active router-link-exact-active">CloudLinux OS Python Selector</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#ruby-selector" class="router-link-active router-link-exact-active">CloudLinux OS Ruby Selector</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#node-js-selector" class="router-link-active router-link-exact-active">CloudLinux OS NodeJS Selector</a></li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Nginx support is currently experimental.</p></div><h3 id="how-to-use-certbot-with-alt-python36" tabindex="-1"><a class="header-anchor" href="#how-to-use-certbot-with-alt-python36" aria-hidden="true">#</a> How to use Certbot with alt-python36</h3><p>To run Certbot with <span class="notranslate"><code>alt-python36</code></span>, follow the next steps:</p><ol><li>Add a path to the <span class="notranslate"><code>alt-python36</code></span> in the environment variable <span class="notranslate"><code>PATH</code></span> as the first element: <span class="notranslate"><code>/opt/alt/python36/bin/</code></span>.</li><li>Run Certbot with the <span class="notranslate"><code>--no-bootstrap</code></span> parameter.</li></ol><p><strong>Example:</strong></p><p>The old command to run Certbot on CentOS 6/Cloudlinux OS 6:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>certbot-auto --nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>The new command to run Certbot on CentOS 6/CloudLinux OS 6:</p><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>PATH=&quot;/opt/alt/python36/bin/:$PATH&quot; certbot-auto --no-bootstrap --nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h2 id="apache-suexec-module" tabindex="-1"><a class="header-anchor" href="#apache-suexec-module" aria-hidden="true">#</a> Apache suexec module</h2><h3 id="general-information-and-requirements-9" tabindex="-1"><a class="header-anchor" href="#general-information-and-requirements-9" aria-hidden="true">#</a> General information and requirements</h3><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#how-does-it-work-with-cloudlinux-os" class="router-link-active router-link-exact-active">How does it work with CloudLinux OS?</a></li></ul><p>This module is used by the Apache HTTP Server to switch to another user before executing CGI programs. The suEXEC feature provides users of the Apache HTTP Server with the ability to run CGI and SSI programs under user IDs different from the user ID of the calling web server (<span class="notranslate">apache/nobody</span>). Normally, when a CGI or SSI program executes, it runs as the same user who is running the web server.</p><p>If we are talking about shared hosting where different accounts are launched on the same server, the installation of this module is necessary to ensure security.</p><h4 id="how-does-it-work-with-cloudlinux-os" tabindex="-1"><a class="header-anchor" href="#how-does-it-work-with-cloudlinux-os" aria-hidden="true">#</a> How does it work with CloudLinux OS?</h4><p>The DirectAdmin and CloudLinux OS (for httpd, httpd24-httpd and cPanel EasyApache 4) both provide a patched version of suexec. For other distributions you can use patches available here: <a href="https://repo.cloudlinux.com/cloudlinux/sources/da/cl-apache-patches.tar.gz" target="_blank" rel="noopener noreferrer">https://repo.cloudlinux.com/cloudlinux/sources/da/cl-apache-patches.tar.gz</a></p><ol><li>Besides the ability to run CGI programs under user IDs, suexec with CloudLinux OS patch adds the ability to run that script under CageFS.</li></ol><div class="tip custom-block"><p class="custom-block-title">NOTE</p><p>Therefore, this module is necessary for the proper work of PHP Selector.</p></div><ol start="2"><li>This module is also necessary for the proper work of mod_hostinglimits. The <span class="notranslate"><code>SuexecUserGroup</code></span> directive indicates for <code>mod_hostinglimits</code> in which LVE the user process should be put in.</li></ol><h3 id="configuration-5" tabindex="-1"><a class="header-anchor" href="#configuration-5" aria-hidden="true">#</a> Configuration</h3><p><strong>SuexecUserGroup Directive</strong></p><p><strong>Syntax</strong>: <span class="notranslate">SuexecUserGroup User Group</span></p><p><strong>Context</strong>: <code>httpd.conf</code>, <code>virtualhost</code></p><p><strong>Description</strong>: The SuexecUserGroup directive allows you to specify a user and a group for CGI programs to run as. Startup will fail if this directive is specified but the suEXEC feature is disabled.</p><div class="warning custom-block"><p class="custom-block-title">Note</p><p>Control panels such as cPanel, Plesk, and DirectAdmin add this directive to the Apache configuration automatically when creating a domain. If you use the server without a control panel, make sure this directive is added for each virtual host.</p></div><h3 id="installation-5" tabindex="-1"><a class="header-anchor" href="#installation-5" aria-hidden="true">#</a> Installation</h3><p>The <span class="notranslate"><code>mod_suexec</code></span> installation process varies depending on the control panel and Apache.</p><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#installing-on-cpanel-servers-with-easyapache-4-2" class="router-link-active router-link-exact-active">Installing on cPanel servers with EasyApache 4</a><ul><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#via-command-line" class="router-link-active router-link-exact-active">Via command line</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#via-administrator-interface" class="router-link-active router-link-exact-active">Via administrator interface</a></li></ul></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#installing-on-plesk-servers-2" class="router-link-active router-link-exact-active">Installing on Plesk servers</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#installing-on-directadmin-servers-2" class="router-link-active router-link-exact-active">Installing on DirectAdmin servers</a></li><li><a aria-current="page" href="/cloudlinuxos/cloudlinux_os_components/#installing-on-servers-with-no-control-panel-3" class="router-link-active router-link-exact-active">Installing on servers with no control panel</a></li></ul><h4 id="installing-on-cpanel-servers-with-easyapache-4-1" tabindex="-1"><a class="header-anchor" href="#installing-on-cpanel-servers-with-easyapache-4-1" aria-hidden="true">#</a> Installing on cPanel servers with EasyApache 4</h4><h4 id="via-command-line" tabindex="-1"><a class="header-anchor" href="#via-command-line" aria-hidden="true">#</a> Via command line</h4><ol><li>Install <code>mod_suexec</code> through YUM package manager as follows:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install ea-apache24-mod_suexec
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><div class="warning custom-block"><p class="custom-block-title">NOTE</p><p><code>ea-apache24-mod_suexec</code> conflicts with the <code>mod_ruid2</code> therefore, before installing the module, remove <code>ea-apache24-mod_ruid2</code> as follows: <span class="notranslate"><code>$ yum remove ea-apache24-mod_ruid2</code></span></p></div><ol start="2"><li>Now, when the module is installed, restart Apache:</li></ol><div class="notranslate"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>service httpd restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>If you use CageFS + PHP Selector, you should run the <span class="notranslate"><code>cagefsctl --force-update</code></span> command.</p></div><h4 id="via-administrator-interface" tabindex="-1"><a class="header-anchor" href="#via-administrator-interface" aria-hidden="true">#</a> Via administrator interface</h4><ol><li>Open EasyApache4 page.</li><li>Click <span class="notranslate"><em>Customize</em></span> for <span class="notranslate"><em>Currently installed Packages</em></span>.</li></ol><p><img src="/images/cloudlinuxos/cloudlinux_os_components/mod_suexec_admin_ui_1.webp" alt=""></p><ol start="3"><li>Click <span class="notranslate"><em>Apache Modules</em></span>. Find <span class="notranslate"><code>mod_suexec</code></span> and click <span class="notranslate"><em>Yes</em></span> to install it.</li></ol><p><img src="/images/cloudlinuxos/cloudlinux_os_components/mod_suexec_admin_ui_2.webp" alt=""></p><ol start="4"><li>Select <span class="notranslate"><em>Review</em></span> and <span class="notranslate"><em>Provision</em></span>.</li></ol><p><img src="/images/cloudlinuxos/cloudlinux_os_components/mod_suexec_admin_ui_3.webp" alt=""></p><ol start="5"><li><p>Wait while <span class="notranslate"><em>Provision</em></span> will be finished.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>If you use CageFS + PHP Selector, you should run the <span class="notranslate"><code>cagefsctl --force-update</code></span> command.</p></div></li></ol><h4 id="installing-on-plesk-servers-1" tabindex="-1"><a class="header-anchor" href="#installing-on-plesk-servers-1" aria-hidden="true">#</a> Installing on Plesk servers</h4><p>This module is integrated into Apache for Plesk control panel by default.</p><h4 id="installing-on-directadmin-servers-1" tabindex="-1"><a class="header-anchor" href="#installing-on-directadmin-servers-1" aria-hidden="true">#</a> Installing on DirectAdmin servers</h4><p>This module is integrated into Apache for DirectAdmin control panel by default.</p><h4 id="installing-on-servers-with-no-control-panel-1" tabindex="-1"><a class="header-anchor" href="#installing-on-servers-with-no-control-panel-1" aria-hidden="true">#</a> Installing on servers with no control panel</h4><p>This module is integrated into httpd Apache rpm provided by Cloudlinux OS by default.</p><p>If you are using an alternative Apache - <a href="https://www.cloudlinux.com/cloudlinux-os-blog/entry/httpd24-updated-for-cloudlinux-6" target="_blank" rel="noopener noreferrer">httpd24</a>, nothing has to be done as this module is also integrated into httpd24-httpd Apache rpm provided by Cloudlinux by default.</p></div><div class="page-edit"><div class="edit-link"><img src="/global/pen.svg" alt="icon pen"><a href="https://github.com/cloudlinux/cloudlinux-documentation/tree/master/docs/cloudlinuxos/cloudlinux_os_components/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a></div></div><div class="back-to-top" data-v-1eb13e00><a class="nav-arrow top back-to-top__link" data-v-1eb13e00><span class="back-to-top__link-span" data-v-1eb13e00>Scroll up</span></a></div><!--[--><!--]--></div><!----><div class="footer footer-default-layout" data-v-f2902e71><div class="footer__img" data-v-f2902e71><a href="https://cloudlinux.com" data-v-f2902e71><img src="/global/we-are-cloudlinux.svg" data-v-f2902e71></a></div><div class="footer-company-title" data-v-f2902e71>2026. CloudLinux Inc </div><div class="social" data-v-f2902e71><div class="social_links" data-v-f2902e71><!--[--><a href="https://cloudlinux.zendesk.com/hc/en-us/categories/360002375940" target="_blank" data-v-f2902e71>Knowledge base</a><a href="https://forum.cloudlinux.com/" target="_blank" data-v-f2902e71>Forum</a><a href="https://blog.cloudlinux.com/" target="_blank" data-v-f2902e71>Blog</a><a href="https://www.cloudlinux.com/privacy-policy/" target="_blank" data-v-f2902e71>Privacy Policy</a><!--]--></div><span class="footer-social-text" data-v-f2902e71>Stay in touch</span><div class="social-icons-wrapper" data-v-f2902e71><!--[--><a class="social-icons-link" href="https://www.facebook.com/cloudlinux/" target="_blank" data-v-f2902e71><img class="social-icons-link-img" src="/footer-social/fb.png" alt="footer logo" data-v-f2902e71></a><a class="social-icons-link" href="https://twitter.com/cloudlinuxos/" target="_blank" data-v-f2902e71><img class="social-icons-link-img" src="/footer-social/tw.png" alt="footer logo" data-v-f2902e71></a><a class="social-icons-link" href="https://linkedin.com/company/cloudlinux" target="_blank" data-v-f2902e71><img class="social-icons-link-img" src="/footer-social/in.png" alt="footer logo" data-v-f2902e71></a><a class="social-icons-link" href="https://www.youtube.com/channel/UCZ3YMHWnMP7TaxlXVay5-aw" target="_blank" data-v-f2902e71><img class="social-icons-link-img" src="/footer-social/ytube.png" alt="footer logo" data-v-f2902e71></a><!--]--></div></div></div></div><div id="bot-ui" data-v-8f754991><!-- Conditionally show toggle button with highlight --><div class="toggle-container" style="" data-v-8f754991><div class="pulse-ring" data-v-8f754991></div><button class="chat-toggle" data-v-8f754991><img src="/assets/bot-icon-c9c7c2f6.webp" alt="Bot icon" class="bot-icon" data-v-8f754991></button><div class="highlight-container" data-v-8f754991><div class="tooltip-text" data-v-8f754991><div class="tooltip-close" data-v-8f754991>×</div><div class="tooltip-title" data-v-8f754991><b data-v-8f754991>Need help?</b></div><div class="tooltip-subtitle" data-v-8f754991>I&#39;m a multilingual AI chatbot, trained to answer all your questions!</div></div></div></div><!----></div><div class="user-global-copy-code-root"></div><!--]--></div>
    <script type="module" src="/assets/app-a6b4ef15.js" defer></script>
  </body>
</html>
